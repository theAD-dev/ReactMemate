import React, { useState } from "react";
import { CardElement, useStripe, useElements, Elements } from "@stripe/react-stripe-js";
import { loadStripe } from "@stripe/stripe-js";
import { Button } from 'primereact/button';
import { Dialog } from 'primereact/dialog';
import { Divider } from 'primereact/divider';
import { ProgressSpinner } from "primereact/progressspinner";
import style from './change-payment-method.module.scss';
import { updatePaymentMethodInfo } from "../../../../../APIs/SettingsGeneral";

const stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISH_KEY);

const Wrapper = ({ setVisible, refetch }) => {
  const stripe = useStripe();
  const elements = useElements();

  const [error, setError] = useState(null);
  const [isPending, setIsPending] = useState(false);

  const handleSubmit = async (event) => {
    console.log('event: ', event);
    event.preventDefault();
    setIsPending(true);
    const cardElement = elements.getElement(CardElement);
    const { error, paymentMethod } = await stripe.createPaymentMethod({
      type: "card",
      card: cardElement,
    });

    if (error) {
      console.error(error.message);
      setError(error.message);
      setIsPending(false);
    } else {
      console.log("PaymentMethod:", paymentMethod);
      updatePaymentMethodInfo({ payment_method: paymentMethod.id })
        .then(() => {
          setVisible(false);
          refetch();
          setIsPending(false);
        })
        .catch((err) => {
          console.error("Error submitting form:", err);
          setError(err.message);
          setIsPending(false);
        });
    }
  };
  
  return (
    <div>
      {error && <div>
        <div className="d-flex gap-2 border rounded p-3">
          <svg width="39" height="39" viewBox="0 0 39 39" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g opacity="0.1">
              <rect x="1.5" y="1.5" width="36" height="36" rx="18" stroke="#D92D20" strokeWidth="2" />
            </g>
            <path d="M19.5 28.25C14.6675 28.25 10.75 24.3325 10.75 19.5C10.75 14.6675 14.6675 10.75 19.5 10.75C24.3325 10.75 28.25 14.6675 28.25 19.5C28.25 24.3325 24.3325 28.25 19.5 28.25ZM19.5 29.5C25.0228 29.5 29.5 25.0228 29.5 19.5C29.5 13.9772 25.0228 9.5 19.5 9.5C13.9772 9.5 9.5 13.9772 9.5 19.5C9.5 25.0228 13.9772 29.5 19.5 29.5Z" fill="#D92D20" />
            <path d="M18.2519 23.25C18.2519 22.5596 18.8116 22 19.5019 22C20.1923 22 20.7519 22.5596 20.7519 23.25C20.7519 23.9404 20.1923 24.5 19.5019 24.5C18.8116 24.5 18.2519 23.9404 18.2519 23.25Z" fill="#D92D20" />
            <path d="M18.3744 15.7438C18.3078 15.0779 18.8307 14.5 19.5 14.5C20.1693 14.5 20.6922 15.0779 20.6256 15.7438L20.1872 20.1281C20.1519 20.4811 19.8548 20.75 19.5 20.75C19.1452 20.75 18.8481 20.4811 18.8128 20.1281L18.3744 15.7438Z" fill="#D92D20" />
          </svg>
          <div className="d-flex flex-column">
            <p className="font-14 mb-2" style={{ fontWeight: 600 }}>Payment Failed</p>
            <p className="mb-0">{error}</p>
          </div>
        </div>
      </div>
      }

      <div className="d-flex justify-content-center">
        <div className={style.cardElement}>
          <div className="d-flex justify-content-between align-items-center w-100 p-4">
            <div className={style.cardLogo}>
              <svg xmlns="http://www.w3.org/2000/svg" width="42" height="22" viewBox="0 0 42 22" fill="none">
                <g clipPath="url(#clip0_16600_25013)">
                  <path d="M12.395 0.770752C13.3438 0.770752 14.0993 1.06359 14.6615 1.64926C15.2355 2.22322 15.5224 3.08415 15.5224 4.23206V10.3289H12.395V4.95243C12.395 4.35505 12.2837 3.92165 12.0611 3.65225C11.8386 3.38285 11.5106 3.24815 11.0772 3.24815C10.6438 3.24815 10.2807 3.42384 9.98786 3.77524C9.70673 4.11493 9.56618 4.62447 9.56618 5.30384V10.3289H6.45627V4.95243C6.45627 4.35505 6.34499 3.92165 6.12243 3.65225C5.89988 3.38285 5.5719 3.24815 5.13852 3.24815C4.70512 3.24815 4.342 3.42384 4.04916 3.77524C3.76804 4.11493 3.62749 4.62447 3.62749 5.30384V10.3289H0.5V0.999164H3.50448V2.26421H3.57477C4.26586 1.26857 5.22635 0.770752 6.45627 0.770752C7.0888 0.770752 7.63932 0.905454 8.10785 1.17487C8.57639 1.43256 8.93952 1.82496 9.19721 2.35207C9.60717 1.87182 10.0581 1.49112 10.5501 1.21001C11.0421 0.917165 11.657 0.770752 12.395 0.770752ZM25.7266 7.51768C25.6095 7.99793 25.3634 8.47232 24.9886 8.94086C24.6138 9.39768 24.0866 9.78422 23.4074 10.1005C22.728 10.405 21.8963 10.5573 20.9123 10.5573C19.3545 10.5573 18.1363 10.1239 17.2577 9.25712C16.3793 8.39032 15.94 7.20142 15.94 5.69039C15.94 4.15594 16.3733 2.9553 17.2402 2.08852C18.1186 1.21001 19.3369 0.770752 20.8948 0.770752C22.4292 0.770752 23.6358 1.1983 24.5142 2.05337C25.4045 2.90846 25.8495 4.13835 25.8495 5.74309L25.8321 6.28777H19.1554C19.1554 6.97886 19.3134 7.52939 19.6297 7.93935C19.9577 8.33762 20.3853 8.53674 20.9123 8.53674C21.3926 8.53674 21.7616 8.4196 22.0193 8.18533C22.2769 7.95107 22.4468 7.6641 22.5288 7.32441L25.7266 7.51768ZM20.8948 2.7386C20.3795 2.7386 19.9694 2.9026 19.6649 3.23056C19.3603 3.54683 19.1963 3.96852 19.1728 4.49561H22.6343C22.6108 3.96852 22.441 3.54683 22.1247 3.23056C21.8201 2.9026 21.4102 2.7386 20.8948 2.7386ZM12.395 12.0943C13.3438 12.0943 14.0993 12.3871 14.6615 12.9728C15.2355 13.5468 15.5224 14.4076 15.5224 15.5557V21.6524H12.395V16.276C12.395 15.6786 12.2837 15.2452 12.0611 14.9757C11.8386 14.7064 11.5106 14.5717 11.0772 14.5717C10.6438 14.5717 10.2807 14.7473 9.98786 15.0989C9.70673 15.4384 9.56618 15.948 9.56618 16.6274V21.6524H6.45627V16.276C6.45627 15.6786 6.34499 15.2452 6.12243 14.9757C5.89988 14.7064 5.5719 14.5717 5.13852 14.5717C4.70512 14.5717 4.342 14.7473 4.04916 15.0989C3.76804 15.4384 3.62749 15.948 3.62749 16.6274V21.6524H0.5V12.3227H3.50448V13.5877H3.57477C4.26586 12.5921 5.22635 12.0943 6.45627 12.0943C7.0888 12.0943 7.63932 12.229 8.10785 12.4984C8.57639 12.7561 8.93952 13.1485 9.19721 13.6756C9.60717 13.1953 10.0581 12.8147 10.5501 12.5335C11.0421 12.2407 11.657 12.0943 12.395 12.0943ZM22.318 21.6524C22.1422 21.4416 22.0544 20.9906 22.0544 20.2996C21.8319 20.7915 21.4453 21.178 20.8948 21.4591C20.356 21.7403 19.7351 21.8808 19.0323 21.8808C18.4936 21.8808 17.984 21.7695 17.5038 21.547C17.0235 21.3245 16.637 21.0081 16.3441 20.5982C16.0513 20.1883 15.9049 19.7022 15.9049 19.1399C15.9049 18.1911 16.2153 17.4825 16.8362 17.014C17.4568 16.5454 18.3998 16.2291 19.6649 16.0651C20.3091 15.9714 20.801 15.8836 21.1407 15.8016C21.4804 15.7079 21.7147 15.6082 21.8436 15.5029C21.9842 15.3858 22.0544 15.2334 22.0544 15.0461C22.0544 14.7532 21.9372 14.5307 21.703 14.3784C21.4804 14.2145 21.1642 14.1325 20.7543 14.1325C20.3795 14.1325 20.0514 14.2378 19.7702 14.4487C19.4891 14.6595 19.2901 14.9583 19.1728 15.3447L16.2739 15.0461C16.473 14.1207 16.9767 13.4003 17.7849 12.8849C18.5931 12.3578 19.6004 12.0943 20.807 12.0943C22.2477 12.0943 23.337 12.3754 24.075 12.9376C24.8129 13.4882 25.1819 14.273 25.1819 15.292V19.913C25.1819 20.4167 25.1936 20.7973 25.217 21.055C25.2521 21.3011 25.3225 21.5002 25.4278 21.6524H22.318ZM22.0544 17.2599C21.9256 17.3419 21.7147 17.4181 21.4219 17.4883C21.1291 17.5468 20.807 17.6054 20.4555 17.664C19.5418 17.8396 19.085 18.2497 19.085 18.8939C19.085 19.2101 19.1847 19.462 19.3838 19.6495C19.5946 19.8251 19.8699 19.913 20.2096 19.913C20.4907 19.913 20.7717 19.8486 21.0529 19.7197C21.334 19.5909 21.5683 19.3918 21.7557 19.1223C21.9549 18.8413 22.0544 18.4898 22.0544 18.068V17.2599ZM31.7873 19.3507V21.6524C31.5999 21.6759 30.9674 21.6875 29.8898 21.6875C29.1283 21.6875 28.5309 21.6231 28.0976 21.4942C27.6758 21.3538 27.3596 21.1078 27.1488 20.7564C26.9497 20.4049 26.85 19.8895 26.85 19.2101V14.273H25.427V12.3227H26.85V9.75746H29.96V12.3227H31.8224V14.273H29.96V18.4723C29.96 18.8471 30.0362 19.0872 30.1884 19.1926C30.3524 19.2981 30.657 19.3507 31.102 19.3507H31.7873ZM41.603 18.8413C41.4859 19.3214 41.2398 19.7959 40.865 20.2643C40.4902 20.7211 39.963 21.1078 39.2838 21.424C38.6043 21.7286 37.7727 21.8808 36.7887 21.8808C35.2309 21.8808 34.0127 21.4475 33.1341 20.5806C32.2557 19.7138 31.8164 18.5249 31.8164 17.014C31.8164 15.4795 32.2497 14.2789 33.1166 13.412C33.995 12.5335 35.2133 12.0943 36.7712 12.0943C38.3056 12.0943 39.5122 12.5218 40.3906 13.3769C41.2809 14.232 41.7259 15.4619 41.7259 17.0666L41.7085 17.6112H35.0318C35.0318 18.3024 35.1898 18.8529 35.5061 19.2628C35.8341 19.6611 36.2617 19.8602 36.7887 19.8602C37.269 19.8602 37.638 19.7431 37.8957 19.5089C38.1533 19.2746 38.3232 18.9877 38.4052 18.648L41.603 18.8413ZM36.7712 14.0621C36.2558 14.0621 35.8458 14.2261 35.5413 14.554C35.2367 14.8704 35.0727 15.292 35.0492 15.8192H38.5107C38.4872 15.292 38.3174 14.8704 38.0011 14.554C37.6965 14.2261 37.2866 14.0621 36.7712 14.0621Z" fill="white" />
                </g>
                <defs>
                  <clipPath id="clip0_16600_25013">
                    <rect width="41.25" height="21.2316" fill="white" transform="translate(0.527344 0.770752)" />
                  </clipPath>
                </defs>
              </svg>
            </div>
            <div className={style.chip}>
              <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25" fill="none">
                <path d="M12.4219 2.51013C6.90188 2.51013 2.42188 6.99013 2.42188 12.5101C2.42188 18.0301 6.90188 22.5101 12.4219 22.5101C17.9419 22.5101 22.4219 18.0301 22.4219 12.5101C22.4219 6.99013 17.9419 2.51013 12.4219 2.51013ZM9.17188 14.1901C9.04188 14.6201 8.55188 14.8201 8.15188 14.6401C7.81188 14.4801 7.64187 14.1001 7.75187 13.7401C7.87187 13.3301 7.93187 12.9101 7.92188 12.5001C7.91188 12.0901 7.86187 11.7001 7.75187 11.3201C7.65187 10.9601 7.81188 10.5701 8.15188 10.4201C8.57188 10.2301 9.06188 10.4601 9.19188 10.9101C9.34188 11.4201 9.41188 11.9401 9.42188 12.4801C9.42188 13.0401 9.34188 13.6201 9.17188 14.1901ZM12.3119 15.7801C12.1419 16.1901 11.6419 16.3501 11.2519 16.1301C10.9219 15.9401 10.7919 15.5401 10.9319 15.1901C11.2619 14.4201 11.4219 13.5601 11.4219 12.6301C11.4219 11.6701 11.2419 10.7401 10.8919 9.85013C10.7519 9.49013 10.9119 9.09013 11.2519 8.91013C11.6419 8.71013 12.1219 8.89013 12.2819 9.30013C12.7019 10.3601 12.9119 11.4801 12.9119 12.6301C12.9319 13.7601 12.7219 14.8201 12.3119 15.7801ZM15.4219 17.1101C15.2519 17.5101 14.7819 17.6901 14.4019 17.5001C14.0519 17.3301 13.8819 16.9101 14.0319 16.5501C14.6219 15.1601 14.9219 13.8001 14.9219 12.4901C14.9219 11.1801 14.6219 9.84013 14.0419 8.48013C13.8819 8.12013 14.0519 7.70013 14.4019 7.53013C14.7919 7.33013 15.2519 7.51013 15.4219 7.91013C16.0819 9.45013 16.4219 10.9901 16.4219 12.4901C16.4219 13.9901 16.0819 15.5501 15.4219 17.1101Z" fill="white" />
              </svg>
            </div>
          </div>
          <div className="d-flex justify-content-between align-items-end w-100 p-4">
            <div className={`${style.cardDetails}`}>
              <p className="mb-1 ms-1" style={{ color: '#FFF', fontWeight: 500, fontSize: '10px' }}>John Smith</p>
              <div className="d-flex align-items-center justify-content-start gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25" fill="none">
                  <path d="M6.52734 10.5835C5.42734 10.5835 4.52734 11.4835 4.52734 12.5835C4.52734 13.6835 5.42734 14.5835 6.52734 14.5835C7.62734 14.5835 8.52734 13.6835 8.52734 12.5835C8.52734 11.4835 7.62734 10.5835 6.52734 10.5835ZM18.5273 10.5835C17.4273 10.5835 16.5273 11.4835 16.5273 12.5835C16.5273 13.6835 17.4273 14.5835 18.5273 14.5835C19.6273 14.5835 20.5273 13.6835 20.5273 12.5835C20.5273 11.4835 19.6273 10.5835 18.5273 10.5835ZM12.5273 10.5835C11.4273 10.5835 10.5273 11.4835 10.5273 12.5835C10.5273 13.6835 11.4273 14.5835 12.5273 14.5835C13.6273 14.5835 14.5273 13.6835 14.5273 12.5835C14.5273 11.4835 13.6273 10.5835 12.5273 10.5835Z" fill="white" />
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25" fill="none">
                  <path d="M6.52734 10.5835C5.42734 10.5835 4.52734 11.4835 4.52734 12.5835C4.52734 13.6835 5.42734 14.5835 6.52734 14.5835C7.62734 14.5835 8.52734 13.6835 8.52734 12.5835C8.52734 11.4835 7.62734 10.5835 6.52734 10.5835ZM18.5273 10.5835C17.4273 10.5835 16.5273 11.4835 16.5273 12.5835C16.5273 13.6835 17.4273 14.5835 18.5273 14.5835C19.6273 14.5835 20.5273 13.6835 20.5273 12.5835C20.5273 11.4835 19.6273 10.5835 18.5273 10.5835ZM12.5273 10.5835C11.4273 10.5835 10.5273 11.4835 10.5273 12.5835C10.5273 13.6835 11.4273 14.5835 12.5273 14.5835C13.6273 14.5835 14.5273 13.6835 14.5273 12.5835C14.5273 11.4835 13.6273 10.5835 12.5273 10.5835Z" fill="white" />
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25" fill="none">
                  <path d="M6.52734 10.5835C5.42734 10.5835 4.52734 11.4835 4.52734 12.5835C4.52734 13.6835 5.42734 14.5835 6.52734 14.5835C7.62734 14.5835 8.52734 13.6835 8.52734 12.5835C8.52734 11.4835 7.62734 10.5835 6.52734 10.5835ZM18.5273 10.5835C17.4273 10.5835 16.5273 11.4835 16.5273 12.5835C16.5273 13.6835 17.4273 14.5835 18.5273 14.5835C19.6273 14.5835 20.5273 13.6835 20.5273 12.5835C20.5273 11.4835 19.6273 10.5835 18.5273 10.5835ZM12.5273 10.5835C11.4273 10.5835 10.5273 11.4835 10.5273 12.5835C10.5273 13.6835 11.4273 14.5835 12.5273 14.5835C13.6273 14.5835 14.5273 13.6835 14.5273 12.5835C14.5273 11.4835 13.6273 10.5835 12.5273 10.5835Z" fill="white" />
                </svg>
                <span style={{ color: '#FFF', fontWeight: 500, fontSize: '10px' }}>1234</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 13 13" fill="none">
                  <g clipPath="url(#clip0_16600_38176)">
                    <path d="M8.77734 1.0835H2.77734C2.22734 1.0835 1.77734 1.5335 1.77734 2.0835V9.0835H2.77734V2.0835H8.77734V1.0835ZM10.2773 3.0835H4.77734C4.22734 3.0835 3.77734 3.5335 3.77734 4.0835V11.0835C3.77734 11.6335 4.22734 12.0835 4.77734 12.0835H10.2773C10.8273 12.0835 11.2773 11.6335 11.2773 11.0835V4.0835C11.2773 3.5335 10.8273 3.0835 10.2773 3.0835ZM10.2773 11.0835H4.77734V4.0835H10.2773V11.0835Z" fill="white" />
                  </g>
                  <defs>
                    <clipPath id="clip0_16600_38176">
                      <rect width="12" height="12" fill="white" transform="translate(0.527344 0.583496)" />
                    </clipPath>
                  </defs>
                </svg>
              </div>
              <div className="d-flex align-items-center justify-content-start gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25" fill="none">
                  <path d="M6.52734 10.5835C5.42734 10.5835 4.52734 11.4835 4.52734 12.5835C4.52734 13.6835 5.42734 14.5835 6.52734 14.5835C7.62734 14.5835 8.52734 13.6835 8.52734 12.5835C8.52734 11.4835 7.62734 10.5835 6.52734 10.5835ZM18.5273 10.5835C17.4273 10.5835 16.5273 11.4835 16.5273 12.5835C16.5273 13.6835 17.4273 14.5835 18.5273 14.5835C19.6273 14.5835 20.5273 13.6835 20.5273 12.5835C20.5273 11.4835 19.6273 10.5835 18.5273 10.5835ZM12.5273 10.5835C11.4273 10.5835 10.5273 11.4835 10.5273 12.5835C10.5273 13.6835 11.4273 14.5835 12.5273 14.5835C13.6273 14.5835 14.5273 13.6835 14.5273 12.5835C14.5273 11.4835 13.6273 10.5835 12.5273 10.5835Z" fill="white" />
                </svg>
                <span style={{ color: '#FFF', fontWeight: 500, fontSize: '10px' }}>10/24</span>
              </div>
            </div>
            <div className={style.cardType}>
              <svg xmlns="http://www.w3.org/2000/svg" width="36" height="12" viewBox="0 0 36 12" fill="none">
                <path d="M15.9349 11.661H13.0938L14.8708 0.660889H17.7117L15.9349 11.661Z" fill="white" />
                <path d="M26.2335 0.929868C25.6731 0.707295 24.7843 0.461548 23.6853 0.461548C20.8796 0.461548 18.9038 1.95936 18.8917 4.10079C18.8684 5.68072 20.3063 6.55826 21.3817 7.08506C22.4809 7.62337 22.8545 7.97473 22.8545 8.45456C22.8433 9.19149 21.9663 9.53118 21.1483 9.53118C20.014 9.53118 19.4063 9.35604 18.4826 8.94605L18.1085 8.7703L17.7109 11.2396C18.3773 11.5435 19.605 11.8132 20.8796 11.825C23.8607 11.825 25.8015 10.3504 25.8244 8.06836C25.8358 6.81614 25.0765 5.85663 23.4396 5.07258C22.4459 4.56926 21.8374 4.22988 21.8374 3.7149C21.849 3.24674 22.3521 2.76722 23.4738 2.76722C24.3974 2.74373 25.0761 2.96599 25.5902 3.18841L25.8471 3.30522L26.2335 0.929868Z" fill="white" />
                <path d="M30.0129 7.76407C30.2468 7.13213 31.1472 4.68632 31.1472 4.68632C31.1353 4.70981 31.3807 4.04271 31.521 3.63319L31.7195 4.58102C31.7195 4.58102 32.2575 7.2141 32.3744 7.76407C31.9303 7.76407 30.574 7.76407 30.0129 7.76407ZM33.5198 0.660889H31.3222C30.6446 0.660889 30.1297 0.859664 29.8373 1.57358L25.6172 11.6609H28.5983C28.5983 11.6609 29.0891 10.3032 29.1946 10.0108C29.5216 10.0108 32.4216 10.0108 32.8423 10.0108C32.9239 10.397 33.1813 11.6609 33.1813 11.6609H35.8119L33.5198 0.660889Z" fill="white" />
                <path d="M10.7215 0.660889L7.93911 8.16194L7.63506 6.64064C7.12066 4.88525 5.50737 2.97807 3.70703 2.02976L6.2556 11.6494H9.26L13.7257 0.660889H10.7215Z" fill="white" />
                <path d="M5.35612 0.660889H0.785045L0.738281 0.88315C4.30401 1.79599 6.66552 3.99636 7.63576 6.6411L6.64206 1.58555C6.47846 0.882994 5.97571 0.684064 5.35612 0.660889Z" fill="white" />
              </svg>
            </div>
          </div>
        </div>
      </div>

      <form onSubmit={handleSubmit} className="mt-4">
        <label style={{ color: '#475467', fontSize: '14px', fontWeight: '500', marginBottom: '6px' }}>Card Information</label>
        <CardElement
          options={{
            hidePostalCode: true
          }}
        />

        <div className="d-flex justify-content-center gap-2 mt-3">
          <span style={{ color: '#635BFF', fontWeight: 500 }} className="font-14">Powerd by:</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="49" height="21" viewBox="0 0 49 21" fill="none">
            <g clipPath="url(#clip0_16444_92705)">
              <path fillRule="evenodd" clipRule="evenodd" d="M48.5227 10.7117C48.5227 7.29472 46.8676 4.59851 43.7042 4.59851C40.5275 4.59851 38.6055 7.29472 38.6055 10.685C38.6055 14.7026 40.8746 16.7315 44.1314 16.7315C45.7197 16.7315 46.921 16.3711 47.8286 15.8639V13.1943C46.921 13.6482 45.8799 13.9285 44.5585 13.9285C43.2638 13.9285 42.1159 13.4746 41.9691 11.8996H48.496C48.496 11.7261 48.5227 11.032 48.5227 10.7117ZM41.929 9.44368C41.929 7.9354 42.85 7.30807 43.6909 7.30807C44.5051 7.30807 45.3727 7.9354 45.3727 9.44368H41.929Z" fill="#635BFF" />
              <path fillRule="evenodd" clipRule="evenodd" d="M33.4527 4.59851C32.1446 4.59851 31.3037 5.2125 30.8365 5.63962L30.663 4.81207H27.7266V20.3753L31.0635 19.6679L31.0768 15.8906C31.5573 16.2376 32.2647 16.7315 33.4393 16.7315C35.8285 16.7315 38.0042 14.8094 38.0042 10.5782C37.9908 6.70743 35.7885 4.59851 33.4527 4.59851ZM32.6518 13.795C31.8643 13.795 31.3971 13.5147 31.0768 13.1677L31.0635 8.2157C31.4105 7.82862 31.891 7.56167 32.6518 7.56167C33.8664 7.56167 34.7073 8.92312 34.7073 10.6717C34.7073 12.4602 33.8798 13.795 32.6518 13.795Z" fill="#635BFF" />
              <path fillRule="evenodd" clipRule="evenodd" d="M23.1367 3.81106L26.487 3.09029V0.380737L23.1367 1.08816V3.81106Z" fill="#635BFF" />
              <path d="M26.487 4.82544H23.1367V16.5046H26.487V4.82544Z" fill="#635BFF" />
              <path fillRule="evenodd" clipRule="evenodd" d="M19.5459 5.81319L19.3323 4.82547H16.4492V16.5046H19.7861V8.58948C20.5736 7.56172 21.9084 7.74859 22.3221 7.89541V4.82547C21.895 4.6653 20.3334 4.37165 19.5459 5.81319Z" fill="#635BFF" />
              <path fillRule="evenodd" clipRule="evenodd" d="M12.8717 1.92908L9.61491 2.62315L9.60156 13.3146C9.60156 15.29 11.0831 16.7449 13.0586 16.7449C14.1531 16.7449 14.9539 16.5447 15.3944 16.3044V13.5949C14.9673 13.7684 12.8584 14.3824 12.8584 12.4069V7.66853H15.3944V4.8255H12.8584L12.8717 1.92908Z" fill="#635BFF" />
              <path fillRule="evenodd" clipRule="evenodd" d="M3.84959 8.2157C3.84959 7.69515 4.27671 7.49493 4.98414 7.49493C5.99855 7.49493 7.27992 7.80193 8.29433 8.34918V5.2125C7.18648 4.77203 6.09198 4.59851 4.98414 4.59851C2.27458 4.59851 0.472656 6.01335 0.472656 8.37587C0.472656 12.0598 5.54473 11.4725 5.54473 13.0609C5.54473 13.6749 5.01083 13.8751 4.26337 13.8751C3.15552 13.8751 1.74068 13.4213 0.619479 12.8073V15.984C1.8608 16.5179 3.11548 16.7448 4.26337 16.7448C7.03966 16.7448 8.94836 15.37 8.94836 12.9808C8.93502 9.00321 3.84959 9.71063 3.84959 8.2157Z" fill="#635BFF" />
            </g>
            <defs>
              <clipPath id="clip0_16444_92705">
                <rect width="48.0539" height="20" fill="white" transform="translate(0.472656 0.380737)" />
              </clipPath>
            </defs>
          </svg>
        </div>

        <Divider className="mt-5" />
        <div className="d-flex justify-content-between gap-2">
          <Button type='button' className='text-button text-danger bg-transparent' style={{ minWidth: '70px', borderRadius: '28px' }}>Cancel</Button>
          <Button disabled={isPending} type='submit' className='solid-button' style={{ minWidth: '70px', borderRadius: '28px' }}>
            Save Details
            {isPending && <ProgressSpinner className='me-2' style={{ width: '18px', height: '18px' }} />}
          </Button>
        </div>
      </form>
    </div>
  );
};

const ChangePaymentMethod = ({ visible, setVisible, refetch }) => {
  const headerElement = (
    <div className={`${style.modalHeader}`}>
      <svg width="57" height="57" viewBox="0 0 57 57" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="4.5" y="4.5" width="48" height="48" rx="24" fill="#BAE8FF" />
        <rect x="4.5" y="4.5" width="48" height="48" rx="24" stroke="#EBF8FF" strokeWidth="8" />
        <path d="M39.7524 19.409C40.0453 19.7019 40.0453 20.1768 39.7524 20.4697L38.1881 22.034L35.1881 19.034L36.7524 17.4697C37.0453 17.1768 37.5202 17.1768 37.8131 17.4697L39.7524 19.409Z" fill="#1AB2FF" />
        <path d="M37.1274 23.0947L34.1274 20.0947L23.9079 30.3141C23.8256 30.3965 23.7636 30.4968 23.7267 30.6073L22.5199 34.2278C22.4222 34.521 22.7011 34.7999 22.9942 34.7022L26.6148 33.4953C26.7252 33.4585 26.8256 33.3965 26.9079 33.3141L37.1274 23.0947Z" fill="#1AB2FF" />
        <path fillRule="evenodd" clipRule="evenodd" d="M18 36.75C18 37.9926 19.0074 39 20.25 39H36.75C37.9926 39 39 37.9926 39 36.75V27.75C39 27.3358 38.6642 27 38.25 27C37.8358 27 37.5 27.3358 37.5 27.75V36.75C37.5 37.1642 37.1642 37.5 36.75 37.5H20.25C19.8358 37.5 19.5 37.1642 19.5 36.75V20.25C19.5 19.8358 19.8358 19.5 20.25 19.5H30C30.4142 19.5 30.75 19.1642 30.75 18.75C30.75 18.3358 30.4142 18 30 18H20.25C19.0074 18 18 19.0074 18 20.25V36.75Z" fill="#1AB2FF" />
      </svg>
      <span className={`white-space-nowrap ${style.headerTitle}`}>Edit Payment Method</span>
    </div>
  );

  return (
    <Dialog visible={visible} modal header={headerElement} className={`${style.modal} custom-modal`} onHide={() => { setVisible(false); }}>
      <Elements stripe={stripePromise}>
        <Wrapper setVisible={setVisible} refetch={refetch} />
      </Elements>
    </Dialog>
  );
};

export default ChangePaymentMethod;