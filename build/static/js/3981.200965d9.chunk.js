"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[3981],{33981:(e,t,s)=>{s.d(t,{A:()=>U});var a=s(65043),n=s(93202),o=s(56741),r=s(95192),l=s(93747),i=s(47097),d=s(58387),c=s(88060),u=s(93740),h=s(20288),p=s(14282),m=s(78602),x=s(29853),v=s(61072),f=s(56328);const g="create-task_circleDesignStyle__vtKho",j="create-task_out__LG-iY",y="create-task_taskTitleInput__s+lNu",b="create-task_formLabel__04J0h",w="create-task_taskDescriptionInput__RZWSI",k="create-task_projectDropdown__qXb5+";var D=s(10586),_=s(79106),A=s(72796),N=s(57189),S=s(58027),T=s(63040),C=s(83738),E=s(70579);const R=(e,t)=>{const s={month:"short",day:"numeric"};return`${new Date(e).toLocaleDateString("en-US",s)} - ${new Date(t).toLocaleDateString("en-US",s)}`},$=e=>{let{startDate:t,endDate:s}=e;return(0,E.jsx)("div",{className:"dateSelectdTaskBar",children:R(t,s)})},L=e=>{let{setDateRange:t,dateRange:s}=e;console.log("dateRange: ",s);const[n,o]=(0,a.useState)(!1),r=(0,a.useRef)(null),l=e=>{r.current&&!r.current.contains(e.target)&&o(!1)};return(0,a.useEffect)((()=>(n?document.addEventListener("mousedown",l):document.removeEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)})),[n]),(0,E.jsxs)("div",{className:"select-date",style:{position:"relative"},ref:r,children:[(0,E.jsx)("div",{onClick:()=>o((e=>!e)),style:{cursor:"pointer"},children:null!==s&&void 0!==s&&s.startDate&&null!==s&&void 0!==s&&s.endDate?(0,E.jsx)($,{startDate:s.startDate,endDate:s.endDate}):(0,E.jsx)("div",{style:{border:"1px dashed #98A2B3",width:"24px",height:"24px",borderRadius:"50%"},className:"iconStyleCircle d-flex justify-content-center align-items-center iconStyleCircleRight "+(n?"active":""),children:(0,E.jsx)(T.A,{color:n?"#1AB2FF":"#475467",size:14})})}),n&&(0,E.jsx)("div",{className:"select-date-range",style:{position:"absolute",top:"-100px",background:"#fff",zIndex:1e3},children:(0,E.jsx)(C.s,{onDataApply:e=>{t(e),o(!1)},dateRange:s,onClose:()=>o(!1)})})]})},I=e=>{if(!e)return null;return new Date(1e3*+e)},U=e=>{let{show:t,setShow:s,refetch:T,taskId:C,setTaskId:R,defaultValue:$,projectId:U}=e;const P=(0,a.useRef)(null),F=(0,a.useRef)(null),q=(0,a.useRef)(null),{session:z}=(0,N.As)(),[B,G]=(0,a.useState)(!1),[H,M]=(0,a.useState)(""),[O,K]=(0,a.useState)(""),[W,V]=(0,a.useState)(""),[J,Y]=(0,a.useState)(null),[X,Z]=(0,a.useState)(null),[Q,ee]=(0,a.useState)([]),[te,se]=(0,a.useState)(""),[ae,ne]=(0,a.useState)(!1),[oe,re]=(0,a.useState)({taskTitle:!1,description:!1,project:!1,user:!1,date:!1});(0,a.useEffect)((()=>{var e,t;C&&$&&(M(null===$||void 0===$?void 0:$.title),K(null===$||void 0===$?void 0:$.description),V(null===$||void 0===$||null===(e=$.project)||void 0===e?void 0:e.id),Y(null===$||void 0===$||null===(t=$.user)||void 0===t?void 0:t.id),Z({startDate:I(null===$||void 0===$?void 0:$.from_date),endDate:I(null===$||void 0===$?void 0:$.to_date)}),le(C))}),[C,$]);const le=async e=>{try{await new Promise((e=>setTimeout(e,300)));const t=[{id:1,task_id:e,user:{first_name:"Timothy",last_name:"Garrager",photo:"",has_photo:!1},text:'Can we include a "custom quote" option for users ordering over a certain quantity? Might help capture more leads from enterprise buyers.',created_at:new Date(Date.now()-18e5).toISOString()},{id:2,task_id:e,user:{first_name:"Timothy",last_name:"Garrager",photo:"",has_photo:!1},text:'Can we include a "custom quote" option for users ordering over a certain quantity?',created_at:new Date(Date.now()-138e4).toISOString()}];ee(t)}catch(t){console.error("Error loading comments:",t)}},ie=()=>{M(""),K(""),V(""),Y(null),Z(null),ee([]),se(""),G(!1),re({taskTitle:!1,description:!1,project:!1,user:!1,date:!1})},de=(0,l.I)({queryKey:["getProjectsList"],queryFn:D.Bu}),ce=(0,l.I)({queryKey:["getUserList"],queryFn:_.aU}),ue=(0,l.I)({queryKey:["getMobileUserList"],queryFn:_.gy});(0,a.useEffect)((()=>{t||ie()}),[t]);const he=(0,i.n)({mutationFn:e=>C?(0,_.lC)(C,e):(0,_.Af)(e),onSuccess:()=>{T(),s(!1),ie(),C&&R(null),f.oR.success(`Task ${C?"updated":"created"} successfully`)},onError:e=>{console.error(`Error ${C?"updating":"creating"} task:`,e),f.oR.error(`Failed to ${C?"update":"create"} client. Please try again.`)}});(0,a.useEffect)((()=>{if(B){re({taskTitle:!H,description:!O,project:!W,user:!J,date:!X})}}),[H,O,W,J,X,B]);const pe=()=>{G(!0);const e={taskTitle:!H,description:!O,project:!W,user:!J,date:!X};re(e),e.taskTitle||e.description||e.user||e.date||e.project||he.mutate({title:H,description:O,project:W,user:J,from_date:X.startDate,to_date:X.endDate})},me=(0,i.n)({mutationFn:()=>(0,A.mM)(C),onSuccess:()=>{console.log("Delete success"),s(!1),T()},onError:e=>{console.error("Error creating task:",e)}}),xe=()=>{me.mutate()},ve=()=>{s(!1),ie()};return(0,a.useEffect)((()=>{setTimeout((()=>{F.current&&(F.current.style.height="auto",F.current.style.height=F.current.scrollHeight+"px")}),200)}),[O,C]),(0,a.useEffect)((()=>{U&&V(+U)}),[U]),(0,E.jsx)(h.B,{visible:t,position:"right",onHide:()=>{s(!1)},modal:!1,dismissable:!1,style:{width:"591px",height:"97vh",borderRadius:"10px",marginRight:"10px"},content:e=>{var t,s,a,l,i,h,D,_,A,N,T,R;let{closeIconRef:$,hide:I}=e;return(0,E.jsxs)("div",{className:"create-sidebar d-flex flex-column",children:[(0,E.jsxs)("div",{className:"d-flex align-items-center justify-content-between flex-shrink-0",style:{borderBottom:"1px solid #EAECF0",padding:"24px"},children:[(0,E.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,E.jsx)("div",{className:g,children:(0,E.jsx)("div",{className:j,children:(0,E.jsx)(n.A,{size:24,color:"#17B26A"})})}),(0,E.jsxs)("span",{style:{color:"344054",fontSize:"20px",fontWeight:600},children:[C?"Update":"Create New"," Task"]})]}),(0,E.jsx)("span",{children:(0,E.jsx)(p.A,{type:"button",className:"text-button",ref:$,onClick:e=>I(e),children:(0,E.jsx)(o.A,{size:24,color:"#667085"})})})]}),(0,E.jsxs)("div",{className:"modal-body",style:{padding:"24px 24px",height:"calc(100vh - 72px - 122px - 75px)",overflow:"auto"},children:[(0,E.jsx)(x.A.Control,{type:"text",name:"taskTitle",id:"taskTitle",placeholder:"Enter task title",value:H,onChange:e=>M(e.target.value),className:y}),oe.taskTitle&&(0,E.jsx)(x.A.Text,{className:"error-message",children:"Task title is required"}),(0,E.jsxs)(v.A,{className:"mt-3",children:[(0,E.jsx)(m.A,{sm:4,className:"d-flex flex-column justify-content-center pt-2",children:(0,E.jsx)(x.A.Label,{className:b,children:"Assignee"})}),(0,E.jsxs)(m.A,{sm:8,className:"d-flex flex-column justify-content-center",children:[!J&&(0,E.jsx)("div",{className:"d-flex align-items-center justify-content-center",onClick:()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.show()},style:{border:"1px dashed #98A2B3",width:"24px",height:"24px",borderRadius:"50%"},children:(0,E.jsx)(r.A,{color:null!==(t=P.current)&&void 0!==t&&null!==(s=t.panel)&&void 0!==s&&null!==(a=s.element)&&void 0!==a&&a.offsetParent?"#1AB2FF":"#475467",size:18,className:"cursor-pointer"})}),(0,E.jsx)(c.m,{ref:P,options:[{label:"Desktop User",items:(null===ce||void 0===ce||null===(l=ce.data)||void 0===l||null===(i=l.users)||void 0===i||null===(h=i.filter((e=>null===e||void 0===e?void 0:e.is_active)))||void 0===h?void 0:h.map((e=>({value:null===e||void 0===e?void 0:e.id,label:`${null===e||void 0===e?void 0:e.first_name} ${null===e||void 0===e?void 0:e.last_name}`||(null===e||void 0===e?void 0:e.first_name)||"-",photo:(null===e||void 0===e?void 0:e.photo)||"",has_photo:null===e||void 0===e?void 0:e.has_photo}))))||[]},...null!==z&&void 0!==z&&z.has_work_subscription?[{label:"Mobile User",items:(null===ue||void 0===ue||null===(D=ue.data)||void 0===D||null===(_=D.users)||void 0===_||null===(A=_.filter((e=>"disconnected"!==(null===e||void 0===e?void 0:e.status))))||void 0===A?void 0:A.map((e=>({value:null===e||void 0===e?void 0:e.id,label:`${null===e||void 0===e?void 0:e.first_name} ${null===e||void 0===e?void 0:e.last_name}`||(null===e||void 0===e?void 0:e.first_name)||"-",photo:(null===e||void 0===e?void 0:e.photo)||"",has_photo:null===e||void 0===e?void 0:e.has_photo}))))||[]}]:[]],onChange:e=>{Y(e.value)},valueTemplate:e=>e?(0,E.jsxs)("div",{className:"d-flex gap-2 align-items-center",style:{position:"relative",left:"-10px"},children:[(0,E.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{width:"24px",height:"24px",borderRadius:"50%",overflow:"hidden",border:"1px solid #dedede"},children:(0,E.jsx)(S.A,{photo:null===e||void 0===e?void 0:e.photo,has_photo:null===e||void 0===e?void 0:e.has_photo,is_business:!1,size:17})}),null===e||void 0===e?void 0:e.label]}):null,itemTemplate:e=>(0,E.jsxs)("div",{className:"d-flex gap-2 align-items-center",children:[(0,E.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{width:"24px",height:"24px",borderRadius:"50%",overflow:"hidden",border:"1px solid #dedede"},children:(0,E.jsx)(S.A,{photo:null===e||void 0===e?void 0:e.photo,has_photo:null===e||void 0===e?void 0:e.has_photo,is_business:!1,size:17})}),null===e||void 0===e?void 0:e.label]}),className:"outline-none border-0 p-0",style:{width:J?"fit-content":"0px",height:J?"46px":"0px",zIndex:J?"1":"0",position:"relative",left:J?"-4px":"-60px",top:J?"0px":"-15px"},value:J,dropdownIcon:(0,E.jsx)(E.Fragment,{}),collapseIcon:(0,E.jsx)(E.Fragment,{}),placeholder:"Select project",filter:!0,filterInputAutoFocus:!0,optionGroupLabel:"label",optionGroupChildren:"items",scrollHeight:"400px"})]})]}),oe.user&&(0,E.jsx)(x.A.Text,{className:"error-message",children:"User is required"}),(0,E.jsxs)(v.A,{className:"mt-3",children:[(0,E.jsx)(m.A,{sm:4,className:"d-flex flex-column justify-content-center",children:(0,E.jsx)(x.A.Label,{className:b,children:"Due Date"})}),(0,E.jsx)(m.A,{sm:8,className:"d-flex flex-column justify-content-center",children:(0,E.jsx)(L,{dateRange:X,setDateRange:Z})})]}),oe.date&&(0,E.jsx)(x.A.Text,{className:"error-message",children:"Date is required"}),(0,E.jsxs)(v.A,{className:"mt-3",children:[(0,E.jsx)(m.A,{sm:4,className:"d-flex flex-column justify-content-center pt-3",children:(0,E.jsx)(x.A.Label,{className:b,children:"Link to Project"})}),(0,E.jsx)(m.A,{sm:8,className:"d-flex flex-column justify-content-center",children:(0,E.jsx)(c.m,{options:(null===de||void 0===de||null===(N=de.data)||void 0===N?void 0:N.map((e=>({value:e.id,label:`${e.number}: ${e.reference}`}))))||[],onChange:e=>{V(e.value)},className:(0,d.A)("outline-none",k),style:{height:"46px",maxWidth:"100%",width:"fit-content"},value:W,loading:null===de||void 0===de?void 0:de.isFetching,placeholder:"Select project",filter:!0,filterInputAutoFocus:!0})})]}),oe.project&&(0,E.jsx)(x.A.Text,{className:"error-message",children:"Project task is required"}),(0,E.jsxs)(v.A,{className:"mt-3",children:[(0,E.jsx)(m.A,{sm:4,children:(0,E.jsx)(x.A.Label,{className:b,children:"Description"})}),(0,E.jsx)(m.A,{sm:12,children:(0,E.jsx)(x.A.Control,{name:"taskDescription",id:"taskDescription",as:"textarea",placeholder:"Enter a description...",value:O,rows:6,ref:F,onChange:e=>{K(e.target.value)},className:w,onInput:e=>{e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"},onFocus:()=>{F.current&&(F.current.style.height="auto",F.current.style.height=F.current.scrollHeight+"px")}})})]}),oe.description&&(0,E.jsx)(x.A.Text,{className:"error-message",children:"Description is required"})]}),(0,E.jsxs)("div",{className:"modal-footer d-flex flex-column",style:{borderTop:"1px solid var(--Gray-200, #EAECF0)"},children:[(0,E.jsx)("div",{className:"d-flex w-100",style:{padding:"16px 24px"},children:(0,E.jsxs)("div",{className:"d-flex align-items-start gap-3 w-100",children:[(0,E.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{width:"40px",height:"40px",borderRadius:"50%",overflow:"hidden",border:"1px solid #EAECF0",flexShrink:0},children:(0,E.jsx)(S.A,{photo:null===z||void 0===z||null===(T=z.user)||void 0===T?void 0:T.photo,has_photo:null===z||void 0===z||null===(R=z.user)||void 0===R?void 0:R.has_photo,is_business:!1,size:23})}),(0,E.jsx)("div",{className:"flex-grow-1",children:(0,E.jsx)(x.A.Control,{as:"textarea",placeholder:"Add a comment...",rows:1,value:te,onChange:e=>se(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),(async()=>{if(te.trim())if(C){ne(!0);try{var e,t,s,a,n;await new Promise((e=>setTimeout(e,500)));const o={id:Date.now(),task_id:C,text:te,user:{id:null===z||void 0===z||null===(e=z.user)||void 0===e?void 0:e.id,first_name:(null===z||void 0===z||null===(t=z.user)||void 0===t?void 0:t.first_name)||"Current",last_name:(null===z||void 0===z||null===(s=z.user)||void 0===s?void 0:s.last_name)||"User",photo:(null===z||void 0===z||null===(a=z.user)||void 0===a?void 0:a.photo)||"",has_photo:(null===z||void 0===z||null===(n=z.user)||void 0===n?void 0:n.has_photo)||!1},created_at:(new Date).toISOString()};ee([...Q,o]),se(""),f.oR.success("Comment added successfully"),setTimeout((()=>{q.current&&q.current.scrollIntoView({behavior:"smooth",block:"end"})}),100)}catch(o){console.error("Error adding comment:",o),f.oR.error("Failed to add comment. Please try again.")}finally{ne(!1)}}else f.oR.error("Please save the task first before adding comments");else f.oR.error("Please enter a comment")})())},disabled:ae||!C||!0,style:{border:"1px solid #D0D5DD",borderRadius:"8px",padding:"10px 14px",fontSize:"14px",resize:"none",minHeight:"44px",transition:"all 0.2s ease"}})})]})}),(0,E.jsxs)("div",{className:"w-100 d-flex align-items-center justify-content-between gap-3",style:{borderTop:"1px solid var(--Gray-200, #EAECF0)",padding:"12px 14px 6px 14px"},children:[(0,E.jsx)("div",{children:C&&(0,E.jsxs)(p.A,{className:"danger-text-button gap-2",onClick:xe,children:["Delete",me.isPending&&(0,E.jsx)(u.p,{style:{width:"18px",height:"18px"}})]})}),(0,E.jsxs)("div",{className:"d-flex align-items-center gap-3",children:[(0,E.jsx)(p.A,{type:"button",onClick:ve,className:"outline-button",children:"Cancel"}),(0,E.jsxs)(p.A,{type:"button",onClick:pe,className:"solid-button",style:{minWidth:"70px"},disabled:he.isPending,children:[C?"Update Task":"Create Task"," ",he.isPending&&(0,E.jsx)(u.p,{style:{width:"18px",height:"18px"}})]})]})]})]})]})}})}},72796:(e,t,s)=>{s.d(t,{_x:()=>r,dd:()=>n,mM:()=>o});const a="https://app.memate.com.au/api/v1",n=async e=>{const t=new Headers,s=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${s}`),t.append("Content-Type","application/json");const n={method:"GET",headers:t};try{const t=new URL(`${a}/tasks/${e}/`),s=await fetch(t,n);return await s.json()}catch(o){throw console.error("Tasks fetch error:",o),o}},o=async e=>{const t=new Headers,s=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${s}`),t.append("Content-Type","application/json");const n={method:"DELETE",headers:t,redirect:"follow"};try{const t=new URL(`${a}/tasks/delete/${e}/`);if((await fetch(t,n)).ok)return{message:"Task deleted successfully"};throw new Error("Error during deleting")}catch(o){throw console.error("Tasks fetch error:",o),o}},r=async(e,t)=>{const s=new Headers,n=localStorage.getItem("access_token");s.append("Authorization",`Bearer ${n}`),s.append("Content-Type","application/json");const o={method:"PATCH",headers:s,body:JSON.stringify({finished:t}),redirect:"follow"};try{const t=new URL(`${a}/tasks/complete/${e}/`),s=await fetch(t,o);return await s.json()}catch(r){throw console.error("Tasks fetch error:",r),r}}},79106:(e,t,s)=>{s.d(t,{Af:()=>l,U9:()=>o,aU:()=>d,gg:()=>r,gy:()=>c,lC:()=>i});var a=s(31342);const n="https://app.memate.com.au/api/v1",o=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6?arguments[6]:void 0;const d=(e-1)*t,c=new URL(`${n}/tasks/`);return c.searchParams.append("limit",t),c.searchParams.append("offset",d),s&&c.searchParams.append("search",s),o&&c.searchParams.append("ordering",o),r&&c.searchParams.append("deleted",1),!0===l&&c.searchParams.append("finished",!1),!1===l&&c.searchParams.append("finished",!0),i&&c.searchParams.append("users",i),(0,a.f)(c.toString(),{method:"GET"})},r=async e=>{const t=new URL(`${n}${`/tasks/${e}/`}`);return(0,a.f)(t.toString(),{method:"GET"})},l=async e=>{const t={method:"POST",body:e},s=new URL(`${n}/tasks/new/`);return(0,a.f)(s.toString(),t)},i=async(e,t)=>{const s={method:"PUT",body:t},o=new URL(`${n}${`/tasks/update/${e}/`}`);return(0,a.f)(o.toString(),s)},d=async()=>{const e=new URL(`${n}/desktop-users/`);return(0,a.f)(e.toString(),{method:"GET"})},c=async()=>{const e=new URL(`${n}/team/mobile-users/`);return(0,a.f)(e.toString(),{method:"GET"})}},83738:(e,t,s)=>{s.d(t,{s:()=>d});var a=s(65043),n=s(58387),o=s(670),r=s(68767),l=s(32370),i=s(70579);const d=e=>{let{onDataApply:t,dateRange:s,onClose:d,className:c=""}=e;const[u,h]=(0,a.useState)(null);(0,a.useEffect)((()=>{if(null!==s&&void 0!==s&&s.startDate&&null!==s&&void 0!==s&&s.endDate){const e=s.startDate instanceof Date?s.startDate:new Date(s.startDate),t=s.endDate instanceof Date?s.endDate:new Date(s.endDate);h([e,t])}}),[s]);const p=(0,a.useCallback)((()=>{u&&2===u.length&&u[0]&&u[1]?t({startDate:u[0],endDate:u[1]}):u&&1===u.length&&u[0]&&t({startDate:u[0],endDate:u[0]})}),[u,t]),m=(0,a.useCallback)((()=>{h(null),d&&d()}),[d]),x=(0,a.useCallback)((()=>{const e=new Date;e.setHours(0,0,0,0),h([e,e])}),[]),v=(0,a.useCallback)((()=>{const e=u&&u.length>=1&&u[0];return(0,i.jsxs)("div",{className:"date-range-footer",children:[(0,i.jsx)("button",{type:"button",className:"date-range-footer-btn date-range-footer-btn-today",onClick:x,children:"Today"}),(0,i.jsx)("button",{type:"button",className:"date-range-footer-btn date-range-footer-btn-cancel",onClick:m,children:"Cancel"}),(0,i.jsx)("button",{type:"button",className:"date-range-footer-btn date-range-footer-btn-apply",onClick:p,disabled:!e,children:"Apply"})]})}),[u,x,m,p]),f=(0,a.useCallback)((()=>{var e,t;if(!u||0===u.length)return"Select date range";const s={month:"short",day:"numeric",year:"numeric"},a=(null===(e=u[0])||void 0===e?void 0:e.toLocaleDateString("en-US",s))||"",n=(null===(t=u[1])||void 0===t?void 0:t.toLocaleDateString("en-US",s))||"";return a&&n?`${a} - ${n}`:a?`${a} - Select end date`:"Select date range"}),[u]);return(0,i.jsxs)("div",{className:(0,n.A)("date-range-picker-calendar",c),children:[(0,i.jsx)("div",{className:"date-range-header",children:(0,i.jsx)("span",{className:"date-range-header-text",children:f()})}),(0,i.jsx)(o.V,{value:u,onChange:e=>h(e.value),selectionMode:"range",inline:!0,numberOfMonths:1,locale:"en",dateFormat:"dd M yy",footerTemplate:v,firstDayOfWeek:1,showButtonBar:!1,prevIcon:(0,i.jsx)(r.Y,{}),nextIcon:(0,i.jsx)(l.v,{})})]})}}}]);
//# sourceMappingURL=3981.200965d9.chunk.js.map