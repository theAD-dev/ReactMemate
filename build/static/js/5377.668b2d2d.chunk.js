"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[5377,6731],{14834:(e,t,l)=>{function s(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const l=parseFloat(e);return isNaN(l)?"0.00":t&&Math.abs(l)>=1e3?new Intl.NumberFormat("en-AU",{notation:"compact",compactDisplay:"short",minimumFractionDigits:2,maximumFractionDigits:2}).format(l):new Intl.NumberFormat("en-AU",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l)}l.d(t,{m:()=>s})},17030:(e,t,l)=>{l.d(t,{DY:()=>r,Dc:()=>i,MY:()=>j,VL:()=>p,Vn:()=>d,WL:()=>o,_0:()=>h,ax:()=>n,cM:()=>m,dl:()=>f,jH:()=>g,mL:()=>u,sl:()=>v,tA:()=>c,zw:()=>x});var s=l(31342);const a="https://dev.memate.com.au/api/v1",n=async e=>{const t=new URL(`${a}/references/calc-indexes/`);return 1===e&&t.searchParams.append("all",1),(0,s.f)(t.toString(),{method:"GET"})},i=async e=>{const t=new URL(`${a}${`/references/calculators/${e}/`}`),l=await(0,s.f)(t.toString(),{method:"GET"});return Array.isArray(l)?l.filter((e=>!e.deleted)):l&&!l.deleted?l:null},o=async e=>{const t=new URL(`${a}${`/projects/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},r=async e=>{const t={method:"POST",body:e},l=new URL(`${a}/sales/new-request/`);return(0,s.f)(l.toString(),t)},d=async(e,t)=>{if(!e)throw new Error("No id found");const l={method:"PUT",body:t},n=new URL(`${a}${`/sales/projects/${e}/`}`);return(0,s.f)(n.toString(),l)},c=async e=>{const t={method:"POST",body:e},l=new URL(`${a}/projects/merges/new/`);return(0,s.f)(l.toString(),t)},u=async e=>{const t=new URL(`${a}${`/projects/merges/${e}/delete/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},p=async e=>{const t={method:"POST",body:e},l=new URL(`${a}/settings/departments/`);return(0,s.f)(l.toString(),t)},m=async(e,t)=>{if(!e)return;const l={method:"PUT",body:t},n=new URL(`${a}${`/settings/departments/update/${e}/`}`);return(0,s.f)(n.toString(),l)},x=async e=>{const t={method:"POST",body:e},l=new URL(`${a}/settings/sub-departments/`);return(0,s.f)(l.toString(),t)},h=async(e,t)=>{if(!e)return;const l={method:"PUT",body:t},n=new URL(`${a}${`/settings/sub-departments/update/${e}/`}`);return(0,s.f)(n.toString(),l)},g=async(e,t)=>{const l={method:"POST",body:t},n=new URL(`${a}${`/references/calculators/${e}/new/`}`);return(0,s.f)(n.toString(),l)},v=async(e,t,l)=>{const n={method:"PUT",body:l},i=new URL(`${a}${`/references/calculators/${e}/update/${t}/`}`);return(0,s.f)(i.toString(),n)},j=async e=>{const t=new URL(`${a}${e}`);return(0,s.f)(t.toString(),{method:"DELETE"})},f=async e=>{const t={method:"POST",body:e.map(((e,t)=>({id:e.id,order:t+1})))},l=new URL(`${a}/settings/departments/order/`);return(0,s.f)(l.toString(),t)}},24572:(e,t,l)=>{function s(e){var t,l={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},s="";for(t in l)for(;e>=l[t];)s+=t,e-=l[t];return s}function a(e){return e.toLocaleString("en-US",{style:"currency",currency:"USD"})}l.d(t,{Mf:()=>s,i$:()=>n,up:()=>a});const n=(e,t)=>{var l;if(!e)return"-";const s=new Date(1e3*+e);if(t){return s.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,".")}return null===(l=s.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))||void 0===l?void 0:l.replace(/,/g,"")}},31342:(e,t,l)=>{l.d(t,{f:()=>s});const s=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{method:s="GET",headers:a={},body:n}=t,i=localStorage.getItem("access_token"),o=n instanceof FormData,r={"Content-Type":o?"multipart/form-data":"application/json",...a};l&&(r.Authorization=`Bearer ${i}`);const d={method:s,headers:r,body:o?n:JSON.stringify(n),redirect:"follow"};try{const t=new URL(e),l=await fetch(t,d),s=l.headers.get("Content-Type");if(!l.ok){var c;let e=null;e=s&&s.includes("application/json")?await l.json():await l.text(),401===l.status&&(localStorage.clear(),sessionStorage.clear(),window.location.replace("/login"));const t=new Error((null===(c=e)||void 0===c?void 0:c.message)||`HTTP error! Status: ${l.status}`);throw t.status=l.status,t.data=e,t}if(s&&s.includes("application/json"))return await l.json();return{message:"Non-JSON response",body:await l.text()}}catch(u){throw console.error("Fetch API error:",u),u}}},54967:(e,t,l)=>{l.d(t,{A:()=>r,h:()=>d});var s=l(65043),a=l(44541),n=l(95192);const i="image-avatar_clientImg__-nnRU";var o=l(70579);const r=e=>{let{has_photo:t,photo:l,is_business:i,size:r}=e;const[d,c]=(0,s.useState)(!1),u=i?a.A:n.A;return(0,o.jsx)(o.Fragment,{children:t&&l&&!d?(0,o.jsx)("img",{src:l,alt:"client avatar",className:"w-100",onError:()=>c(!0)}):(0,o.jsx)(u,{color:"#667085",size:r})})},d=e=>{let{has_photo:t,photo:l,is_business:r}=e;const[d,c]=(0,s.useState)(!1),u=r?a.A:n.A;return(0,o.jsx)("div",{className:`d-flex justify-content-center align-items-center ${i} ${r?"":"rounded-circle"}`,style:{overflow:"hidden"},children:t&&l&&!d?(0,o.jsx)("img",{src:l,alt:"client avatar",className:"w-100",onError:()=>c(!0)}):(0,o.jsx)(u,{color:"#667085"})})}},59638:(e,t,l)=>{l.d(t,{EZ:()=>i,F1:()=>j,Fl:()=>p,OF:()=>r,QK:()=>h,Ql:()=>o,X6:()=>d,Ye:()=>g,ab:()=>f,i6:()=>u,kB:()=>y,nP:()=>c,o6:()=>x,oO:()=>n,oo:()=>m,zZ:()=>v});var s=l(31342);const a="https://dev.memate.com.au/api/v1",n=async e=>{const t=new URL(`${a}${`/clients/restore/${e}/`}`);return(0,s.f)(t.toString(),{method:"POST"})},i=async e=>{const t=new URL(`${a}${`/clients/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},o=async()=>{const e=new URL(`${a}/references/clients/categories/`);return(0,s.f)(e.toString(),{method:"GET"})},r=async()=>{const e=new URL(`${a}/references/clients/industries/`);return(0,s.f)(e.toString(),{method:"GET"})},d=async()=>{const e=new URL(`${a}/references/countries/`),t=await(0,s.f)(e.toString(),{method:"GET"},!1),l=[1];return(null===t||void 0===t?void 0:t.filter((e=>l.includes(e.id))))||[]},c=async e=>{const t=new URL(`${a}${`/references/states/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"},!1)},u=async e=>{const t=new URL(`${a}${`/references/cities/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"},!1)},p=async()=>{const e=new URL(`${a}/references/desktop-users/`);return(0,s.f)(e.toString(),{method:"GET"})},m=async function(e,t){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;const o=(e-1)*t,r=new URL(`${a}/clients/`);return r.searchParams.append("limit",t),r.searchParams.append("offset",o),l&&r.searchParams.append("name",l),n&&r.searchParams.append("ordering",n),i&&r.searchParams.append("deleted",1),(0,s.f)(r.toString(),{method:"GET"})},x=async function(e,t,l){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";const o=(t-1)*l,r=new URL(`${a}${`/clients/${e}/orders/`}`);return r.searchParams.append("limit",l),r.searchParams.append("offset",o),n&&r.searchParams.append("number",n),i&&r.searchParams.append("ordering",i),(0,s.f)(r.toString(),{method:"GET"})},h=async e=>{const t=new URL(`${a}${`/clients/address/${e}/main`}`);return(0,s.f)(t.toString(),{method:"PUT"})},g=async e=>{const t=new URL(`${a}${`/clients/contact-persons/${e}/main`}`);return(0,s.f)(t.toString(),{method:"PUT"})},v=async e=>{const t=new URL(`${a}${`/clients/delete/${e}/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},j=async e=>{const t=new URL(`${a}${`/clients/contact-persons/${e}/delete/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},f=async e=>{const t=new URL(`${a}${`/clients/address/${e}/delete/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},y=async e=>{const t={method:"PUT",body:{unique_id:e}},l=new URL(`${a}/projects/back/`);return(0,s.f)(l.toString(),t)}},81047:(e,t,l)=>{l.d(t,{AO:()=>x,Ad:()=>w,Bz:()=>F,Hb:()=>u,IT:()=>k,Kb:()=>o,Mp:()=>b,Pf:()=>S,Rh:()=>N,SQ:()=>c,T6:()=>g,UM:()=>f,VQ:()=>$,Xm:()=>d,bd:()=>C,bj:()=>h,gY:()=>v,hS:()=>m,hx:()=>_,iS:()=>i,p4:()=>r,pJ:()=>y,rJ:()=>A,s:()=>p,sB:()=>j,tC:()=>n});var s=l(31342);const a="https://dev.memate.com.au/api/v1",n=async()=>{const e=new URL(`${a}/jobs/templates/`);return(0,s.f)(e.toString(),{method:"GET"})},i=async e=>{const t=new URL(`${a}${`/jobs/templates/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},o=async e=>{const t={method:"POST",body:e},l=new URL(`${a}/jobs/templates/`);return(0,s.f)(l.toString(),t)},r=async(e,t)=>{const l={method:"PUT",body:t},n=new URL(`${a}${`/jobs/templates/${e}/`}`);return(0,s.f)(n.toString(),l)},d=async e=>{const t=new URL(`${a}${`/jobs/templates/${e}/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},c=async()=>{const e=new URL(`${a}/settings/templates/email-templates/`);return(0,s.f)(e.toString(),{method:"GET"})},u=async e=>{const t={method:"POST",body:e},l=new URL(`${a}/settings/templates/email-templates/`);return(0,s.f)(l.toString(),t)},p=async(e,t)=>{const l={method:"PUT",body:t},n=new URL(`${a}${`/settings/templates/email-templates/${e}/`}`);return(0,s.f)(n.toString(),l)},m=async e=>{const t=new URL(`${a}${`/settings/templates/email-templates/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},x=async()=>{const e=new URL(`${a}/email-signatures/`);return(0,s.f)(e.toString(),{method:"GET"})},h=async e=>{const t=new URL(`${a}${`/email-signatures/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},g=async e=>{const t={method:"POST",body:e},l=new URL(`${a}/email-signatures/`);return(0,s.f)(l.toString(),t)},v=async(e,t)=>{const l={method:"PUT",body:t},n=new URL(`${a}${`/email-signatures/${e}/`}`);return(0,s.f)(n.toString(),l)},j=async e=>{const t=new URL(`${a}${`/email-signatures/${e}/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},f=async e=>{const t=new URL(`${a}${`/settings/email-signatures/default/${e}/`}`);return(0,s.f)(t.toString(),{method:"PUT"})},y=async()=>{const e=new URL(`${a}/sms-templates/`);return(0,s.f)(e.toString(),{method:"GET"})},b=async e=>{const t=new URL(`${a}${`/sms-templates/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},w=async e=>{const t={method:"POST",body:e},l=new URL(`${a}/sms-templates/`);return(0,s.f)(l.toString(),t)},N=async(e,t)=>{const l={method:"PUT",body:t},n=new URL(`${a}${`/sms-templates/${e}/`}`);return(0,s.f)(n.toString(),l)},A=async e=>{const t=new URL(`${a}${`/sms-templates/${e}/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},S=async e=>{const t=new URL(`${a}${`/proposals/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},_=async()=>{const e=new URL(`${a}/references/outgoing-email/`);return(0,s.f)(e.toString(),{method:"GET"})},C=async e=>{const t=new URL(`${a}${`/settings/templates/email-templates/${e}/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},$=async()=>{const e=new URL(`${a}/settings/proposals/`);return(0,s.f)(e.toString(),{method:"GET"})},k=async e=>{const t=new URL(`${a}${`/settings/proposals/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},F=async e=>{const t=new URL(`${a}${`/settings/proposals/delete/${e}/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})}},85377:(e,t,l)=>{l.r(t),l.d(t,{default:()=>ht});var s=l(65043),a=l(27417),n=l(38294),i=l(22636),o=l(83700),r=l(73216),d=l(35475),c=l(93747),u=l(47097),p=l(93740),m=l(56328),x=l(61072),h=l(78602),g=l(65975),v=l(36097),j=l(10615),f=l(14282),y=l(77918),b=l(73898),w=l(66415),N=l(72234),A=l(55235),S=l(53193),_=l(11079),C=l(37970),$=l(85371),k=l(88060),F=l(79255),R=l(73722),q=l(94819),E=l(48792),L=l(38161),I=l(29485),B=l(63712),T=l(70579);const P=()=>(0,T.jsxs)("tr",{children:[(0,T.jsx)("td",{style:{width:"24px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"64px",textAlign:"center"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"192px",textAlign:"center"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"600px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"128px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"185px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"118px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"166px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"83px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"118px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"32px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})})]}),D=()=>(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("td",{style:{width:"64px",textAlign:"center"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"192px",textAlign:"center"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"600px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"128px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"185px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"118px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"166px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"83px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"118px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})}),(0,T.jsx)("td",{style:{width:"32px"},children:(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary"})})})]});var z=l(79726),M=l(3930),U=l(27002),O=l(35131);l(93066);const W=e=>{var t;let{departments:l,handleChange:a,title:n,keyValue:i}=e;const o=(e,t)=>{a(t,e,i)};return(0,T.jsx)(z.W,{menuButton:(0,T.jsxs)(M.I,{style:{width:"150px",display:"inline-flex",alignItems:"center",justifyContent:"space-between",padding:"8px 0px",cursor:"pointer",background:"transparent",border:"none",color:n?"#101828":"#98A2B3"},children:[(0,T.jsx)("div",{className:"ellipsis-width",title:n||"Department",children:n||"Department"}),(0,T.jsx)("span",{children:(0,T.jsx)(w.A,{color:"#98A2B3",size:15})})]}),overflow:"auto",position:"anchor",portal:!0,className:"departmentSelect",children:null===l||void 0===l||null===(t=l.filter((e=>!(null!==e&&void 0!==e&&e.deleted))))||void 0===t?void 0:t.sort(((e,t)=>e.order-t.order)).map((e=>{var t,l,a;return(0,T.jsx)(s.Fragment,{children:null!==e&&void 0!==e&&null!==(t=e.subindexes)&&void 0!==t&&t.length?(0,T.jsx)(U.g,{label:null===e||void 0===e?void 0:e.name,direction:"right",align:"start",menuStyle:{maxHeight:"500px",overflow:"auto",textAlign:"left"},children:null===(l=e.subindexes)||void 0===l||null===(a=l.filter((e=>!(null!==e&&void 0!==e&&e.deleted))))||void 0===a?void 0:a.sort(((e,t)=>e.order-t.order)).map((e=>(0,T.jsx)(O.D,{onClick:()=>o(null===e||void 0===e?void 0:e.name,null===e||void 0===e?void 0:e.id),children:null===e||void 0===e?void 0:e.name},e.id)))},e.id):(0,T.jsx)(O.D,{style:{textAlign:"left"},onClick:()=>o(null===e||void 0===e?void 0:e.name,null===e||void 0===e?void 0:e.id),children:null===e||void 0===e?void 0:e.name},e.id)},e.id)}))})};var G=l(17030),H=l(14834),K=l(32952),Y=l(32223),Q=l(24858),V=l(18403),J=l(58387),Z=l(80899);const X="create-merge-calculation_mergeButton__A2lWg",ee="create-merge-calculation_disabled__-KWur",te="create-merge-calculation_deleteButton__AA6vR";var le=l(24572);const se=Z.Ik({title:Z.Yj().required("Title is required"),description:Z.Yj().required("Description is required")}).required(),ae=e=>{var t,l,a;let{selectItem:n,setSelectItem:i,merges:o,setMerges:r}=e;const[d,c]=(0,s.useState)(!1),u=(0,le.Mf)(((null===o||void 0===o?void 0:o.length)||0)+1),[p]=(0,s.useState)({title:"",description:""}),{register:m,reset:g,handleSubmit:v,formState:{errors:j}}=(0,Q.mN)({resolver:(0,V.t)(se),defaultValues:p});(0,s.useEffect)((()=>{g()}),[n]);const y=()=>c(!1);return(0,T.jsxs)(s.Fragment,{children:[(0,T.jsx)(f.A,{type:"button",disabled:(null===(t=Object.keys(n))||void 0===t?void 0:t.length)<2,onClick:()=>c(!0),className:(0,J.A)(X,"text-button",{[ee]:(null===(l=Object.keys(n))||void 0===l?void 0:l.length)<2}),children:"Merge Items"}),(0,T.jsxs)(K.A,{size:"lg",show:d,centered:!0,onHide:y,className:(0,J.A)("task-form","mergeForm"),children:[(0,T.jsx)(K.A.Header,{closeButton:!0,children:(0,T.jsxs)(K.A.Title,{className:"d-flex align-items-center",children:[(0,T.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{width:"36px",height:"36px",borderRadius:"50%",border:"1px solid #EAECF0",background:"#F2F4F7",color:"#344054",fontSize:"14px",fontWeight:600},children:u}),(0,T.jsx)("span",{className:"modal-task-title",children:"Merge Items"})]})}),(0,T.jsx)(K.A.Body,{className:"px-0",children:(0,T.jsxs)(R.A,{onSubmit:v((e=>{var t;const l={...e,alias:u,calculators:null===(t=Object.values(n))||void 0===t?void 0:t.flat().map((e=>({key:e.key,merge_id:e.merge_id,calculator:e.calculator,label:e.label,total:e.total,description:e.description})))};r((e=>[...e,l])),y(),i({})})),children:[(0,T.jsxs)("div",{className:"px-4",style:{maxHeight:"450px",overflow:"auto"},children:[(0,T.jsxs)(R.A.Group,{className:"mb-3",children:[(0,T.jsx)(R.A.Label,{children:"Task Title"}),(0,T.jsx)(R.A.Control,{...m("title"),type:"text",placeholder:"Merge items title",className:""+(j.title?"border border-danger":"")}),j.title&&(0,T.jsx)(R.A.Text,{className:"text-danger",children:j.title.message})]}),(0,T.jsxs)(R.A.Group,{className:"mb-3",controlId:"exampleForm.ControlTextarea1",children:[(0,T.jsx)(R.A.Label,{children:"Describe merging items"}),(0,T.jsx)(R.A.Control,{as:"textarea",rows:2,placeholder:"Enter a description...",...m("description"),style:{height:"80px",outline:"none",boxShadow:"none"},className:""+(j.description?"border border-danger":"")}),j.description&&(0,T.jsx)(R.A.Text,{className:"text-danger",children:j.description.message})]}),(0,T.jsx)(Y.A,{variant:"flush border rounded mb-4",style:{border:"1px solid var(--Gray-100, #F2F4F7)"},children:null===(a=Object.entries(n))||void 0===a?void 0:a.map((e=>{let[t,l]=e;return null===l||void 0===l?void 0:l.map((e=>(0,T.jsx)(Y.A.Item,{className:"d-flex justify-content-between",children:(0,T.jsxs)(x.A,{className:"w-100",children:[(0,T.jsx)(h.A,{sm:4,className:"text-start",children:(0,T.jsx)("span",{style:{color:"#101828",fontSize:"16px"},children:(null===e||void 0===e?void 0:e.label)||""})}),(0,T.jsx)(h.A,{sm:6,children:(0,T.jsx)("span",{style:{color:"#101828",fontSize:"16px"},children:(null===e||void 0===e?void 0:e.description)||""})}),(0,T.jsx)(h.A,{sm:2,className:"text-end text-nowrap",children:(0,T.jsxs)("span",{style:{color:"#101828",fontSize:"16px",textAlign:"end"},children:["$ ",parseFloat(null===e||void 0===e?void 0:e.total).toFixed(2)]})})]})},`${t}-${e.id}`)))}))})]}),(0,T.jsxs)(K.A.Footer,{className:"d-flex justify-content-between align-items-center",children:[(0,T.jsx)(f.A,{type:"button",onClick:()=>{c(!1),i({})},className:te,children:(0,T.jsx)(q.A,{color:"#B42318",size:18})}),(0,T.jsxs)("div",{className:"d-flex align-items-center gap-3",children:[(0,T.jsx)(f.A,{type:"button",onClick:y,className:"outline-button",style:{minWidth:"67px"},children:"Cancel"}),(0,T.jsx)(f.A,{type:"submit",className:"solid-button",style:{minWidth:"67px"},children:"Save"})]})]})]})})]})]})},ne="list-merge-calculation_mergeListItem__lMMHT",ie="list-merge-calculation_mergeListSrBox__Pg9x-",oe="list-merge-calculation_divider__uLh55",re="list-merge-calculation_divider2__ixjfs";var de=l(30970);const ce=e=>{let{id:t,alias:l,refetch:n,setMerges:i}=e;const{unique_id:o}=(0,r.g)(),d=(0,u.n)({mutationFn:()=>(0,G.mL)(t),onSuccess:()=>{m.oR.success("Merge item deleted successfully"),n()},onError:e=>{console.log("error: ",e),m.oR.error("Failed to delete merge item. Please try again.")}}),c=()=>{if(o){if(!t)return m.oR.error("Id not found");d.mutate()}else i((e=>e.filter((e=>e.alias!==l))))},p=()=>{};return(0,T.jsxs)(s.Fragment,{children:[(0,T.jsx)(de.r,{}),d.isPending?(0,T.jsx)(a.A,{animation:"border",role:"status",size:"sm",children:(0,T.jsx)("span",{className:"visually-hidden",children:"Loading..."})}):(0,T.jsx)(q.A,{onClick:e=>{(0,de.P)({target:e.currentTarget,message:"Do you want to delete this record?",defaultFocus:"reject",acceptClassName:"p-button-danger",accept:c,reject:p})},color:"#98A2B3",size:16,className:"cursor-pointer"})]})},ue="edit-merge-calculation_mergeButton__MJN7A",pe="edit-merge-calculation_deleteButton__5ACo9",me=Z.Ik({title:Z.Yj().required("Title is required"),description:Z.Yj().required("Description is required")}).required(),xe=e=>{var t;let{merge:l,alias:a,setMerges:n,refetch:i,deleteMergeCalculator:o}=e;const[r,d]=(0,s.useState)(!1),c=a,[u]=(0,s.useState)({title:(null===l||void 0===l?void 0:l.title)||"",description:(null===l||void 0===l?void 0:l.description)||""}),{register:p,reset:m,handleSubmit:g,formState:{errors:v}}=(0,Q.mN)({resolver:(0,V.t)(me),defaultValues:u});(0,s.useEffect)((()=>{m()}),[a]);const j=()=>d(!1);return(0,T.jsxs)(s.Fragment,{children:[(0,T.jsx)(f.A,{type:"button",onClick:()=>d(!0),className:(0,J.A)(ue,"text-button"),children:"Edit"}),(0,T.jsxs)(K.A,{size:"lg",show:r,centered:!0,onHide:j,className:(0,J.A)("task-form","mergeForm"),children:[(0,T.jsx)(K.A.Header,{closeButton:!0,children:(0,T.jsxs)(K.A.Title,{className:"d-flex align-items-center",children:[(0,T.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{width:"36px",height:"36px",borderRadius:"50%",border:"1px solid #EAECF0",background:"#F2F4F7",color:"#344054",fontSize:"14px",fontWeight:600},children:c}),(0,T.jsx)("span",{className:"modal-task-title",children:"Edit Merge Items"})]})}),(0,T.jsx)(K.A.Body,{className:"px-0",children:(0,T.jsxs)(R.A,{onSubmit:g((e=>{var t;const s={...e,alias:c,calculators:null===l||void 0===l||null===(t=l.calculators)||void 0===t?void 0:t.map((e=>({key:e.key,merge_id:e.merge_id,calculator:e.calculator,label:e.label,total:e.total,description:e.description})))};n((e=>e.map((e=>e.alias===c?{...e,...s}:e)))),j()})),children:[(0,T.jsxs)("div",{className:"px-4",style:{maxHeight:"450px",overflow:"auto"},children:[(0,T.jsxs)(R.A.Group,{className:"mb-3",children:[(0,T.jsx)(R.A.Label,{children:"Task Title"}),(0,T.jsx)(R.A.Control,{...p("title"),type:"text",placeholder:"Merge items title",className:""+(v.title?"border border-danger":"")}),v.title&&(0,T.jsx)(R.A.Text,{className:"text-danger",children:v.title.message})]}),(0,T.jsxs)(R.A.Group,{className:"mb-3",controlId:"exampleForm.ControlTextarea1",children:[(0,T.jsx)(R.A.Label,{children:"Describe merging items"}),(0,T.jsx)(R.A.Control,{as:"textarea",rows:2,placeholder:"Enter a description...",...p("description"),style:{height:"80px",outline:"none",boxShadow:"none"},className:""+(v.description?"border border-danger":"")}),v.description&&(0,T.jsx)(R.A.Text,{className:"text-danger",children:v.description.message})]}),(0,T.jsx)(Y.A,{variant:"flush border rounded mb-4",style:{border:"1px solid var(--Gray-100, #F2F4F7)"},children:null===l||void 0===l||null===(t=l.calculators)||void 0===t?void 0:t.map(((e,t)=>(0,T.jsx)(Y.A.Item,{className:"d-flex justify-content-between",children:(0,T.jsxs)(x.A,{className:"w-100",children:[(0,T.jsx)(h.A,{sm:4,className:"text-start",children:(0,T.jsx)("span",{style:{color:"#101828",fontSize:"16px"},children:(null===e||void 0===e?void 0:e.label)||""})}),(0,T.jsx)(h.A,{sm:6,children:(0,T.jsx)("span",{style:{color:"#101828",fontSize:"16px"},children:(null===e||void 0===e?void 0:e.description)||""})}),(0,T.jsxs)(h.A,{sm:2,className:"text-end text-nowrap",children:[(0,T.jsxs)("span",{style:{color:"#101828",fontSize:"16px",textAlign:"end"},children:["$ ",parseFloat(null===e||void 0===e?void 0:e.total).toFixed(2)]}),(0,T.jsx)(q.A,{onClick:()=>o(e.calculator,e.key),color:"#98A2B3",size:16,className:"ms-2",style:{position:"relative",left:"20px",cursor:"pointer"}})]})]})},`${t}-${e.id}`)))})]}),(0,T.jsxs)(K.A.Footer,{className:"d-flex justify-content-between align-items-center",children:[(0,T.jsx)(f.A,{type:"button",onClick:()=>{d(!1)},className:pe,children:(0,T.jsx)(q.A,{color:"#B42318",size:18})}),(0,T.jsxs)("div",{className:"d-flex align-items-center gap-3",children:[(0,T.jsx)(f.A,{type:"button",onClick:j,className:"outline-button",style:{minWidth:"67px"},children:"Cancel"}),(0,T.jsx)(f.A,{type:"submit",className:"solid-button",style:{minWidth:"67px"},children:"Save"})]})]})]})})]})]})};var he=l(85632),ge=l(90688),ve=l(88120);const je=e=>{let{title:t,alias:l,items:a}=e;const n=(0,s.useRef)(null),[i,o]=(0,s.useState)(!1),r=(0,ge.k)(i,o);return(0,T.jsxs)(s.Fragment,{children:[(0,T.jsx)("button",{type:"button",className:"btn p-0 ellipsis-width",style:{maxWidth:"450px"},ref:n,...r,children:t}),(0,T.jsxs)(ve.k,{state:i?"open":"closed",anchorRef:n,onClose:()=>o(!1),menuStyle:{padding:"24px 24px 20px 24px",width:"365px"},children:[(0,T.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,T.jsx)("div",{className:"BoxNo",children:(0,T.jsx)("div",{className:"no",children:l})}),(0,T.jsx)(he.A,{onClick:()=>o(!1)})]}),(0,T.jsx)(Y.A,{variant:"flush border",style:{marginTop:"16px"},children:null===a||void 0===a?void 0:a.map(((e,t)=>(0,T.jsxs)(Y.A.Item,{className:"d-flex justify-content-between border-0",children:[(0,T.jsx)("span",{style:{color:"#475467",fontSize:"14px",fontWeight:400},children:null===e||void 0===e?void 0:e.label}),(0,T.jsxs)("span",{style:{color:"#475467",fontSize:"14px",fontWeight:600,whiteSpace:"nowrap"},children:["$ ",(null===e||void 0===e?void 0:e.total)||"0.00"]})]},t)))})]})]})},fe=e=>{let{merges:t,setMerges:l,refetch:s,deleteMergeCalculator:a}=e;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("div",{className:(0,J.A)("w-100",oe),style:{}}),(null===t||void 0===t?void 0:t.length)&&(0,T.jsx)("p",{className:"mb-0",style:{fontSize:"14px",fontWeight:"500",color:"#475467"},children:"Merged Items"})||"",t.map(((e,t)=>{var n;return(0,T.jsxs)("div",{className:(0,J.A)("d-flex align-items-center gap-3",ne),children:[(0,T.jsx)("div",{className:(0,J.A)("d-flex justify-content-center align-items-center",ie),children:null===e||void 0===e?void 0:e.alias}),(0,T.jsxs)("div",{className:"d-flex align-items-center gap-3",style:{width:"317px"},children:[(0,T.jsx)(je,{title:e.title,alias:null===e||void 0===e?void 0:e.alias,items:e.calculators}),(0,T.jsx)(xe,{merge:e,setMerges:l,alias:null===e||void 0===e?void 0:e.alias,deleteMergeCalculator:a})]}),(0,T.jsxs)("span",{style:{minWidth:"120px",color:"#667085"},children:["$ ",(null===e||void 0===e||null===(n=e.calculators)||void 0===n?void 0:n.reduce(((e,t)=>e+parseFloat(t.total)),0).toFixed(2))||"0.00"]}),(0,T.jsx)(ce,{id:e.id,alias:null===e||void 0===e?void 0:e.alias,refetch:s,setMerges:l})]},`${t}-${e.id}`)})),(null===t||void 0===t?void 0:t.length)&&(0,T.jsx)("div",{className:(0,J.A)("w-100",re)})||""]})},ye=e=>{let{srNo:t,departments:l,handleChange:s}=e;return(0,T.jsxs)("tr",{children:[(0,T.jsx)("td",{style:{width:"24px"},className:"shadowRight-"}),(0,T.jsx)("td",{style:{width:"64px",textAlign:"left"},children:t+1}),(0,T.jsx)("td",{style:{width:"192px"},children:(0,T.jsx)(W,{departments:l,handleChange:s,isShowlabel:!1})}),(0,T.jsx)("td",{style:{width:"100%",paddingTop:"10px"},children:(0,T.jsx)("textarea",{disabled:!0,rows:1,placeholder:"Enter a description...",style:{background:"transparent",border:"0px solid #fff",resize:"none",boxSizing:"border-box"},onChange:()=>{}})}),(0,T.jsx)("td",{style:{width:"128px"},children:(0,T.jsxs)("div",{className:"d-flex align-items-center",children:[(0,T.jsx)("span",{style:{color:"rgb(152, 162, 179)"},children:"$"}),(0,T.jsx)("input",{type:"text",disabled:!0,style:{padding:"4px",width:"100px",background:"transparent",color:"#98A2B3"},value:"0.00",onChange:()=>{}})]})}),(0,T.jsx)("td",{style:{width:"185px"},children:(0,T.jsxs)("div",{className:"d-flex align-items-center",children:[(0,T.jsx)("input",{type:"text",disabled:!0,style:{padding:"4px",width:"60px",background:"transparent",color:"#98A2B3"},value:"0.00",onChange:()=>{}}),(0,T.jsxs)("select",{value:"MRG",disabled:!0,style:{border:"0px solid #fff",background:"transparent"},onChange:()=>{},children:[(0,T.jsx)("option",{value:"MRG",children:"MRG %"}),(0,T.jsx)("option",{value:"AMN",children:"AMT $"}),(0,T.jsx)("option",{value:"MRK",children:"MRK %"})]})]})}),(0,T.jsxs)("td",{style:{width:"118px",textAlign:"left",color:"rgb(152, 162, 179)"},children:["$ ","0.00"]}),(0,T.jsx)("td",{style:{width:"166px"},children:(0,T.jsxs)("div",{className:"d-flex align-items-center",children:[(0,T.jsx)("input",{type:"text",disabled:!0,style:{padding:"4px",width:"60px",background:"transparent",color:"#98A2B3"},value:"0.00",onChange:()=>{}}),(0,T.jsxs)("select",{value:"Cost",disabled:!0,style:{border:"0px solid #fff",background:"transparent"},onChange:()=>{},children:[(0,T.jsx)("option",{value:"Cost",children:"1/Q"}),(0,T.jsx)("option",{value:"Hourly",children:"1/H"})]})]})}),(0,T.jsx)("td",{style:{width:"83px"},children:(0,T.jsx)("div",{className:"d-flex align-items-center",children:(0,T.jsx)("input",{type:"text",disabled:!0,style:{width:"60px",padding:"4px",background:"transparent",color:"#98A2B3"},value:"0.00%",onChange:()=>{}})})}),(0,T.jsxs)("td",{style:{width:"118px",textAlign:"left",color:"rgb(152, 162, 179)"},children:["$ ","0.00"]}),(0,T.jsx)("td",{style:{width:"32px",position:"sticky",right:"0px"},className:"shadowLeft-",children:(0,T.jsx)(q.A,{color:"#98A2B3",style:{cursor:"not-allowed",opacity:".5"},onClick:()=>{}})})]})},be=()=>(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{style:{width:"24px"}}),(0,T.jsx)("th",{style:{width:"64px",textAlign:"left"},children:"Order"}),(0,T.jsx)("th",{style:{width:"192px"},children:"Department"}),(0,T.jsx)("th",{style:{width:"100%"},children:"Description"}),(0,T.jsx)("th",{style:{width:"128px"},children:"Cost"}),(0,T.jsx)("th",{style:{width:"185px"},children:"Markup / Margin"}),(0,T.jsx)("th",{style:{width:"118px"},children:"Unit Price"}),(0,T.jsx)("th",{style:{width:"166px"},children:"Qty / Unit"}),(0,T.jsx)("th",{style:{width:"83px"},children:"Discount"}),(0,T.jsx)("th",{style:{width:"118px"},children:"Amount"}),(0,T.jsx)("th",{style:{width:"32px"}})]})}),we=e=>{let{rows:t,updateData:l,deleteRow:a,selectItem:n,setSelectItem:i,mapMergeItemWithNo:o,checkedItems:r=[],departments:d,handleDepartmentChange:c,selectKey:u}=e;return(0,T.jsx)(T.Fragment,{children:Object.entries(t).map(((e,t)=>{let[p,m]=e;return(0,T.jsx)(s.Fragment,{children:null===m||void 0===m?void 0:m.map(((e,s)=>(0,T.jsx)(I.sx,{draggableId:`row-${p}-${e.id}`,index:t,children:m=>(0,T.jsx)("tr",{ref:m.innerRef,...m.draggableProps,style:{...m.draggableProps.style,cursor:"default"},className:"calculation-tr "+(r.includes(p)?"selected":""),children:u===p?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("td",{...m.dragHandleProps,style:{width:"24px"},children:0===s&&(0,T.jsx)(E.A,{color:"#98A2B3",style:{cursor:"move"}})}),(0,T.jsx)(D,{})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("td",{...m.dragHandleProps,style:{width:"24px"},className:"shadowRight-",children:0===s&&(0,T.jsx)(E.A,{color:"#98A2B3",style:{cursor:"move"}})}),(0,T.jsx)("td",{style:{width:"64px",textAlign:"left"},children:(0,T.jsxs)("div",{className:"d-flex align-items-center justify-content-end gap-2",children:[0===s&&(0,T.jsx)("span",{children:t+1}),o[`${p}-${e.calculator}`]?(0,T.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{width:"20px",height:"20px",borderRadius:"24px",background:"#F2F4F7",border:"1px solid #EAECF0",color:"#344054",fontSize:"10px",marginRight:"0px"},children:o[`${p}-${e.calculator}`]}):(0,T.jsxs)("label",{className:"customCheckBox checkbox",style:{marginRight:"0px"},children:[(0,T.jsx)("input",{type:"checkbox",checked:!!n[`${p}-${e.id}`],onChange:t=>((e,t,l)=>{const s=`${l}-${t.id}`;i((a=>{if(e.target.checked){const e={label:t.label,description:null===t||void 0===t?void 0:t.description,calculator:null===t||void 0===t?void 0:t.calculator,index:null===t||void 0===t?void 0:t.index,total:null===t||void 0===t?void 0:t.total,key:l,merge_id:null===t||void 0===t?void 0:t.merge_id};let n=a[s]||[];return n.push(e),{...a,[s]:n}}{const e={...a};return e[s]&&delete e[s],e}}))})(t,e,p)}),(0,T.jsx)("span",{className:"checkmark",style:{top:"0px"},children:(0,T.jsx)(L.A,{color:"#1AB2FF",size:20})})]})]})}),(0,T.jsx)("td",{style:{width:"192px"},children:0===s&&(0,T.jsx)(W,{departments:d,handleChange:c,title:e.label,keyValue:p})}),(0,T.jsx)("td",{style:{width:"300px",textAlign:"left"},children:(0,T.jsx)("textarea",{rows:1,className:"auto-expand",style:{background:"transparent",border:"0px solid #fff",fontSize:"14px"},value:e.description,onChange:t=>l(p,e.id,"description",t.target.value),onInput:e=>{e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`},onFocus:e=>{e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`},onBlur:e=>{e.target.style.height="50px"},onClick:e=>{e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`}})}),(0,T.jsx)("td",{style:{width:"128px"},children:(0,T.jsx)("div",{className:"d-flex align-items-center",children:(0,T.jsx)(F.Y,{prefix:"$",value:e.cost,onValueChange:t=>l(p,e.id,"cost",t.target.value),maxFractionDigits:2,minFractionDigits:2,placeholder:"$0.00",inputId:"minmaxfraction",className:"w-100",inputStyle:{width:"120px",padding:"4px",background:"transparent"}})})}),(0,T.jsx)("td",{style:{width:"185px"},children:(0,T.jsxs)("div",{className:"d-flex align-items-center",children:[(0,T.jsx)(F.Y,{value:e.profit_type_value,onValueChange:t=>l(p,e.id,"profit_type_value",t.target.value),maxFractionDigits:2,minFractionDigits:2,placeholder:"0.00",inputId:"minmaxfraction",className:"w-100",inputStyle:{width:"60px",padding:"4px",background:"transparent"}}),(0,T.jsxs)("select",{value:e.profit_type,style:{border:"0px solid #fff",background:"transparent",fontSize:"14px"},onChange:t=>l(p,e.id,"profit_type",t.target.value),children:[(0,T.jsx)("option",{value:"MRG",children:"MRG %"}),(0,T.jsx)("option",{value:"AMN",children:"AMT $"}),(0,T.jsx)("option",{value:"MRK",children:"MRK %"})]})]})}),(0,T.jsxs)("td",{style:{width:"100%",textAlign:"left",fontSize:"14px"},children:["$",(0,H.m)(e.unit_price||"0.00")]}),(0,T.jsx)("td",{style:{width:"166px"},children:(0,T.jsxs)("div",{className:"d-flex align-items-center",children:[(0,T.jsx)(F.Y,{value:e.quantity,onValueChange:t=>l(p,e.id,"quantity",t.target.value),maxFractionDigits:2,minFractionDigits:2,placeholder:"0.00",inputId:"minmaxfraction",className:"w-100",inputStyle:{width:"60px",padding:"4px",background:"transparent"}}),(0,T.jsxs)("select",{value:e.type,style:{border:"0px solid #fff",background:"transparent",fontSize:"14px"},onChange:t=>l(p,e.id,"type",t.target.value),children:[(0,T.jsx)("option",{value:"Cost",children:"1/Q"}),(0,T.jsx)("option",{value:"Hourly",children:"1/H"})]})]})}),(0,T.jsx)("td",{style:{width:"60px"},children:(0,T.jsx)("div",{className:"d-flex align-items-center",children:(0,T.jsx)(F.Y,{suffix:"%",value:e.discount,onValueChange:t=>l(p,e.id,"discount",t.target.value),maxFractionDigits:2,minFractionDigits:2,placeholder:"0.00%",inputId:"minmaxfraction",className:"w-100",inputStyle:{width:"60px",padding:"4px",background:"transparent"}})})}),(0,T.jsxs)("td",{style:{textAlign:"left",fontSize:"14px"},children:["$ ",(0,H.m)(e.total||0)]}),(0,T.jsx)("td",{style:{width:"32px",position:"sticky",right:"0px"},className:"shadowLeft-",children:(0,T.jsx)(q.A,{color:"#98A2B3",style:{cursor:"pointer"},onClick:()=>a(p,e.id,e.calculator)})})]})},`tr-${p}-${e.id}`)},`${p}-${e.id}`)))},p)}))})},Ne=e=>{let{setTotals:t,setPayload:l,defaultDiscount:a,xero_tax:n,preExistCalculation:i,preMerges:o,refetch:d,setMergeDeletedItems:u}=e;const{unique_id:p}=(0,r.g)(),[x,h]=(0,s.useState)({}),[g,v]=(0,s.useState)(null),[j,f]=(0,s.useState)(null),[y,b]=(0,s.useState)(null),[w,N]=(0,s.useState)([]),[A,S]=(0,s.useState)([]),[_,C]=(0,s.useState)({}),[$,k]=(0,s.useState)({}),{data:F}=(0,c.I)({queryKey:["departments"],queryFn:G.ax,enabled:!0}),{isLoading:R,data:q}=(0,c.I)({queryKey:["calcReferenceId",g],queryFn:()=>(0,G.Dc)(g),enabled:!!g,retry:1}),E=(e,t)=>{e&&v(e),t&&f(t)},L=e=>{let t=(parseFloat(e.cost)||0)*(parseFloat(e.quantity)||0),l=parseFloat(e.profit_type_value)||0;"MRK"===e.profit_type?t+=t*l/100:"MRG"===e.profit_type?t/=1-l/100:"AMN"===e.profit_type&&(t+=l);let s=parseFloat(e.discount)||0;return parseFloat(t-t*s/100).toFixed(2)},D=e=>{let t=parseFloat(e.cost)||0,l=0,s=parseFloat(e.profit_type_value)||0;return"MRK"===e.profit_type?l=t+t*(s/100):"MRG"===e.profit_type?l=t/(1-s/100):"AMN"===e.profit_type&&(l=t+s),parseFloat(l).toFixed(2)},z=(e,t,l,s)=>{h((a=>({...a,[e]:a[e].map((e=>{if(e.id===t){const t={...e,[l]:s};return"MRG"===t.profit_type&&t.profit_type_value>=100&&(t.profit_type_value=99.99),t.unit_price=D(t),t.total=L(t),t}return e}))})))},M=(e,t)=>{let l=[],s=0;const a=A.reduce(((a,n)=>{const i=n.calculators.filter((l=>!(l.calculator===e&&l.key===t)));if(i.length<2)return n.id&&p&&l.push(n.id),a;s++;const o=(0,le.Mf)(s);return a.push({...n,calculators:i,alias:o}),a}),[]);S(a),u((e=>[...new Set([...e,...l])]))},U=(e,t,l)=>{h((l=>{const s={...l,[e]:l[e].filter((e=>e.id!==t))};return 0===s[e].length&&delete s[e],s})),M(l,e)};(0,s.useEffect)((()=>{if(q&&q.length&&g){q.length?q.forEach((e=>{e.label=j,e.calculator=e.id,e.index=g,e.merge_id=(0,B.Ak)(6),e.discount=a,e.quantity=parseFloat(parseFloat(e.quantity)||1).toFixed(2),e.unit_price=D(e),e.total=L(e)})):q.push({label:j,calculator:q.id,index:g,merge_id:(0,B.Ak)(6),discount:a,quantity:parseFloat(parseFloat(q.quantity)||1).toFixed(2)});let e=q.filter(((e,t,l)=>t===l.findIndex((t=>t.id===e.id)))),t=`${(0,B.Ak)(6)}`;h((l=>({...l,[`${t}`]:e}))),v("")}g&&0===(null===q||void 0===q?void 0:q.length)&&m.oR.error(`No calculation found inside ${j}`)}),[q,g,a,j]);const O=async(e,t,l)=>{if(e&&l)try{b(l);const s=await(0,G.Dc)(e);if(null!==s&&void 0!==s&&s.length){s.forEach((l=>{l.label=t,l.calculator=l.id,l.index=e,l.merge_id=(0,B.Ak)(6),l.discount=a,l.quantity=parseFloat(parseFloat(l.quantity)||1).toFixed(2),l.unit_price=D(l),l.total=L(l)}));let n=s.filter(((e,t,l)=>t===l.findIndex((t=>t.id===e.id))));h((e=>({...e,[`${l}`]:n})))}else m.oR.error(`No calculation found inside ${t}`)}catch(s){console.error("Error in handleDepartmentChange:",s)}finally{b(null)}};return(0,s.useEffect)((()=>{const e=(e=>{var t;let l=0,s=0;null===(t=Object.values(x))||void 0===t||t.forEach((e=>{null===e||void 0===e||e.forEach((e=>{let t=parseFloat(e.cost)||0,a=parseFloat(e.quantity)||0;l+=parseFloat(t*a||0),s+=parseFloat(e.total||0)}))}));let a=0,n=0;"ex"===e?(a=.1*s,n=s+a):"in"===e?(n=s,a=.1*n/1.1,s=n-a):"no"===e&&(a=0,n=s);const i=s-l;return{budget:parseFloat(l||0).toFixed(2),operationalProfit:parseFloat(i).toFixed(2),subtotal:parseFloat(s).toFixed(2),tax:parseFloat(a).toFixed(2),total:parseFloat(n).toFixed(2)}})(n);t(e);const s=Object.entries(x).flatMap(((e,t)=>{let[l,s]=e;return s.map((e=>{const{id:l,...s}=e;return{...s,cost:parseFloat(s.cost||0).toFixed(2),profit_type_value:parseFloat(s.profit_type_value||0).toFixed(2),unit_price:parseFloat(s.unit_price||0).toFixed(2),quantity:parseFloat(s.quantity||0).toFixed(2),discount:parseFloat(s.discount||0).toFixed(2),order:t+1}}))}));l((t=>({...t,expense:e.total||"",calculations:s})))}),[x,n]),(0,s.useEffect)((()=>{N(o)}),[o]),(0,s.useEffect)((()=>{if(null===i||void 0===i||!i.length||null===F||void 0===F||!F.length)return;const e=F.reduce(((e,t)=>(t.subindexes.forEach((t=>{e[t.id]=t.name})),e)),{});i.forEach((e=>{e.merge_id||(e.merge_id=(0,B.Ak)(6))}));const t=i.reduce(((t,l)=>{let{order:s,index:a,...n}=l;t[s]=t[s]||[];let i=n.unit_price;return"0.00"!==i&&i?i&&(i=D(n)):i=D(n),t[s].push({...n,unit_price:i,label:e[a]||"Unknown",index:a}),t}),{}),l=Object.keys(t).reduce(((e,l)=>(e[(0,B.Ak)(6)]=t[l],e)),{}),s={};Object.entries(l).forEach((e=>{let[t,l]=e;l.forEach((e=>{s[e.id]=t}))}));const a=w.map(((t,l)=>{var a;const n=(0,le.Mf)(l+1),o=null===t||void 0===t||null===(a=t.calculators)||void 0===a?void 0:a.map((t=>{const l=i.find((e=>e.id===t.calculator)),a=s[null===l||void 0===l?void 0:l.id];return{label:e[null===l||void 0===l?void 0:l.index],description:null===l||void 0===l?void 0:l.description,total:null===l||void 0===l?void 0:l.total,calculator:null===l||void 0===l?void 0:l.calculator,key:a,merge_id:null===l||void 0===l?void 0:l.merge_id}}));return{...t,alias:n,calculators:o}}));h(l),S(a)}),[i,w,F]),(0,s.useEffect)((()=>{if(null!==F&&void 0!==F&&F.length){const e={};null===A||void 0===A||A.forEach(((t,l)=>{var s;const a=(0,le.Mf)(l+1);null===t||void 0===t||null===(s=t.calculators)||void 0===s||s.forEach((t=>{e[`${t.key}-${t.calculator}`]=a}))})),k(e),l((e=>({...e,merges:A})))}}),[A]),(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("div",{className:"pb-3",style:{overflowX:"auto",width:"100%"},children:(0,T.jsx)(I.JY,{onDragEnd:e=>{const{source:t,destination:l}=e;if(!l)return;const s=Object.keys(x),a=s[t.index],n=s[l.index];if(!a||!n)return void console.error("Invalid source or destination key.");const i=Array.from(s),[o]=i.splice(t.index,1);i.splice(l.index,0,o);const r=i.reduce(((e,t)=>(e[t]=x[t],e)),{});h(r)},children:(0,T.jsxs)("table",{className:"w-100 department-calculation",children:[(0,T.jsx)(be,{}),(0,T.jsx)(I.gL,{droppableId:"departmentQuoteTable",children:e=>(0,T.jsxs)("tbody",{...e.droppableProps,ref:e.innerRef,children:[(0,T.jsx)(we,{rows:x,updateData:z,deleteRow:U,defaultDiscount:a,selectItem:_,setSelectItem:C,mapMergeItemWithNo:$,checkedItems:Object.keys(_),selectKey:y,departments:F,handleDepartmentChange:O}),R&&(0,T.jsx)(P,{}),(0,T.jsx)(ye,{srNo:Object.keys(x||{}).length,departments:F,handleChange:E}),e.placeholder]})})]})})}),(0,T.jsxs)("div",{className:"merge-section",style:{marginTop:"20px",textAlign:"left"},children:[(0,T.jsx)(ae,{unique_id:p,selectItem:_,setSelectItem:C,merges:A,setMerges:S,setPayload:l,refetch:d,setPreExistMerges:N}),(0,T.jsx)(fe,{unique_id:p,merges:A,setMerges:S,refetch:d,deleteMergeCalculator:M})]})]})};var Ae=l(25721),Se=l(2028),_e=l(28676),Ce=l(74532),$e=l(72052),ke=l(59638),Fe=l(54967);const Re=e=>{var t,l,a,n;let{isLoading:i,data:o,setPayload:r}=e;const[d,u]=(0,s.useState)(null),[p,v]=(0,s.useState)(null),[j,f]=(0,s.useState)(!1),y=(0,s.useRef)(null),b=(0,s.useRef)(null),[w,N]=(0,s.useState)([]),[A,S]=(0,s.useState)(1),[_,C]=(0,s.useState)(!0),[$,F]=(0,s.useState)(!1),[R,q,E]=(0,Se.d7)("",400),L=o.addresses.find((e=>e.is_main))||(null!==(t=o.addresses)&&void 0!==t&&t.length?o.addresses[0]:{}),I=o.contact_persons.find((e=>e.is_main))||(null!==(l=o.contact_persons)&&void 0!==l&&l.length?o.contact_persons[0]:{}),B=(0,c.I)({queryKey:["id",d],queryFn:()=>(0,ke.EZ)(d),enabled:!!d,retry:1}),P=null===(a=B.data)||void 0===a?void 0:a.is_business,D=(null===(n=B.data)||void 0===n?void 0:n.contact_persons)||[];(0,s.useEffect)((()=>{S(1)}),[q]),(0,s.useEffect)((()=>{(async()=>{F(!0);const e=await(0,ke.oo)(A,25,q);var t;1===A?N(e.results):(null===e||void 0===e||null===(t=e.results)||void 0===t?void 0:t.length)>0&&N((t=>{const l=new Set(t.map((e=>e.id))),s=e.results.filter((e=>!l.has(e.id)));return[...t,...s]}));C(e.count!==w.length),F(!1)})()}),[A,q]);const z=()=>{const e=document.querySelector(".p-dropdown-items .p-dropdown-item:last-child");e&&!y.current&&(y.current=new IntersectionObserver((e=>{e[0].isIntersecting&&S((e=>e+1))}),{threshold:1}),y.current.observe(e))};(0,s.useEffect)((()=>{if(!j||!w.length||!_||!b.current)return;const e=setTimeout(z,100);return()=>{clearTimeout(e),y.current&&(y.current.disconnect(),y.current=null)}}),[w,_,j]);return(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)(x.A,{children:[j?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(h.A,{sm:6,style:{minHeight:"190px"},children:[(0,T.jsxs)("p",{style:{color:"#667085",fontSize:"14px",fontWeight:"600",marginBottom:"4px"},children:["Company",(0,T.jsx)("span",{className:"required",children:"*"})]}),(0,T.jsx)(k.m,{ref:b,value:d,loading:$,onChange:e=>u(e.value),options:w,itemTemplate:e=>(0,T.jsxs)("div",{className:"d-flex align-items-center gap-1",children:[(0,T.jsx)(Fe.h,{has_photo:e.has_photo,photo:e.photo,is_business:e.is_business}),(0,T.jsx)("div",{children:e.name})]}),valueTemplate:d&&(e=>{if(null!==e&&void 0!==e&&e.name)return(0,T.jsxs)("div",{className:"d-flex align-items-center gap-1",children:[(0,T.jsx)(Fe.h,{has_photo:null===e||void 0===e?void 0:e.has_photo,photo:null===e||void 0===e?void 0:e.photo,is_business:null===e||void 0===e?void 0:e.is_business}),(0,T.jsx)("div",{children:null===e||void 0===e?void 0:e.name})]})}),optionLabel:"name",optionValue:"id",placeholder:"Select client",filter:!0,filterTemplate:()=>(0,T.jsxs)(_e.C,{iconPosition:"left",children:[(0,T.jsx)(Ce.m,{children:(0,T.jsx)(Ae.A,{className:"mb-2"})}),(0,T.jsx)($e.S,{type:"text",value:R,onChange:e=>E(e.target.value),className:"p-inputtext p-component",placeholder:"Search clients",style:{width:"100%"}})]}),virtualScrollerOptions:{itemSize:46,lazy:!0,onLazyLoad:z},className:"w-100",filterInputAutoFocus:!0})]}),P&&(0,T.jsxs)(h.A,{sm:6,style:{minHeight:"190px"},children:[(0,T.jsx)("p",{style:{color:"#667085",fontSize:"14px",fontWeight:"600",marginBottom:"4px"},children:"Main Contact"}),(0,T.jsx)(k.m,{value:p,onChange:e=>v(e.value),options:D,optionLabel:e=>`${e.firstname} ${e.lastname}`,optionValue:"id",placeholder:"Select contact",filter:!0,loading:B.isLoading,className:"w-100",filterInputAutoFocus:!0})]})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(h.A,{sm:6,children:i?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(g.A,{as:"p",animation:"wave",className:"mb-1 mt-0",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary",className:"rounded-0",size:"sm",style:{width:"100%",height:"12px"}})}),(0,T.jsx)(g.A,{as:"p",animation:"wave",className:"mb-1 mt-0",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary",className:"rounded-0",size:"sm",style:{width:"100%",height:"12px"}})}),(0,T.jsx)(g.A,{as:"p",animation:"wave",className:"mb-1 mt-0",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary",className:"rounded-0",size:"sm",style:{width:"100%",height:"12px"}})}),(0,T.jsx)(g.A,{as:"p",animation:"wave",className:"mb-1 mt-0",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary",className:"rounded-0",size:"sm",style:{width:"100%",height:"12px"}})}),(0,T.jsx)(g.A,{as:"p",animation:"wave",className:"mb-1 mt-0",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary",className:"rounded-0",size:"sm",style:{width:"100%",height:"12px"}})})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("p",{style:{color:"#667085",fontSize:"14px",fontWeight:"600",marginBottom:"4px"},children:"Company"}),(0,T.jsx)("p",{style:{color:"#1D2939",fontSize:"16px",fontWeight:"400",marginBottom:"4px"},children:(null===o||void 0===o?void 0:o.name)||"-"}),(0,T.jsxs)("p",{style:{color:"#1D2939",fontSize:"16px",fontWeight:"400",marginBottom:"4px"},children:["ABN: ",(null===o||void 0===o?void 0:o.abn)||"-"]}),(0,T.jsx)("p",{style:{color:"#1D2939",fontSize:"16px",fontWeight:"400",marginBottom:"4px"},children:(null===o||void 0===o?void 0:o.phone)||"-"}),(0,T.jsx)("p",{style:{color:"#1D2939",fontSize:"16px",fontWeight:"400",marginBottom:"8px"},children:(null===L||void 0===L?void 0:L.address)||"-"})]})}),(0,T.jsxs)(h.A,{sm:6,children:[(0,T.jsx)("p",{style:{color:"#667085",fontSize:"14px",fontWeight:"600",marginBottom:"4px"},children:"Main Contact"}),(0,T.jsx)("p",{style:{color:"#1D2939",fontSize:"16px",fontWeight:"400",marginBottom:"4px"},children:`${(null===I||void 0===I?void 0:I.firstname)||"-"} ${(null===I||void 0===I?void 0:I.lastname)||"-"}`}),(0,T.jsx)("p",{style:{color:"#1D2939",fontSize:"16px",fontWeight:"400",marginBottom:"4px"},children:(null===I||void 0===I?void 0:I.position)||"-"}),(0,T.jsx)("p",{style:{color:"#1D2939",fontSize:"16px",fontWeight:"400",marginBottom:"4px"},children:(null===I||void 0===I?void 0:I.phone)||"-"}),(0,T.jsx)("p",{style:{color:"#1D2939",fontSize:"16px",fontWeight:"400",marginBottom:"4px"},children:(null===I||void 0===I?void 0:I.email)||"-"})]})]}),(0,T.jsx)(h.A,{sm:12,children:j?(0,T.jsxs)("div",{className:"d-flex",children:[(0,T.jsx)("button",{onClick:()=>{if(!d)return m.oR.error("Please select a client");r((e=>({...e,client:d,contact_person:p}))),f(!1)},className:"btn py-0",style:{color:"#158ECC",fontSize:"14px",fontWeight:"600"},children:"Save"}),(0,T.jsx)("button",{onClick:()=>f(!j),className:"btn py-0",style:{color:"#B42318",fontSize:"14px",fontWeight:"600"},children:"Cancel"})]}):(0,T.jsx)("button",{onClick:()=>f(!j),className:"btn p-0",style:{color:"#158ECC",fontSize:"14px",fontWeight:"600"},children:"Edit info"})})]})})},qe=e=>{var t,l,a,n;let{isLoading:i,data:o,setPayload:r}=e;const[d,u]=(0,s.useState)(null),[p,v]=(0,s.useState)(null),[j,f]=(0,s.useState)(!1),y=(0,s.useRef)(null),b=(0,s.useRef)(null),[w,N]=(0,s.useState)([]),[A,S]=(0,s.useState)(1),[_,C]=(0,s.useState)(!0),[$,F]=(0,s.useState)(!1),[R,q,E]=(0,Se.d7)("",400),L=(null===o||void 0===o||null===(t=o.contact_persons)||void 0===t?void 0:t.find((e=>e.is_main)))||(null!==o&&void 0!==o&&null!==(l=o.contact_persons)&&void 0!==l&&l.length?null===o||void 0===o?void 0:o.contact_persons[0]:{}),I=(0,c.I)({queryKey:["id",d],queryFn:()=>(0,ke.EZ)(d),enabled:!!d,retry:1}),B=(null===(a=I.data)||void 0===a?void 0:a.contact_persons)||[],P=null===(n=I.data)||void 0===n?void 0:n.is_business;(0,s.useEffect)((()=>{S(1)}),[q]),(0,s.useEffect)((()=>{(async()=>{F(!0);const e=await(0,ke.oo)(A,25,q);var t;1===A?N(e.results):(null===e||void 0===e||null===(t=e.results)||void 0===t?void 0:t.length)>0&&N((t=>{const l=new Set(t.map((e=>e.id))),s=e.results.filter((e=>!l.has(e.id)));return[...t,...s]}));C(e.count!==w.length),F(!1)})()}),[A,q]);const D=()=>{const e=document.querySelector(".p-dropdown-items .p-dropdown-item:last-child");e&&!y.current&&(y.current=new IntersectionObserver((e=>{e[0].isIntersecting&&S((e=>e+1))}),{threshold:1}),y.current.observe(e))};(0,s.useEffect)((()=>{if(!j||!w.length||!_||!b.current)return;const e=setTimeout(D,100);return()=>{clearTimeout(e),y.current&&(y.current.disconnect(),y.current=null)}}),[w,_,j]);return(0,T.jsxs)(x.A,{children:[j?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(h.A,{sm:6,style:{minHeight:"190px"},children:[(0,T.jsxs)("p",{style:{color:"#667085",fontSize:"14px",fontWeight:"600",marginBottom:"4px"},children:["Company",(0,T.jsx)("span",{className:"required",children:"*"})]}),(0,T.jsx)(k.m,{ref:b,value:d,loading:$,onChange:e=>u(e.value),options:w,itemTemplate:e=>(0,T.jsxs)("div",{className:"d-flex align-items-center gap-1",children:[(0,T.jsx)(Fe.h,{has_photo:e.has_photo,photo:e.photo,is_business:e.is_business}),(0,T.jsx)("div",{children:e.name})]}),valueTemplate:d&&(e=>{if(null!==e&&void 0!==e&&e.name)return(0,T.jsxs)("div",{className:"d-flex align-items-center gap-1",children:[(0,T.jsx)(Fe.h,{has_photo:null===e||void 0===e?void 0:e.has_photo,photo:null===e||void 0===e?void 0:e.photo,is_business:null===e||void 0===e?void 0:e.is_business}),(0,T.jsx)("div",{children:null===e||void 0===e?void 0:e.name})]})}),optionLabel:"name",optionValue:"id",placeholder:"Select client",filter:!0,filterTemplate:()=>(0,T.jsxs)(_e.C,{iconPosition:"left",children:[(0,T.jsx)(Ce.m,{children:(0,T.jsx)(Ae.A,{className:"mb-2"})}),(0,T.jsx)($e.S,{type:"text",value:R,onChange:e=>E(e.target.value),className:"p-inputtext p-component",placeholder:"Search clients",style:{width:"100%"}})]}),virtualScrollerOptions:{itemSize:46,lazy:!0,onLazyLoad:D},className:"w-100",filterInputAutoFocus:!0})]}),P&&(0,T.jsxs)(h.A,{sm:6,style:{minHeight:"190px"},children:[(0,T.jsx)("p",{style:{color:"#667085",fontSize:"14px",fontWeight:"600",marginBottom:"4px"},children:"Main Contact"}),(0,T.jsx)(k.m,{value:p,onChange:e=>v(e.value),options:B,optionLabel:e=>`${e.firstname} ${e.lastname}`,optionValue:"id",placeholder:"Select contact",filter:!0,loading:I.isLoading,className:"w-100",filterInputAutoFocus:!0})]})]}):(0,T.jsx)(h.A,{sm:12,children:i?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(g.A,{as:"p",animation:"wave",className:"mb-1 mt-0",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary",className:"rounded-0",size:"sm",style:{width:"100%",height:"12px"}})}),(0,T.jsx)(g.A,{as:"p",animation:"wave",className:"mb-1 mt-0",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary",className:"rounded-0",size:"sm",style:{width:"100%",height:"12px"}})}),(0,T.jsx)(g.A,{as:"p",animation:"wave",className:"mb-1 mt-0",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary",className:"rounded-0",size:"sm",style:{width:"100%",height:"12px"}})}),(0,T.jsx)(g.A,{as:"p",animation:"wave",className:"mb-1 mt-0",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary",className:"rounded-0",size:"sm",style:{width:"100%",height:"12px"}})}),(0,T.jsx)(g.A,{as:"p",animation:"wave",className:"mb-1 mt-0",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary",className:"rounded-0",size:"sm",style:{width:"100%",height:"12px"}})})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("p",{style:{color:"#667085",fontSize:"14px",fontWeight:"600",marginBottom:"4px"},children:"Main Contact"}),(0,T.jsx)("p",{style:{color:"#1D2939",fontSize:"16px",fontWeight:"400",marginBottom:"4px"},children:`${(null===L||void 0===L?void 0:L.firstname)||"-"} ${(null===L||void 0===L?void 0:L.lastname)||"-"}`}),(0,T.jsx)("p",{style:{color:"#1D2939",fontSize:"16px",fontWeight:"400",marginBottom:"4px"},children:(null===L||void 0===L?void 0:L.position)||"-"}),(0,T.jsx)("p",{style:{color:"#1D2939",fontSize:"16px",fontWeight:"400",marginBottom:"4px"},children:(null===L||void 0===L?void 0:L.phone)||"-"}),(0,T.jsx)("p",{style:{color:"#1D2939",fontSize:"16px",fontWeight:"400",marginBottom:"4px"},children:(null===L||void 0===L?void 0:L.email)||"-"})]})}),(0,T.jsx)(h.A,{sm:12,children:j?(0,T.jsxs)("div",{className:"d-flex",children:[(0,T.jsx)("button",{onClick:()=>{if(!d)return m.oR.error("Please select a client");r((e=>({...e,client:d,contact_person:p}))),f(!1)},className:"btn py-0",style:{color:"#158ECC",fontSize:"14px",fontWeight:"600"},children:"Save"}),(0,T.jsx)("button",{onClick:()=>f(!j),className:"btn py-0",style:{color:"#B42318",fontSize:"14px",fontWeight:"600"},children:"Cancel"})]}):(0,T.jsx)("button",{onClick:()=>f(!j),className:"btn p-0",style:{color:"#158ECC",fontSize:"14px",fontWeight:"600"},children:"Edit info"})})]})},Ee=e=>{let{label:t,name:l,value:s,checked:a,onChange:n,disabled:i}=e;return(0,T.jsxs)("label",{className:"custom-radio-button "+(i?"disabled":""),children:[(0,T.jsx)("input",{type:"radio",name:l,value:s,checked:a,onChange:n,disabled:i}),(0,T.jsx)("span",{className:"custom-radio-button__checkmark"}),t]})},Le=e=>(0,T.jsx)(N.c.Option,{...e,children:(0,T.jsxs)("div",{className:"d-flex align-items-center",children:[(0,T.jsx)(Fe.h,{has_photo:null===e||void 0===e?void 0:e.data.has_photo,photo:e.data.image,is_business:!1}),e.data.label]})}),Ie=s.memo((e=>{var t,l,a,n,i,o,r,d,u,p,m;let{payload:N,setPayload:q,setTotals:E,refetch:L,preExistCalculation:I,preExistMerges:B,setMergeDeletedItems:P,setContactPersons:D,quoteType:z}=e;const[M,U]=(0,s.useState)("request"),[O,W]=(0,s.useState)([]),[G,H]=(0,s.useState)(""),[K,Y]=(0,s.useState)(!1),[Q,V]=(0,s.useState)(""),[J,Z]=(0,s.useState)(!1),X=e=>{H(e.target.value),V(e.target.value)},ee=(0,c.I)({queryKey:["project-manager"],queryFn:ke.Fl}),te=(0,c.I)({queryKey:["id",N.client],queryFn:()=>(0,ke.EZ)(N.client),enabled:!!N.client,retry:1});return(0,s.useEffect)((()=>{var e,t;if(null!==(e=te.data)&&void 0!==e&&null!==(t=e.contact_persons)&&void 0!==t&&t.length){var l,s,a;let e=null===(l=te.data)||void 0===l?void 0:l.contact_persons[0],t=null===(s=te.data)||void 0===s?void 0:s.contact_persons.find((e=>!0===e.is_main));q(t?e=>({...e,contact_person:t.id}):t=>({...t,contact_person:e.id})),D(null===(a=te.data)||void 0===a?void 0:a.contact_persons)}}),[te.data]),(0,s.useEffect)((()=>{if(N.managers){const e=N.managers.reduce(((e,t)=>(e.some((e=>e.manager===t.manager))||e.push(t),e)),[]).map((e=>{var t,l,s,a,n,i;return{value:e.manager,has_photo:null===ee||void 0===ee||null===(t=ee.data)||void 0===t||null===(l=t.find((t=>t.id===e.manager)))||void 0===l?void 0:l.has_photo,label:(null===ee||void 0===ee||null===(s=ee.data)||void 0===s||null===(a=s.find((t=>t.id===e.manager)))||void 0===a?void 0:a.name)||"Unknown",image:(null===ee||void 0===ee||null===(n=ee.data)||void 0===n||null===(i=n.find((t=>t.id===e.manager)))||void 0===i?void 0:i.photo)||"https://dev.memate.com.au/media/no_org.png"}}));W(e)}}),[N.managers,ee.data]),(0,T.jsxs)(s.Fragment,{children:[(0,T.jsx)("div",{className:"company-info text-left",style:{background:"#fff",borderRadius:"4px",padding:"16px",marginBottom:"16px"},children:(0,T.jsxs)(x.A,{children:[(0,T.jsxs)(h.A,{md:8,style:{borderRight:"1px solid #F2F4F7"},children:[(0,T.jsxs)("h3",{style:{color:"#344054",fontSize:"16px",fontWeight:"600"},children:["Reference  ",(0,T.jsx)(y.A,{color:"#667085",size:16})]}),te.isLoading?(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary",className:"rounded-0",size:"sm",style:{width:"120px",height:"20px"}})}):K?(0,T.jsx)("p",{children:(0,T.jsx)("input",{type:"text",value:G,onChange:X,onBlur:()=>{Y(!1),q((e=>({...e,reference:G})))},autoFocus:!0,className:"border rounded p-2 w-100"})}):(0,T.jsx)("div",{children:(0,T.jsxs)("p",{style:{color:"#475467",fontSize:"16px",fontWeight:"400",marginBottom:"16px",whiteSpace:"pre-line"},children:[N.reference,(0,T.jsx)(b.A,{size:16,color:"#106B99",onClick:()=>{Y(!0),H(N.reference||"")},className:"ms-2",style:{cursor:"pointer"}})]})}),(0,T.jsx)("h3",{style:{color:"#344054",fontSize:"16px",fontWeight:"600"},children:"Description"}),te.isLoading?(0,T.jsx)(g.A,{as:"p",animation:"wave",children:(0,T.jsx)(g.A,{xs:12,bg:"secondary",className:"rounded-0",size:"sm",style:{width:"120px",height:"20px"}})}):J?(0,T.jsx)("p",{children:(0,T.jsx)("textarea",{type:"text",value:Q,onChange:X,onBlur:()=>{Z(!1),q((e=>({...e,description:Q})))},autoFocus:!0,className:"border rounded p-2",style:{resize:"none",width:"100%",height:"120px"}})}):(0,T.jsxs)("div",{className:"mb-4",children:[(0,T.jsx)("p",{style:{color:"#475467",fontSize:"16px",fontWeight:"400",marginBottom:"0px",whiteSpace:"pre-line",maxHeight:"200px",overflow:"auto"},children:N.description}),(0,T.jsx)(b.A,{size:16,color:"#106B99",onClick:()=>{Z(!0),V(N.description||"")},className:"ms-1",style:{cursor:"pointer"}})]})]}),(0,T.jsxs)(h.A,{md:4,children:[(0,T.jsxs)("h3",{style:{color:"#344054",fontSize:"16px",fontWeight:"600"},children:["Quote To  ",(0,T.jsx)(y.A,{color:"#667085",size:16})]}),(0,T.jsx)(x.A,{children:null!==te&&void 0!==te&&null!==(t=te.data)&&void 0!==t&&t.is_business?(0,T.jsx)(Re,{isLoading:null===te||void 0===te?void 0:te.isLoading,data:null===te||void 0===te?void 0:te.data,setPayload:q}):(0,T.jsx)(qe,{isLoading:null===te||void 0===te?void 0:te.isLoading,data:null===te||void 0===te?void 0:te.data,setPayload:q})})]})]})}),(0,T.jsxs)("div",{className:"DepartmentQuote mb-3",style:{background:"#fff",borderRadius:"4px",padding:"16px",width:"100%"},children:[(0,T.jsx)(Ne,{setTotals:E,setPayload:q,xero_tax:N.xero_tax,defaultDiscount:(null===te||void 0===te||null===(l=te.data)||void 0===l||null===(a=l.category)||void 0===a?void 0:a.value)||0,preExistCalculation:I,preMerges:B,refetch:L,setMergeDeletedItems:P}),(0,T.jsxs)(x.A,{children:[(0,T.jsx)(h.A,{md:6,children:(0,T.jsxs)(R.A.Group,{className:"mb-3 text-start note-textarea",controlId:"exampleForm.ControlTextarea1",children:[(0,T.jsx)(R.A.Label,{style:{color:"#475467",fontSize:"14px"},children:"Notes on the quote/invoice"}),(0,T.jsx)(R.A.Control,{as:"textarea",rows:3,placeholder:"Enter a description...",value:N.note||"",onChange:e=>q((t=>({...t,note:e.target.value}))),required:!0,className:"textarea",style:{height:"229px",padding:"12px 14px",resize:"none"}})]})}),(0,T.jsx)(h.A,{md:6,children:(0,T.jsxs)(x.A,{children:[(0,T.jsx)(h.A,{children:(0,T.jsxs)(x.A,{children:[(0,T.jsx)(h.A,{sm:12,className:"text-start",children:(0,T.jsxs)("div",{className:"formgroupboxs mb-3 mt-1",children:[(0,T.jsxs)("label",{style:{color:"#475467",fontSize:"14px",display:"block",marginBottom:"6px"},children:["Project Manager",(0,T.jsx)("span",{className:"required",children:"*"})]}),(0,T.jsx)("div",{className:"inputInfo px-0",style:{minHeight:"46px",height:"fit-content",padding:"0px 14px"},children:(0,T.jsx)(A.Ay,{placeholder:"Select Manager",className:"basic-multi-select w-100 border-0",closeMenuOnSelect:!1,components:{Option:Le},value:O,onChange:e=>{const t=e?[...new Map(e.map((e=>[e.value,{manager:e.value}]))).values()]:[];W(e),q((e=>({...e,managers:t||[]})))},isMulti:!0,styles:{control:e=>({...e,boxShadow:"none"}),multiValueRemove:e=>({...e,":hover":{backgroundColor:"#fff",cursor:"pointer"}}),multiValue:(e,t)=>{let{data:l}=t;return{...e,backgroundColor:"#fff",border:"1px solid #D0D5DD",borderRadius:"4px",":before":{borderRadius:"50%",content:'" "',backgroundImage:null!==l&&void 0!==l&&l.has_photo?`url(${l.image})`:'url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNiAxNiIgd2lkdGg9IjFlbSIgaGVpZ2h0PSIxZW0iIGZpbGw9IiM2NjcwODUiIGNsYXNzPSJiaSBiaS1wZXJzb24iPjxwYXRoIGQ9Ik04IDhhMyAzIDAgMSAwIDAtNiAzIDMgMCAwIDAgMCA2bTItM2EyIDIgMCAxIDEtNCAwIDIgMiAwIDEgMSA0IDBtNCA4YzAgMS0xIDEtMSAxSDMscy0xIDAtMS0xIDEtNCA2LTQgNiAzIDYgNG0tMS0uMDA0Yy0uMDAxLS4yNDYtLjE1NC0uOTg2LS44MzItMS42NjRDMTEuNTE2IDEwLjY4IDEwLjI4OSAxMCA4IDEwcy0zLjUxNi42OC00LjE2OCAxLjMzMmMtLjY3OC42NzgtLjgzIDEuNDE4LS44MzIgMS42NjR6Ij48L3BhdGg+PC9zdmc+")',backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",display:"block",marginRight:8,position:"relative",top:"5px",left:"5px",height:16,width:16,border:"0.3px solid #101828"}}}},options:null===ee||void 0===ee||null===(n=ee.data)||void 0===n?void 0:n.map((e=>({value:e.id,label:e.name,image:e.photo,has_photo:e.has_photo})))})})]})}),(0,T.jsx)(h.A,{sm:12,className:"text-start",children:(0,T.jsxs)("div",{className:"formgroupboxs mb-3",children:[(0,T.jsx)("label",{style:{color:"#475467",fontSize:"14px",marginBottom:"6px"},children:"PO"}),(0,T.jsx)("div",{className:"inputInfo px-0",style:{height:"46px"},children:(0,T.jsx)(R.A.Control,{required:!0,type:"text",placeholder:"Purchase Order #",value:(null===N||void 0===N?void 0:N.purchase_order)||"",style:{color:"#101828"},className:"w-100 m-0 border-0 no-border-outline",onChange:e=>q((t=>({...t,purchase_order:e.target.value})))})})]})}),(0,T.jsx)(h.A,{sm:12,className:"text-start",children:(0,T.jsxs)(R.A.Group,{className:"mb-3 mui-select-custom",children:[(0,T.jsxs)(R.A.Label,{style:{color:"#475467",fontSize:"14px",marginBottom:"6px"},children:["Amounts are",(0,T.jsx)("span",{className:"required",children:"*"})]}),(0,T.jsx)(S.A,{sx:{m:0,minWidth:"100%",color:"#101828"},children:(0,T.jsxs)(_.A,{value:(null===N||void 0===N?void 0:N.xero_tax)||"",onChange:e=>q((t=>({...t,xero_tax:e.target.value}))),displayEmpty:!0,inputProps:{"aria-label":"Without label"},IconComponent:w.A,children:[(0,T.jsx)(C.A,{value:"ex",children:"Tax exclusive"}),(0,T.jsx)(C.A,{value:"in",children:"Tax Inclusive"}),(0,T.jsx)(C.A,{value:"no",children:"No tax"})]})})]})})]})}),(0,T.jsx)(h.A,{children:(0,T.jsxs)(x.A,{children:[(0,T.jsx)(h.A,{sm:12,className:"quoteInvoice",children:(0,T.jsxs)("div",{className:"radio-buttons mt-4 pt-3",children:[(0,T.jsx)(Ee,{label:(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("b",{children:"Request Payment "})," ",(0,T.jsxs)("span",{children:[" Create an invoice requesting ",(0,T.jsx)("br",{}),"payment on a specific date"]})]}),name:"payment",value:"request",checked:"request"===M,onChange:()=>U("request")}),(0,T.jsx)(Ee,{label:(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("b",{children:"Autocharge Customer "})," ",(0,T.jsxs)("span",{children:[" Automatically charge a payment",(0,T.jsx)("br",{})," method on file"]})]}),name:"payment",value:"auto",checked:"auto"===M,onChange:()=>U("auto")})]})}),(0,T.jsx)(h.A,{sm:12,children:(0,T.jsxs)("div",{className:"toggle-switch-wrap",children:[(0,T.jsxs)("label",{className:"toggle-switch",children:[(0,T.jsx)("input",{type:"checkbox",checked:Boolean(N.display_discount),onChange:e=>q((t=>({...t,display_discount:e.target.checked})))}),(0,T.jsx)("span",{className:"switch"})]}),(0,T.jsx)("em",{children:"Display Discounts"})]})})]})})]})})]})]}),"Recurring"===z&&(0,T.jsxs)("div",{style:{background:"#fff",borderRadius:"4px",padding:"16px",width:"100%"},children:[(0,T.jsxs)("h3",{style:{color:"rgb(52, 64, 84)",fontSize:"16px",fontWeight:"600",textAlign:"left"},children:["Recurring Details "," ",["top"].map((e=>(0,T.jsx)(v.A,{placement:e,overlay:(0,T.jsx)(j.A,{className:"TooltipOverlay width-300",id:`tooltip-${e}`,children:(0,T.jsxs)("div",{className:"text-start",children:["1. Daily - 15 Upfront ",(0,T.jsx)("br",{}),"2. Weekly - Day of the Week - 5 Upfront",(0,T.jsx)("br",{}),"3. Biweekly - Day of the week - 4 Upfront",(0,T.jsx)("br",{}),"4. Monthly - Date - 3 Upfront",(0,T.jsx)("br",{}),"5. Last Day of the Month - Date - 3 Upfront",(0,T.jsx)("br",{}),"6. Quarterly - Date - 4 Upfront",(0,T.jsx)("br",{}),"7. Yearly - 2 Upfront"]})}),children:(0,T.jsxs)(f.A,{className:"ms-1 bg-transparent border-0 p-0",children:[(0,T.jsx)(y.A,{size:16,color:"#667085"})," "]})},e)))]}),(0,T.jsxs)("div",{className:"d-flex align-items-center gap-3",children:[(0,T.jsxs)("div",{className:"formgroupboxs mb-3 text-start",children:[(0,T.jsxs)("label",{style:{color:"#475467",fontSize:"14px",marginBottom:"6px",display:"block"},children:["Frequency ",(0,T.jsx)("span",{className:"required",children:"*"})]}),(0,T.jsx)(k.m,{style:{height:"46px",minWidth:"250px",maxWidth:"250px"},value:(null===N||void 0===N||null===(i=N.recurring)||void 0===i?void 0:i.frequency)||null,onChange:e=>q((t=>({...t,recurring:{...null===t||void 0===t?void 0:t.recurring,frequency:e.value}}))),options:[{label:"Daily",value:"D"},{label:"Weekly",value:"W"},{label:"Biweekly",value:"B"},{label:"Monthly",value:"M"},{label:"Last Day of the Month",value:"L"},{label:"Quarterly",value:"Q"},{label:"Yearly",value:"Y"}],className:"w-100 outline-none",placeholder:"Select frequency",filterInputAutoFocus:!0})]}),(0,T.jsxs)("div",{className:"formgroupboxs mb-3 text-start",children:[(0,T.jsxs)("label",{style:{color:"#475467",fontSize:"14px",marginBottom:"6px"},children:["Start ",(0,T.jsx)("span",{className:"required",children:"*"})]}),(0,T.jsx)($.V,{value:(null===N||void 0===N||null===(o=N.recurring)||void 0===o?void 0:o.start_date)||null,onChange:e=>q((t=>({...t,recurring:{...null===t||void 0===t?void 0:t.recurring,start_date:e.value}}))),showButtonBar:!0,placeholder:"DD/MM/YY",dateFormat:"dd/mm/yy",locale:"en",style:{height:"46px"},className:"w-100 outline-none border rounded"})]}),(0,T.jsxs)("div",{className:"formgroupboxs mb-3 text-start",children:[(0,T.jsxs)("label",{style:{color:"#475467",fontSize:"14px",marginBottom:"6px"},children:["End ",(0,T.jsx)("span",{className:"required",children:"*"})]}),(0,T.jsx)(k.m,{value:null===N||void 0===N||null===(r=N.recurring)||void 0===r?void 0:r.end_by,onChange:e=>q((t=>({...t,recurring:{...null===t||void 0===t?void 0:t.recurring,end_by:e.value}}))),options:[{label:"No end",value:0},{label:"Number of Occurrences",value:2},{label:"By date",value:1}],style:{height:"46px",minWidth:"260px"},className:"w-100 outline-none",placeholder:"Select an end",filterInputAutoFocus:!0})]}),2===(null===N||void 0===N||null===(d=N.recurring)||void 0===d?void 0:d.end_by)?(0,T.jsxs)("div",{className:"formgroupboxs mb-3 text-start",children:[(0,T.jsxs)("label",{style:{color:"#475467",fontSize:"14px",marginBottom:"6px"},children:["Number of Occurrences ",(0,T.jsx)("span",{className:"required",children:"*"})]}),(0,T.jsx)(F.Y,{value:(null===N||void 0===N||null===(u=N.recurring)||void 0===u?void 0:u.occurrences)||0,onValueChange:e=>q((t=>({...t,recurring:{...null===t||void 0===t?void 0:t.recurring,occurrences:e.target.value}}))),style:{height:"46px"},placeholder:"Enter number of occurrences",inputStyle:{width:"80px"},className:"w-100 outline-none border rounded"})]}):1===(null===N||void 0===N||null===(p=N.recurring)||void 0===p?void 0:p.end_by)?(0,T.jsxs)("div",{className:"formgroupboxs mb-3 text-start",children:[(0,T.jsxs)("label",{style:{color:"#475467",fontSize:"14px",marginBottom:"6px"},children:["By Date ",(0,T.jsx)("span",{className:"required",children:"*"})]}),(0,T.jsx)($.V,{value:(null===N||void 0===N||null===(m=N.recurring)||void 0===m?void 0:m.end_date)||null,onChange:e=>q((t=>({...t,recurring:{...null===t||void 0===t?void 0:t.recurring,end_date:e.value}}))),showButtonBar:!0,placeholder:"DD/MM/YY",dateFormat:"dd/mm/yy",locale:"en",style:{height:"46px"},className:"w-100 outline-none border rounded"})]}):null]})]})]})}));var Be=l(48417),Te=l(99832),Pe=l(83627),De=l(69956),ze=l(21052),Me=l(55797),Ue=l(8868);const Oe={iconStyle:"create-proposal_iconStyle__Q0cmV",headerTitle:"create-proposal_headerTitle__vMyBv",customLabel:"create-proposal_customLabel__vKXkN",dropdownSelect:"create-proposal_dropdownSelect__uAoBl",accordion:"create-proposal_accordion__WM+iT",error:"create-proposal_error__QxGLm","p-accordion-content":"create-proposal_p-accordion-content__om9Aa",uploadBox:"create-proposal_uploadBox__KxAAF",imageBox:"create-proposal_imageBox__-Eh-d",uploadButton:"create-proposal_uploadButton__jHShw",uploadText:"create-proposal_uploadText__mWPJf",trashBox:"create-proposal_trashBox__A3WDp"};var We=l(76163),Ge=l(89488),He=l(55683);const Ke="file-uploader_title__MJFJ7",Ye="file-uploader_previewSection__ot4jI",Qe="file-uploader_previewBox__KC4if",Ve="file-uploader_previewBoxImg1__rKP04",Je="file-uploader_previewActions__r3LWm",Ze="file-uploader_label__pWhYK";const Xe=e=>{let{show:t,setShow:l,setPhoto:a,additionalDesign:n,shape:i="rect"}=e;const[o,r]=(0,s.useState)([]),[d,c]=(0,s.useState)({x:0,y:0}),[u,p]=(0,s.useState)(1),[x,h]=(0,s.useState)(0),[g,v]=(0,s.useState)(null),[j,y]=(0,s.useState)({}),b=(0,s.useCallback)(((e,t)=>{v(t)}),[]),w=(0,s.useCallback)((async()=>{if(!o.length||!g)return;const e=document.createElement("canvas"),t=e.getContext("2d"),l=new Image;l.src=o[0].preview,await new Promise((e=>l.onload=e)),e.width=g.width,e.height=g.height,t.translate(e.width/2,e.height/2),t.rotate(x*Math.PI/180),t.translate(-e.width/2,-e.height/2),t.drawImage(l,g.x,g.y,g.width,g.height,0,0,g.width,g.height);return e.toDataURL("image/jpeg")}),[o,g,x]),N=async()=>{const e=await w();e&&y({img2:e,img3:e,img4:e,img5:e})};(0,s.useEffect)((()=>{N()}),[u,d,x,o,g]);const{getRootProps:A,getInputProps:S}=(0,Ge.VB)({maxFiles:1,accept:{"image/*":[]},onDrop:e=>{r(e.map((e=>Object.assign(e,{preview:URL.createObjectURL(e)}))))}});return(0,T.jsxs)(K.A,{style:{zIndex:1111},show:t,centered:!0,onHide:()=>l(!1),onShow:N,children:[(0,T.jsx)(K.A.Header,{closeButton:!0,children:(0,T.jsx)(K.A.Title,{children:(0,T.jsx)("span",{className:`${Ke}`,children:"Edit Photo"})})}),(0,T.jsxs)(K.A.Body,{children:[n,(0,T.jsxs)("div",{className:`${Ye}`,children:[(0,T.jsx)("div",{className:`${Qe}`,children:(0,T.jsx)("div",{className:(0,J.A)(Ve,"round"===i?"rounded-circle":""),children:(0,T.jsx)(He.Ay,{image:o.length>0?o[0].preview:null,crop:d,zoom:u,cropShape:i,rotation:x,onCropChange:c,onZoomChange:p,onCropComplete:b,aspect:1.5,restrictPosition:!1,style:{containerStyle:{width:"100%",height:"100%",position:"relative"},cropAreaStyle:{width:"100%",height:"100%"},mediaStyle:{width:"100%",height:"100%",objectFit:"contain"}}})})}),(0,T.jsxs)("div",{className:`${Je}`,children:[(0,T.jsxs)(R.A.Group,{children:[(0,T.jsx)(R.A.Label,{className:`${Ze}`,children:"Zoom"}),(0,T.jsx)(R.A.Range,{value:u,min:1,max:3,step:.1,className:"custom-range",onChange:e=>p(e.target.value)})]}),(0,T.jsx)("div",{className:"d-flex align-item-center pt-4 ms-4",style:{gap:"8px"},children:(0,T.jsxs)(f.A,{className:"text-button",onClick:()=>{h((e=>(e+90)%360))},children:[(0,T.jsx)(We.A,{color:"#106B99",size:24}),"Rotate"]})})]})]}),(0,T.jsxs)("div",{...A({className:"dropzone d-flex justify-content-center align-items-center flex-column"}),style:{width:"100%",height:"126px",background:"#fff",borderRadius:"4px",border:"1px solid #EAECF0",marginTop:"16px"},children:[(0,T.jsx)("input",{...S()}),(0,T.jsx)("button",{type:"button",className:"d-flex justify-content-center align-items-center",style:{width:"40px",height:"40px",border:"1px solid #EAECF0",background:"#fff",borderRadius:"8px",marginBottom:"16px"},children:(0,T.jsx)(De.A,{})}),(0,T.jsxs)("p",{className:"mb-0",style:{color:"#475467",fontSize:"14px"},children:[(0,T.jsx)("span",{style:{color:"#106B99",fontWeight:"600"},children:"Click to upload"})," or drag and drop"]}),(0,T.jsx)("span",{style:{color:"#475467",fontSize:"12px"},children:"SVG, PNG, JPG or GIF (max. 800x400px)"})]})]}),(0,T.jsxs)(K.A.Footer,{className:"d-flex justify-content-end",children:[(0,T.jsx)(f.A,{className:"outline-button",onClick:e=>{e.stopPropagation(),r([]),y({}),l(!1)},children:"Cancel"}),(0,T.jsx)(f.A,{className:"solid-button",onClick:async()=>{const e=await w();if(!e)return m.oR.error("Please select a photo");const t=function(e,t){const l=atob(e.split(",")[1]),s=new ArrayBuffer(l.length),a=new Uint8Array(s);for(let n=0;n<l.length;n++)a[n]=l.charCodeAt(n);return new Blob([s],{type:t})}(e,"image/jpeg");a({croppedImageBase64:e,croppedImageBlob:t}),l(!1),r([]),y({})},children:"Save Photo"})]})]})};var et=l(81047),tt=l(75758);const lt={headerTitle:"send-proposal-email_headerTitle__Z8dTz",customLabel:"send-proposal-email_customLabel__BN+xG",bag:"send-proposal-email_bag__a-GeD",lable:"send-proposal-email_lable__PQY4a",dropdownSelect:"send-proposal-email_dropdownSelect__WENZ5",autoCompleteBox:"send-proposal-email_autoCompleteBox__la62D",AutoComplete:"send-proposal-email_AutoComplete__55Bdi",bcc:"send-proposal-email_bcc__G5naH",box:"send-proposal-email_box__CiEmC",active:"send-proposal-email_active__ERNoo",inputBox:"send-proposal-email_inputBox__-sHnD"},st=(0,T.jsx)("div",{className:`${lt.modalHeader}`,children:(0,T.jsx)("div",{className:"w-100 d-flex align-items-center gap-2",children:(0,T.jsx)("span",{className:`white-space-nowrap mt-2 mb-2 ${lt.headerTitle}`,children:"Send a Proposal"})})}),at=(0,T.jsxs)("span",{className:"ql-formats",children:[(0,T.jsx)("button",{className:"ql-bold","aria-label":"Bold"}),(0,T.jsx)("button",{className:"ql-italic","aria-label":"Italic"}),(0,T.jsx)("button",{className:"ql-underline","aria-label":"Underline"}),(0,T.jsx)("button",{className:"ql-strike","aria-label":"Strikethrough"}),(0,T.jsx)("button",{className:"ql-blockquote","aria-label":"Blockquote"}),(0,T.jsx)("button",{className:"ql-list",value:"ordered","aria-label":"Ordered List"}),(0,T.jsx)("button",{className:"ql-list",value:"bullet","aria-label":"Bullet List"}),(0,T.jsx)("button",{className:"ql-align",value:"","aria-label":"Align Left"}),(0,T.jsx)("button",{className:"ql-align",value:"center","aria-label":"Align Center"}),(0,T.jsx)("button",{className:"ql-align",value:"right","aria-label":"Align Right"}),(0,T.jsx)("button",{className:"ql-align",value:"justify","aria-label":"Justify"}),(0,T.jsx)("button",{className:"ql-link","aria-label":"Insert Link"}),(0,T.jsx)("button",{className:"ql-image","aria-label":"Insert Image"}),(0,T.jsx)("button",{className:"ql-code-block","aria-label":"Code Block"})]}),nt=e=>{var t,l,a,n;let{show:i,setShow:o,contactPersons:r,setPayload:d,save:u}=e;const m=JSON.parse(window.localStorage.getItem("profileData")||"{}"),[g,v]=(0,s.useState)(""),[j,y]=(0,s.useState)([]),[b,w]=(0,s.useState)([]),[N,A]=(0,s.useState)([]),[S,_]=(0,s.useState)(null),[C,$]=(0,s.useState)(null),[F,R]=(0,s.useState)(null),[q,E]=(0,s.useState)({}),[L,I]=(0,s.useState)([]),B=(0,s.useRef)(null),P=(0,s.useRef)(null),D=(0,s.useRef)(null),[z,M]=(0,s.useState)(!1),[U,O]=(0,s.useState)(!1),[W,G]=(0,s.useState)(!1),[H,K]=(0,s.useState)(null),Y=(0,c.I)({queryKey:["emailTemplate"],queryFn:et.SQ}),Q=(0,c.I)({queryKey:["getSignatureTemplates"],queryFn:et.AO}),V=(0,c.I)({queryKey:["getOutgoingEmail"],queryFn:et.hx}),Z=(0,c.I)({queryKey:["emailQuery",H],queryFn:()=>(0,et.hS)(H),enabled:!!H,retry:1});(0,s.useEffect)((()=>{var e,t,l;null!==V&&void 0!==V&&V.data&&(null!==V&&void 0!==V&&null!==(e=V.data)&&void 0!==e&&e.outgoing_email&&null!==V&&void 0!==V&&null!==(t=V.data)&&void 0!==t&&t.outgoing_email_verified?v(null===V||void 0===V||null===(l=V.data)||void 0===l?void 0:l.outgoing_email):v("no-reply@memate.com.au"));if(!H&&null!==Y&&void 0!==Y&&Y.data){var s;const e=null===Y||void 0===Y||null===(s=Y.data)||void 0===s?void 0:s.find((e=>"Proposal"===e.type));null!==e&&void 0!==e&&e.id&&K(e.id)}}),[Z,V]);const X=(0,T.jsxs)("div",{className:"d-flex justify-content-end gap-2",children:[(0,T.jsx)(f.A,{className:"outline-button",onClick:()=>o(!1),children:"Cancel"}),(0,T.jsxs)(f.A,{className:"solid-button",disabled:W,onClick:async()=>{let e=0;E({}),g||(++e,E((e=>({...e,from:!0})))),0===(null===j||void 0===j?void 0:j.length)&&(++e,E((e=>({...e,to:!0})))),S||(++e,E((e=>({...e,subject:!0})))),C||(++e,E((e=>({...e,text:!0})))),e||(G(!0),await u(),G(!1))},children:["Send"," ",W&&(0,T.jsx)(p.p,{style:{width:"20px",height:"20px",color:"#fff"}})]})]}),ee=e=>{var t;const l=(null===e||void 0===e||null===(t=e.query)||void 0===t?void 0:t.toLowerCase())||"";let s=r.map((e=>e.email));s=s.filter((e=>!j.includes(e))),s=s.filter((e=>!b.includes(e))),s=s.filter((e=>!N.includes(e))),s=s.filter((e=>e.toLowerCase().includes(l))),I(s)},te=()=>{ee(),B.current&&B.current.show()},le=()=>{ee(),P.current&&P.current.show()},se=()=>{ee(),D.current&&D.current.show()};return(0,s.useEffect)((()=>{if(null!==r&&void 0!==r&&r.length){let e=r.map((e=>e.email));I(e)}}),[r]),(0,s.useEffect)((()=>{d((e=>({...e,subject:S,email_body:C,from_email:g,to:null===j||void 0===j?void 0:j.toString(),...b.length>0&&{cc:b.toString()},...N.length>0&&{bcc:N.toString()},...F&&{signature:F}})))}),[S,C,g,j,b,N,F,d]),(0,s.useEffect)((()=>{var e,t;$((null===Z||void 0===Z||null===(e=Z.data)||void 0===e?void 0:e.body)||""),_(null===Z||void 0===Z||null===(t=Z.data)||void 0===t?void 0:t.subject),E((e=>({...e,subject:!1}))),E((e=>({...e,text:!1})))}),[null===Z||void 0===Z?void 0:Z.data]),(0,s.useEffect)((()=>{var e,t;null!==Q&&void 0!==Q&&Q.data&&R(null===Q||void 0===Q||null===(e=Q.data)||void 0===e||null===(t=e.find((e=>e.id===m.email_signature)))||void 0===t?void 0:t.id)}),[null===Q||void 0===Q?void 0:Q.data,m.email_signature]),(0,T.jsxs)(Me.l,{visible:i,modal:!0,header:st,footer:X,className:`${lt.modal} custom-modal`,style:{width:"896px"},onHide:()=>o(!1),children:[(0,T.jsxs)(x.A,{children:[(0,T.jsxs)(h.A,{sm:6,className:"mb-3",children:[(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("label",{className:(0,J.A)(lt.customLabel),children:"FROM"}),(0,T.jsx)(k.m,{options:V&&(null===V||void 0===V?void 0:V.data)&&[{value:null===V||void 0===V||null===(t=V.data)||void 0===t?void 0:t.outgoing_email,label:`${null===V||void 0===V||null===(l=V.data)||void 0===l?void 0:l.outgoing_email}`}]||[],className:(0,J.A)(lt.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"60px"},placeholder:"Select from email",onChange:e=>{v(e.value),E((e=>({...e,from:!1})))},value:g,filterInputAutoFocus:!0})]}),(null===q||void 0===q?void 0:q.from)&&(0,T.jsx)("p",{className:"error-message mb-0",children:"From email is required"})]}),(0,T.jsx)(h.A,{sm:6,className:"mb-3",children:(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("label",{className:(0,J.A)(lt.customLabel),children:"Templates"}),(0,T.jsx)(k.m,{options:Y&&(null===(a=Y.data)||void 0===a?void 0:a.map((e=>({value:e.id,label:`${e.name}`}))))||[],className:(0,J.A)(lt.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select template",onChange:e=>{K(e.value)},value:H,loading:null===Y||void 0===Y?void 0:Y.isFetching,filterInputAutoFocus:!0})]})})]}),(0,T.jsxs)(x.A,{children:[(0,T.jsxs)(h.A,{sm:12,className:"mb-3",children:[(0,T.jsxs)("div",{className:"d-flex gap-3 w-100",children:[(0,T.jsxs)("div",{style:{position:"relative"},className:lt.autoCompleteBox,children:[(0,T.jsx)("div",{style:{width:"50px"},className:lt.bag}),(0,T.jsx)("label",{className:(0,J.A)(lt.customLabel),children:"TO"}),(0,T.jsx)(tt.j,{ref:B,value:j,completeMethod:ee,onChange:e=>{y(e.value),E((e=>({...e,to:!1})))},multiple:!0,suggestions:L,onClick:te,onFocus:te,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const l=t.split(/[\s,]+/).filter((e=>e));y((e=>[...new Set([...e,...l])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(y((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,J.A)(lt.AutoComplete,"w-100"),placeholder:"TO"})]}),(0,T.jsx)(f.A,{className:(0,J.A)(lt.box,{[lt.active]:z}),onClick:()=>{M(!z),w([])},children:"CC"}),(0,T.jsx)(f.A,{className:(0,J.A)(lt.box,{[lt.active]:U}),onClick:()=>{O(!U),A([])},children:"BCC"})]}),(null===q||void 0===q?void 0:q.to)&&(0,T.jsx)("p",{className:"error-message mb-0",children:"To email is required"})]}),z&&(0,T.jsx)(h.A,{sm:6,className:"mb-3",children:(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("div",{style:{width:"50px"},className:lt.bag}),(0,T.jsx)("label",{className:(0,J.A)(lt.customLabel),children:"CC"}),(0,T.jsx)(tt.j,{ref:P,value:b,completeMethod:ee,onChange:e=>{w(e.value)},multiple:!0,suggestions:L,onClick:le,onFocus:le,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const l=t.split(/[\s,]+/).filter((e=>e));w((e=>[...new Set([...e,...l])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(w((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,J.A)(lt.AutoComplete,"w-100"),placeholder:"CC"})]})}),U&&(0,T.jsx)(h.A,{sm:6,className:"mb-3",children:(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("div",{style:{width:"60px"},className:lt.bag}),(0,T.jsx)("label",{className:(0,J.A)(lt.customLabel),children:"BCC"}),(0,T.jsx)(tt.j,{ref:D,value:N,completeMethod:ee,onChange:e=>{A(e.value)},multiple:!0,suggestions:L,onClick:se,onFocus:se,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const l=t.split(/[\s,]+/).filter((e=>e));A((e=>[...new Set([...e,...l])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(A((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,J.A)(lt.AutoComplete,lt.bcc,"w-100"),placeholder:"BCC"})]})}),(0,T.jsxs)(h.A,{sm:12,className:"mb-2",children:[(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("div",{style:{width:"60px"},className:lt.bag}),(0,T.jsx)("label",{className:(0,J.A)(lt.customLabel),children:"SUBJECT"}),(0,T.jsxs)(_e.C,{children:[(0,T.jsx)(Ce.m,{children:(null===Z||void 0===Z?void 0:Z.isFetching)&&(0,T.jsx)(p.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,T.jsx)($e.S,{value:S,className:(0,J.A)(lt.inputBox,"w-100"),style:{paddingLeft:"100px"},onChange:e=>{_(e.target.value),E((e=>({...e,subject:!1})))},placeholder:"{Organization} | Quotation: {number} | {reference}"})]})]}),(null===q||void 0===q?void 0:q.subject)&&(0,T.jsx)("p",{className:"error-message mb-0",children:"Subject is required"})]}),(0,T.jsxs)(h.A,{sm:12,className:"mb-3",children:[(0,T.jsxs)("div",{className:"d-flex flex-column gap-1",style:{position:"relative"},children:[(0,T.jsx)("label",{className:(0,J.A)(lt.lable),children:"Message"}),(0,T.jsx)(Ce.m,{style:{position:"absolute",right:"15px",top:"40px",zIndex:1},children:(null===Z||void 0===Z?void 0:Z.isFetching)&&(0,T.jsx)(p.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,T.jsx)(Ue.K,{style:{minHeight:"150px"},headerTemplate:at,value:C,placeholder:"Enter a description...",onTextChange:e=>{$(e.htmlValue),E((e=>({...e,text:!1})))}})]}),(null===q||void 0===q?void 0:q.text)&&(0,T.jsx)("p",{className:"error-message mb-0",children:"Message is required"})]}),(0,T.jsx)(h.A,{sm:12,children:(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("label",{className:(0,J.A)(lt.customLabel),children:"Signature"}),(0,T.jsx)(k.m,{options:Q&&(null===(n=Q.data)||void 0===n?void 0:n.map((e=>({value:e.id,label:`${e.name}`}))))||[],panelClassName:"px880-dropdown-item",className:(0,J.A)(lt.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select signature",onChange:e=>{R(e.value)},value:F,loading:null===Q||void 0===Q?void 0:Q.isFetching,filterInputAutoFocus:!0})]})})]})]})},it=e=>{let{show:t,setShow:l,contactPersons:s,setPayload:a,onSubmit:n,handleClose:i}=e;return(0,T.jsx)(nt,{show:t,setShow:l,contactPersons:s,setPayload:a,save:async()=>await n("send"),handleOtherClose:i})},ot=(0,T.jsx)("div",{className:`${Oe.modalHeader}`,children:(0,T.jsxs)("div",{className:"w-100 d-flex align-items-center gap-2",children:[(0,T.jsx)("b",{className:Oe.iconStyle,children:(0,T.jsx)(Te.A,{size:24,color:"#079455"})}),(0,T.jsx)("span",{className:`white-space-nowrap mt-2 mb-2 ${Oe.headerTitle}`,children:"Proposal"})]})}),rt=(0,T.jsxs)("span",{className:"ql-formats",children:[(0,T.jsx)("button",{className:"ql-bold","aria-label":"Bold"}),(0,T.jsx)("button",{className:"ql-italic","aria-label":"Italic"}),(0,T.jsx)("button",{className:"ql-underline","aria-label":"Underline"}),(0,T.jsx)("button",{className:"ql-strike","aria-label":"Strikethrough"}),(0,T.jsx)("button",{className:"ql-blockquote","aria-label":"Blockquote"}),(0,T.jsx)("button",{className:"ql-list",value:"ordered","aria-label":"Ordered List"}),(0,T.jsx)("button",{className:"ql-list",value:"bullet","aria-label":"Bullet List"}),(0,T.jsx)("button",{className:"ql-align",value:"","aria-label":"Align Left"}),(0,T.jsx)("button",{className:"ql-align",value:"center","aria-label":"Align Center"}),(0,T.jsx)("button",{className:"ql-align",value:"right","aria-label":"Align Right"}),(0,T.jsx)("button",{className:"ql-align",value:"justify","aria-label":"Justify"}),(0,T.jsx)("button",{className:"ql-link","aria-label":"Insert Link"}),(0,T.jsx)("button",{className:"ql-image","aria-label":"Insert Image"}),(0,T.jsx)("button",{className:"ql-code-block","aria-label":"Code Block"})]}),dt=e=>{var t,l,a;let{show:n,setShow:i,refetch:o,contactPersons:d,isExist:u}=e;const{unique_id:g}=(0,r.g)(),[v,j]=(0,s.useState)(!1),[y,b]=(0,s.useState)(!1),[w,N]=(0,s.useState)({}),[A,S]=(0,s.useState)(""),[_,C]=(0,s.useState)(!1),[$,F]=(0,s.useState)({}),[R,E]=(0,s.useState)(null),[L,I]=(0,s.useState)([]),[P,D]=(0,s.useState)(null),z=(0,c.I)({queryKey:["proposalTemplate"],queryFn:et.VQ}),M=(0,c.I)({queryKey:["readProposal",g],queryFn:()=>(0,et.Pf)(g),enabled:!!g&&u,retry:0});(0,s.useEffect)((()=>{var e,t,l;null!==M&&void 0!==M&&M.data&&E(null===M||void 0===M||null===(t=M.data)||void 0===t?void 0:t.template);!P&&null!==M&&void 0!==M&&null!==(e=M.data)&&void 0!==e&&e.image&&D({croppedImageBase64:null===M||void 0===M||null===(l=M.data)||void 0===l?void 0:l.image})}),[null===M||void 0===M?void 0:M.data]);const U=(0,c.I)({queryKey:["getProposal",R],queryFn:()=>(0,et.IT)(R),enabled:!!R,retry:0}),O=async e=>{var t;if(!g)return m.oR.error("Id not found");let l=null===L||void 0===L?void 0:L.filter((e=>!e.delete));if(null===l||void 0===l||!l.length)return m.oR.error("Please add proposal content");N({});const s={},a=null===L||void 0===L||null===(t=L.filter((e=>!e.delete)))||void 0===t?void 0:t.map((e=>{const t={};return e.title||(t.title=!0),e.description||(t.description=!0),t}));if(a.some((e=>Object.keys(e).length>0))&&(s.sections=a),N(s),0===Object.keys(s).length){const t=new FormData;if(L.forEach(((e,l)=>{t.append(`sections[${l}]title`,e.title),t.append(`sections[${l}]description`,e.description),t.append(`sections[${l}]delete`,!!e.delete),null!==M&&void 0!==M&&M.data&&e.id&&t.append(`sections[${l}]id`,e.id)})),R?t.append("template",R):t.append("template",""),"send"===e?(t.append("action","send"),t.append("subject",null===$||void 0===$?void 0:$.subject),t.append("email_body",null===$||void 0===$?void 0:$.email_body),t.append("from_email",null===$||void 0===$?void 0:$.from_email),t.append("to",null===$||void 0===$?void 0:$.to),null!==$&&void 0!==$&&$.cc&&t.append("cc",null===$||void 0===$?void 0:$.cc),null!==$&&void 0!==$&&$.bcc&&t.append("bcc",null===$||void 0===$?void 0:$.bcc)):t.append("action","create"),null!==P&&void 0!==P&&P.croppedImageBlob){const e=(0,B.Ak)(6);t.append("image",null===P||void 0===P?void 0:P.croppedImageBlob,`${e}.jpg`)}const l=localStorage.getItem("access_token");j(!0);let s="POST",a=`https://dev.memate.com.au/api/v1/proposals/new/${g}/`;null!==M&&void 0!==M&&M.data&&(s="PUT",a=`https://dev.memate.com.au/api/v1/proposals/update/${g}/`);try{j(!0);const n=await fetch(a,{method:s,headers:{Authorization:`Bearer ${l}`},body:t});await n.json();return j(!1),n.ok?(W(),m.oR.success(`Proposal ${"send"===e?"created and send":"created"} successfully!`),o(),M.refetch(),"success"):(m.oR.error(`Failed to ${"send"===e?"create and send":"create"} the proposal. Please try again.`),"error")}catch(n){return j(!1),console.error("Error creating proposal:",n),m.oR.error(`Failed to ${"send"===e?"create and send":"create"} the proposal. Please try again.`),"error"}finally{j(!1)}}},W=()=>{i(!1),C(!1)},G=(0,T.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,T.jsx)(f.A,{className:"text-button text-danger",onClick:W,children:"Cancel"}),(0,T.jsxs)("div",{className:"d-flex justify-content-end gap-2",children:[(0,T.jsxs)(f.A,{className:"btn info-button",onClick:()=>{I([...L,{title:"",description:""}])},children:["Add  New Section ",(0,T.jsx)(Pe.A,{color:"#106B99"})]}),(0,T.jsxs)(f.A,{className:"outline-button",disabled:v,onClick:O,children:["Create & Save",v&&(0,T.jsx)(p.p,{style:{width:"20px",height:"20px",color:"#fff"}})]}),(0,T.jsx)(f.A,{className:"solid-button",onClick:()=>{var e;if(!g)return m.oR.error("Id not found");let t=null===L||void 0===L?void 0:L.filter((e=>!e.delete));if(null===t||void 0===t||!t.length)return m.oR.error("Please add proposal content");const l={},s=null===L||void 0===L||null===(e=L.filter((e=>!e.delete)))||void 0===e?void 0:e.map((e=>{const t={};return e.title||(t.title=!0),e.description||(t.description=!0),t}));s.some((e=>Object.keys(e).length>0))&&(l.sections=s),N(l),0===Object.keys(l).length&&(i(!1),C(!0))},children:"Send Proposal"})]})]});return(0,s.useEffect)((()=>{var e,t,l,s,a,n;if(R&&R!=(null===M||void 0===M||null===(e=M.data)||void 0===e?void 0:e.template)&&null!==U&&void 0!==U&&U.data)I([...(null===M||void 0===M||null===(l=M.data)||void 0===l||null===(s=l.sections)||void 0===s?void 0:s.map((e=>({...e,delete:!0}))))||[],...(null===U||void 0===U||null===(a=U.data)||void 0===a||null===(n=a.sections)||void 0===n?void 0:n.map((e=>{let{id:t,...l}=e;return{...l}})))||[]]);else if(R===(null===M||void 0===M||null===(t=M.data)||void 0===t?void 0:t.template)){var i;I(null===M||void 0===M||null===(i=M.data)||void 0===i?void 0:i.sections)}}),[R,null===U||void 0===U?void 0:U.data,null===M||void 0===M?void 0:M.data]),(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(Me.l,{visible:n,modal:!0,header:ot,footer:G,className:`${Oe.modal} custom-modal p-0`,style:{width:"896px"},onHide:W,children:[(0,T.jsx)(x.A,{className:"px-4 pt-4 border-bottom mb-3 bg-white",children:(0,T.jsx)(h.A,{sm:12,className:"mb-3",children:(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("label",{className:(0,J.A)(Oe.customLabel),children:"Templates"}),(0,T.jsx)(k.m,{options:z&&(null===(t=z.data)||void 0===t?void 0:t.map((e=>({value:e.id,label:`${e.name}`}))))||[],className:(0,J.A)(Oe.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select template",onChange:e=>{E(e.value)},value:R,loading:null===z||void 0===z?void 0:z.isFetching,showClear:!0,scrollHeight:"380px",filter:!0,filterInputAutoFocus:!0})]})})}),(0,T.jsxs)("div",{className:"d-flex flex-column px-4",children:[(0,T.jsx)("div",{className:"d-flex gap-3 justify-content-center align-items-center mb-1",children:null!==P&&void 0!==P&&P.croppedImageBase64?(0,T.jsxs)("div",{style:{position:"relative",cursor:"pointer"},onClick:()=>b(!0),children:[(0,T.jsx)("div",{className:Oe.imageBox,style:{overflow:"hidden",textAlign:"center"},children:(0,T.jsx)("img",{alt:"uploaded-file",src:null===P||void 0===P?void 0:P.croppedImageBase64,style:{width:"100%",height:"100#"}})}),(0,T.jsx)("div",{className:(0,J.A)(Oe.trashBox,"cursor-pointer"),onClick:e=>{e.stopPropagation(),D(null)},children:(0,T.jsx)(q.A,{color:"#F04438",size:16})})]}):(0,T.jsxs)("div",{className:Oe.uploadBox,style:{cursor:"pointer"},onClick:()=>b(!0),children:[(0,T.jsx)("div",{className:Oe.uploadButton,children:(0,T.jsx)(De.A,{color:"#475467",size:20})}),(0,T.jsx)("p",{className:Oe.uploadText,children:"Click to upload"})]})}),(0,T.jsx)(Xe,{show:y,setShow:b,setPhoto:D}),(null===w||void 0===w?void 0:w.image)&&(0,T.jsx)("p",{className:"error-message mb-2",children:"Image is required"}),(0,T.jsx)(ze.n,{activeIndex:0,className:"mt-3",children:null===L||void 0===L||null===(l=L.map(((e,t)=>({...e,originalIndex:t}))))||void 0===l||null===(a=l.filter((e=>!e.delete)))||void 0===a?void 0:a.map(((e,t)=>{var l,s,a,n,i,o,r,d;return(0,T.jsxs)(ze.g,{className:(0,J.A)(Oe.accordion,{[Oe.error]:!!(null!==w&&void 0!==w&&null!==(l=w.sections)&&void 0!==l&&null!==(s=l[t])&&void 0!==s&&s.title||null!==w&&void 0!==w&&null!==(a=w.sections)&&void 0!==a&&null!==(n=a[t])&&void 0!==n&&n.description)},"proposal-accordion"),header:`Paragraph ${t+1}`,children:[(0,T.jsxs)("div",{className:"flex flex-column gap-2 w-100",style:{marginBottom:"16px"},children:[(0,T.jsx)("label",{className:Oe.label,children:"Paragraph title"}),(0,T.jsxs)(_e.C,{children:[(0,T.jsx)(Ce.m,{children:(null===U||void 0===U?void 0:U.isFetching)&&(0,T.jsx)(p.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,T.jsx)($e.S,{value:null===e||void 0===e?void 0:e.title,className:(0,J.A)(Oe.inputBox,"w-100 border mt-2"),onChange:t=>{I((l=>{const s=[...l];return s[null===e||void 0===e?void 0:e.originalIndex]={...s[null===e||void 0===e?void 0:e.originalIndex],title:t.target.value},s}))},placeholder:"Section Title"})]}),(null===w||void 0===w||null===(i=w.sections)||void 0===i||null===(o=i[t])||void 0===o?void 0:o.title)&&(0,T.jsx)("p",{className:"error-message mb-0",children:"Title is required"})]}),(0,T.jsxs)("div",{className:"d-flex flex-column gap-1 w-100 pb-2",style:{position:"relative"},children:[(0,T.jsx)("label",{className:(0,J.A)(Oe.lable),children:"Paragraph"}),(0,T.jsx)(Ce.m,{style:{position:"absolute",right:"15px",top:"40px",zIndex:1},children:(null===U||void 0===U?void 0:U.isFetching)&&(0,T.jsx)(p.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,T.jsx)(Ue.K,{style:{minHeight:"299px"},headerTemplate:rt,value:e.description,placeholder:"Enter a description...",onTextChange:t=>{I((l=>{const s=[...l];return s[null===e||void 0===e?void 0:e.originalIndex]={...s[null===e||void 0===e?void 0:e.originalIndex],description:t.htmlValue},s}))}}),(null===w||void 0===w||null===(r=w.sections)||void 0===r||null===(d=r[t])||void 0===d?void 0:d.description)&&(0,T.jsx)("p",{className:"error-message mb-0",children:"Message is required"})]}),(0,T.jsx)("div",{className:"bg-white mt-2 pt-2 d-flex justify-content-end",children:(0,T.jsx)(f.A,{className:"danger-outline-button",onClick:()=>((e,t)=>{I(t?t=>t.map(((t,l)=>l===e?{...t,delete:!0}:t)):t=>t.filter(((t,l)=>l!==e)))})(null===e||void 0===e?void 0:e.originalIndex,null===e||void 0===e?void 0:e.id),children:"Delete Paragraph"})})]},(null===e||void 0===e?void 0:e.id)||`accordion-${t}`)}))})]})]}),(0,T.jsx)(it,{show:_,setShow:C,contactPersons:d,setPayload:F,onSubmit:O,handleClose:W})]})},ct={headerTitle:"send-email_headerTitle__cXbQd",customLabel:"send-email_customLabel__ulebR",bag:"send-email_bag__+1Isj",lable:"send-email_lable__pfv8S",dropdownSelect:"send-email_dropdownSelect__yuxmj",autoCompleteBox:"send-email_autoCompleteBox__zqO6y",AutoComplete:"send-email_AutoComplete__peyFk",bcc:"send-email_bcc__vHuNY",box:"send-email_box__KRxo7",active:"send-email_active__sUnBO",inputBox:"send-email_inputBox__cV-UR"},ut=(0,T.jsx)("div",{className:`${ct.modalHeader}`,children:(0,T.jsx)("div",{className:"w-100 d-flex align-items-center gap-2",children:(0,T.jsx)("span",{className:`white-space-nowrap mt-2 mb-2 ${ct.headerTitle}`,children:"Send a Quote"})})}),pt=(0,T.jsxs)("span",{className:"ql-formats",children:[(0,T.jsx)("button",{className:"ql-bold","aria-label":"Bold"}),(0,T.jsx)("button",{className:"ql-italic","aria-label":"Italic"}),(0,T.jsx)("button",{className:"ql-underline","aria-label":"Underline"}),(0,T.jsx)("button",{className:"ql-strike","aria-label":"Strikethrough"}),(0,T.jsx)("button",{className:"ql-blockquote","aria-label":"Blockquote"}),(0,T.jsx)("button",{className:"ql-list",value:"ordered","aria-label":"Ordered List"}),(0,T.jsx)("button",{className:"ql-list",value:"bullet","aria-label":"Bullet List"}),(0,T.jsx)("button",{className:"ql-align",value:"","aria-label":"Align Left"}),(0,T.jsx)("button",{className:"ql-align",value:"center","aria-label":"Align Center"}),(0,T.jsx)("button",{className:"ql-align",value:"right","aria-label":"Align Right"}),(0,T.jsx)("button",{className:"ql-align",value:"justify","aria-label":"Justify"}),(0,T.jsx)("button",{className:"ql-link","aria-label":"Insert Link"}),(0,T.jsx)("button",{className:"ql-image","aria-label":"Insert Image"}),(0,T.jsx)("button",{className:"ql-code-block","aria-label":"Code Block"})]}),mt=e=>{var t,l,a,n;let{show:i,setShow:o,contactPersons:r,setPayload:d,save:u}=e;const m=JSON.parse(window.localStorage.getItem("profileData")||"{}"),[g,v]=(0,s.useState)(""),[j,y]=(0,s.useState)([]),[b,w]=(0,s.useState)([]),[N,A]=(0,s.useState)([]),[S,_]=(0,s.useState)(null),[C,$]=(0,s.useState)(null),[F,R]=(0,s.useState)(null),[q,E]=(0,s.useState)({}),[L,I]=(0,s.useState)([]),B=(0,s.useRef)(null),P=(0,s.useRef)(null),D=(0,s.useRef)(null),[z,M]=(0,s.useState)(!1),[U,O]=(0,s.useState)(!1),[W,G]=(0,s.useState)(!1),[H,K]=(0,s.useState)(null),Y=(0,c.I)({queryKey:["emailTemplate"],queryFn:et.SQ}),Q=(0,c.I)({queryKey:["getSignatureTemplates"],queryFn:et.AO}),V=(0,c.I)({queryKey:["getOutgoingEmail"],queryFn:et.hx}),Z=(0,c.I)({queryKey:["emailQuery",H],queryFn:()=>(0,et.hS)(H),enabled:!!H,retry:1});(0,s.useEffect)((()=>{var e,t,l;null!==V&&void 0!==V&&V.data&&(null!==V&&void 0!==V&&null!==(e=V.data)&&void 0!==e&&e.outgoing_email&&null!==V&&void 0!==V&&null!==(t=V.data)&&void 0!==t&&t.outgoing_email_verified?v(null===V||void 0===V||null===(l=V.data)||void 0===l?void 0:l.outgoing_email):v("no-reply@memate.com.au"));if(null!==Y&&void 0!==Y&&Y.data){var s;const e=null===Y||void 0===Y||null===(s=Y.data)||void 0===s?void 0:s.find((e=>"Quote"===e.type));null!==e&&void 0!==e&&e.id&&K(null===e||void 0===e?void 0:e.id)}}),[Y,V]);const X=(0,T.jsxs)("div",{className:"d-flex justify-content-end gap-2",children:[(0,T.jsx)(f.A,{className:"outline-button",onClick:()=>o(!1),children:"Cancel"}),(0,T.jsxs)(f.A,{disabled:W,className:"solid-button",onClick:async()=>{let e=0;E({}),g||(++e,E((e=>({...e,from:!0})))),0===(null===j||void 0===j?void 0:j.length)&&(++e,E((e=>({...e,to:!0})))),S||(++e,E((e=>({...e,subject:!0})))),C||(++e,E((e=>({...e,text:!0})))),e||(G(!0),await u(),G(!1))},children:["Send"," ",W&&(0,T.jsx)(p.p,{style:{width:"20px",height:"20px",color:"#fff"}})]})]}),ee=e=>{var t;const l=(null===e||void 0===e||null===(t=e.query)||void 0===t?void 0:t.toLowerCase())||"";let s=r.map((e=>e.email));s=s.filter((e=>!j.includes(e))),s=s.filter((e=>!b.includes(e))),s=s.filter((e=>!N.includes(e))),s=s.filter((e=>e.toLowerCase().includes(l))),console.log("emails: ",s),I(s)},te=()=>{ee(),B.current&&B.current.show()},le=()=>{ee(),P.current&&P.current.show()},se=()=>{ee(),D.current&&D.current.show()};return(0,s.useEffect)((()=>{if(null!==r&&void 0!==r&&r.length){let e=r.map((e=>e.email));I(e)}}),[r]),(0,s.useEffect)((()=>{d((e=>({...e,subject:S,email_body:C,from_email:g,to:null===j||void 0===j?void 0:j.toString(),...b.length>0&&{cc:b.toString()},...N.length>0&&{bcc:N.toString()},...F&&{signature:F}})))}),[S,C,g,j,b,N,F,d]),(0,s.useEffect)((()=>{var e,t;null!==Q&&void 0!==Q&&Q.data&&R(null===Q||void 0===Q||null===(e=Q.data)||void 0===e||null===(t=e.find((e=>e.id===m.email_signature)))||void 0===t?void 0:t.id)}),[null===Q||void 0===Q?void 0:Q.data,m.email_signature]),(0,s.useEffect)((()=>{var e,t;$((null===Z||void 0===Z||null===(e=Z.data)||void 0===e?void 0:e.body)||""),_(null===Z||void 0===Z||null===(t=Z.data)||void 0===t?void 0:t.subject),E((e=>({...e,subject:!1}))),E((e=>({...e,text:!1})))}),[null===Z||void 0===Z?void 0:Z.data]),(0,T.jsxs)(Me.l,{visible:i,modal:!0,header:ut,footer:X,className:`${ct.modal} custom-modal`,style:{width:"896px"},onHide:()=>o(!1),children:[(0,T.jsxs)(x.A,{children:[(0,T.jsxs)(h.A,{sm:6,className:"mb-3",children:[(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("label",{className:(0,J.A)(ct.customLabel),children:"FROM"}),(0,T.jsx)(k.m,{options:V&&(null===V||void 0===V?void 0:V.data)&&[{value:null===V||void 0===V||null===(t=V.data)||void 0===t?void 0:t.outgoing_email,label:`${null===V||void 0===V||null===(l=V.data)||void 0===l?void 0:l.outgoing_email}`}]||[],className:(0,J.A)(ct.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"60px"},placeholder:"Select from email",onChange:e=>{v(e.value),E((e=>({...e,from:!1})))},value:g,filterInputAutoFocus:!0})]}),(null===q||void 0===q?void 0:q.from)&&(0,T.jsx)("p",{className:"error-message mb-0",children:"From email is required"})]}),(0,T.jsx)(h.A,{sm:6,className:"mb-3",children:(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("label",{className:(0,J.A)(ct.customLabel),children:"Templates"}),(0,T.jsx)(k.m,{options:Y&&(null===(a=Y.data)||void 0===a?void 0:a.map((e=>({value:e.id,label:`${e.name}`}))))||[],className:(0,J.A)(ct.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select template",onChange:e=>{K(e.value)},value:H,loading:null===Y||void 0===Y?void 0:Y.isFetching,filterInputAutoFocus:!0})]})})]}),(0,T.jsxs)(x.A,{children:[(0,T.jsxs)(h.A,{sm:12,className:"mb-3",children:[(0,T.jsxs)("div",{className:"d-flex gap-3 w-100",children:[(0,T.jsxs)("div",{style:{position:"relative"},className:ct.autoCompleteBox,children:[(0,T.jsx)("div",{style:{width:"50px"},className:ct.bag}),(0,T.jsx)("label",{className:(0,J.A)(ct.customLabel),children:"TO"}),(0,T.jsx)(tt.j,{ref:B,value:j,completeMethod:ee,onChange:e=>{y(e.value),E((e=>({...e,to:!1})))},multiple:!0,suggestions:L,onClick:te,onFocus:te,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const l=t.split(/[\s,]+/).filter((e=>e));y((e=>[...new Set([...e,...l])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(y((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,J.A)(ct.AutoComplete,"w-100"),placeholder:"TO"})]}),(0,T.jsx)(f.A,{className:(0,J.A)(ct.box,{[ct.active]:z}),onClick:()=>{M(!z),w([])},children:"CC"}),(0,T.jsx)(f.A,{className:(0,J.A)(ct.box,{[ct.active]:U}),onClick:()=>{O(!U),A([])},children:"BCC"})]}),(null===q||void 0===q?void 0:q.to)&&(0,T.jsx)("p",{className:"error-message mb-0",children:"To email is required"})]}),z&&(0,T.jsx)(h.A,{sm:6,className:"mb-3",children:(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("div",{style:{width:"50px"},className:ct.bag}),(0,T.jsx)("label",{className:(0,J.A)(ct.customLabel),children:"CC"}),(0,T.jsx)(tt.j,{ref:P,value:b,completeMethod:ee,onChange:e=>{w(e.value)},multiple:!0,suggestions:L,onClick:le,onFocus:le,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const l=t.split(/[\s,]+/).filter((e=>e));w((e=>[...new Set([...e,...l])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(w((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,J.A)(ct.AutoComplete,"w-100"),placeholder:"CC"})]})}),U&&(0,T.jsx)(h.A,{sm:6,className:"mb-3",children:(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("div",{style:{width:"60px"},className:ct.bag}),(0,T.jsx)("label",{className:(0,J.A)(ct.customLabel),children:"BCC"}),(0,T.jsx)(tt.j,{ref:D,value:N,completeMethod:ee,onChange:e=>{A(e.value)},multiple:!0,suggestions:L,onClick:se,onFocus:se,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const l=t.split(/[\s,]+/).filter((e=>e));A((e=>[...new Set([...e,...l])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(A((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,J.A)(ct.AutoComplete,ct.bcc,"w-100"),placeholder:"BCC"})]})}),(0,T.jsxs)(h.A,{sm:12,className:"mb-2",children:[(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("div",{style:{width:"60px"},className:ct.bag}),(0,T.jsx)("label",{className:(0,J.A)(ct.customLabel),children:"SUBJECT"}),(0,T.jsxs)(_e.C,{children:[(0,T.jsx)(Ce.m,{children:(null===Z||void 0===Z?void 0:Z.isFetching)&&(0,T.jsx)(p.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,T.jsx)($e.S,{value:S,className:(0,J.A)(ct.inputBox,"w-100"),style:{paddingLeft:"100px"},onChange:e=>{_(e.target.value),E((e=>({...e,subject:!1})))},placeholder:"{Organization} | Quotation: {number} | {reference}"})]})]}),(null===q||void 0===q?void 0:q.subject)&&(0,T.jsx)("p",{className:"error-message mb-0",children:"Subject is required"})]}),(0,T.jsxs)(h.A,{sm:12,className:"mb-3",children:[(0,T.jsxs)("div",{className:"d-flex flex-column gap-1",style:{position:"relative"},children:[(0,T.jsx)("label",{className:(0,J.A)(ct.lable),children:"Message"}),(0,T.jsx)(Ce.m,{style:{position:"absolute",right:"15px",top:"40px",zIndex:1},children:(null===Z||void 0===Z?void 0:Z.isFetching)&&(0,T.jsx)(p.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,T.jsx)(Ue.K,{style:{minHeight:"150px"},headerTemplate:pt,value:C,placeholder:"Enter a description...",onTextChange:e=>{$(e.htmlValue),E((e=>({...e,text:!1})))}})]}),(null===q||void 0===q?void 0:q.text)&&(0,T.jsx)("p",{className:"error-message mb-0",children:"Message is required"})]}),(0,T.jsx)(h.A,{sm:12,children:(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("label",{className:(0,J.A)(ct.customLabel),children:"Signature"}),(0,T.jsx)(k.m,{options:Q&&(null===(n=Q.data)||void 0===n?void 0:n.map((e=>({value:e.id,label:`${e.name}`}))))||[],panelClassName:"px880-dropdown-item",className:(0,J.A)(ct.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select signature",onChange:e=>{R(e.value)},value:F,loading:null===Q||void 0===Q?void 0:Q.isFetching,filterInputAutoFocus:!0})]})})]})]})},xt=e=>{let{show:t,setShow:l,contactPersons:s,setPayload:a,createNewRequest:n}=e;return(0,T.jsx)(mt,{show:t,setShow:l,contactPersons:s,setPayload:a,save:async()=>{await n("send")}})},ht=()=>{var e,t,l,x,h,g,v,j,f,y,b,w,N;const A=(0,r.Zp)(),{trialHeight:S}=(0,Be.$)(),[_,C]=(0,s.useState)([]),[$,k]=(0,s.useState)(!1),[F,R]=(0,s.useState)(!1),[q,E]=(0,s.useState)(!1),[L,I]=(0,s.useState)("Standard"),[B,P]=(0,s.useState)({}),[D,z]=(0,s.useState)([]),[M,U]=(0,s.useState)({budget:0,operationalProfit:0,subtotal:0,tax:0,total:0}),{unique_id:O}=(0,r.g)(),W=(0,c.I)({queryKey:["unique_id",O],queryFn:()=>(0,G.WL)(O),enabled:!!O,retry:1,cacheTime:0,refetchOnWindowFocus:!1});(0,s.useEffect)((()=>{if(O){if(null!==W&&void 0!==W&&W.data){var e,t;let l=null!==W&&void 0!==W&&null!==(e=W.data)&&void 0!==e&&null!==(t=e.recurring)&&void 0!==t&&t.frequency?"Recurring":"Standard";I(l);const s={...null===W||void 0===W?void 0:W.data};"Recurring"===l&&(s.recurring.start_date=new Date(1e3*+s.recurring.start_date),s.recurring.end_by=+s.recurring.end_by,1===s.recurring.end_by&&(s.recurring.end_date=new Date(1e3*+s.recurring.end_date))),P((e=>({...e,...s})))}}else{const e=JSON.parse(window.sessionStorage.getItem("new-request")||"{}"),t=JSON.parse(window.localStorage.getItem("profileData")||"{}");P((l=>({...l,xero_tax:"ex",display_discount:!0,managers:[{manager:null===t||void 0===t?void 0:t.desktop_user_id}],client:(null===e||void 0===e?void 0:e.id)||"",reference:(null===e||void 0===e?void 0:e.reference)||"",description:(null===e||void 0===e?void 0:e.requirements)||""})))}}),[O,null===W||void 0===W?void 0:W.data]);const K=(0,u.n)({mutationFn:e=>(0,G.DY)(e),onSuccess:e=>{e||m.oR.error("Failed to create new calculation quote. Please try again.")},onError:e=>{E(!1),console.error("Error creating new calculation quote:",e),m.oR.error("Failed to create new calculation quote. Please try again.")}}),Y=(0,u.n)({mutationFn:e=>(0,G.Vn)(O,e),onSuccess:e=>{e||(E(!1),m.oR.error("Failed to update calculation quote. Please try again."))},onError:e=>{var t,l;if(E(!1),console.log("Error updating new calculation quote:",e,null===e||void 0===e||null===(t=e.data)||void 0===t||null===(l=t.client)||void 0===l?void 0:l[0]),400===(null===e||void 0===e?void 0:e.status)){var s,a;const t=null===e||void 0===e||null===(s=e.data)||void 0===s||null===(a=s.client)||void 0===a?void 0:a[0];if(null!==t&&void 0!==t&&t.includes("Invalid pk")&&null!==t&&void 0!==t&&t.includes("object does not exist"))return m.oR.error("This client has been deleted. Please restore it before continuing.")}m.oR.error("Failed to update calculation quote. Please try again.")}}),Q=async e=>{var t,l,s,a,n,i,o,r;if(B.action=e,"send"!==e&&(delete B.subject,delete B.email_body,delete B.to,delete B.cc,delete B.bcc,delete B.from_email,delete B.signature),"saveAndsend"===e)return void k(!0);"quote-pdf-open"===e&&(B.action="save");const d=B.merges;if(B.merges&&delete B.merges,null===B||void 0===B||!B.client)return m.oR.error("Client is required");if((null===B||void 0===B||!B.managers||null===(t=B.managers)||void 0===t||!t.length)&&"draft"!==e)return m.oR.error("Project manager is required");if((null===B||void 0===B||!B.calculations||!B.calculations.length)&&"draft"!==e)return m.oR.error("At least one calculation is required");if((null===B||void 0===B||!B.xero_tax)&&"draft"!==e)return m.oR.error("Tax details is required");if((null===B||void 0===B||!B.expense)&&"draft"!==e)return m.oR.error("Expense is required");if("Recurring"===L&&(null===B||void 0===B||!B.recurring))return m.oR.error("Recurring details is required");if("Recurring"===L&&(null===B||void 0===B||null===(l=B.recurring)||void 0===l||!l.frequency))return m.oR.error("Recurring frequency is required");if("Recurring"===L&&(null===B||void 0===B||null===(s=B.recurring)||void 0===s||!s.start_date))return m.oR.error("Recurring start date is required");if("Recurring"===L&&![0,1,2].includes(null===B||void 0===B||null===(a=B.recurring)||void 0===a?void 0:a.end_by))return m.oR.error("Recurring end by is required");if("Recurring"===L&&1===(null===B||void 0===B||null===(n=B.recurring)||void 0===n?void 0:n.end_by)&&(null===B||void 0===B||null===(i=B.recurring)||void 0===i||!i.end_date))return m.oR.error("Recurring end date is required");if("Recurring"===L&&2===(null===B||void 0===B||null===(o=B.recurring)||void 0===o?void 0:o.end_by)&&(null===B||void 0===B||null===(r=B.recurring)||void 0===r||!r.occurrences))return m.oR.error("Recurring projects is required");let c;if("Recurring"===L&&(B.recurring.start_date&&(B.recurring.start_date=B.recurring.start_date.toISOString().split("T")[0]),B.recurring.end_date&&1===B.recurring.end_by?B.recurring.end_date=B.recurring.end_date.toISOString().split("T")[0]:delete B.recurring.end_date),E(!0),D.length)for(const m of D)try{m&&await(0,G.mL)(m)}catch(v){console.log("Error during with deleting merge: ",v)}if(O){var u;c=await Y.mutateAsync(B);let e=null===(u=c)||void 0===u?void 0:u.unique_id;if(d&&null!==d&&void 0!==d&&d.length){var p;let t=null===(p=c.calculations)||void 0===p?void 0:p.reduce(((e,t)=>(e[t.merge_id]=t.id,e)),{});const l=null===d||void 0===d?void 0:d.map((l=>({...l,unique_id:e,calculations:l.calculators.map((e=>({calculator:t[e.merge_id]})))})));for(const e of l)try{e.id&&await(0,G.mL)(e.id),await(0,G.tA)(e)}catch(v){E(!1),console.log("Error during with creating merge: ",v)}m.oR.success("Calculations and merge items updated successfully.")}else m.oR.success("Calculations updated successfully.")}else{var x;c=await K.mutateAsync(B);let e=null===(x=c)||void 0===x?void 0:x.unique_id;if(d&&null!==d&&void 0!==d&&d.length){var h;let t=null===(h=c.calculations)||void 0===h?void 0:h.reduce(((e,t)=>(e[t.merge_id]=t.id,e)),{});(null===d||void 0===d?void 0:d.map((l=>({...l,unique_id:e,calculations:l.calculators.map((e=>({calculator:t[e.merge_id]})))})))).forEach((async e=>{try{await(0,G.tA)(e)}catch(v){E(!1),console.log("Error during with creating merge: ",v)}})),m.oR.success("Calculations and new merge items created successfully.")}else m.oR.success("Calculations created successfully.")}var g;"quote-pdf-open"===e?null!==(g=c)&&void 0!==g&&g.quote_url?window.open(c.quote_url,"_blank"):m.oR.error("Quote PDF not found."):A("/sales");E(!1),k(!1)};return(0,T.jsxs)("div",{className:"newQuotePage",children:[(0,T.jsxs)("div",{className:"topbar d-flex justify-content-between",style:{padding:"16px 32px",height:"72px",position:"relative",boxShadow:"rgba(0, 0, 0, 0.05) 0px 1px 2px 0px"},children:[(0,T.jsx)(d.k2,{to:"",children:(0,T.jsxs)("button",{className:"back-button",style:{padding:"10px 16px"},onClick:()=>{A(-1)},children:[(0,T.jsx)(n.A,{color:"#000000",size:17})," \xa0Go Back"]})}),(0,T.jsx)("h2",{className:"m-0",style:{fontSize:"22px",fontWeight:"600",position:"absolute",left:"42.5%"},children:(0,T.jsxs)("div",{className:"d-flex flex-column align-items-center gap-1",children:[(0,T.jsxs)("div",{className:"d-flex align-items-center",children:[(0,T.jsx)(i.A,{color:"#1D2939",size:16}),"\xa0 Calculate a Quote"]}),(null===W||void 0===W||null===(e=W.data)||void 0===e?void 0:e.number)&&(0,T.jsx)("small",{className:"font-14 border px-3 py-1 rounded",style:{width:"fit-content"},children:null===W||void 0===W||null===(t=W.data)||void 0===t?void 0:t.number})]})}),(0,T.jsxs)("div",{className:"d-flex align-items-center justify-content-end",children:[(0,T.jsx)(Ee,{label:"Standard",name:"customRadio",value:"Standard",checked:"Standard"===L,onChange:e=>I(e.target.value),disabled:!1}),(0,T.jsx)(Ee,{label:"Recurring",name:"customRadio",value:"Recurring",checked:"Recurring"===L,onChange:e=>I(e.target.value)}),(0,T.jsx)(Ee,{label:"Subscription",name:"customRadio",value:"Subscription",checked:"Subscription"===L,onChange:e=>I(e.target.value),disabled:!0}),(0,T.jsx)(Ee,{label:"Retainer",name:"customRadio",value:"Retainer",checked:"Retainer"===L,onChange:e=>I(e.target.value),disabled:!0})]})]}),(0,T.jsx)("div",{className:"w-100",style:{overflow:"auto",height:`calc(100% - 208px - ${S}px)`,padding:"16px 32px"},children:(0,T.jsx)(Ie,{payload:B,setPayload:P,totals:M,setTotals:U,refetch:null===W||void 0===W?void 0:W.refetch,preExistMerges:(null===W||void 0===W||null===(l=W.data)||void 0===l?void 0:l.merges)||[],preExistCalculation:(null===W||void 0===W||null===(x=W.data)||void 0===x?void 0:x.calculations)||[],setMergeDeletedItems:z,setContactPersons:C,quoteType:L})}),(0,T.jsxs)("div",{className:"calculation-quote-bottom w-100",style:{padding:"8px 24px",height:"136px",background:"#fff",borderTop:"1px solid #f2f2f2",boxShadow:"rgba(0, 0, 0, 0.06) 0px 0px 4px 0px inset"},children:[(0,T.jsxs)("div",{className:"d-flex justify-content-between align-items-center pb-3",style:{gap:"20px",width:"100%",overflowX:"auto"},children:[(0,T.jsxs)("div",{className:"d-flex align-items-center",style:{gap:"16px"},children:[(0,T.jsxs)("div",{className:"item",children:[(0,T.jsx)("label",{children:"Budget"}),(0,T.jsxs)("div",{className:"amount",children:["$",(0,H.m)(M.budget)]})]}),(0,T.jsxs)("div",{className:"item",children:[(0,T.jsx)("label",{children:"Operational Profit"}),(0,T.jsxs)("div",{className:"amount",style:{color:"#079455"},children:["$",(0,H.m)(M.operationalProfit)]})]})]}),(0,T.jsxs)("div",{className:"d-flex align-items-center",style:{gap:"16px"},children:[(0,T.jsxs)("div",{className:"item",children:[(0,T.jsx)("label",{children:"Subtotal"}),(0,T.jsxs)("div",{className:"amount",children:["$",(0,H.m)(M.subtotal)]})]}),(0,T.jsxs)("div",{className:"item",children:[(0,T.jsx)("label",{children:"Tax (10%)"}),(0,T.jsxs)("div",{className:"amount",children:["$",(0,H.m)(M.tax)]})]}),(0,T.jsxs)("div",{className:"item",style:{minWidth:"fit-content"},children:[(0,T.jsx)("label",{children:"Total"}),(0,T.jsxs)("div",{className:"amount",children:["$",(0,H.m)(M.total)]})]})]})]}),(0,T.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,T.jsxs)("div",{className:"d-flex align-items-center",style:{gap:"0px"},children:[(0,T.jsx)("a",{href:"/sales",type:"button",className:"button-custom text-button text-danger padding-left-0",style:{color:"#B42318"},children:"Cancel"}),(0,T.jsx)("a",{href:"#",onClick:()=>Q("quote-pdf-open"),type:"button",className:"button-custom text-button px-0",children:"Quote PDF"}),null!==W&&void 0!==W&&null!==(h=W.data)&&void 0!==h&&h.proposal_pdf?(0,T.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,T.jsx)("button",{type:"button",className:"button-custom text-button pe-0",onClick:()=>R(!0),children:"Edit Proposal"}),(0,T.jsx)("a",{href:`${null===W||void 0===W||null===(g=W.data)||void 0===g?void 0:g.proposal_pdf}`,target:"_blank",type:"button",className:"button-custom text-button ps-0",rel:"noreferrer",children:(0,T.jsx)(o.A,{color:"#106B99",size:20})})]}):(0,T.jsx)("button",{type:"button",disabled:!O,className:"button-custom text-button px-2",onClick:()=>R(!0),children:"Create Proposal"})]}),(0,T.jsxs)("div",{className:"d-flex align-items-center",style:{gap:"8px"},children:[(0,T.jsxs)("button",{type:"button",disabled:K.isPending||Y.isPending,onClick:()=>Q("draft"),className:"button-custom text-button",children:["Save Draft",(K.isPending||Y.isPending)&&("draft"===(null===K||void 0===K||null===(v=K.variables)||void 0===v?void 0:v.action)||"draft"===(null===Y||void 0===Y||null===(j=Y.variables)||void 0===j?void 0:j.action))&&(0,T.jsx)(p.p,{style:{width:"20px",height:"20px"}})]}),(0,T.jsxs)("button",{type:"button",disabled:K.isPending||Y.isPending,onClick:()=>Q("save"),className:"button-custom submit-button-light",children:["Save",(K.isPending||Y.isPending)&&("save"===(null===K||void 0===K||null===(f=K.variables)||void 0===f?void 0:f.action)||"save"===(null===Y||void 0===Y||null===(y=Y.variables)||void 0===y?void 0:y.action))&&(0,T.jsx)(p.p,{style:{width:"20px",height:"20px"}})]}),(0,T.jsxs)("button",{type:"button",disabled:K.isPending||Y.isPending,onClick:()=>Q("saveAndsend"),className:"submit-button",children:["Save and Send",(K.isPending||Y.isPending)&&("send"===(null===K||void 0===K||null===(b=K.variables)||void 0===b?void 0:b.action)||"send"===(null===Y||void 0===Y||null===(w=Y.variables)||void 0===w?void 0:w.action))&&(0,T.jsx)(p.p,{style:{width:"20px",height:"20px"}})]})]})]})]}),(0,T.jsx)(xt,{show:$,setShow:k,contactPersons:_,setPayload:P,createNewRequest:Q}),(0,T.jsx)(dt,{show:F,setShow:R,refetch:null===W||void 0===W?void 0:W.refetch,contactPersons:_,isExist:!(null===W||void 0===W||null===(N=W.data)||void 0===N||!N.proposal_pdf)}),(K.isPending||W.isFetching||q)&&(0,T.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",background:"white",width:"60px",height:"60px",borderRadius:"4px",display:"flex",justifyContent:"center",alignItems:"center",zIndex:10},className:"shadow-lg",children:(0,T.jsx)(a.A,{animation:"border",role:"status",children:(0,T.jsx)("span",{className:"visually-hidden",children:"Loading..."})})})]})}}}]);
//# sourceMappingURL=5377.668b2d2d.chunk.js.map