"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[8273],{18273:(e,t,s)=>{s.r(t),s.d(t,{default:()=>k});var r=s(65043),n=s(61072),a=s(78602),o=s(52572),i=s(84843),c=s(22927),l=s(62624),d=s(34305),h=s(38294),p=s(95192),u=s(36237),m=s(64416),f=s(544),g=s(94819),x=s(24858),w=s(73216),y=s(35475),j=s(18403),$=s(47097),S=s(93747),b=s(93740),v=s(56328),N=s(51238),P=s(80899),T=s(59638),E=s(67046),A=s(27472),U=s(70579);const q=P.Ik({reference:P.Yj().required("Project reference is required")}).required(),k=()=>{const e=(0,w.Zp)(),{id:t}=(0,w.g)();let s={};const P=JSON.parse(window.localStorage.getItem("profileData")||"{}");try{const e=window.sessionStorage.getItem("new-request");e&&(s=JSON.parse(e))}catch(B){console.error("Failed to parse form data from sessionStorage",B)}const[k,C]=(0,r.useState)([]),[D]=(0,r.useState)({reference:s.reference||"",requirements:s.requirements||""}),{register:R,handleSubmit:L,trigger:O,formState:{errors:_},watch:I}=(0,x.mN)({resolver:(0,j.t)(q),defaultValues:D}),z=(0,$.n)({mutationFn:e=>(0,E.D7)(e),onSuccess:()=>{e("/sales"),v.oR.success("New request created as draft successfully.")},onError:e=>{console.error("Error creating draft new request:",e),v.oR.error("Failed to create new request. Please try again.")}}),G=(0,S.I)({queryKey:["id",t],queryFn:()=>(0,T.EZ)(t),enabled:!!t,retry:1});return(0,U.jsx)("form",{onSubmit:L((s=>{const r={id:t,reference:s.reference,requirements:s.requirements,files:k.map((e=>e.file))};window.sessionStorage.setItem("new-request",JSON.stringify(r)),e("/sales/quote-calculation")})),children:(0,U.jsx)("div",{className:"newQuotePage existingClients borderSkyColor",children:(0,U.jsxs)("div",{style:{height:"calc(100vh - 249px)"},children:[(0,U.jsx)("div",{className:"newQuoteBack",children:(0,U.jsx)(y.k2,{to:"/sales/newquote/selectyourclient",children:(0,U.jsxs)("button",{children:[(0,U.jsx)(h.A,{color:"#000000",size:20})," \xa0\xa0Go Back"]})})}),(0,U.jsxs)("div",{className:"newQuoteContent h-100",children:[(0,U.jsx)("div",{className:"navStepClient",children:(0,U.jsxs)("ul",{children:[(0,U.jsxs)("li",{children:[(0,U.jsx)("span",{children:(0,U.jsx)(p.A,{color:"#D0D5DD",size:15})})," ",(0,U.jsx)("p",{children:"Choose Client"})]}),(0,U.jsxs)("li",{children:[(0,U.jsx)("span",{children:(0,U.jsx)(u.A,{color:"#D0D5DD",size:15})})," ",(0,U.jsx)("p",{children:"Client Information"})," "]}),(0,U.jsxs)("li",{className:"activeClientTab",children:[(0,U.jsx)("span",{children:(0,U.jsx)(m.A,{color:"#D0D5DD",size:15})})," ",(0,U.jsx)("p",{children:"Scope of Work"})," "]})]})}),(0,U.jsx)("div",{className:"individual height",children:(0,U.jsx)("div",{className:"formgroupboxs",style:{paddingTop:"32px"},children:(0,U.jsxs)(n.A,{className:"text-left",children:[(0,U.jsx)(a.A,{sm:12,children:(0,U.jsxs)("div",{className:"formgroup mb-3 mt-0",children:[(0,U.jsxs)("label",{children:["Project Reference",(0,U.jsx)("span",{className:"required",children:"*"})]}),(0,U.jsxs)("div",{className:"inputInfo "+(_.reference?"error-border":""),children:[(0,U.jsx)("input",{...R("reference"),placeholder:"Add Reference for your Project"}),_.reference&&(0,U.jsx)("img",{className:"ExclamationCircle",src:A.A,alt:"Exclamation Circle"})]}),_.reference&&(0,U.jsx)("p",{className:"error-message",children:_.reference.message})]})}),(0,U.jsx)(a.A,{sm:12,children:(0,U.jsxs)("div",{className:"formgroup mb-2 mt-0",children:[(0,U.jsxs)("label",{children:["Describe requirements for the order below",(0,U.jsx)("br",{}),(0,U.jsx)("small",{style:{color:"#475467",fontWeight:400},children:"Use for organisation. Not customer-facing."})]}),(0,U.jsxs)("div",{style:{position:"relative"},className:"inputInfo textarea "+(_.requirements?"error-border":""),children:[(0,U.jsx)("textarea",{...R("requirements"),placeholder:"Enter a description..."}),_.requirements&&(0,U.jsx)("img",{className:"ExclamationCircle",style:{position:"absolute",right:"10px",bottom:"10px"},src:A.A,alt:"Exclamation Circle"})]}),_.requirements&&(0,U.jsx)("p",{className:"error-message",children:_.requirements.message})]})}),(0,U.jsx)(a.A,{sm:12,children:(0,U.jsxs)("div",{className:"formgroup mb-3 mt-0",children:[(0,U.jsx)("label",{style:{fontWeight:"normal"},children:"Only for internal use."}),(0,U.jsxs)("div",{className:"custom-file-upload",style:{marginTop:"10px"},children:[(0,U.jsxs)("label",{htmlFor:"file-upload",className:"custom-upload-btn",style:{border:"1px solid var(--Gray-300, #D0D5DD)",borderRadius:"4px",padding:"8px 14px"},children:["Attach Files \xa0",(0,U.jsx)(f.A,{color:"#1D2939",width:20,height:20})]}),(0,U.jsx)("input",{id:"file-upload",type:"file",multiple:!0,onChange:e=>{const t=Array.from(e.target.files).map((e=>({id:(0,N.A)(),file:e,type:e.type})));C((e=>[...e,...t]))},style:{display:"none"}})]})]})}),(0,U.jsx)(a.A,{sm:12,children:k.length>0&&(0,U.jsx)("div",{className:"uploaded-files pb-5",children:(0,U.jsx)("ul",{children:k.map((e=>{return(0,U.jsxs)("li",{className:"ps-0",children:[(t=e.type,t.includes("pdf")?(0,U.jsx)(o.A,{color:"#000000",width:20,height:20}):t.includes("image")?(0,U.jsx)(i.A,{color:"#000000",width:20,height:20}):t.includes("text")?(0,U.jsx)(c.A,{color:"#000000",width:20,height:20}):t.includes("word")?(0,U.jsx)(l.A,{color:"#000000",width:20,height:20}):t.includes("code")?(0,U.jsx)(d.A,{color:"#000000",width:20,height:20}):(0,U.jsx)(c.A,{color:"#000000",size:20})),(0,U.jsx)("span",{className:"text-lowercase",children:e.file.name}),(0,U.jsx)(g.A,{color:"#98A2B3",style:{cursor:"pointer",marginLeft:"20px"},onClick:()=>(e=>{C((t=>t.filter((t=>t.id!==e))))})(e.id)})]},e.id);var t}))})})})]})})}),(0,U.jsxs)("div",{className:"individual bottomBox justify-content-between",children:[(0,U.jsx)(y.N_,{to:"/sales",children:(0,U.jsx)("button",{type:"button",className:"cancel-button border-0 text-danger",children:"Cancel"})}),(0,U.jsxs)("div",{className:"d-flex",style:{gap:"12px"},children:[(0,U.jsxs)("button",{type:"button",disabled:z.isPending,onClick:async()=>{var e,s;const r=await O(),n=null===(e=G.data)||void 0===e?void 0:e.contact_persons[0],a=null===(s=G.data)||void 0===s?void 0:s.contact_persons.find((e=>!0===e.is_main)),o=null!==a&&void 0!==a&&a.id?null===a||void 0===a?void 0:a.id:null===n||void 0===n?void 0:n.id;o?r&&z.mutate({client:t,action:"draft",contact_person:o,reference:I("reference"),description:I("requirements"),managers:[{manager:null===P||void 0===P?void 0:P.desktop_user_id}]}):v.oR.error("No contact person found for this client. Please add a contact person before saving as a draft.")},className:"cancel-button",children:["Save Draft "," ",z.isPending&&(0,U.jsx)(b.p,{style:{width:"18px",height:"18px"}})]}),(0,U.jsx)("button",{type:"submit",className:"submit-button",children:"Calculate"})]})]})]})]})})})}},59638:(e,t,s)=>{s.d(t,{EZ:()=>o,F1:()=>w,Fl:()=>p,OF:()=>c,QK:()=>f,Ql:()=>i,X6:()=>l,Ye:()=>g,ab:()=>y,i6:()=>h,kB:()=>j,nP:()=>d,o6:()=>m,oO:()=>a,oo:()=>u,zZ:()=>x});var r=s(31342);const n="https://app.memate.com.au/api/v1",a=async e=>{const t=new URL(`${n}${`/clients/restore/${e}/`}`);return(0,r.f)(t.toString(),{method:"POST"})},o=async e=>{const t=new URL(`${n}${`/clients/${e}/`}`);return(0,r.f)(t.toString(),{method:"GET"})},i=async()=>{const e=new URL(`${n}/references/clients/categories/`);return(0,r.f)(e.toString(),{method:"GET"})},c=async()=>{const e=new URL(`${n}/references/clients/industries/`);return(0,r.f)(e.toString(),{method:"GET"})},l=async()=>{const e=new URL(`${n}/references/countries/`),t=await(0,r.f)(e.toString(),{method:"GET"},!1),s=[1];return(null===t||void 0===t?void 0:t.filter((e=>s.includes(e.id))))||[]},d=async e=>{const t=new URL(`${n}${`/references/states/${e}/`}`);return(0,r.f)(t.toString(),{method:"GET"},!1)},h=async e=>{const t=new URL(`${n}${`/references/cities/${e}/`}`);return(0,r.f)(t.toString(),{method:"GET"},!1)},p=async()=>{const e=new URL(`${n}/references/desktop-users/`);return(0,r.f)(e.toString(),{method:"GET"})},u=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4?arguments[4]:void 0;const i=(e-1)*t,c=new URL(`${n}/clients/`);return c.searchParams.append("limit",t),c.searchParams.append("offset",i),s&&c.searchParams.append("search",s),a&&c.searchParams.append("ordering",a),o&&c.searchParams.append("deleted",1),(0,r.f)(c.toString(),{method:"GET"})},m=async function(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";const i=(t-1)*s,c=new URL(`${n}${`/clients/${e}/orders/`}`);return c.searchParams.append("limit",s),c.searchParams.append("offset",i),a&&c.searchParams.append("number",a),o&&c.searchParams.append("ordering",o),(0,r.f)(c.toString(),{method:"GET"})},f=async e=>{const t=new URL(`${n}${`/clients/address/${e}/main`}`);return(0,r.f)(t.toString(),{method:"PUT"})},g=async e=>{const t=new URL(`${n}${`/clients/contact-persons/${e}/main`}`);return(0,r.f)(t.toString(),{method:"PUT"})},x=async e=>{const t=new URL(`${n}${`/clients/delete/${e}/`}`);return(0,r.f)(t.toString(),{method:"DELETE"})},w=async e=>{const t=new URL(`${n}${`/clients/contact-persons/${e}/delete/`}`);return(0,r.f)(t.toString(),{method:"DELETE"})},y=async e=>{const t=new URL(`${n}${`/clients/address/${e}/delete/`}`);return(0,r.f)(t.toString(),{method:"DELETE"})},j=async e=>{const t={method:"PUT",body:{unique_id:e}},s=new URL(`${n}/projects/back/`);return(0,r.f)(s.toString(),t)}},67046:(e,t,s)=>{s.d(t,{CK:()=>u,D7:()=>a,HT:()=>m,Op:()=>l,V3:()=>h,WG:()=>c,cS:()=>i,fW:()=>p,j3:()=>o,oe:()=>d});var r=s(31342);const n="https://app.memate.com.au/api/v1",a=async e=>{const t={method:"POST",body:e},s=new URL(`${n}/sales/new-request/`);return(0,r.f)(s.toString(),t)},o=async()=>{const e=new Headers,t=localStorage.getItem("access_token");e.append("Authorization",`Bearer ${t}`);const s={method:"GET",headers:e,redirect:"follow"};try{const e=await fetch(`${n}/sales/`,s);return await e.text()}catch(r){throw console.error("Profile fetch error:",r),r}},i=async(e,t)=>{const s=new Headers,r=localStorage.getItem("access_token");s.append("Authorization",`Bearer ${r}`),s.append("Content-Type","application/json");const a={method:"PUT",headers:s,body:JSON.stringify({sales_note:t}),redirect:"follow"};try{const t=await fetch(`${n}/sales/${e}/notes/`,a);if(!t.ok){const e=await t.text();throw new Error(`Sales notes update failed with status ${t.status}: ${e}`)}const s=await t.text();return s.trim()?JSON.parse(s):null}catch(o){throw console.error("Sales notes update error:",o),o}},c=async e=>{const t={method:"PUT",body:{ids:e}},s=new URL(`${n}/sales/status/won/`);return(0,r.f)(s.toString(),t)},l=async e=>{const t={method:"PUT",body:{ids:e}},s=new URL(`${n}/sales/status/lost/`);return(0,r.f)(s.toString(),t)},d=async(e,t)=>{const s=new Headers,r=localStorage.getItem("access_token");s.append("Authorization",`Bearer ${r}`),s.append("Content-Type","application/json");const a={method:"POST",headers:s,body:JSON.stringify(t),redirect:"follow"};try{const t=await fetch(`${n}/sales/${e}/contacts/`,a);return t.ok?t:(console.log("Error:",t.status),null)}catch(o){return console.log("Error:",o),null}},h=async(e,t)=>{const s=new Headers,r=localStorage.getItem("access_token");s.append("Authorization",`Bearer ${r}`),s.append("Content-Type","application/json");const a={method:"PUT",headers:s,body:JSON.stringify({lead:t,unique_id:e}),redirect:"follow"};try{const t=await fetch(`${n}/sales/${e}/lead/`,a);if(!t.ok){const e=await t.text();throw new Error(`Sales lead update failed with status ${t.status}: ${e}`)}const s=await t.text();return s.trim()?JSON.parse(s):null}catch(o){throw console.error("Sales lead update error:",o),o}},p=async e=>{const t=new Headers,s=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${s}`),t.append("Content-Type","application/json");const r={method:"PUT",headers:t,body:JSON.stringify({ids:e}),redirect:"follow"},a=await Promise.all([fetch(`${n}/sales/status/won/`,r)]);return await Promise.all(a.map((e=>e.json())))},u=async e=>{const t=new Headers,s=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${s}`),t.append("Content-Type","application/json");const r={method:"POST",headers:t,redirect:"follow"},a=await fetch(`${n}/sales/${e}/duplicate/`,r);return(await a.json())[0]},m=async e=>{const t=new Headers,s=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${s}`),t.append("Content-Type","application/json");const r={method:"PUT",headers:t,body:JSON.stringify({ids:e}),redirect:"follow"},a=await Promise.all([fetch(`${n}/sales/status/lost/`,r)]);return await Promise.all(a.map((e=>e.json())))}}}]);
//# sourceMappingURL=8273.2126a4be.chunk.js.map