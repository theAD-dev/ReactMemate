"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[120,6731],{30155:(e,s,t)=>{t.d(s,{A:()=>l});var a=t(65043),i=t(58387),n=t(4258),r=t(99724),o=t(70579);const l=e=>{let{show:s,setShow:t,setMessage:l}=e;const c=e=>{const s=document.querySelector(".emoji-picker"),a=document.querySelector(".chat-emoji-button");!s||s.contains(e.target)||a.contains(e.target)||t(!1)};return a.useEffect((()=>(document.addEventListener("click",c),()=>{document.removeEventListener("click",c)})),[]),(0,o.jsxs)("div",{className:"chat-emoji-picker",children:[(0,o.jsx)("button",{type:"button",className:(0,i.A)(r.A.emojiButton,"chat-emoji-button"),onClick:()=>t((e=>!e)),tabIndex:-1,style:{padding:"4px"},children:(0,o.jsxs)("svg",{width:"15",height:"15",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsx)("path",{d:"M10 18.3333C14.6024 18.3333 18.3334 14.6024 18.3334 10C18.3334 5.39763 14.6024 1.66667 10 1.66667C5.39765 1.66667 1.66669 5.39763 1.66669 10C1.66669 14.6024 5.39765 18.3333 10 18.3333Z",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)("path",{d:"M6.66669 11.6667C6.66669 11.6667 7.91669 13.3333 10 13.3333C12.0834 13.3333 13.3334 11.6667 13.3334 11.6667",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)("path",{d:"M7.5 7.5H7.50833",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)("path",{d:"M12.5 7.5H12.5083",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]})}),s&&(0,o.jsx)("div",{className:"emoji-picker",style:{position:"absolute",bottom:"40px",right:0,zIndex:10},children:(0,o.jsx)(n.Ay,{onEmojiClick:e=>{l((s=>s+(e.emoji||""))),t(!1)},theme:"light"})})]})}},50696:(e,s,t)=>{t.r(s),t.d(s,{default:()=>ds});var a=t(65043),i=t(49367),n=t(73216),r=t(42104),o=t(56328);const l="chat-layout_chatContainer__qW3K4";var c=t(90386),d=t(57189),u=t(48417),h=t(27734),p=t(86213),m=t(70381),v=t.n(m),_=t(72018),g=t(27932),x=t(93740),f=t(99724),j=t(95753),C=t(30155),b=t(70579);const N=()=>(0,b.jsxs)("div",{className:f.A.emptyChat,children:[(0,b.jsx)("div",{className:f.A.emptyChatIcon,children:(0,b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"220",height:"171",viewBox:"0 0 220 171",fill:"none",children:[(0,b.jsx)("circle",{cx:"110",cy:"80",r:"80",fill:"#EAECF0"}),(0,b.jsx)("circle",{cx:"18",cy:"12",r:"8",fill:"#F2F4F7"}),(0,b.jsx)("circle",{cx:"198",cy:"142",r:"6",fill:"#F2F4F7"}),(0,b.jsx)("circle",{cx:"25",cy:"138",r:"10",fill:"#F2F4F7"}),(0,b.jsx)("circle",{cx:"210",cy:"46",r:"10",fill:"#F2F4F7"}),(0,b.jsx)("circle",{cx:"191",cy:"11",r:"7",fill:"#F2F4F7"}),(0,b.jsx)("path",{opacity:"0.7",d:"M140.356 4H75.0524C72.3887 4.00774 69.8364 5.06932 67.9528 6.95284C66.0693 8.83635 65.0077 11.3887 65 14.0524V20.7589C65.0077 23.4226 66.0693 25.975 67.9528 27.8585C69.8364 29.742 72.3887 30.8036 75.0524 30.8113H140.356L150.409 36.7694V14.0231C150.391 11.3651 149.326 8.82132 147.444 6.94454C145.561 5.06776 143.014 4.00961 140.356 4Z",fill:"#667085"}),(0,b.jsx)("path",{d:"M138.537 13.605H76.8355V15.2779H138.537V13.605Z",fill:"white"}),(0,b.jsx)("path",{d:"M138.537 19.5339H88.7074V21.2069H138.537V19.5339Z",fill:"white"}),(0,b.jsx)("path",{opacity:"0.15",d:"M75.0156 48.6416H140.32C142.983 48.6493 145.536 49.7109 147.419 51.5944C149.303 53.478 150.364 56.0303 150.372 58.694V65.3932C150.364 68.0569 149.303 70.6092 147.419 72.4928C145.536 74.3763 142.983 75.4378 140.32 75.4456H75.0156L64.9631 81.4037V58.6573C64.9786 55.9994 66.0438 53.4553 67.9267 51.5793C69.8096 49.7033 72.3576 48.6474 75.0156 48.6416Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.5",d:"M138.537 58.239H76.8355V59.912H138.537V58.239Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.5",d:"M105.452 64.175H76.8355V65.848H105.452V64.175Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.5",d:"M121.558 64.175H109.92V65.848H121.558V64.175Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.7",d:"M140.356 93.2759H75.0524C72.3887 93.2836 69.8364 94.3452 67.9528 96.2287C66.0693 98.1123 65.0077 100.665 65 103.328V110.027C65.0058 112.692 66.0668 115.245 67.9507 117.129C69.8346 119.013 72.3881 120.074 75.0524 120.08H140.356L150.409 126.038V103.292C150.39 100.635 149.323 98.093 147.441 96.2178C145.559 94.3426 143.013 93.2855 140.356 93.2759Z",fill:"#667085"}),(0,b.jsx)("path",{d:"M138.537 102.873H76.8355V104.546H138.537V102.873Z",fill:"white"}),(0,b.jsx)("path",{d:"M138.537 108.809H88.7074V110.482H138.537V108.809Z",fill:"white"}),(0,b.jsx)("path",{opacity:"0.15",d:"M75.0156 137.91H100.425C103.089 137.92 105.64 138.982 107.523 140.865C109.406 142.748 110.468 145.299 110.478 147.963V154.669C110.468 157.332 109.406 159.883 107.523 161.767C105.64 163.65 103.089 164.712 100.425 164.721H75.0156L64.9631 170.672V147.963C64.9709 145.299 66.0325 142.747 67.916 140.863C69.7995 138.979 72.3519 137.918 75.0156 137.91Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.5",d:"M80.1079 151.316C80.1079 151.896 79.9357 152.464 79.6132 152.946C79.2907 153.429 78.8324 153.805 78.2961 154.027C77.7598 154.249 77.1696 154.308 76.6003 154.194C76.0309 154.081 75.508 153.801 75.0975 153.391C74.687 152.981 74.4075 152.458 74.2942 151.888C74.181 151.319 74.2391 150.729 74.4613 150.192C74.6834 149.656 75.0596 149.198 75.5423 148.875C76.0249 148.553 76.5924 148.381 77.1729 148.381C77.9483 148.39 78.6893 148.702 79.2377 149.251C79.7861 149.799 80.0984 150.54 80.1079 151.316Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.5",d:"M86.0441 151.91C87.6853 151.91 89.0157 150.579 89.0157 148.938C89.0157 147.297 87.6853 145.967 86.0441 145.967C84.4028 145.967 83.0724 147.297 83.0724 148.938C83.0724 150.579 84.4028 151.91 86.0441 151.91Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.5",d:"M97.9162 154.874C97.9162 155.455 97.744 156.022 97.4215 156.505C97.099 156.988 96.6406 157.364 96.1043 157.586C95.568 157.808 94.9779 157.866 94.4086 157.753C93.8392 157.64 93.3163 157.36 92.9058 156.95C92.4953 156.539 92.2158 156.016 92.1025 155.447C91.9893 154.878 92.0474 154.288 92.2696 153.751C92.4917 153.215 92.8679 152.757 93.3506 152.434C93.8332 152.112 94.4007 151.939 94.9812 151.939C95.7596 151.939 96.5061 152.249 97.0565 152.799C97.6069 153.35 97.9162 154.096 97.9162 154.874Z",fill:"#667085"})]})}),(0,b.jsx)("p",{className:f.A.emptyChatText,children:"No chat group selected. Please choose a chat to start messaging."})]});var y=t(50565);const w="chat-header_chatHeader__NBNiP",A="chat-header_headerContent__eonUD",I="chat-header_projectHeader__bh-f2",k="chat-header_projectReference__MYCPr",S="chat-header_userContainer__+afvT",M="chat-header_userAvatar__wKfvC",$="chat-header_userInfo__LWRrj",F="chat-header_userName__7Nea5",L="chat-header_statusContainer__HUydX",U="chat-header_statusIndicator__mg5ai",z="chat-header_statusText__mcVoz",B="chat-header_headerActions__ZniE4",E="chat-header_menuButton__pcyHE",R=e=>{var s,t,i,n,r;let{chat:o,userId:l,setParticipants:c,onlineUsers:d=[],setShowSidebar:u,users:h}=e;const p=a.useMemo((()=>{const e=(null===o||void 0===o?void 0:o.participants)||[];return null===e||void 0===e?void 0:e.reduce(((e,s)=>(e[s.id]=s.name,e)),{})}),[null===o||void 0===o?void 0:o.participants]);(0,a.useEffect)((()=>{c(p)}),[p,c]);const m=o.project_id||o.job_number,v=e=>{var s;const t=e.participants.find((e=>e.id!==+l));return t?{name:(null===t||void 0===t?void 0:t.name)||"Unknown User",avatar:null!==t&&void 0!==t&&t.id&&null!==(s=h[null===t||void 0===t?void 0:t.id])&&void 0!==s&&s.photo?h[null===t||void 0===t?void 0:t.id].photo:"",id:t.id,status:null!==d&&void 0!==d&&d.includes(t.id)?"online":"offline"}:{name:"Unknown User",avatar:"",id:null,status:"offline"}};return(0,b.jsx)("div",{className:w,children:(0,b.jsx)("div",{className:A,children:m?(0,b.jsxs)("div",{className:"d-flex w-100 justify-content-between align-items-center",children:[(0,b.jsx)("div",{className:I,children:(0,b.jsx)("span",{className:k,children:(null===o||void 0===o?void 0:o.name)||"Unknown"})}),(0,b.jsx)("div",{className:B,children:(0,b.jsx)("button",{className:E,onClick:()=>u((e=>!e)),children:(0,b.jsx)(y.A,{size:20,color:"#667085"})})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:S,children:[(0,b.jsx)("div",{className:M,children:null!==(s=v(o))&&void 0!==s&&s.avatar?(0,b.jsx)("img",{src:null===(t=v(o))||void 0===t?void 0:t.avatar,alt:"avatar"}):null===(i=v(o))||void 0===i||null===(n=i.name)||void 0===n?void 0:n.split(" ").map((e=>e[0])).join("").slice(0,2)}),(0,b.jsxs)("div",{className:$,children:[(0,b.jsx)("h2",{className:F,children:null===(r=v(o))||void 0===r?void 0:r.name}),(0,b.jsxs)("div",{className:L,children:[(0,b.jsx)("span",{className:U,"data-status":v(o).status}),(0,b.jsx)("span",{className:z,children:v(o).status})]})]})]}),(0,b.jsx)("div",{className:B,children:(0,b.jsx)("button",{className:E,onClick:()=>u((e=>!e)),children:(0,b.jsx)(y.A,{size:20,color:"#667085"})})})]})})})};var D=t(93202),H=t(56741),T=t(96141),P=t(94819),W=t(25721),Z=t(58387),V=t(54972),G=t(55797);const O={chatInfoSidebar:"chat-info-sidebar_chatInfoSidebar__B2GSA",chatInfoHeader:"chat-info-sidebar_chatInfoHeader__EJGoD",closeButton:"chat-info-sidebar_closeButton__F11xC",chatInfoContent:"chat-info-sidebar_chatInfoContent__LPT17",groupInfoAvatar:"chat-info-sidebar_groupInfoAvatar__qwdU8",scrollContainer:"chat-info-sidebar_scrollContainer__njhX1",participantsList:"chat-info-sidebar_participantsList__nm8XP",participantItem:"chat-info-sidebar_participantItem__dSQQf",participantAvatar:"chat-info-sidebar_participantAvatar__Rxfmr",participantName:"chat-info-sidebar_participantName__CQFtG",addParticipantAvatar:"chat-info-sidebar_addParticipantAvatar__h01WK",addParticipantButton:"chat-info-sidebar_addParticipantButton__oZGqt",circledesignstyle:"chat-info-sidebar_circledesignstyle__MmFQR",out:"chat-info-sidebar_out__+dukq",modal:"chat-info-sidebar_modal__9He2B",userContainer:"chat-info-sidebar_userContainer__1SFUL",contactItem:"chat-info-sidebar_contactItem__nRCMw",participantsFooter:"chat-info-sidebar_participantsFooter__B+Euk"};var Y=t(58027);const K=e=>{var s;let{chatId:t,userId:i,chatInfo:r,participants:l,closeSidebar:c,users:d,socket:u,refetchGroupChats:h}=e;const p=(0,n.Zp)(),[m,v]=a.useState(!1),[g,f]=a.useState(""),[j,C]=a.useState([]),[N,y]=a.useState([]),[w,A]=a.useState([]),[I,k]=a.useState(!1),[S,M]=a.useState(!1),$=(null===r||void 0===r?void 0:r.project_id)||(null===r||void 0===r?void 0:r.job_number),F=(null===r||void 0===r||null===(s=r.participants)||void 0===s?void 0:s.map((e=>{var s;return{id:e.id,name:e.name,avatar:(null===(s=d[e.id])||void 0===s?void 0:s.photo)||""}})))||[],L=F.find((e=>e.id!==+i)),U=$?"":null===L||void 0===L?void 0:L.avatar,z=$?(null===r||void 0===r?void 0:r.name)||"Unknown Group":(null===L||void 0===L?void 0:L.name)||"Unknown User",B=()=>{v(!1),A([]),f(""),y(j)},E=()=>{0!==w.length&&(k(!0),u.emit("add_participant",{group_id:+t,user_id:+i,participant_id:w[0]},(e=>{"success"===e.status?(B(),h(),o.oR.success("Member added successfully")):o.oR.error("Failed to add member"),k(!1)})))};return(0,a.useEffect)((()=>{A([]),f("");const e=Object.keys(l),s=Object.values(d).filter((s=>!e.includes(String(s.id))));y(s||[]),C(s||[])}),[t,l,d]),(0,a.useEffect)((()=>{if(""===g.trim())return void y(j);const e=g.toLowerCase(),s=j.filter((s=>s.first_name.toLowerCase().includes(e)||s.last_name.toLowerCase().includes(e)||s.email.toLowerCase().includes(e)));y(s)}),[g,j]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:O.chatInfoSidebar,children:[(0,b.jsxs)("div",{className:O.chatInfoHeader,children:[(0,b.jsx)("p",{className:"font-18 mb-0",style:{fontWeight:600,color:"#344054"},children:$?"Group Info":"Contact Info"}),(0,b.jsx)("button",{className:O.closeButton,onClick:c,children:(0,b.jsx)(H.A,{size:32})})]}),(0,b.jsxs)("div",{className:O.scrollContainer,children:[(0,b.jsxs)("div",{className:O.chatInfoContent,children:[(0,b.jsx)("div",{className:O.groupInfoAvatar,children:U?(0,b.jsx)("img",{src:U,alt:z}):(0,b.jsx)("div",{className:O.groupAvatarPlaceholder,children:z.split(" ").map((e=>e[0])).join("").slice(0,2)})}),(0,b.jsx)("p",{className:"mb-0",style:{fontSize:"20px"},children:z}),(0,b.jsx)("p",{className:"font-14 mb-0",children:$?(null===r||void 0===r?void 0:r.project_id)||(null===r||void 0===r?void 0:r.job_number):""})]}),(0,b.jsxs)("div",{className:O.participantsList,children:[(0,b.jsxs)("h3",{className:"font-14 ms-2 mb-2",style:{color:"var(--Gray-600, #344952)"},children:[Object.keys(l).length," members"]}),(0,b.jsxs)("ul",{className:"w-100 mb-3",children:[F.map((e=>{let{id:s,name:t,avatar:a}=e;return(0,b.jsxs)("li",{className:O.participantItem,children:[(0,b.jsx)("div",{className:O.participantAvatar,children:a?(0,b.jsx)("img",{src:a,alt:t}):t.split(" ").map((e=>e[0])).join("").slice(0,2)}),(0,b.jsx)("span",{className:O.participantName,children:t})]},s)})),$&&(0,b.jsxs)("button",{className:O.addParticipantButton,onClick:()=>v(!0),children:[(0,b.jsx)("div",{className:O.addParticipantAvatar,children:(0,b.jsx)(T.A,{size:20,color:"#1AB2FF"})}),(0,b.jsx)("span",{className:O.participantName,children:"Add Member"})]})]})]})]}),$&&(0,b.jsx)("div",{className:O.participantsFooter,children:(0,b.jsxs)("button",{className:"danger-text-button",disabled:S,onClick:()=>{M(!0),u.emit("archive_chat_group",{group_id:t,user_id:i},(e=>{"success"===e.status?(c(),h(),p("/chat"),o.oR.success("Group archived successfully")):o.oR.error("Failed to archive group"),M(!1)}))},children:[(0,b.jsx)(P.A,{color:"#b42318",size:16,className:"me-1"})," Archive Group",S&&(0,b.jsx)(x.p,{style:{width:"16px",height:"16px"},className:"ms-2"})]})})]}),(0,b.jsxs)(G.l,{header:()=>(0,b.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,b.jsx)("div",{className:O.circledesignstyle,children:(0,b.jsx)("div",{className:O.out,children:(0,b.jsx)(D.A,{size:24,color:"#17B26A"})})}),(0,b.jsx)("span",{style:{color:"344054",fontSize:"20px",fontWeight:600},children:"Add Member"})]}),footer:()=>(0,b.jsxs)("div",{className:"d-flex justify-content-end gap-3 pt-3",children:[(0,b.jsx)(_.$,{label:"Cancel",className:"outline-button",disabled:I,onClick:B}),(0,b.jsx)(_.$,{label:"Add",loading:I,disabled:I||0===w.length,className:"solid-button",onClick:E})]}),modal:!0,className:`${O.modal} custom-modal`,visible:m,onHide:B,children:[(0,b.jsx)("div",{className:"search-header w-100",children:(0,b.jsxs)("div",{className:"searchGroupFilter d-flex align-items-center",style:{gap:"10px",minWidth:"100%",maxWidth:"100%"},children:[(0,b.jsx)(W.A,{color:"#98A2B3",size:20}),(0,b.jsx)("input",{id:"search-box",placeholder:"Search",value:g,className:"pl-2",onChange:e=>f(e.target.value)})]})}),(0,b.jsx)("div",{className:O.userContainer,children:N.map((e=>(0,b.jsxs)("div",{className:(0,Z.A)("d-flex align-items-center justify-content-start gap-2",O.contactItem),children:[(0,b.jsx)(V.S,{inputId:`checkbox-${e.id}`,disabled:w.length,checked:w.includes(e.id),onChange:()=>A((s=>s.includes(e.id)?s.filter((s=>s!==e.id)):[...s,e.id]))}),(0,b.jsxs)("label",{htmlFor:`checkbox-${e.id}`,className:"d-flex align-items-center gap-1 cursor-pointer",children:[(0,b.jsx)(Y.h,{has_photo:e.has_photo,photo:e.photo,is_business:!1}),(0,b.jsxs)("div",{className:"d-flex flex-column",children:[(0,b.jsxs)("span",{className:"font-14",children:[e.first_name," ",e.last_name]}),(0,b.jsx)("span",{className:"font-12 text-muted",children:e.email})]})]})]},e.id)))})]})]})};var q=t(60867),J=t(55850),Q=t(96956);const X="message-list_messageGroup__ErZtK",ee="message-list_dateHeader__eLUx6",se="message-list_message__3UO-2",te="message-list_sent__lna8g",ae="message-list_messageContent__-bYu5",ie="message-list_messageTime__GG1x5",ne="message-list_received__QjePJ",re="message-list_messageAttachment__9Xcs9",oe="message-list_messageContentSent__uivln",le="message-list_messageText__JpeJm",ce="message-list_emptyMessages__Zcq-I",de="message-list_typingIndicator__GbJ55",ue="message-list_typingDot__BlFvs",he="message-list_userAvatar__UkK5U",pe="message-list_messageSenderName__UmAeW",me="message-list_messageTimeSent__7OaoW";var ve=t(11281),_e=t(33296),ge=t(54967),xe=t(75329),fe=t(35475);const je="file-attachment_fileName__hKqo3",Ce="file-attachment_fileSize__JE1wZ",be="file-attachment_fileAttachment__po3Wp",Ne="file-attachment_downloadButton__CRO8A",ye=e=>{let{file:s}=e;if(!s)return null;const{url:t,type:a}=s,i=t.split("?")[0],n=i.substring(i.lastIndexOf("/")+1),r=a.split("-")[0]||"",o=a.split("-")[1]||"";return(0,b.jsxs)("div",{className:(0,Z.A)(be),style:{display:"flex",alignItems:"center",marginBottom:0,gap:12,padding:10,width:"508px",marginLeft:"auto",position:"relative"},children:[(0,ve.I)(r),(0,b.jsxs)("div",{style:{width:"80%",textAlign:"left"},children:[(0,b.jsx)("div",{className:(0,Z.A)(je,"ellipsis-width"),children:n}),(0,b.jsx)("div",{className:(0,Z.A)(Ce),children:o})]}),(0,b.jsx)(fe.N_,{to:t,target:"_blank",className:(0,Z.A)(Ne),children:(0,b.jsx)(xe.A,{size:16,color:"var(--gray-600, #475467)"})})]})},we=e=>{const s=new Date(1e3*e),t=s.toLocaleString("en-US",{weekday:"long"});let a=s.getHours();const i=a>=12?"pm":"am";return a=a%12||12,`${t} ${a}:${s.getMinutes().toString().padStart(2,"0")}${i}`},Ae=(e,s)=>e.getFullYear()===s.getFullYear()&&e.getMonth()===s.getMonth()&&e.getDate()===s.getDate(),Ie=e=>{var s,t,i,n,r,o,l,c,d;let{messages:u=[],isTyping:h={},loading:p=!0,currentUserId:m,participants:v,chatId:_,attachmentFile:g,setAttachmentFile:x}=e;const f=(0,a.useRef)(null),C=(0,a.useMemo)((()=>Array.isArray(u)?(null!==g&&void 0!==g&&g.file&&x(null),u.filter((e=>null===e||void 0===e?void 0:e.sent_at)).map(((e,s)=>{const t=Number(e.sent_at),a=new Date(1e3*t),i=e.sender_photo&&"/media/no_photo.png"!==e.sender_photo?e.sender_photo.startsWith("http")?e.sender_photo:`https://app.memate.com.au${e.sender_photo}`:"";return{id:e.id||`msg-${s}`,text:e.message||"",sender:e.sender||"Unknown",photo:i,timestamp:t,sendingTime:we(t),isOwn:m===e.sender,attachment:e.file_url?{url:e.file_url,type:e.file_type}:void 0,displayDate:a,fullDate:a.toLocaleDateString("en-US",{dateStyle:"medium"})}})).sort(((e,s)=>e.timestamp-s.timestamp))):(console.warn("Messages is not an array:",u),[])),[u,m]),N=(0,a.useMemo)((()=>{const e={},s=new Date,t=new Date;return t.setDate(s.getDate()-1),C.forEach((a=>{let i=a.fullDate;Ae(a.displayDate,s)?i="Today":Ae(a.displayDate,t)&&(i="Yesterday"),e[i]||(e[i]=[]),e[i].push(a)})),e}),[C]),y=(0,a.useMemo)((()=>Object.entries(N).sort(((e,s)=>{let[,t]=e,[,a]=s;return t[0].timestamp-a[0].timestamp})).map((e=>{let[s]=e;return s}))),[N]);return(0,a.useEffect)((()=>{(()=>{var e;null===(e=f.current)||void 0===e||e.scrollIntoView({behavior:"auto"})})()}),[C,g]),(0,b.jsxs)(b.Fragment,{children:[y.map((e=>(0,b.jsxs)("div",{className:X,children:[(0,b.jsx)("div",{className:(0,Z.A)(ee,"dividerContainer"),children:(0,b.jsx)(Q.c,{children:(0,b.jsx)("span",{children:e})})}),N[e].map((e=>(0,b.jsxs)("div",{className:(0,Z.A)(se,e.isOwn?te:ne),children:[(0,b.jsxs)("div",{className:(0,Z.A)("w-100 d-flex align-items-center gap-2 justify-content-between"),children:[e.isOwn?(0,b.jsx)("span",{className:pe,children:"You"}):(0,b.jsxs)("div",{className:"d-flex gap-2",children:[(0,b.jsx)("div",{className:he,children:(0,b.jsx)(ge.dg,{has_photo:e.photo,photo:e.photo,name:(null===v||void 0===v?void 0:v[e.sender])||"Unknown"})}),(0,b.jsx)("span",{className:pe,children:(null===v||void 0===v?void 0:v[e.sender])||"Unknown"})]}),(0,b.jsx)("span",{className:(0,Z.A)(ie,{[me]:!e.isOwn}),children:e.sendingTime})]}),e.attachment?(0,b.jsx)("div",{className:(0,Z.A)(re,{[oe]:!e.isOwn}),children:(0,b.jsx)(ye,{file:e.attachment})}):(0,b.jsx)("div",{className:(0,Z.A)(ae,{[oe]:!e.isOwn}),children:(0,b.jsx)("p",{className:le,children:e.text})})]},e.id)))]},e))),0===C.length&&!p&&(0,b.jsx)("div",{className:ce,children:(0,b.jsx)("p",{children:"No messages yet. Start the conversation!"})}),(null===g||void 0===g?void 0:g.file)&&(null===g||void 0===g?void 0:g.chatId)===_&&(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",background:"#F9FAFB",borderRadius:8,padding:12,marginBottom:0,gap:12,border:"1px solid #EAECF0",width:"508px",marginLeft:"auto",position:"relative"},children:[(0,ve.I)(g.file.name.split(".").pop()),(0,b.jsxs)("div",{style:{flex:1,textAlign:"left"},children:[(0,b.jsx)("div",{style:{fontWeight:600,color:"#101828",fontSize:16,marginBottom:2},children:g.file.name}),(0,b.jsx)("div",{style:{color:"#667085",fontSize:14},children:(0,j.v)(g.file.size)})]}),null!==g&&void 0!==g&&g.error?(0,b.jsx)(q.A,{color:"#F04438",size:20}):100==(null===g||void 0===g?void 0:g.progress)?(0,b.jsx)(J.A,{color:"#12B76A",size:20}):(0,b.jsx)(_e.A,{percentage:parseInt(null===g||void 0===g?void 0:g.progress)||0,size:30,color:"#158ECC"}),(0,b.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",right:"-6px",top:"-8px",background:"#d4d5d7ff",borderRadius:"50%",padding:"2px",cursor:"pointer"},onClick:()=>x({}),children:(0,b.jsx)(H.A,{size:18,color:"#667085"})})]}),h.isTyping&&(0,b.jsxs)("div",{className:(0,Z.A)(se,ne),children:[(0,b.jsx)("div",{className:(0,Z.A)("w-100 d-flex align-items-center gap-2 justify-content-between"),children:(0,b.jsxs)("div",{className:"d-flex gap-2",children:[(0,b.jsx)("div",{className:he,children:null!==h&&void 0!==h&&null!==(s=h.user)&&void 0!==s&&s.has_photo?(0,b.jsx)(ge.dg,{has_photo:null===h||void 0===h||null===(t=h.user)||void 0===t?void 0:t.has_photo,photo:null===h||void 0===h||null===(i=h.user)||void 0===i?void 0:i.photo,name:`${null===h||void 0===h||null===(n=h.user)||void 0===n?void 0:n.first_name} ${null===h||void 0===h||null===(r=h.user)||void 0===r?void 0:r.last_name}`}):(0,b.jsx)(ge.fr,{name:`${null===h||void 0===h||null===(o=h.user)||void 0===o?void 0:o.first_name} ${null===h||void 0===h||null===(l=h.user)||void 0===l?void 0:l.last_name}`})}),(0,b.jsxs)("span",{className:pe,children:[null===h||void 0===h||null===(c=h.user)||void 0===c?void 0:c.first_name," ",null===h||void 0===h||null===(d=h.user)||void 0===d?void 0:d.last_name]})]})}),(0,b.jsxs)("div",{className:de,children:[(0,b.jsx)("div",{className:ue}),(0,b.jsx)("div",{className:ue}),(0,b.jsx)("div",{className:ue})]})]}),(0,b.jsx)("div",{ref:f})]})},ke=e=>{let{currentChat:s,socket:t,userId:i,chatId:r,onlineUsers:l=[],setChatData:c,users:d,updatePrivateGroupChatId:u,refetchGroupChats:h}=e;const m=(0,n.Zp)(),y=localStorage.getItem("access_token"),[w,A]=(0,a.useState)(""),[I,k]=(0,a.useState)(!1),[S,M]=(0,a.useState)({}),[$,F]=(0,a.useState)([]),[L,U]=(0,a.useState)({}),[z,B]=(0,a.useState)(1),[E]=(0,a.useState)(20),[D,H]=(0,a.useState)(!1),[T,P]=(0,a.useState)(!0),[W,Z]=(0,a.useState)(!1),[V,G]=(0,a.useState)(null),[O,Y]=(0,a.useState)(!1),q=(0,a.useRef)(null),J=(0,a.useRef)(null),Q=(0,a.useRef)(0),X=(0,a.useRef)(null),[ee,se]=(0,a.useState)(!1),te=(0,a.useCallback)(((e,s,t)=>{F((s=>{const a=e.filter((e=>!s.some((s=>s.id===e.id))));return 1===t?a:[...a,...s]})),P(t<(s||1)),H(!1)}),[]);(0,a.useEffect)((()=>{r&&i&&t&&(null===r||void 0===r||!r.startsWith("private_group"))&&(H(!0),J.current&&z>1&&(Q.current=J.current.scrollHeight),t.emit("get_group_messages",{user_id:i,group_id:r,page:z,page_size:E},(e=>{e&&"success"===e.status&&e.messages&&te(e.messages,e.total_pages,z)})))}),[r,i,t,z,E,te]),(0,a.useEffect)((()=>{var e;if(t&&!D&&s&&i&&!Number(r)&&null!==s&&void 0!==s&&null!==(e=s.participants)&&void 0!==e&&e.length&&null!==r&&void 0!==r&&r.startsWith("private_group")){const e=s.participants.map((e=>e.id)).filter((e=>e!==i)),a="Private Chat";t.emit("create_chat_group",{name:a,user_id:i,participants:e,project_id:null,job_id:null},(e=>{"success"===e.status&&e.chat_group_id?(H(!0),u(r,e.chat_group_id)):(H(!1),console.log("Error during creation chat group: ",e),o.oR.error("Could not start chat. Please try again."))}))}}),[r,i,t,s,m,D]);(0,a.useEffect)((()=>{if(!t||!r||null!==r&&void 0!==r&&r.startsWith("private_group"))return;const e=e=>{e.chat_group==r&&F((s=>s.some((s=>s.id==e.id))?s:[e,...s])),c((s=>{var t;const a={...s[e.chat_group],last_message:e,unread_count:((null===(t=s[e.chat_group])||void 0===t?void 0:t.unread_count)||0)+1};return{...s,[e.chat_group]:a}}))};return t.on("new_message",e),t.on("typing",(e=>{(null===e||void 0===e?void 0:e.group_id)===r&&M({isTyping:!0,user:d[e.user_id]})})),t.on("stop_typing",(e=>{(null===e||void 0===e?void 0:e.group_id)===r&&M({})})),()=>{t.off("new_message",e)}}),[t,r]),(0,a.useEffect)((()=>{if(t&&r&&(null===r||void 0===r||!r.startsWith("private_group")))return t.emit("join_group",{group_id:r},(e=>{"success"===e.status?console.log("Joined group successfully"):console.log("Failed to join group: ",e)})),()=>{t.emit("leave_group",{group_id:r})}}),[t,r]),(0,a.useEffect)((()=>{const e=J.current;if(e)if(1===z&&q.current)q.current.scrollIntoView({behavior:"auto"}),Q.current=0;else if(z>1&&Q.current){const s=e.scrollHeight;e.scrollTop=s-Q.current}}),[$,z]);const ae=(e,a)=>{if((w.trim()||e)&&s&&t&&i&&!I){const s={user_id:i,chat_group_id:r,message:w.trim(),file_url:e,file_type:a};k(!0),t.emit("send_message",s,(e=>{"success"===e.status?(e=>{var s;(null===e||void 0===e||null===(s=e.sent_message)||void 0===s?void 0:s.chat_group)==r&&(F((s=>s.some((s=>s.id===e.message_id))?s:[e.sent_message,...s])),k(!1),A(""),Q.current=0,setTimeout((()=>{X.current&&X.current.focus()}),500),c((s=>{var t,a;const i={...s[null===e||void 0===e||null===(t=e.sent_message)||void 0===t?void 0:t.chat_group],last_message:null===e||void 0===e?void 0:e.sent_message};return{...s,[null===e||void 0===e||null===(a=e.sent_message)||void 0===a?void 0:a.chat_group]:i}})))})(e):(k(!1),o.oR.error("Failed to send message:"))}))}};let ie;const ne=(0,a.useMemo)((()=>v()(((e,s)=>{t&&e&&s&&t.emit("typing",{group_id:e,user_id:s})}),2e3)),[t]),re=async e=>{if(e&&r)try{var s,t,a;const i=null===e||void 0===e||null===(s=e.name)||void 0===s?void 0:s.split(".")[0],n=null===e||void 0===e||null===(t=e.name)||void 0===t||null===(a=t.split("."))||void 0===a?void 0:a.pop(),l=`${i}-${Date.now()}.${n}`,c=(0,j.v)(e.size),d=await p.A.post(`https://app.memate.com.au/api/v1/chat/upload/${r}/`,{filename:l},{headers:{Authorization:`Bearer ${y}`}}),{url:u}=d.data;if(!u)return G((e=>({...e,progress:0,error:!0}))),void o.oR.error("Failed to get upload URL. Please try again.");await(async(e,s,t,a)=>p.A.put(s,e,{headers:{"Content-Type":""},onUploadProgress:e=>{const s=Math.round(e.loaded/e.total*100);G((e=>({...e,progress:s})))}}).then((()=>{G((e=>({...e,progress:100,success:!0})));const e=s.split("?")[0]||"";ae(e,`${t}-${a}`)})).catch((e=>{console.log("Error uploading to S3: ",e),G((e=>({...e,progress:0,error:!0})))})))(e,u,n,c)}catch(i){G((e=>({...e,progress:0,error:!0}))),console.error("Error uploading file:",i),o.oR.error("Failed to upload file. Please try again.")}},oe=["jpg","jpeg","png","gif","pdf","doc","docx","txt","xls","xlsx","ppt","pptx","csv"],le=["image/jpeg","image/png","image/gif","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/csv"],ce=["exe","bat","cmd","com","scr","vbs","js","jar","zip","rar","7z","tar","gz","iso","dmg","app","msi","dll","sys","mp4","avi","mov","mkv","flv","wmv","webm","m4v"],de=(e,s)=>{var t,a;const i=null===e||void 0===e||null===(t=e.split("."))||void 0===t||null===(a=t.pop())||void 0===a?void 0:a.toLowerCase();return ce.includes(i)?{allowed:!1,reason:`File type (.${i}) is not allowed for security reasons. Videos, archives, and executable files cannot be uploaded.`}:oe.includes(i)?s&&!le.includes(s)?{allowed:!1,reason:`File MIME type (${s}) is not allowed for security reasons.`}:{allowed:!0}:{allowed:!1,reason:`File type (.${i}) is not supported. Allowed formats: ${oe.join(", ")}`}},ue=(0,a.useCallback)((()=>{0===J.current.scrollTop&&T&&!D&&B((e=>e+1))}),[T,D]);return(0,a.useEffect)((()=>{const e=J.current;if(e)return e.addEventListener("scroll",ue),()=>e.removeEventListener("scroll",ue)}),[ue,$]),(0,a.useEffect)((()=>{X.current&&X.current.focus(),Q.current=0,B(1),F([]),P(!0),H(!1)}),[r]),(0,b.jsxs)("div",{className:"d-flex w-100 h-100",children:[(0,b.jsx)("div",{className:f.A.chatArea,children:s?(0,b.jsxs)("div",{className:f.A.chatContent,style:{position:"relative"},children:[(0,b.jsx)(R,{chat:s,userId:i,setParticipants:U,onlineUsers:l,users:d,setShowSidebar:se}),(0,b.jsxs)("div",{className:`${f.A.chatBodyArea}  ${O?f.A.dragOver:""}`,onDragOver:e=>{e.preventDefault(),e.stopPropagation(),Y(!0)},onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),Y(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.contains(e.relatedTarget)||Y(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),Y(!1);const s=e.dataTransfer.files;if(s&&s.length>0){const e=s[0],t=de(e.name,e.type);if(!t.allowed)return void o.oR.error(t.reason);if(e.size>15728640)return void o.oR.error(`File size exceeds 15 MB limit. Your file is ${(e.size/1048576).toFixed(2)} MB.`);G({file:e,chatId:r,error:!1,progress:0}),re(e)}},children:[(0,b.jsxs)("div",{className:`${f.A.messagesContainer}`,ref:J,children:[D&&(0,b.jsx)("div",{className:f.A.loadingContainer,children:(0,b.jsx)(x.p,{style:{width:"16px",height:"16px"}})}),(0,b.jsx)(Ie,{messages:$,isTyping:S,loading:D,currentUserId:i,chatId:r,participants:L,attachmentFile:V,setAttachmentFile:G}),(0,b.jsx)("div",{ref:q})]}),(0,b.jsx)("div",{className:`${f.A.messageInputContainer}`,children:(0,b.jsxs)("div",{className:"position-relative w-100",children:[(0,b.jsx)(g.Z,{placeholder:"Send a message...",value:w,onChange:e=>{A(e.target.value),ne(r,i),clearTimeout(ie),ie=setTimeout((()=>{t&&r&&i&&t.emit("stop_typing",{group_id:r,user_id:i})}),2e3)},autoFocus:!0,ref:X,disabled:I||(null===r||void 0===r?void 0:r.startsWith("private_group")),onKeyUp:e=>{"Enter"!==e.key||e.shiftKey||ae()},className:f.A.messageInput}),(0,b.jsxs)("div",{className:f.A.messageInputIcons,children:[I&&(0,b.jsx)(x.p,{style:{width:"20px",height:"20px"}}),(0,b.jsx)("div",{className:f.A.attachWrapper,style:{position:"relative",display:"inline-block"},children:(0,b.jsx)(j.A,{onFileChange:e=>{const s=e.target.files[0];if(s){const e=de(s.name,s.type);if(!e.allowed)return o.oR.error(e.reason),void G(null);if(s.size>15728640)return o.oR.error(`File size exceeds 15 MB limit. Your file is ${(s.size/1048576).toFixed(2)} MB.`),void G(null);G({file:s,chatId:r,error:!1,progress:0}),re(s)}},styles:f.A,file:V,onRemoveFile:()=>G(null)})}),(0,b.jsx)(C.A,{show:W,setShow:Z,setMessage:A}),(0,b.jsx)(_.$,{className:f.A.sendButton,onClick:()=>ae(),disabled:!w.trim()||I,children:"Send"})]})]})})]})]}):(0,b.jsx)(N,{})}),(0,b.jsx)("div",{style:ee?{position:"absolute",right:"16px"}:{display:"none"},className:f.A.chatSidebar,children:(0,b.jsx)(K,{chatId:r,userId:i,chatInfo:s,closeSidebar:()=>se(!1),participants:L,users:d,socket:t,refetchGroupChats:h})})]})};var Se=t(28676),Me=t(74532),$e=t(21080),Fe=t(72052);const Le="chat-sidebar_chatSidebar__zzpNg",Ue="chat-sidebar_sidebarHeader__R0eP2",ze="chat-sidebar_headerFirstRow__QMmIk",Be="chat-sidebar_sidebarTitle__3Np6U",Ee="chat-sidebar_archivedLabel__AGzqF",Re="chat-sidebar_headerSecondRow__4diKO",De="chat-sidebar_headerThirdRow__9ynMU",He="chat-sidebar_tabButton__gHzm6",Te="chat-sidebar_active__vtn5W",Pe="chat-sidebar_listContainer__A3eW3";var We=t(65148),Ze=t(16484);const Ve="project-list_projectList__9Df50",Ge="project-list_projectItem__eBp-6",Oe="project-list_active__jFy-d",Ye="project-list_projectHeader__OU-Of",Ke="project-list_projectInfo__LoSIl",qe="project-list_projectTitleRow__EhGqR",Je="project-list_projectName__w7dZI",Qe="project-list_messagePreviewContainer__uYIHz",Xe="project-list_userInfo__2ZVWv",es="project-list_lastMessage__iWohN",ss="project-list_lastMessageTime__HD-aX",ts="project-list_archivedBadge__uJ+Vf",as="project-list_unreadCount__RJKbs",is="project-list_fallbackAvatar__ImNhd",ns=e=>{let{chatData:s,searchQuery:t,showArchived:a,userId:i,users:r}=e;console.log("chatData: ",s);const o=(0,n.zy)(),l=new URLSearchParams(o.search).get("id"),c=Object.entries(s).filter((e=>{let[,s]=e;return s.project_id||s.job_number})).sort(((e,s)=>{var t,a;const i=(null===(t=e[1].last_message)||void 0===t?void 0:t.sent_at)||0;return((null===(a=s[1].last_message)||void 0===a?void 0:a.sent_at)||0)-i})).filter((e=>{var s;let[,i]=e;const n=((null===i||void 0===i?void 0:i.name)||"Unknown Group").toLowerCase().includes(t.toLowerCase()),r=a||!((null===(s=i.archived_by)||void 0===s?void 0:s.length)>0);return n&&r}));return(0,b.jsx)("div",{className:Ve,children:c.map((e=>{var s,t,a;let[n,o]=e;const c=(e=>{var s;return(null===e||void 0===e||null===(s=e.last_message)||void 0===s?void 0:s.message)||null})(o),d=(e=>{if(!e)return"";const s=Date.now()-1e3*e,t=Math.floor(s/1e3),a=Math.floor(s/6e4),i=Math.floor(s/36e5),n=Math.floor(s/864e5),r=Math.floor(s/6048e5),o=Math.floor(s/2592e6),l=Math.floor(s/31536e6);return t<60?`${t} second${1!==t?"s":""} ago`:a<60?`${a} minute${1!==a?"s":""} ago`:i<24?`${i} hour${1!==i?"s":""} ago`:n<7?`${n} day${1!==n?"s":""} ago`:r<4?`${r} week${1!==r?"s":""} ago`:o<12?`${o} month${1!==o?"s":""} ago`:`${l} year${1!==l?"s":""} ago`})(null===o||void 0===o||null===(s=o.last_message)||void 0===s?void 0:s.sent_at),u=(e=>(null===e||void 0===e?void 0:e.unread_count)||0)(o),h=(e=>{const s=null===e||void 0===e?void 0:e.last_message;if(!s)return"";const t=e.participants.find((e=>e.id===s.sender));return t.id===i?"You: ":`${null===t||void 0===t?void 0:t.name}: `||"Unknown Sender: `"})(o),p=null===o||void 0===o?void 0:o.name,m=((null===o||void 0===o?void 0:o.job_number)||(null===o||void 0===o||o.project_id),(null===o||void 0===o||null===(t=o.participants)||void 0===t?void 0:t.map((e=>{var s;return{id:e.id,name:e.name,avatar:null!==e&&void 0!==e&&e.id&&null!==(s=r[null===e||void 0===e?void 0:e.id])&&void 0!==s&&s.photo?r[null===e||void 0===e?void 0:e.id].photo:""}})))||[]);return console.log("members: ",null===o||void 0===o?void 0:o.participants,m),(0,b.jsxs)(fe.N_,{to:`?id=${n}`,className:(0,Z.A)(Ge,{[Oe]:l==n}),children:[(0,b.jsxs)("div",{className:Ye,children:[(0,b.jsx)("div",{className:Ke,children:(0,b.jsx)("div",{className:qe,children:(0,b.jsx)("span",{className:Je,children:p})})}),(0,b.jsxs)("div",{className:"d-flex flex-column gap-2",children:[(0,b.jsx)("span",{className:ss,children:d}),(0,b.jsxs)("div",{className:"d-flex align-items-center justify-content-end gap-2",children:[null!==(a=o.archived_by)&&void 0!==a&&a.length?(0,b.jsx)("span",{className:ts,children:"Archived"}):null,u>0&&(0,b.jsx)("span",{className:as,children:u})]})]})]}),(0,b.jsxs)("div",{className:Qe,children:[(0,b.jsx)("div",{className:Xe,children:(0,b.jsx)(Ze.Z,{children:m.map((e=>e.avatar?(0,b.jsx)(We.e,{image:e.avatar,size:"small",shape:"circle"},e.id):(0,b.jsx)(We.e,{label:e.name.split(" ").map((e=>e[0])).join("").slice(0,2),size:"small",shape:"circle",className:is},e.id)))})}),(0,b.jsx)("p",{className:(0,Z.A)(es,"text-start"),children:c?`${h} ${c?c.substring(0,30):""}`:"No messages yet"})]})]},n)}))})},rs={userList:"user-list_userList__Tj5r8",userItem:"user-list_userItem__2vBej",active:"user-list_active__ylmYf",userItemContent:"user-list_userItemContent__a0bK2",userAvatarWrapper:"user-list_userAvatarWrapper__+CzoZ",onlineIndicator:"user-list_onlineIndicator__kRi92",userAvatar:"user-list_userAvatar__EhrPu",userInfo:"user-list_userInfo__tRZdB",userName:"user-list_userName__pjTE0",lastMessage:"user-list_lastMessage__LFBTg",lastMessageTime:"user-list_lastMessageTime__+6gj+",unreadCount:"user-list_unreadCount__2vYTB"},os=e=>{let{chatData:s,searchQuery:t,showArchived:a,userId:i,onlineUsers:r,users:o}=e;const l=(0,n.zy)(),c=new URLSearchParams(l.search).get("id"),d=Object.entries(s).filter((e=>{let[,s]=e;return!s.project_id&&!s.job_number})).sort(((e,s)=>{var t,a;const i=(null===(t=e[1].last_message)||void 0===t?void 0:t.sent_at)||0;return((null===(a=s[1].last_message)||void 0===a?void 0:a.sent_at)||0)-i})).filter((e=>{let[,s]=e;const n=s.participants.find((e=>e.id!==+i)),r=((null===n||void 0===n?void 0:n.name)||(null===s||void 0===s?void 0:s.name)||"Unknown User").toLowerCase().includes(t.toLowerCase()),o=!!a||!s.archived;return r&&o}));return(0,b.jsx)("div",{className:rs.userList,children:d.map((e=>{var s,t;let[a,n]=e;const l=(e=>(null===e||void 0===e?void 0:e.last_message)||null)(n),d=(e=>{if(!e)return"";const s=Date.now()-1e3*e,t=Math.floor(s/1e3),a=Math.floor(s/6e4),i=Math.floor(s/36e5),n=Math.floor(s/864e5),r=Math.floor(s/6048e5),o=Math.floor(s/2592e6),l=Math.floor(s/31536e6);return t<60?`${t} second${1!==t?"s":""} ago`:a<60?`${a} minute${1!==a?"s":""} ago`:i<24?`${i} hour${1!==i?"s":""} ago`:n<7?`${n} day${1!==n?"s":""} ago`:r<4?`${r} week${1!==r?"s":""} ago`:o<12?`${o} month${1!==o?"s":""} ago`:`${l} year${1!==l?"s":""} ago`})(null===n||void 0===n||null===(s=n.last_message)||void 0===s?void 0:s.sent_at),u=(e=>(null===e||void 0===e?void 0:e.unread_count)||0)(n),h=(e=>{const s=null===e||void 0===e?void 0:e.last_message;if(!s)return"";const t=e.participants.find((e=>e.id===s.sender));return(null===t||void 0===t?void 0:t.id)===i?"You: ":null!==t&&void 0!==t&&t.name?`${null===t||void 0===t?void 0:t.name}: `:""})(n),p=(e=>{var s;const t=e.participants.find((e=>e.id!==+i));return null!==t&&void 0!==t&&t.id&&null!==(s=o[null===t||void 0===t?void 0:t.id])&&void 0!==s&&s.photo?o[null===t||void 0===t?void 0:t.id].photo:""})(n),m=(e=>{const s=e.participants.find((e=>e.id!==+i));return(null===s||void 0===s?void 0:s.name)||(null===e||void 0===e?void 0:e.name)||"Unknown User"})(n),v=(e=>{const s=e.participants.find((e=>e.id!==+i));return s&&null!==r&&void 0!==r&&r.includes(s.id)?"online":"offline"})(n);return(0,b.jsxs)(fe.N_,{to:`?id=${a}`,className:(0,Z.A)(rs.userItem,{[rs.active]:c==a}),children:[(0,b.jsxs)("div",{className:rs.userItemContent,children:[(0,b.jsxs)("div",{className:rs.userAvatarWrapper,children:["online"===v&&(0,b.jsx)("div",{className:rs.onlineIndicator}),(0,b.jsx)("div",{className:rs.userAvatar,children:p?(0,b.jsx)("img",{src:p,alt:m}):(0,b.jsx)("span",{className:rs.avatarPlaceholder,children:null===m||void 0===m?void 0:m.split(" ").map((e=>e[0])).join("").slice(0,2)})})]}),(0,b.jsx)("div",{className:rs.userInfo,children:(0,b.jsx)("span",{className:rs.userName,children:m})}),(0,b.jsxs)("div",{className:"d-flex flex-column align-items-end gap-1",children:[(0,b.jsx)("span",{className:rs.lastMessageTime,children:d||""}),u>0&&(0,b.jsx)("span",{className:rs.unreadCount,children:u>9?"9+":u})]})]}),(0,b.jsx)("p",{className:rs.lastMessage,children:null!==l&&void 0!==l&&l.message?`${h} ${null!==l&&void 0!==l&&l.message?null===l||void 0===l||null===(t=l.message)||void 0===t?void 0:t.substring(0,30):""}`:"No messages yet"})]},a)}))})},ls=e=>{let{activeTab:s,setActiveTab:t,archivedVisible:i,setArchivedVisible:n,chatData:r,userId:o,onlineUsers:l,users:c}=e;const[d,u]=(0,a.useState)(""),h=Object.entries(r).filter((e=>{let[,s]=e;return!s.project_id&&!s.job_number})).reduce(((e,s)=>{let[,t]=s;return e+(t.unread_count||0)}),0),p=Object.entries(r).filter((e=>{let[,s]=e;return s.project_id||s.job_number})).filter((e=>{var s;let[,t]=e;const a=((null===t||void 0===t?void 0:t.name)||"Unknown Group").toLowerCase().includes(d.toLowerCase()),n=i||!((null===(s=t.archived_by)||void 0===s?void 0:s.length)>0);return a&&n})).reduce(((e,s)=>{let[,t]=s;return e+(t.unread_count||0)}),0);return(0,b.jsxs)("div",{className:Le,children:[(0,b.jsxs)("div",{className:Ue,children:[(0,b.jsxs)("div",{className:ze,children:[(0,b.jsx)("div",{className:"d-flex align-items-center gap-2",children:(0,b.jsx)("h1",{className:Be,children:"Messages"})}),(0,b.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,b.jsx)($e.H,{checked:i,onChange:e=>n(e.value)}),(0,b.jsx)("h1",{className:Ee,children:"Archived"})]})]}),(0,b.jsx)("div",{className:Re,children:(0,b.jsxs)(Se.C,{iconPosition:"left",className:"border w-100 rounded text-start",children:[(0,b.jsx)(Me.m,{style:{position:"relative"},children:(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:(0,b.jsx)("path",{d:"M14.6777 12.9299C15.6661 11.5841 16.25 9.92275 16.25 8.125C16.25 3.63769 12.6123 0 8.125 0C3.63769 0 0 3.63769 0 8.125C0 12.6123 3.63769 16.25 8.125 16.25C9.92323 16.25 11.585 15.6658 12.9309 14.6769L12.9299 14.6777C12.9667 14.7277 13.0078 14.7756 13.053 14.8208L17.8661 19.6339C18.3543 20.122 19.1457 20.122 19.6339 19.6339C20.122 19.1457 20.122 18.3543 19.6339 17.8661L14.8208 13.053C14.7756 13.0078 14.7277 12.9667 14.6777 12.9299ZM15 8.125C15 11.922 11.922 15 8.125 15C4.32804 15 1.25 11.922 1.25 8.125C1.25 4.32804 4.32804 1.25 8.125 1.25C11.922 1.25 15 4.32804 15 8.125Z",fill:"#98A2B3"})})}),(0,b.jsx)(Fe.S,{placeholder:"Search",style:{padding:"10px 10px 10px 20px"},value:d,onChange:e=>{u(e.target.value)}})]})}),(0,b.jsxs)("div",{className:De,children:[(0,b.jsxs)("div",{className:(0,Z.A)(He,{[Te]:"users"===s}),onClick:()=>t("users"),children:[(0,b.jsx)("span",{children:"Users"}),!!h&&(0,b.jsx)("div",{children:h>9?"9+":h})]}),(0,b.jsxs)("div",{className:(0,Z.A)(He,{[Te]:"projects"===s}),onClick:()=>t("projects"),children:[(0,b.jsx)("span",{children:"Projects"}),!!p&&(0,b.jsx)("div",{children:p>9?"9+":p})]})]})]}),(0,b.jsx)("div",{className:Pe,children:"users"===s?(0,b.jsx)(os,{chatData:r,searchQuery:d,showArchived:i,userId:o,onlineUsers:l,users:c}):(0,b.jsx)(ns,{chatData:r,searchQuery:d,showArchived:i,userId:o,users:c})})]})},cs=()=>{var e;const{session:s}=(0,d.As)(),t=null===s||void 0===s?void 0:s.desktop_user_id,i=null===s||void 0===s||null===(e=s.organization)||void 0===e?void 0:e.id,{trialHeight:p}=(0,u.$)(),m=(0,n.zy)(),v=(0,n.Zp)(),_=new URLSearchParams(m.search).get("id"),[g,x]=(0,a.useState)(!0),[f,j]=(0,a.useState)("users"),[C,N]=(0,a.useState)(!1),[y,w]=(0,a.useState)({}),[A,I]=(0,a.useState)(null),[k,S]=(0,a.useState)([]),[M,$]=(0,a.useState)({}),F=(0,a.useRef)(null),L=e=>{const a={};let i=1;return e.forEach((e=>{let n={id:null===e||void 0===e?void 0:e.group_id,archived_by:[],unread_count:(null===e||void 0===e?void 0:e.unread_count)||0,participants:[{id:e.id,name:`${e.full_name}`,avatar:e.avatar||""},{id:t,name:(null===s||void 0===s?void 0:s.full_name)||"You",avatar:null!==s&&void 0!==s&&s.has_photo?null===s||void 0===s?void 0:s.photo:""}],last_message:null===e||void 0===e?void 0:e.last_message};n.id?a[n.id]=n:a["private_group_"+i++]=n})),a};return(0,a.useEffect)((()=>{const e=(0,r.io)("https://chat.memate.com.au",{transports:["websocket"],autoConnect:!0});return F.current=e,t?i?(e.emit("register_user",{user_id:t,org_id:i},(e=>{"success"===e.status?console.log("User registered successfully"):o.oR.error("Failed to connect to chat server")})),e.emit("get_user_chat_groups",{user_id:t},(e=>{if("success"===e.status&&e.chat_groups){const s={};e.chat_groups.forEach((e=>{s[e.id]=e})),console.log("groups chat groups : ",s),w((e=>({...e,...s}))),x(!1)}})),e.on("get_user_chat_groups",(e=>{if("success"===e.status&&e.chat_groups){const s={};e.chat_groups.forEach((e=>{s[e.id]=e})),console.log("groups chat groups : ",s),w((e=>({...e,...s})))}})),e.emit("get_organization_users",{user_id:t,organization_id:i},(e=>{var s;if("success"===e.status&&null!==e&&void 0!==e&&null!==(s=e.users)&&void 0!==s&&s.length){const s=L(e.users);console.log("private chatGroups: ",s),w((e=>({...e,...s})))}})),e.on("get_organization_users",(e=>{var s;if("success"===e.status&&null!==e&&void 0!==e&&null!==(s=e.users)&&void 0!==s&&s.length){const s=L(e.users);console.log("private chatGroups: ",s),w((e=>({...e,...s})))}})),()=>{e.disconnect()}):o.oR.error("Organization ID is not available"):o.oR.error("User ID is not available")}),[t,i,s]),(0,a.useEffect)((()=>{if(!F.current)return;const e=F.current;return e.on("presence_list",(e=>{e.online&&S(e.online)})),e.on("presence_update",(e=>{e.user_id&&"offline"===e.status?S((s=>s.filter((s=>s!==e.user_id)))):e.user_id&&"online"===e.status&&S((s=>[...new Set([...s,e.user_id])]))})),e.on("chat_group_updated",(e=>{e.id&&w((s=>({...s,[e.id]:e})))})),()=>{e.off("presence_list"),e.off("presence_update"),e.off("chat_group_updated")}}),[F]),(0,a.useEffect)((()=>{if(_&&y[_]){const e=y[_].project_id||y[_].job_number;j(e?"projects":"users"),I(y[_])}else I(null)}),[_,y]),(0,a.useEffect)((()=>{(async()=>{try{var e;const s=await(0,c.V_)();let t=null===s||void 0===s||null===(e=s.users)||void 0===e?void 0:e.filter((e=>e.is_active));const a={};t.forEach((e=>{null!==e&&void 0!==e&&e.has_photo||(e.photo=""),a[e.id]=e})),$((e=>({...e,...a})))}catch(s){console.log(s)}})(),(async()=>{try{const e=await(0,c.tD)(),s=null===e||void 0===e?void 0:e.users.filter((e=>"disconnected"!==e.status)),t={};s.forEach((e=>{null!==e&&void 0!==e&&e.has_photo||(e.photo=""),t[e.id]=e})),$((e=>({...e,...t})))}catch(e){console.log(e)}})()}),[]),(0,b.jsxs)("div",{className:"container-fluid px-0",children:[(0,b.jsxs)("div",{className:l,style:{height:`calc(100vh - 73px - ${p}px)`},children:[(0,b.jsx)(ls,{activeTab:f,setActiveTab:j,archivedVisible:C,setArchivedVisible:N,chatData:y,userId:t,onlineUsers:k,users:M}),(0,b.jsx)(ke,{currentChat:A,setCurrentChat:I,socket:F.current,userId:t,chatId:_,onlineUsers:k,setChatData:w,users:M,updatePrivateGroupChatId:(e,s)=>{w((t=>{const a={...t};return e&&s&&a[e]&&(a[s]=a[e],delete a[e]),a})),v(`/chat?id=${s}`,{replace:!0})},refetchGroupChats:()=>{if(!F.current)return;F.current.emit("get_user_chat_groups",{user_id:t},(e=>{if("success"===e.status&&e.chat_groups){const s={};e.chat_groups.forEach((e=>{s[e.id]=e})),console.log("groups chat groups : ",s),w((e=>({...e,...s})))}}))}})]}),g&&(0,b.jsx)(h.A,{})]})},ds=()=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.mg,{children:(0,b.jsx)("title",{children:"MeMate - Chat"})}),(0,b.jsx)(cs,{})]})},54967:(e,s,t)=>{t.d(s,{Ab:()=>l,dg:()=>c,fr:()=>d,Ay:()=>u});var a=t(65043),i=t(44541),n=t(95192);const r="image-avatar_clientImg__-nnRU";var o=t(70579);const l=e=>{let{has_photo:s,photo:t,is_business:r,size:l}=e;const[c,d]=(0,a.useState)(!1),u=r?i.A:n.A;return(0,o.jsx)(o.Fragment,{children:s&&t&&!c?(0,o.jsx)("img",{src:t,alt:"client avatar",className:"w-100",onError:()=>d(!0)}):(0,o.jsx)(u,{color:"#667085",size:l})})},c=e=>{var s,t,i;let{has_photo:n,photo:r,name:l}=e;const[c,d]=(0,a.useState)(!1),u=l&&(null===l||void 0===l||null===(s=l.split(" "))||void 0===s||null===(t=s.map((e=>e[0])))||void 0===t||null===(i=t.join(""))||void 0===i?void 0:i.toUpperCase())||"";return(0,o.jsx)(o.Fragment,{children:n&&r&&!c?(0,o.jsx)("img",{src:r,alt:"client avatar",className:"w-100",onError:()=>d(!0)}):u})},d=e=>{let{name:s,size:t=14}=e;const a=s.split(" ").map((e=>e[0])).join("").toUpperCase();return(0,o.jsx)("span",{style:{fontSize:`${t}px`},children:a})},u=e=>{let{has_photo:s,photo:t,is_business:l}=e;const[c,d]=(0,a.useState)(!1),u=l?i.A:n.A;return(0,o.jsx)("div",{className:`d-flex justify-content-center align-items-center ${r} ${l?"":"rounded-circle"}`,style:{overflow:"hidden"},children:s&&t&&!c?(0,o.jsx)("img",{src:t,alt:"client avatar",className:"w-100",onError:()=>d(!0)}):(0,o.jsx)(u,{color:"#667085"})})}},95753:(e,s,t)=>{t.d(s,{A:()=>l,v:()=>o});var a=t(65043),i=t(22927),n=t(43984),r=t(70579);function o(e){return e>=1048576?(e/1048576).toFixed(1)+" MB":e>=1024?(e/1024).toFixed(1)+" KB":e+" B"}const l=e=>{let{onFileChange:s,styles:t}=e;const[o,l]=(0,a.useState)(!1),c=(0,a.useRef)(),d=(0,a.useRef)(),u=e=>{const s=c.current,t=d.current;if(!s||!t)return;const a=s.contains(e.target),i=t.contains(e.target);a||i||l(!1)};return a.useEffect((()=>(document.addEventListener("click",u),()=>{document.removeEventListener("click",u)})),[]),(0,r.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,r.jsx)("button",{className:t.attachButton,type:"button","aria-label":"Attach file",ref:c,onClick:()=>l((e=>!e)),style:{padding:"6px 6px 6px 8px"},children:(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M18.0833 8.33333L9.16667 17.25C8.17221 18.2444 6.82407 18.8042 5.41667 18.8042C4.00926 18.8042 2.66112 18.2444 1.66667 17.25C0.672214 16.2556 0.112446 14.9074 0.112446 13.5C0.112446 12.0926 0.672214 10.7444 1.66667 9.75L10.5833 0.833329C11.2486 0.167998 12.1514 -0.149151 13.0833 0.0666624C14.0153 0.282476 14.8056 0.947998 15.25 1.83333C15.6944 2.71866 15.7361 3.75 15.3333 4.66666C14.9306 5.58333 14.1389 6.29166 13.1667 6.5L5.08333 14.5833C4.75 14.9167 4.31944 15.0833 3.83333 15.0833C3.34722 15.0833 2.91667 14.9167 2.58333 14.5833C2.25 14.25 2.08333 13.8194 2.08333 13.3333C2.08333 12.8472 2.25 12.4167 2.58333 12.0833L9.16667 5.5",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})})}),o&&(0,r.jsxs)("div",{ref:d,className:t.attachmentPopover,style:{position:"absolute",bottom:"40px",left:-200,zIndex:20,minWidth:220,background:"#fff",borderRadius:8,boxShadow:"0 4px 24px rgba(16,24,40,0.18)",padding:10},children:[(0,r.jsxs)("label",{className:t.attachmentLabel,style:{display:"flex",alignItems:"center",cursor:"pointer",gap:8,padding:"10px 6px"},children:[(0,r.jsx)("input",{type:"file",style:{display:"none"},onChange:e=>{s(e),l(!1)},accept:".pdf, .doc, .docx, .txt"}),(0,r.jsx)(i.A,{size:16,color:"#667085"}),(0,r.jsx)("span",{className:"font-16",children:"Document"})]}),(0,r.jsxs)("label",{className:t.attachmentLabel,style:{display:"flex",alignItems:"center",cursor:"pointer",gap:8,padding:"10px 6px"},children:[(0,r.jsx)("input",{type:"file",style:{display:"none"},onChange:e=>{s(e),l(!1)},accept:"image/*"}),(0,r.jsx)(n.A,{size:16,color:"#667085"}),(0,r.jsx)("span",{className:"font-16",children:"Photo "})]})]})]})}},99724:(e,s,t)=>{t.d(s,{A:()=>a});const a={chatArea:"chat-area_chatArea__LcIUx",chatSidebar:"chat-area_chatSidebar__YWktj",slideIn:"chat-area_slideIn__YYoN5",chatContent:"chat-area_chatContent__uf9lg",chatBodyArea:"chat-area_chatBodyArea__pnfS9",messagesContainer:"chat-area_messagesContainer__jP8AR",dragOver:"chat-area_dragOver__zUubn",loadingContainer:"chat-area_loadingContainer__GABMB",messageInputContainer:"chat-area_messageInputContainer__utwWT",messageInput:"chat-area_messageInput__IlSJP",messageInputIcons:"chat-area_messageInputIcons__hW5ZW",attachButton:"chat-area_attachButton__oHyZF",emojiButton:"chat-area_emojiButton__DtKy-",sendButton:"chat-area_sendButton__ZTAOh",emptyChat:"chat-area_emptyChat__Kcq0J",emptyChatIcon:"chat-area_emptyChatIcon__2jxD+",emptyChatText:"chat-area_emptyChatText__bUdhG",chatMenu:"chat-area_chatMenu__K57W1",attachmentLabel:"chat-area_attachmentLabel__Zt7sR"}}}]);
//# sourceMappingURL=120.0dde45e2.chunk.js.map