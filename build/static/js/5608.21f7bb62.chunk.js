"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[5608],{67046:(e,t,s)=>{s.d(t,{CK:()=>m,HT:()=>h,Op:()=>r,V3:()=>d,WG:()=>i,cS:()=>n,fW:()=>u,j3:()=>o,oe:()=>c});var a=s(31342);const l="https://dev.memate.com.au/api/v1",o=async()=>{const e=new Headers,t=localStorage.getItem("access_token");e.append("Authorization",`Bearer ${t}`);const s={method:"GET",headers:e,redirect:"follow"};try{const e=await fetch(`${l}/sales/`,s);return await e.text()}catch(a){throw console.error("Profile fetch error:",a),a}},n=async(e,t)=>{const s=new Headers,a=localStorage.getItem("access_token");s.append("Authorization",`Bearer ${a}`),s.append("Content-Type","application/json");const o={method:"PUT",headers:s,body:JSON.stringify({sales_note:t}),redirect:"follow"};try{const t=await fetch(`${l}/sales/${e}/notes/`,o);if(!t.ok){const e=await t.text();throw new Error(`Sales notes update failed with status ${t.status}: ${e}`)}const s=await t.text();return s.trim()?JSON.parse(s):null}catch(n){throw console.error("Sales notes update error:",n),n}},i=async e=>{const t={method:"PUT",body:{ids:e}},s=new URL(`${l}/sales/status/won/`);return(0,a.f)(s.toString(),t)},r=async e=>{const t={method:"PUT",body:{ids:e}},s=new URL(`${l}/sales/status/lost/`);return(0,a.f)(s.toString(),t)},c=async(e,t)=>{const s=new Headers,a=localStorage.getItem("access_token");s.append("Authorization",`Bearer ${a}`),s.append("Content-Type","application/json");const o={method:"POST",headers:s,body:JSON.stringify(t),redirect:"follow"};try{const t=await fetch(`${l}/sales/${e}/contacts/`,o);return t.ok?t:(console.log("Error:",t.status),null)}catch(n){return console.log("Error:",n),null}},d=async(e,t)=>{const s=new Headers,a=localStorage.getItem("access_token");s.append("Authorization",`Bearer ${a}`),s.append("Content-Type","application/json");const o={method:"PUT",headers:s,body:JSON.stringify({lead:t,unique_id:e}),redirect:"follow"};try{const t=await fetch(`${l}/sales/${e}/lead/`,o);if(!t.ok){const e=await t.text();throw new Error(`Sales lead update failed with status ${t.status}: ${e}`)}const s=await t.text();return s.trim()?JSON.parse(s):null}catch(n){throw console.error("Sales lead update error:",n),n}},u=async e=>{const t=new Headers,s=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${s}`),t.append("Content-Type","application/json");const a={method:"PUT",headers:t,body:JSON.stringify({ids:e}),redirect:"follow"};try{const e=await Promise.all([fetch(`${l}/sales/status/won/`,a)]);return await Promise.all(e.map((e=>e.json())))}catch(o){throw o}},m=async e=>{const t=new Headers,s=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${s}`),t.append("Content-Type","application/json");const a={method:"GET",headers:t,redirect:"follow"},o=await fetch(`${l}/sales/${e}/duplicate/`,a);return(await o.json())[0]},h=async e=>{const t=new Headers,s=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${s}`),t.append("Content-Type","application/json");const a={method:"PUT",headers:t,body:JSON.stringify({ids:e}),redirect:"follow"};try{const e=await Promise.all([fetch(`${l}/sales/status/lost/`,a)]);return await Promise.all(e.map((e=>e.json())))}catch(o){throw o}}},81047:(e,t,s)=>{s.d(t,{Bz:()=>j,Hb:()=>u,IT:()=>b,Kb:()=>i,Pf:()=>p,SQ:()=>d,VQ:()=>x,Xm:()=>c,bd:()=>v,hS:()=>h,hx:()=>g,iS:()=>n,p4:()=>r,s:()=>m,tC:()=>o});var a=s(31342);const l="https://dev.memate.com.au/api/v1",o=async()=>{const e=new URL(`${l}/jobs/templates/`);return(0,a.f)(e.toString(),{method:"GET"})},n=async e=>{const t=new URL(`${l}${`/jobs/templates/${e}/`}`);return(0,a.f)(t.toString(),{method:"GET"})},i=async e=>{const t={method:"POST",body:e},s=new URL(`${l}/jobs/templates/`);return(0,a.f)(s.toString(),t)},r=async(e,t)=>{const s={method:"PUT",body:t},o=new URL(`${l}${`/jobs/templates/${e}/`}`);return(0,a.f)(o.toString(),s)},c=async e=>{const t=new URL(`${l}${`/jobs/templates/${e}/`}`);return(0,a.f)(t.toString(),{method:"DELETE"})},d=async()=>{const e=new URL(`${l}/settings/templates/email-templates/`);return(0,a.f)(e.toString(),{method:"GET"})},u=async e=>{const t={method:"POST",body:e},s=new URL(`${l}/settings/templates/email-templates/`);return(0,a.f)(s.toString(),t)},m=async(e,t)=>{const s={method:"PUT",body:t},o=new URL(`${l}${`/settings/templates/email-templates/${e}/`}`);return(0,a.f)(o.toString(),s)},h=async e=>{const t=new URL(`${l}${`/settings/templates/email-templates/${e}/`}`);return(0,a.f)(t.toString(),{method:"GET"})},p=async e=>{const t=new URL(`${l}${`/proposals/${e}/`}`);return(0,a.f)(t.toString(),{method:"GET"})},g=async()=>{const e=new URL(`${l}/references/outgoing-email/`);return(0,a.f)(e.toString(),{method:"GET"})},v=async e=>{const t=new URL(`${l}${`/settings/templates/email-templates/${e}/`}`);return(0,a.f)(t.toString(),{method:"DELETE"})},x=async()=>{const e=new URL(`${l}/settings/proposals/`);return(0,a.f)(e.toString(),{method:"GET"})},b=async e=>{const t=new URL(`${l}${`/settings/proposals/${e}/`}`);return(0,a.f)(t.toString(),{method:"GET"})},j=async e=>{const t=new URL(`${l}${`/settings/proposals/delete/${e}/`}`);return(0,a.f)(t.toString(),{method:"DELETE"})}},11520:(e,t,s)=>{s.d(t,{Mv:()=>v,Np:()=>n,OE:()=>x,SE:()=>m,ZE:()=>d,aj:()=>i,fi:()=>h,jE:()=>c,jy:()=>p,mw:()=>o,o2:()=>r,qm:()=>g,yE:()=>u});const a="https://dev.memate.com.au/api/v1",l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{method:s="GET",headers:a={},body:l}=t,o={method:s,headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json",...a},body:JSON.stringify(l),redirect:"follow"};try{const t=new URL(`${e}`),s=await fetch(t,o);if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const a=s.headers.get("Content-Type");if(a&&a.includes("application/json"))return await s.json();return{message:"Non-JSON response",body:await s.text()}}catch(n){throw console.error("Fetch API error:",n),n}},o=async(e,t)=>{const s={method:"PUT",body:t},o=new URL(`${a}${`/project-card/schedule/${e}/`}`);return l(o.toString(),s)},n=async(e,t)=>{const s={method:"PUT",body:t},o=new URL(`${a}${`/project-card/custom-status/${e}/`}`);return l(o.toString(),s)},i=async(e,t)=>{const s={method:"PUT",body:t},o=new URL(`${a}${`/project-card/reference/${e}/`}`);return l(o.toString(),s)},r=async(e,t)=>{const s={method:"POST",body:t},o=new URL(`${a}${`/project-card/note/${e}/`}`);return l(o.toString(),s)},c=async e=>{const t={method:"PUT",body:{unique_id:e}},s=new URL(`${a}/projects/back/`);return l(s.toString(),t)},d=async e=>{const t={method:"PUT",body:{unique_id:e}},s=new URL(`${a}/projects/decline/`);return l(s.toString(),t)},u=async e=>{const t={method:"PUT",body:{unique_id:e}},s=new URL(`${a}/projects/complete/`);return l(s.toString(),t)},m=async e=>{const t=new URL(`${a}${`/invoices/create/${e}/`}`);return l(t.toString(),{method:"POST"})},h=async(e,t)=>{const s={method:"POST",body:t},o=new URL(`${a}${`/invoices/send/${e}/`}`);return l(o.toString(),s)},p=async(e,t,s)=>{let o;o=t?`/custom/email/${e}/${t}/`:`/custom/email/${e}/`;const n={method:"POST",body:s},i=new URL(`${a}${o}`);return l(i.toString(),n)},g=async(e,t)=>{const s={method:"POST",body:t},o=new URL(`${a}${`/sms/${e}/`}`);return l(o.toString(),s)},v=async()=>{const e=new Headers,t=localStorage.getItem("access_token");e.append("Authorization",`Bearer ${t}`),e.append("Content-Type","application/json");const s={method:"GET",headers:e,redirect:"follow"};try{const e=await fetch(`${a}/management/`,s);return await e.json()}catch(l){throw console.error(l),l}},x=async e=>{const t=new Headers,s=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${s}`),t.append("Content-Type","application/json");const l={method:"GET",headers:t,redirect:"follow"};try{const t=await fetch(`${a}/project-card/${e}/`,l);return await t.json()}catch(o){throw console.error(o),o}}},81242:(e,t,s)=>{s.d(t,{A:()=>f});var a=s(65043),l=s(61424),o=s(61072),n=s(78602),i=s(14282),r=s(93740),c=s(8868),d=s(8129),u=s(75758),m=s(72052),h=s(93747);const p={headerTitle:"send-email_headerTitle__50KUB",customLabel:"send-email_customLabel__r5xED",bag:"send-email_bag__wtdwK",lable:"send-email_lable__+kNCa",dropdownSelect:"send-email_dropdownSelect__RY5w8",autoCompleteBox:"send-email_autoCompleteBox__fWZ7C",AutoComplete:"send-email_AutoComplete__m9YI5",bcc:"send-email_bcc__BwFzl",box:"send-email_box__Zlmer",active:"send-email_active__vEx4h",inputBox:"send-email_inputBox__NpU2b"};var g=s(81047),v=s(58387),x=s(28676),b=s(74532),j=(s(56328),s(70579));const y=(0,j.jsxs)("span",{className:"ql-formats",children:[(0,j.jsx)("button",{className:"ql-bold","aria-label":"Bold"}),(0,j.jsx)("button",{className:"ql-italic","aria-label":"Italic"}),(0,j.jsx)("button",{className:"ql-underline","aria-label":"Underline"}),(0,j.jsx)("button",{className:"ql-strike","aria-label":"Strikethrough"}),(0,j.jsx)("button",{className:"ql-blockquote","aria-label":"Blockquote"}),(0,j.jsx)("button",{className:"ql-list",value:"ordered","aria-label":"Ordered List"}),(0,j.jsx)("button",{className:"ql-list",value:"bullet","aria-label":"Bullet List"}),(0,j.jsx)("button",{className:"ql-align",value:"","aria-label":"Align Left"}),(0,j.jsx)("button",{className:"ql-align",value:"center","aria-label":"Align Center"}),(0,j.jsx)("button",{className:"ql-align",value:"right","aria-label":"Align Right"}),(0,j.jsx)("button",{className:"ql-align",value:"justify","aria-label":"Justify"}),(0,j.jsx)("button",{className:"ql-link","aria-label":"Insert Link"}),(0,j.jsx)("button",{className:"ql-image","aria-label":"Insert Image"}),(0,j.jsx)("button",{className:"ql-code-block","aria-label":"Code Block"})]}),f=e=>{var t,s,f,w;let{show:S,setShow:N,mutation:C,contactPersons:$,setPayload:_,defaultTemplateId:A}=e;const[T,L]=(0,a.useState)(""),[q,k]=(0,a.useState)([]),[E,B]=(0,a.useState)([]),[U,R]=(0,a.useState)([]),[P,I]=(0,a.useState)(null),[O,F]=(0,a.useState)(null),[H,z]=(0,a.useState)({}),[K,G]=(0,a.useState)([]),M=(0,a.useRef)(null),J=(0,a.useRef)(null),Q=(0,a.useRef)(null),[D,V]=(0,a.useState)(!1),[Y,Z]=(0,a.useState)(!1),[W,X]=(0,a.useState)(null),ee=()=>{N(!1),A||(L([]),k([]),B([]),R([]),I([]),F([]),X(null))},te=(0,h.I)({queryKey:["emailTemplate"],queryFn:g.SQ,enabled:!!S}),se=(0,h.I)({queryKey:["getOutgoingEmail"],queryFn:g.hx,enabled:!!S}),ae=(0,h.I)({queryKey:["emailQuery",W],queryFn:()=>(0,g.hS)(W),enabled:!!W,retry:1});(0,a.useEffect)((()=>{var e,t;null!==se&&void 0!==se&&se.data&&(null!==se&&void 0!==se&&null!==(e=se.data)&&void 0!==e&&e.outgoing_email&&L(null===se||void 0===se||null===(t=se.data)||void 0===t?void 0:t.outgoing_email));!W&&null!==te&&void 0!==te&&te.data&&A&&X(A)}),[ae,se]);const le=e=>{var t;const s=(null===e||void 0===e||null===(t=e.query)||void 0===t?void 0:t.toLowerCase())||"";let a=$.map((e=>e.email));a=a.filter((e=>!q.includes(e))),a=a.filter((e=>!E.includes(e))),a=a.filter((e=>!U.includes(e))),a=a.filter((e=>e.toLowerCase().includes(s))),G(a)},oe=()=>{le(),M.current&&M.current.show()},ne=()=>{le(),J.current&&J.current.show()},ie=()=>{le(),Q.current&&Q.current.show()};return(0,a.useEffect)((()=>{if(null!==$&&void 0!==$&&$.length){let e=$.map((e=>e.email));G(e)}}),[$]),(0,a.useEffect)((()=>{_((e=>({...e,subject:P,email_body:O,from_email:T,to:null===q||void 0===q?void 0:q.toString(),...E.length>0&&{cc:E.toString()},...U.length>0&&{bcc:U.toString()}})))}),[P,O,T,q,E,U]),(0,a.useEffect)((()=>{var e,t;F((null===ae||void 0===ae||null===(e=ae.data)||void 0===e?void 0:e.body)||""),I(null===ae||void 0===ae||null===(t=ae.data)||void 0===t?void 0:t.subject),z((e=>({...e,subject:!1}))),z((e=>({...e,text:!1})))}),[null===ae||void 0===ae||null===(t=ae.data)||void 0===t?void 0:t.body]),(0,j.jsxs)(l.A,{show:S,centered:!0,onHide:ee,className:"invoice-form",size:"lg",children:[(0,j.jsx)(l.A.Header,{closeButton:!0,children:(0,j.jsx)("div",{className:`${p.modalHeader}`,children:(0,j.jsx)("div",{className:"w-100 d-flex align-items-center gap-2",children:(0,j.jsx)("span",{className:`white-space-nowrap mt-2 mb-2 ${p.headerTitle}`,children:"Send email"})})})}),(0,j.jsxs)(l.A.Body,{children:[(0,j.jsxs)(o.A,{children:[(0,j.jsxs)(n.A,{sm:6,className:"mb-3",children:[(0,j.jsxs)("div",{style:{position:"relative"},children:[(0,j.jsx)("label",{className:(0,v.A)(p.customLabel),children:"FROM"}),(0,j.jsx)(d.m,{options:se&&(null===se||void 0===se?void 0:se.data)&&[{value:null===se||void 0===se||null===(s=se.data)||void 0===s?void 0:s.outgoing_email,label:`${null===se||void 0===se||null===(f=se.data)||void 0===f?void 0:f.outgoing_email}`}]||[],className:(0,v.A)(p.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"60px"},placeholder:"Select from email",onChange:e=>{L(e.value),z((e=>({...e,from:!1})))},value:T})]}),(null===H||void 0===H?void 0:H.from)&&(0,j.jsx)("p",{className:"error-message mb-0",children:"From email is required"})]}),(0,j.jsx)(n.A,{sm:6,className:"mb-3",children:(0,j.jsxs)("div",{style:{position:"relative"},children:[(0,j.jsx)("label",{className:(0,v.A)(p.customLabel),children:"Templates"}),(0,j.jsx)(d.m,{options:te&&(null===(w=te.data)||void 0===w?void 0:w.map((e=>({value:e.id,label:`${e.name}`}))))||[],className:(0,v.A)(p.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select template",onChange:e=>{X(e.value)},value:W,loading:null===te||void 0===te?void 0:te.isFetching})]})})]}),(0,j.jsxs)(o.A,{children:[(0,j.jsxs)(n.A,{sm:12,className:"mb-3",children:[(0,j.jsxs)("div",{className:"d-flex gap-3 w-100",children:[(0,j.jsxs)("div",{style:{position:"relative"},className:p.autoCompleteBox,children:[(0,j.jsx)("div",{style:{width:"50px"},className:p.bag}),(0,j.jsx)("label",{className:(0,v.A)(p.customLabel),children:"TO"}),(0,j.jsx)(u.j,{ref:M,value:q,completeMethod:le,onChange:e=>{k(e.value),z((e=>({...e,to:!1})))},multiple:!0,suggestions:K,onClick:oe,onFocus:oe,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const s=t.split(/[\s,]+/).filter((e=>e));k((e=>[...new Set([...e,...s])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(k((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,v.A)(p.AutoComplete,"w-100"),placeholder:"TO"})]}),(0,j.jsx)(i.A,{className:(0,v.A)(p.box,{[p.active]:D}),onClick:()=>{V(!D),B([])},children:"CC"}),(0,j.jsx)(i.A,{className:(0,v.A)(p.box,{[p.active]:Y}),onClick:()=>{Z(!Y),R([])},children:"BCC"})]}),(null===H||void 0===H?void 0:H.to)&&(0,j.jsx)("p",{className:"error-message mb-0",children:"To email is required"})]}),D&&(0,j.jsx)(n.A,{sm:6,className:"mb-3",children:(0,j.jsxs)("div",{style:{position:"relative"},children:[(0,j.jsx)("div",{style:{width:"50px"},className:p.bag}),(0,j.jsx)("label",{className:(0,v.A)(p.customLabel),children:"CC"}),(0,j.jsx)(u.j,{ref:J,value:E,completeMethod:le,onChange:e=>{B(e.value)},multiple:!0,suggestions:K,onClick:ne,onFocus:ne,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const s=t.split(/[\s,]+/).filter((e=>e));B((e=>[...new Set([...e,...s])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(B((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,v.A)(p.AutoComplete,"w-100"),placeholder:"CC"})]})}),Y&&(0,j.jsx)(n.A,{sm:6,className:"mb-3",children:(0,j.jsxs)("div",{style:{position:"relative"},children:[(0,j.jsx)("div",{style:{width:"60px"},className:p.bag}),(0,j.jsx)("label",{className:(0,v.A)(p.customLabel),children:"BCC"}),(0,j.jsx)(u.j,{ref:Q,value:U,completeMethod:le,onChange:e=>{R(e.value)},multiple:!0,suggestions:K,onClick:ie,onFocus:ie,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const s=t.split(/[\s,]+/).filter((e=>e));R((e=>[...new Set([...e,...s])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(R((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,v.A)(p.AutoComplete,p.bcc,"w-100"),placeholder:"BCC"})]})}),(0,j.jsxs)(n.A,{sm:12,className:"mb-2",children:[(0,j.jsxs)("div",{style:{position:"relative"},children:[(0,j.jsx)("div",{style:{width:"60px"},className:p.bag}),(0,j.jsx)("label",{className:(0,v.A)(p.customLabel),children:"SUBJECT"}),(0,j.jsxs)(x.C,{children:[(0,j.jsx)(b.m,{children:(null===ae||void 0===ae?void 0:ae.isFetching)&&(0,j.jsx)(r.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,j.jsx)(m.S,{value:P,className:(0,v.A)(p.inputBox,"w-100"),style:{paddingLeft:"100px"},onChange:e=>{I(e.target.value),z((e=>({...e,subject:!1})))},placeholder:"{Organization} | Quotation: {number} | {reference}"})]})]}),(null===H||void 0===H?void 0:H.subject)&&(0,j.jsx)("p",{className:"error-message mb-0",children:"Subject is required"})]}),(0,j.jsxs)(n.A,{sm:12,children:[(0,j.jsxs)("div",{className:"d-flex flex-column gap-1",style:{position:"relative"},children:[(0,j.jsx)("label",{className:(0,v.A)(p.lable),children:"Message"}),(0,j.jsx)(b.m,{style:{position:"absolute",right:"15px",top:"40px",zIndex:1},children:(null===ae||void 0===ae?void 0:ae.isFetching)&&(0,j.jsx)(r.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,j.jsx)(c.K,{style:{minHeight:"150px"},headerTemplate:y,value:O,placeholder:"Enter a description...",onTextChange:e=>{F(e.htmlValue),z((e=>({...e,text:!1})))}})]}),(null===H||void 0===H?void 0:H.text)&&(0,j.jsx)("p",{className:"error-message mb-0",children:"Message is required"})]})]})]}),(0,j.jsxs)(l.A.Footer,{className:"d-flex justify-content-between",children:[(0,j.jsx)("span",{}),(0,j.jsxs)("div",{className:"d-flex justify-content-end gap-2",children:[(0,j.jsxs)(i.A,{className:"outline-button",onClick:ee,children:["Cancel"," "]}),(0,j.jsxs)(i.A,{className:"solid-button",onClick:async()=>{let e=0;z({}),T||(++e,z((e=>({...e,from:!0})))),0===(null===q||void 0===q?void 0:q.length)&&(++e,z((e=>({...e,to:!0})))),P||(++e,z((e=>({...e,subject:!0})))),O||(++e,z((e=>({...e,text:!0})))),e||C.mutate({subject:P,email_body:O,from_email:T,to:null===q||void 0===q?void 0:q.toString(),...E.length>0&&{cc:E.toString()},...U.length>0&&{bcc:U.toString()}})},children:["Send"," ",(null===C||void 0===C?void 0:C.isPending)&&(0,j.jsx)(r.p,{style:{width:"20px",height:"20px",color:"#fff"}})]})]})]})]})}},19004:(e,t,s)=>{s.d(t,{A:()=>C});var a=s(65043),l=s(61424),o=s(61072),n=s(78602),i=s(14282),r=s(93740),c=s(8868),d=s(8129),u=s(75758),m=s(72052),h=s(93747),p=s(47097);const g={headerTitle:"send-invoice_headerTitle__YBmdt",customLabel:"send-invoice_customLabel__0D26B",bag:"send-invoice_bag__VXoPF",lable:"send-invoice_lable__hDm-2",dropdownSelect:"send-invoice_dropdownSelect__y4YWM",autoCompleteBox:"send-invoice_autoCompleteBox__sVyzX",AutoComplete:"send-invoice_AutoComplete__cCiBx",bcc:"send-invoice_bcc__KYSsZ",box:"send-invoice_box__pOjbC",active:"send-invoice_active__hBlO9",inputBox:"send-invoice_inputBox__gIZLk"};var v=s(81047),x=s(58387),b=s(28676),j=s(74532),y=s(56328),f=s(11520),w=s(36166),S=s(70579);const N=(0,S.jsxs)("span",{className:"ql-formats",children:[(0,S.jsx)("button",{className:"ql-bold","aria-label":"Bold"}),(0,S.jsx)("button",{className:"ql-italic","aria-label":"Italic"}),(0,S.jsx)("button",{className:"ql-underline","aria-label":"Underline"}),(0,S.jsx)("button",{className:"ql-strike","aria-label":"Strikethrough"}),(0,S.jsx)("button",{className:"ql-blockquote","aria-label":"Blockquote"}),(0,S.jsx)("button",{className:"ql-list",value:"ordered","aria-label":"Ordered List"}),(0,S.jsx)("button",{className:"ql-list",value:"bullet","aria-label":"Bullet List"}),(0,S.jsx)("button",{className:"ql-align",value:"","aria-label":"Align Left"}),(0,S.jsx)("button",{className:"ql-align",value:"center","aria-label":"Align Center"}),(0,S.jsx)("button",{className:"ql-align",value:"right","aria-label":"Align Right"}),(0,S.jsx)("button",{className:"ql-align",value:"justify","aria-label":"Justify"}),(0,S.jsx)("button",{className:"ql-link","aria-label":"Insert Link"}),(0,S.jsx)("button",{className:"ql-image","aria-label":"Insert Image"}),(0,S.jsx)("button",{className:"ql-code-block","aria-label":"Code Block"})]}),C=e=>{var t,s,C,$;let{show:_,setShow:A,contactPersons:T,setPayload:L,save:q,isLoading:k,create:E,projectId:B,projectCardData:U,isCreated:R}=e;const[P,I]=(0,a.useState)(""),[O,F]=(0,a.useState)([]),[H,z]=(0,a.useState)([]),[K,G]=(0,a.useState)([]),[M,J]=(0,a.useState)(null),[Q,D]=(0,a.useState)(null),[V,Y]=(0,a.useState)({}),[Z,W]=(0,a.useState)([]),X=(0,a.useRef)(null),ee=(0,a.useRef)(null),te=(0,a.useRef)(null),[se,ae]=(0,a.useState)(!1),[le,oe]=(0,a.useState)(!1),ne=()=>A(!1),[ie,re]=(0,a.useState)(18);(0,a.useEffect)((()=>{R&&re(19)}),[R,ie]);const ce=(0,h.I)({queryKey:["emailTemplate"],queryFn:v.SQ}),de=(0,h.I)({queryKey:["getOutgoingEmail"],queryFn:v.hx}),ue=(0,h.I)({queryKey:["emailQuery",ie],queryFn:()=>(0,v.hS)(ie),enabled:!!ie,retry:1});(0,a.useEffect)((()=>{var e,t;null!==de&&void 0!==de&&de.data&&(null!==de&&void 0!==de&&null!==(e=de.data)&&void 0!==e&&e.outgoing_email&&I(null===de||void 0===de||null===(t=de.data)||void 0===t?void 0:t.outgoing_email))}),[ue,de]);const me=(0,p.n)({mutationFn:e=>R?(0,w.LG)(B,e):(0,f.fi)(B,e),onSuccess:e=>{ne(),U(),y.oR.success("Invoice created and send successfully.")},onError:e=>{console.error("Error creating task:",e),y.oR.error("Failed to create and send invoice. Please try again.")}}),he=e=>{var t;const s=(null===e||void 0===e||null===(t=e.query)||void 0===t?void 0:t.toLowerCase())||"";let a=T.map((e=>e.email));a=a.filter((e=>!O.includes(e))),a=a.filter((e=>!H.includes(e))),a=a.filter((e=>!K.includes(e))),a=a.filter((e=>e.toLowerCase().includes(s))),W(a)},pe=()=>{he(),X.current&&X.current.show()},ge=()=>{he(),ee.current&&ee.current.show()},ve=()=>{he(),te.current&&te.current.show()};return(0,a.useEffect)((()=>{if(null!==T&&void 0!==T&&T.length){let e=T.map((e=>e.email));W(e)}}),[T]),(0,a.useEffect)((()=>{L((e=>({...e,subject:M,email_body:Q,from_email:P,to:null===O||void 0===O?void 0:O.toString(),...H.length>0&&{cc:H.toString()},...K.length>0&&{bcc:K.toString()}})))}),[M,Q,P,O,H,K]),(0,a.useEffect)((()=>{var e,t;D((null===ue||void 0===ue||null===(e=ue.data)||void 0===e?void 0:e.body)||""),J(null===ue||void 0===ue||null===(t=ue.data)||void 0===t?void 0:t.subject),Y((e=>({...e,subject:!1}))),Y((e=>({...e,text:!1})))}),[null===ue||void 0===ue||null===(t=ue.data)||void 0===t?void 0:t.body]),(0,S.jsxs)(l.A,{show:_,centered:!0,onHide:ne,className:"invoice-form",size:"lg",children:[(0,S.jsx)(l.A.Header,{closeButton:!0,children:(0,S.jsx)("div",{className:`${g.modalHeader}`,children:(0,S.jsx)("div",{className:"w-100 d-flex align-items-center gap-2",children:(0,S.jsxs)("span",{className:`white-space-nowrap mt-2 mb-2 ${g.headerTitle}`,children:[R?"Resend":"Send"," a Invoice"]})})})}),(0,S.jsxs)(l.A.Body,{children:[(0,S.jsxs)(o.A,{children:[(0,S.jsxs)(n.A,{sm:6,className:"mb-3",children:[(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsx)("label",{className:(0,x.A)(g.customLabel),children:"FROM"}),(0,S.jsx)(d.m,{options:de&&(null===de||void 0===de?void 0:de.data)&&[{value:null===de||void 0===de||null===(s=de.data)||void 0===s?void 0:s.outgoing_email,label:`${null===de||void 0===de||null===(C=de.data)||void 0===C?void 0:C.outgoing_email}`}]||[],className:(0,x.A)(g.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"60px"},placeholder:"Select from email",onChange:e=>{I(e.value),Y((e=>({...e,from:!1})))},value:P})]}),(null===V||void 0===V?void 0:V.from)&&(0,S.jsx)("p",{className:"error-message mb-0",children:"From email is required"})]}),(0,S.jsx)(n.A,{sm:6,className:"mb-3",children:(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsx)("label",{className:(0,x.A)(g.customLabel),children:"Templates"}),(0,S.jsx)(d.m,{options:ce&&(null===($=ce.data)||void 0===$?void 0:$.map((e=>({value:e.id,label:`${e.name}`}))))||[],className:(0,x.A)(g.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select template",onChange:e=>{re(e.value)},value:ie,loading:null===ce||void 0===ce?void 0:ce.isFetching})]})})]}),(0,S.jsxs)(o.A,{children:[(0,S.jsxs)(n.A,{sm:12,className:"mb-3",children:[(0,S.jsxs)("div",{className:"d-flex gap-3 w-100",children:[(0,S.jsxs)("div",{style:{position:"relative"},className:g.autoCompleteBox,children:[(0,S.jsx)("div",{style:{width:"50px"},className:g.bag}),(0,S.jsx)("label",{className:(0,x.A)(g.customLabel),children:"TO"}),(0,S.jsx)(u.j,{ref:X,value:O,completeMethod:he,onChange:e=>{F(e.value),Y((e=>({...e,to:!1})))},multiple:!0,suggestions:Z,onClick:pe,onFocus:pe,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const s=t.split(/[\s,]+/).filter((e=>e));F((e=>[...new Set([...e,...s])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(F((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,x.A)(g.AutoComplete,"w-100"),placeholder:"TO"})]}),(0,S.jsx)(i.A,{className:(0,x.A)(g.box,{[g.active]:se}),onClick:()=>{ae(!se),z([])},children:"CC"}),(0,S.jsx)(i.A,{className:(0,x.A)(g.box,{[g.active]:le}),onClick:()=>{oe(!le),G([])},children:"BCC"})]}),(null===V||void 0===V?void 0:V.to)&&(0,S.jsx)("p",{className:"error-message mb-0",children:"To email is required"})]}),se&&(0,S.jsx)(n.A,{sm:6,className:"mb-3",children:(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsx)("div",{style:{width:"50px"},className:g.bag}),(0,S.jsx)("label",{className:(0,x.A)(g.customLabel),children:"CC"}),(0,S.jsx)(u.j,{ref:ee,value:H,completeMethod:he,onChange:e=>{z(e.value)},multiple:!0,suggestions:Z,onClick:ge,onFocus:ge,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const s=t.split(/[\s,]+/).filter((e=>e));z((e=>[...new Set([...e,...s])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(z((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,x.A)(g.AutoComplete,"w-100"),placeholder:"CC"})]})}),le&&(0,S.jsx)(n.A,{sm:6,className:"mb-3",children:(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsx)("div",{style:{width:"60px"},className:g.bag}),(0,S.jsx)("label",{className:(0,x.A)(g.customLabel),children:"BCC"}),(0,S.jsx)(u.j,{ref:te,value:K,completeMethod:he,onChange:e=>{G(e.value)},multiple:!0,suggestions:Z,onClick:ve,onFocus:ve,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const s=t.split(/[\s,]+/).filter((e=>e));G((e=>[...new Set([...e,...s])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(G((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,x.A)(g.AutoComplete,g.bcc,"w-100"),placeholder:"BCC"})]})}),(0,S.jsxs)(n.A,{sm:12,className:"mb-2",children:[(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsx)("div",{style:{width:"60px"},className:g.bag}),(0,S.jsx)("label",{className:(0,x.A)(g.customLabel),children:"SUBJECT"}),(0,S.jsxs)(b.C,{children:[(0,S.jsx)(j.m,{children:(null===ue||void 0===ue?void 0:ue.isFetching)&&(0,S.jsx)(r.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,S.jsx)(m.S,{value:M,className:(0,x.A)(g.inputBox,"w-100"),style:{paddingLeft:"100px"},onChange:e=>{J(e.target.value),Y((e=>({...e,subject:!1})))},placeholder:"{Organization} | Quotation: {number} | {reference}"})]})]}),(null===V||void 0===V?void 0:V.subject)&&(0,S.jsx)("p",{className:"error-message mb-0",children:"Subject is required"})]}),(0,S.jsxs)(n.A,{sm:12,children:[(0,S.jsxs)("div",{className:"d-flex flex-column gap-1",style:{position:"relative"},children:[(0,S.jsx)("label",{className:(0,x.A)(g.lable),children:"Message"}),(0,S.jsx)(j.m,{style:{position:"absolute",right:"15px",top:"40px",zIndex:1},children:(null===ue||void 0===ue?void 0:ue.isFetching)&&(0,S.jsx)(r.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,S.jsx)(c.K,{style:{minHeight:"150px"},headerTemplate:N,value:Q,placeholder:"Enter a description...",onTextChange:e=>{D(e.htmlValue),Y((e=>({...e,text:!1})))}})]}),(null===V||void 0===V?void 0:V.text)&&(0,S.jsx)("p",{className:"error-message mb-0",children:"Message is required"})]})]})]}),(0,S.jsxs)(l.A.Footer,{className:"d-flex justify-content-between",children:[(0,S.jsx)(i.A,{onClick:ne,className:"text-button text-danger",children:"Cancel"}),(0,S.jsxs)("div",{className:"d-flex justify-content-end gap-2",children:[!R&&(0,S.jsxs)(i.A,{className:"outline-button",onClick:E,children:["Create"," ",k&&(0,S.jsx)(r.p,{style:{width:"20px",height:"20px",color:"#fff"}})]}),(0,S.jsxs)(i.A,{className:"solid-button",onClick:async()=>{let e=0;Y({}),P||(++e,Y((e=>({...e,from:!0})))),0===(null===O||void 0===O?void 0:O.length)&&(++e,Y((e=>({...e,to:!0})))),M||(++e,Y((e=>({...e,subject:!0})))),Q||(++e,Y((e=>({...e,text:!0})))),e||me.mutate({subject:M,email_body:Q,from_email:P,to:null===O||void 0===O?void 0:O.toString(),...H.length>0&&{cc:H.toString()},...K.length>0&&{bcc:K.toString()}})},children:[R?"Resend":"Create and Send"," ",(null===me||void 0===me?void 0:me.isPending)&&(0,S.jsx)(r.p,{style:{width:"20px",height:"20px",color:"#fff"}})]})]})]})]})}}}]);
//# sourceMappingURL=5608.21f7bb62.chunk.js.map