"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[6731,7606],{17030:(e,s,t)=>{t.d(s,{DY:()=>r,Dc:()=>i,MY:()=>f,VL:()=>u,Vn:()=>d,WL:()=>a,_0:()=>m,ax:()=>o,cM:()=>x,dl:()=>j,jH:()=>v,mL:()=>p,sl:()=>g,tA:()=>c,zw:()=>h});var n=t(31342);const l="https://app.memate.com.au/api/v1",o=async e=>{const s=new URL(`${l}/references/calc-indexes/`);return 1===e&&s.searchParams.append("all",1),(0,n.f)(s.toString(),{method:"GET"})},i=async e=>{const s=new URL(`${l}${`/references/calculators/${e}/`}`),t=await(0,n.f)(s.toString(),{method:"GET"});return Array.isArray(t)?t.filter((e=>!e.deleted)):t&&!t.deleted?t:null},a=async e=>{const s=new URL(`${l}${`/projects/${e}/`}`);return(0,n.f)(s.toString(),{method:"GET"})},r=async e=>{const s={method:"POST",body:e},t=new URL(`${l}/sales/new-request/`);return(0,n.f)(t.toString(),s)},d=async(e,s)=>{if(!e)throw new Error("No id found");const t={method:"PUT",body:s},o=new URL(`${l}${`/sales/projects/${e}/`}`);return(0,n.f)(o.toString(),t)},c=async e=>{const s={method:"POST",body:e},t=new URL(`${l}/projects/merges/new/`);return(0,n.f)(t.toString(),s)},p=async e=>{const s=new URL(`${l}${`/projects/merges/${e}/delete/`}`);return(0,n.f)(s.toString(),{method:"DELETE"})},u=async e=>{const s={method:"POST",body:e},t=new URL(`${l}/settings/departments/`);return(0,n.f)(t.toString(),s)},x=async(e,s)=>{if(!e)return;const t={method:"PUT",body:s},o=new URL(`${l}${`/settings/departments/update/${e}/`}`);return(0,n.f)(o.toString(),t)},h=async e=>{const s={method:"POST",body:e},t=new URL(`${l}/settings/sub-departments/`);return(0,n.f)(t.toString(),s)},m=async(e,s)=>{if(!e)return;const t={method:"PUT",body:s},o=new URL(`${l}${`/settings/sub-departments/update/${e}/`}`);return(0,n.f)(o.toString(),t)},v=async(e,s)=>{const t={method:"POST",body:s},o=new URL(`${l}${`/references/calculators/${e}/new/`}`);return(0,n.f)(o.toString(),t)},g=async(e,s,t)=>{const o={method:"PUT",body:t},i=new URL(`${l}${`/references/calculators/${e}/update/${s}/`}`);return(0,n.f)(i.toString(),o)},f=async e=>{const s=new URL(`${l}${e}`);return(0,n.f)(s.toString(),{method:"DELETE"})},j=async e=>{const s={method:"POST",body:e.map(((e,s)=>({id:e.id,order:s+1})))},t=new URL(`${l}/settings/departments/order/`);return(0,n.f)(t.toString(),s)}},54967:(e,s,t)=>{t.d(s,{Ab:()=>r,dg:()=>d,fr:()=>c,Ay:()=>p});var n=t(65043),l=t(44541),o=t(95192);const i="image-avatar_clientImg__-nnRU";var a=t(70579);const r=e=>{let{has_photo:s,photo:t,is_business:i,size:r}=e;const[d,c]=(0,n.useState)(!1),p=i?l.A:o.A;return(0,a.jsx)(a.Fragment,{children:s&&t&&!d?(0,a.jsx)("img",{src:t,alt:"client avatar",className:"w-100",onError:()=>c(!0)}):(0,a.jsx)(p,{color:"#667085",size:r})})},d=e=>{var s,t,l;let{has_photo:o,photo:i,name:r}=e;const[d,c]=(0,n.useState)(!1),p=r&&(null===r||void 0===r||null===(s=r.split(" "))||void 0===s||null===(t=s.map((e=>e[0])))||void 0===t||null===(l=t.join(""))||void 0===l?void 0:l.toUpperCase())||"";return(0,a.jsx)(a.Fragment,{children:o&&i&&!d?(0,a.jsx)("img",{src:i,alt:"client avatar",className:"w-100",onError:()=>c(!0)}):p})},c=e=>{let{name:s,size:t=14}=e;const n=s.split(" ").map((e=>e[0])).join("").toUpperCase();return(0,a.jsx)("span",{style:{fontSize:`${t}px`},children:n})},p=e=>{let{has_photo:s,photo:t,is_business:r}=e;const[d,c]=(0,n.useState)(!1),p=r?l.A:o.A;return(0,a.jsx)("div",{className:`d-flex justify-content-center align-items-center ${i} ${r?"":"rounded-circle"}`,style:{overflow:"hidden"},children:s&&t&&!d?(0,a.jsx)("img",{src:t,alt:"client avatar",className:"w-100",onError:()=>c(!0)}):(0,a.jsx)(p,{color:"#667085"})})}},74641:(e,s,t)=>{t.r(s),t.d(s,{default:()=>he});var n=t(65043),l=t(14282),o=t(72970),i=t(88166),a=t(18091),r=t(75329),d=t(49367),c=t(35475),p=t(47097),u=t(58387),x=t(2028),h=t(93740),m=t(90818),v=t(56328),g=t(43666),f=t(33817),j=t(56741),y=t(50565),w=t(94819),_=t(90688),b=t(88120),S=t(72018),N=t(9642),C=t(64824),A=t(76104);const $={filterBox:"expenses_filterBox__wxXcv",menu:"expenses_menu__5taYH",newButton:"expenses_newButton__SU4MY",total:"expenses_total__LH43I",totalCount:"expenses_totalCount__5Yt5A",totalMoney:"expenses_totalMoney__L+hKb",clientImg:"expenses_clientImg__VRYOd",ellipsis:"expenses_ellipsis__94-xF",location:"expenses_location__JzKDi",active:"expenses_active__J0Nsm",selectedCount:"expenses_selectedCount__wP1-v",deletedRow:"expenses_deletedRow__FYQdz",paidRow:"expenses_paidRow__STtg1",unpaidRow:"expenses_unpaidRow__eujRL",fontStanderdSize:"expenses_fontStanderdSize__F1Lwi",plusIcon:"expenses_plusIcon__YeleL","paid-false":"expenses_paid-false__Oe4Ym",status:"expenses_status__W0wup",inactive:"expenses_inactive__J0oTn",actionButton:"expenses_actionButton__XzmE2",allMoneyButton:"expenses_allMoneyButton__FCs0l",unpaidMoneyButton:"expenses_unpaidMoneyButton__kA4gC",shakeText:"expenses_shakeText__4E+55","tilt-n-move-shaking":"expenses_tilt-n-move-shaking__fDQcc",customToast:"expenses_customToast__MyoQa",toastIcon:"expenses_toastIcon__xu4JV",outerToastIcon:"expenses_outerToastIcon__VG2NP",toastTitle:"expenses_toastTitle__pDAPJ",toastMessage:"expenses_toastMessage__adrZS",paidButton:"expenses_paidButton__pQuP8",notPaidButton:"expenses_notPaidButton__DyR80",accountCode:"expenses_accountCode__4ZKuY",linkToProjectCard:"expenses_linkToProjectCard__ctUh1"};var k=t(37990),R=t(10586),F=t(57189),E=t(48417),L=t(568),z=t(74737),T=t(99678),B=t(14834),D=t(27734),P=t(54967),M=t(99868),I=t(2514),U=t(83624),W=t(70579);const O=e=>{const s=new Date(1e3*e);return`${s.getDate()} ${new Intl.DateTimeFormat("en-US",{month:"short"}).format(s)} ${s.getFullYear()}`},V=(0,n.forwardRef)(((e,s)=>{let{searchValue:t,setTotal:l,setTotalMoney:o,selected:a,setSelected:r,isShowDeleted:d,refetch:u,setRefetch:x,filter:m}=e;const{role:V}=(0,F.As)(),Y=(0,n.useRef)(null),Z=(0,n.useRef)(null),{trialHeight:H}=(0,E.$)(),[K,q]=(0,n.useState)([]),[J,X]=(0,n.useState)(1),[G,Q]=(0,n.useState)({sortField:"id",sortOrder:-1}),[ee,se]=(0,n.useState)({sortField:"id",sortOrder:-1}),[te,ne]=(0,n.useState)(!0),[le,oe]=(0,n.useState)(!1),[ie,ae]=(0,n.useState)(""),[re,de]=(0,n.useState)(!1),[ce,pe]=(0,n.useState)({data:null,show:!1}),ue=n.useMemo((()=>window.location.href),[]),xe=n.useMemo((()=>new URL(ue)),[ue]),he=n.useMemo((()=>new URLSearchParams(xe.search)),[xe]);(0,n.useEffect)((()=>{const e=he.get("expenseId");if(e&&"undefined"!==e){const s=he.get("supplierName");ae({id:e,name:s}),de(!0),xe.searchParams.delete("expenseId"),window.history.replaceState({},"",xe),xe.searchParams.delete("supplierName"),window.history.replaceState({},"",xe)}else"undefined"===e&&(v.oR.error("Expense id not found"),xe.searchParams.delete("expenseId"),window.history.replaceState({},"",xe),xe.searchParams.delete("supplierName"),window.history.replaceState({},"",xe))}),[he]),(0,n.useEffect)((()=>{console.log("Resetting pagination due to filter/search/state change"),X(1),q([]),ne(!0)}),[t,u,d,m]),(0,n.useEffect)((()=>{(async()=>{var e;console.log(`Loading expenses data - Page: ${J}, Search: "${t}", Filter:`,m),oe(!0);let s="";1===(null===ee||void 0===ee?void 0:ee.sortOrder)?s=`${ee.sortField}`:-1===(null===ee||void 0===ee?void 0:ee.sortOrder)&&(s=`-${ee.sortField}`);const n=await(0,R.md)(J,25,t,s,d,m);var i;(console.log(`Loaded ${(null===n||void 0===n||null===(e=n.results)||void 0===e?void 0:e.length)||0} expenses for page ${J}`),l((()=>(null===n||void 0===n?void 0:n.count)||0)),o((null===n||void 0===n?void 0:n.total_amount)||0),1===J)?(console.log("Setting expenses for page 1 (replacing existing)"),q(n.results)):(console.log("Appending expenses for page",J),(null===n||void 0===n||null===(i=n.results)||void 0===i?void 0:i.length)>0&&q((e=>{const s=new Set(e.map((e=>e.id))),t=n.results.filter((e=>!s.has(e.id)));return[...e,...t]})));Q(ee),ne(n.count!==K.length),oe(!1)})()}),[J,t,ee,u,d,m]),(0,n.useEffect)((()=>{if(K.length>0&&te){Y.current=new IntersectionObserver((e=>{e[0].isIntersecting&&X((e=>e+1))}));const e=document.querySelector(".p-datatable-tbody tr:not(.p-datatable-emptymessage):last-child");e&&Y.current.observe(e)}return()=>{Y.current&&Y.current.disconnect()}}),[K,te]);const me=(0,p.n)({mutationFn:e=>(0,R.Wz)(e),onSuccess:()=>{v.oR.success("Expense deleted successfully"),me.reset(),x(!u)},onError:e=>{me.reset(),console.log("error: ",e),v.oR.error("Failed to delete expense. Please try again.")}});return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(C.b,{ref:s,value:K,scrollable:!0,selectionMode:"checkbox",columnResizeMode:"expand",resizableColumns:!0,showGridlines:!0,size:"large",scrollHeight:`calc(100vh - 175px - ${H}px)`,className:"border",selection:a,onSelectionChange:e=>r(e.value),loading:le,loadingIcon:D.A,emptyMessage:(0,W.jsx)(M.A,{isDataExist:!!t||!!d}),sortField:null===G||void 0===G?void 0:G.sortField,sortOrder:null===G||void 0===G?void 0:G.sortOrder,onSort:e=>{const{sortField:s,sortOrder:t}=e;se({sortField:s,sortOrder:t}),X(1)},children:[(0,W.jsx)(N.V,{selectionMode:"multiple",headerClassName:"ps-4 border-end-0",bodyClassName:"show-on-hover border-end-0 ps-4",headerStyle:{width:"3rem",textAlign:"center"},frozen:!0}),(0,W.jsx)(N.V,{field:"id",header:"Expense ID",body:e=>{var s;return(0,W.jsxs)("div",{className:"d-flex align-items-center justify-content-between show-on-hover",children:[(0,W.jsxs)("div",{className:"d-flex flex-column",style:{lineHeight:"1.385"},children:[(0,W.jsx)("span",{children:null===(s=e.number)||void 0===s?void 0:s.split("-")[1]}),(0,W.jsx)("span",{className:"font-12",style:{color:"#98A2B3"},children:O(e.created)})]}),(0,W.jsx)(S.$,{label:"Open",onClick:()=>{var s;de(!0),ae({id:null===e||void 0===e?void 0:e.id,name:null===e||void 0===e||null===(s=e.supplier)||void 0===s?void 0:s.name})},className:"primary-text-button ms-3 show-on-hover-element not-show-checked",text:!0})]})},headerClassName:"paddingLeftHide",bodyClassName:"paddingLeftHide",style:{minWidth:"100px"},frozen:!0,sortable:!0}),(0,W.jsx)(N.V,{field:"supplier__name",header:"Supplier A\u2192Z",body:e=>{var s,t,n;return(0,W.jsxs)("div",{className:"d-flex align-items-center",children:[(0,W.jsx)(P.Ay,{has_photo:null===e||void 0===e||null===(s=e.supplier)||void 0===s?void 0:s.has_photo,photo:null===e||void 0===e||null===(t=e.supplier)||void 0===t?void 0:t.photo,is_business:!0}),(0,W.jsxs)("div",{className:"d-flex flex-column gap-1",children:[(0,W.jsx)("div",{className:`${$.ellipsis}`,children:null===(n=e.supplier)||void 0===n?void 0:n.name}),e.deleted?(0,W.jsx)(A.v,{value:"Deleted",style:{height:"22px",width:"59px",borderRadius:"16px",border:"1px solid #FECDCA",background:"#FEF3F2",color:"#912018",fontSize:"12px",fontWeight:500}}):""]})]})},headerClassName:"shadowRight",bodyClassName:"shadowRight",style:{minWidth:"224px"},frozen:!0,sortable:!0}),(0,W.jsx)(N.V,{field:"invoice_reference",header:"Reference",body:e=>(0,W.jsx)("div",{className:"ellipsis-width",title:e.invoice_reference,style:{maxWidth:"250px",color:"#344054"},children:e.invoice_reference}),style:{minWidth:"94px"}}),(0,W.jsx)(N.V,{field:"file",header:"File",body:e=>{var s,t,n;if(!e.file)return"";const l=e.paid,o=e.file?null===(s=e.file.split("."))||void 0===s||null===(t=s[(null===(n=e.file.split("."))||void 0===n?void 0:n.length)-1])||void 0===t?void 0:t.toLowerCase():"";return e.file?(0,W.jsx)(c.N_,{to:e.file,target:"_blank",children:(0,W.jsx)(T.L,{extension:o,color:l?"#98A2B3":"#FF0000",size:16})}):void 0},style:{minWidth:"60px",textAlign:"center",maxWidth:"60px",width:"60px"}}),(0,W.jsx)(N.V,{field:"created",header:"Due Date",body:e=>(0,W.jsx)("div",{className:"d-flex align-items-center justify-content-between show-on-hover",style:{color:"#667085",fontSize:"12px"},children:O(e.created)}),style:{minWidth:"56px"},className:"text-center"}),(0,W.jsx)(N.V,{field:"jobsdone",header:"Total",body:e=>(0,W.jsx)("div",{className:`d-flex align-items-center justify-content-end show-on-hover ${$.fontStanderdSize}`,children:(0,W.jsxs)("div",{className:` ${e.paid?$["paid-true"]:$["paid-false"]}`,children:["$",(0,B.m)(e.total)]})}),style:{minWidth:"56px",textAlign:"end"}}),(0,W.jsx)(N.V,{field:"type",header:"Interval/Project/Asset",body:e=>{var s,t,n,l,o;return e.asset?(0,W.jsxs)("div",{className:"d-flex flex-column",children:[(0,W.jsx)("span",{className:"text-capitalize",style:{color:"#344054",fontSize:"14px"},children:e.asset.asset_name}),(0,W.jsxs)("span",{className:"font-14",style:{color:"#98A2B3"},children:["Asset | ",e.asset.asset_type_name]})]}):e.order?(0,W.jsxs)("div",{className:"d-flex flex-column",children:[(0,W.jsx)("span",{style:{color:"#344054",fontSize:"14px"},children:(null===e||void 0===e||null===(s=e.order)||void 0===s?void 0:s.reference)||"-"}),(0,W.jsxs)("span",{className:"font-14",style:{color:"#98A2B3"},children:[(0,W.jsx)(c.N_,{className:`${$.linkToProjectCard}`,to:`/management?unique_id=${null===e||void 0===e||null===(t=e.order)||void 0===t?void 0:t.unique_id}`,children:null===e||void 0===e||null===(n=e.order)||void 0===n?void 0:n.number})," | ",null===e||void 0===e||null===(l=e.order)||void 0===l||null===(o=l.client)||void 0===o?void 0:o.name]})]}):(0,W.jsx)("span",{className:"text-capitalize",style:{color:"#344054",fontSize:"14px"},children:e.type})},style:{minWidth:"123px",textAlign:"left"}}),(0,W.jsx)(N.V,{field:"account_code.code",header:"Account Code",body:e=>{var s,t,n;return(0,W.jsxs)("div",{className:`d-flex align-items-center justify-content-start show-on-hover ${$.accountCode}`,children:[(null===(s=e.account_code)||void 0===s?void 0:s.code)&&(0,W.jsxs)("span",{children:[null===(t=e.account_code)||void 0===t?void 0:t.code,": "]}),null===(n=e.account_code)||void 0===n?void 0:n.name]})},style:{minWidth:"114px",textAlign:"left"},sortable:!0}),(0,W.jsx)(N.V,{field:"total_requests",header:"Xero/Myob",body:e=>(0,W.jsx)("div",{className:"d-flex align-items-center justify-content-center",children:"in_progress"===(null===e||void 0===e?void 0:e.xero_status)?(0,W.jsx)("span",{style:{color:"#158ECC",fontSize:"12px"},className:$.shakeText,children:"xero"}):"completed"===(null===e||void 0===e?void 0:e.xero_status)?(0,W.jsx)("span",{style:{color:"#158ECC",fontSize:"12px"},children:"xero"}):(0,W.jsx)("span",{})}),style:{minWidth:"89px",textAlign:"center"}}),(0,W.jsx)(N.V,{field:"paid",header:"Status",body:e=>e.paid?(0,W.jsxs)(S.$,{onClick:()=>pe({data:e,show:!0}),className:$.paidButton,style:{height:"36px",width:"97px"},children:["Paid ",(0,W.jsx)(i.A,{color:"#17B26A",size:16})]}):(0,W.jsxs)(S.$,{onClick:()=>pe({data:e,show:!0}),className:$.notPaidButton,style:{height:"36px",width:"97px"},children:["Not Paid ",(0,W.jsx)(g.A,{color:"#F04438",size:16})," "]}),style:{minWidth:"130px",maxWidth:"130px",width:"130px"},bodyStyle:{color:"#667085"},bodyClassName:"text-center",headerClassName:"text-center"}),(0,z._)(V,L.J.EXPENSE.DELETE)&&(0,W.jsx)(N.V,{header:"Actions",body:e=>{const s=(0,n.useRef)(null),[t,i]=(0,n.useState)(!1),a=(0,_.k)(t,i);return(0,W.jsxs)(n.Fragment,{children:[(0,W.jsx)(y.A,{size:24,color:"#667085",className:"cursor-pointer",ref:s,...a}),(0,W.jsx)(b.k,{state:t?"open":"closed",anchorRef:s,onClose:()=>i(!1),className:"threeDots",menuStyle:{padding:"4px",width:"241px",textAlign:"left"},children:(0,W.jsxs)("div",{className:"d-flex align-items-center cursor-pointer gap-2 hover-greay px-2 py-2",onClick:()=>{i(!1),q((s=>s.filter((s=>s.id!==e.id)))),l((e=>e-1)),o((s=>s-e.total)),Z.current=setTimeout((()=>{e.asset&&(0,k.hk)(e.asset.asset_id,e.asset.asset_type_id,e.id),me.mutate(e.id)}),5e3),v.oR.custom((s=>(0,W.jsxs)("div",{className:$.customToast,children:[(0,W.jsxs)("div",{className:"d-flex align-items-center justify-content-between w-100 mb-3",children:[(0,W.jsx)("div",{className:$.outerToastIcon,children:(0,W.jsx)("div",{className:$.toastIcon,children:(0,W.jsx)(f.A,{color:"#DC6803",size:20})})}),(0,W.jsx)(S.$,{className:"close-button border-0",onClick:()=>v.oR.dismiss(s),children:(0,W.jsx)(j.A,{size:20,color:"#344054"})})]}),(0,W.jsxs)("div",{className:"ps-2",children:[(0,W.jsx)("p",{className:$.toastTitle,children:"Expense has been deleted"}),(0,W.jsx)("p",{className:$.toastMessage,children:"You can undo this action within a few seconds."}),(0,W.jsx)(S.$,{className:"text-button ps-0",onClick:()=>{var t;clearTimeout(Z.current),null===(t=me.reset)||void 0===t||t.call(me),v.oR.success("Expense has been restored"),v.oR.dismiss(s),q((s=>{const t=K.findIndex((s=>s.id===e.id));return[...s.slice(0,t),e,...s.slice(t)]})),l((e=>e+1)),o((s=>s+e.total))},children:"Undo action"})]})]})),{position:"bottom-right"})},children:[(0,W.jsx)(w.A,{color:"#B42318",size:20}),(0,W.jsx)("span",{style:{color:"#B42318",fontSize:"16px",fontWeight:500},children:"Delete expense"}),(null===me||void 0===me?void 0:me.variables)===e.id?(0,W.jsx)(h.p,{style:{width:"20px",height:"20px"}}):""]})})]})},style:{minWidth:"75px",maxWidth:"75px",width:"75px",textAlign:"center"},bodyStyle:{color:"#667085"}})]}),(0,W.jsx)(I.A,{id:null===ie||void 0===ie?void 0:ie.id,name:null===ie||void 0===ie?void 0:ie.name,visible:re,setVisible:de,setEditData:ae,setRefetch:x},null===ie||void 0===ie?void 0:ie.id),(0,W.jsx)(U.A,{showDialog:ce,setShowDialog:pe,setRefetch:x})]})})),Y=V;var Z=t(39759),H=t(94673),K=t(3494),q=t(34602),J=t(62812),X=t(27965),G=(t(7245),t(54972)),Q=t(5328),ee=t(44621);const se="expense-dropdown_filterBox__0jVBu",te="expense-dropdown_searchBox__2-mbW",ne="expense-dropdown_supplierDropdownItem__dA2Q5",le="expense-dropdown_mainTagsWrapper__rDFzz",oe="expense-dropdown_tagsInputContainer__-k4pE",ie="expense-dropdown_tagItemsWrap__c+Ewx",ae="expense-dropdown_tagItemWrap__VZ7nO";var re=t(17030),de=t(52781),ce=t(58027);const pe=e=>{let{setFilters:s,filter:t}=e;const o=(0,n.useRef)(null),i=(0,n.useRef)(null),[a,r]=(0,n.useState)(!1),[d,c]=(0,n.useState)("status"),[p,m]=(0,n.useState)([]),[v,g]=(0,n.useState)([null,null]),[f,j]=(0,n.useState)([]),[y,w]=(0,n.useState)([]),[_,b]=(0,n.useState)(1),[S,N]=(0,n.useState)(1),[C,A]=(0,n.useState)(null),[$,k]=(0,n.useState)(null),[R,F]=(0,n.useState)(!0),[E,L]=(0,n.useState)(!0),[z,T,B]=(0,x.d7)("",400),[D,P,M]=(0,x.d7)("",400),[I,U]=(0,n.useState)(!1),[O,V]=(0,n.useState)(!1);function Y(e){if(!e)return"";const s=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${String(e.getDate()).padStart(2,"0")}-${t}-${s}`}(0,n.useEffect)((()=>{b(1),F(!0)}),[T]),(0,n.useEffect)((()=>{N(1),L(!0)}),[P]),(0,n.useEffect)((()=>{(async()=>{U(!0);try{var e,s;console.log(`Loading suppliers - Page: ${_}, Search: "${T}"`);const n=await(0,de.Jj)(_,25,T,"name");var t;if(console.log(`Suppliers loaded - Results: ${(null===n||void 0===n||null===(e=n.results)||void 0===e?void 0:e.length)||0}, Total: ${(null===n||void 0===n?void 0:n.count)||"unknown"}`),1===_)j((null===n||void 0===n?void 0:n.results)||[]);else(null===n||void 0===n||null===(t=n.results)||void 0===t?void 0:t.length)>0&&j((e=>{const s=new Set(e.map((e=>e.id))),t=n.results.filter((e=>!s.has(e.id)));return console.log(`Adding ${t.length} new suppliers to existing ${e.length}`),[...e,...t]}));const l=null!==n&&void 0!==n&&n.count?25*_<n.count:((null===n||void 0===n||null===(s=n.results)||void 0===s?void 0:s.length)||0)>=25;console.log(`Has more suppliers: ${l} (page: ${_}, limit: 25, total: ${(null===n||void 0===n?void 0:n.count)||"unknown"})`),F(l)}catch(n){console.error("Error loading suppliers:",n),j([]),F(!1)}U(!1)})()}),[_,T]),(0,n.useEffect)((()=>{(async()=>{V(!0);try{const e=await(0,re.ax)(1);1===S?w(Array.isArray(e)?e:[]):Array.isArray(e)&&e.length>0&&w((s=>{const t=new Set(s.map((e=>e.id))),n=e.filter((e=>!t.has(e.id)));return[...s,...n]})),L(Array.isArray(e)&&25===e.length)}catch(e){console.error("Error loading departments:",e),w([])}V(!1)})()}),[S,P,$]),(0,n.useEffect)((()=>{if((null===f||void 0===f?void 0:f.length)>0&&R&&"suppliers"===d&&!I){const e=setTimeout((()=>{const e=document.querySelector(".supplier-dropdown .supplier-dropdown-item:last-child");e&&o.current&&o.current.disconnect(),e&&(o.current=new IntersectionObserver((e=>{e[0].isIntersecting&&R&&!I&&(console.log("Intersection detected - loading next page of suppliers"),b((e=>e+1)))}),{threshold:.8}),o.current.observe(e))}),500);return()=>{clearTimeout(e),o.current&&o.current.disconnect()}}}),[f,R,a,d,I]),(0,n.useEffect)((()=>{if((null===y||void 0===y?void 0:y.length)>0&&E&&"departments"===d){const e=setTimeout((()=>{const e=document.querySelector(".department-dropdown .department-dropdown-item:last-child");e&&(o.current=new IntersectionObserver((e=>{e[0].isIntersecting&&N((e=>e+1))}),{threshold:1}),o.current.observe(e))}),1e3);return()=>{clearTimeout(e),o.current&&o.current.disconnect()}}}),[y,E,a,d]);const le=e=>{m((s=>s.includes(e)?s.filter((s=>s!==e)):[...s,e]))},oe=()=>{r(!1),c("status")},ie=()=>{r(!1),null!==C&&void 0!==C&&C.length&&s((e=>({...e,suppliers:[...C]}))),null!==$&&void 0!==$&&$.length&&s((e=>({...e,departments:[...$]})));const e=p.map((e=>({name:e,value:e})));if(console.log("Status value from checkboxes:",p),console.log("Formatted status for API:",e),s((s=>({...s,status:[...e]}))),v&&v[0]&&v[1]){let e=`${Y(v[0])} - ${Y(v[1])}`;s((s=>({...s,date:[{name:e,value:v}]})))}};return(0,n.useEffect)((()=>{null!==t&&void 0!==t&&t.suppliers?null!==t&&void 0!==t&&t.suppliers&&A(t.suppliers):A(null),null!==t&&void 0!==t&&t.departments?null!==t&&void 0!==t&&t.departments&&k(t.departments):k(null),null!==t&&void 0!==t&&t.status?null!==t&&void 0!==t&&t.status&&m(t.status.map((e=>e.value))):m([]),null!==t&&void 0!==t&&t.date?null!==t&&void 0!==t&&t.date&&g(t.date[0].value):g([null,null])}),[t]),(0,n.useEffect)((()=>{const e=e=>{i.current&&!i.current.contains(e.target)&&r(!1)};return a&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[a]),(0,W.jsxs)("div",{className:"supplier-filters",ref:i,children:[(0,W.jsx)("button",{className:`${se}`,onClick:()=>r(!a),children:(0,W.jsx)(Z.A,{})}),a&&(0,W.jsxs)(ee.A,{id:"expense-filter-tabs",activeKey:d,onSelect:e=>c(e),className:"filtterBoxWrapper",style:{marginLeft:"5px",marginTop:"5px"},children:[(0,W.jsxs)(Q.A,{eventKey:"status",title:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(H.A,{color:"#667085",size:16})," Status"]}),children:[(0,W.jsxs)("div",{className:"d-flex align-items-center gap-3 p-2 mb-2",children:[(0,W.jsx)(G.S,{inputId:"paid",checked:null===p||void 0===p?void 0:p.includes("paid"),onChange:()=>le("paid")}),(0,W.jsx)("label",{htmlFor:"paid",className:"mb-0",children:"Paid"})]}),(0,W.jsxs)("div",{className:"d-flex align-items-center gap-3 p-2 mb-2",children:[(0,W.jsx)(G.S,{inputId:"not_paid",checked:null===p||void 0===p?void 0:p.includes("not_paid"),onChange:()=>le("not_paid")}),(0,W.jsx)("label",{htmlFor:"not_paid",className:"mb-0",children:"Not Paid"})]}),(0,W.jsxs)("div",{className:"d-flex justify-content-end gap-2 p-3 border-top",children:[(0,W.jsx)(l.A,{className:"outline-button",style:{width:"115px",padding:"8px 14px"},onClick:oe,children:"Cancel"}),(0,W.jsx)(l.A,{className:"solid-button",style:{width:"115px",padding:"8px 14px"},onClick:ie,children:"Apply"})]})]}),(0,W.jsxs)(Q.A,{eventKey:"suppliers",title:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(K.A,{color:"#667085",size:16}),"Suppliers"]}),children:[(0,W.jsxs)("div",{className:te,children:[(0,W.jsx)("div",{style:{position:"absolute",top:"7px",left:"18px"},children:(0,W.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:(0,W.jsx)("path",{d:"M14.6777 12.9299C15.6661 11.5841 16.25 9.92275 16.25 8.125C16.25 3.63769 12.6123 0 8.125 0C3.63769 0 0 3.63769 0 8.125C0 12.6123 3.63769 16.25 8.125 16.25C9.92323 16.25 11.585 15.6658 12.9309 14.6769L12.9299 14.6777C12.9667 14.7277 13.0078 14.7756 13.053 14.8208L17.8661 19.6339C18.3543 20.122 19.1457 20.122 19.6339 19.6339C20.122 19.1457 20.122 18.3543 19.6339 17.8661L14.8208 13.053C14.7756 13.0078 14.7277 12.9667 14.6777 12.9299ZM15 8.125C15 11.922 11.922 15 8.125 15C4.32804 15 1.25 11.922 1.25 8.125C1.25 4.32804 4.32804 1.25 8.125 1.25C11.922 1.25 15 4.32804 15 8.125Z",fill:"#98A2B3"})})}),(0,W.jsx)("input",{type:"text",placeholder:"Search suppliers",value:z,onChange:e=>B(e.target.value),className:"border search-resource",style:{borderRadius:"4px",width:"260px",border:"1px solid #D0D5DD",color:"#424242",padding:"10px 10px 10px 36px",fontSize:"14px",height:"40px"}})]}),(0,W.jsxs)("div",{className:"supplier-dropdown",style:{height:"350px",overflow:"auto",marginLeft:"0px"},children:[null===f||void 0===f?void 0:f.map((e=>(0,W.jsxs)("div",{className:(0,u.A)(ne,"supplier-dropdown-item"),onClick:()=>A((s=>null!==s&&void 0!==s&&s.some((s=>s.id===e.id))?s.filter((s=>s.id!==e.id)):s?[...s,e]:[e])),children:[(0,W.jsxs)("div",{className:"d-flex gap-2 align-items-center w-100",children:[(0,W.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{width:"24px",height:"24px",borderRadius:"4px",overflow:"hidden",border:"1px solid #dedede"},children:(0,W.jsx)(ce.A,{photo:null===e||void 0===e?void 0:e.photo,has_photo:null===e||void 0===e?void 0:e.has_photo,is_business:!0,size:17})}),(0,W.jsx)("div",{className:"ellipsis-width",style:{maxWidth:"200px"},children:null===e||void 0===e?void 0:e.name})]}),null!==C&&void 0!==C&&C.some((s=>s.id===e.id))?(0,W.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:(0,W.jsx)("path",{d:"M16.25 5.625L7.5 14.375L3.75 10.625",stroke:"#1AB2FF",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}):null]},e.id))),I&&(0,W.jsx)("div",{className:"d-flex justify-content-center p-2",children:(0,W.jsx)(h.p,{style:{width:"20px",height:"20px",color:"#1AB2FF"}})}),!I&&!R&&(null===f||void 0===f?void 0:f.length)>0&&(0,W.jsx)("div",{className:"d-flex justify-content-center p-2 text-muted",style:{fontSize:"12px"},children:"No more suppliers to load"})]}),(0,W.jsxs)("div",{className:"d-flex justify-content-end gap-2 p-3 border-top",children:[(0,W.jsx)(l.A,{className:"outline-button",style:{width:"115px",padding:"8px 14px"},onClick:oe,children:"Cancel"}),(0,W.jsx)(l.A,{className:"solid-button",style:{width:"115px",padding:"8px 14px"},onClick:ie,children:"Apply"})]})]}),(0,W.jsxs)(Q.A,{eventKey:"departments",title:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(q.A,{color:"#667085",size:16}),"Departments"]}),children:[(0,W.jsxs)("div",{className:te,children:[(0,W.jsx)("div",{style:{position:"absolute",top:"7px",left:"18px"},children:(0,W.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:(0,W.jsx)("path",{d:"M14.6777 12.9299C15.6661 11.5841 16.25 9.92275 16.25 8.125C16.25 3.63769 12.6123 0 8.125 0C3.63769 0 0 3.63769 0 8.125C0 12.6123 3.63769 16.25 8.125 16.25C9.92323 16.25 11.585 15.6658 12.9309 14.6769L12.9299 14.6777C12.9667 14.7277 13.0078 14.7756 13.053 14.8208L17.8661 19.6339C18.3543 20.122 19.1457 20.122 19.6339 19.6339C20.122 19.1457 20.122 18.3543 19.6339 17.8661L14.8208 13.053C14.7756 13.0078 14.7277 12.9667 14.6777 12.9299ZM15 8.125C15 11.922 11.922 15 8.125 15C4.32804 15 1.25 11.922 1.25 8.125C1.25 4.32804 4.32804 1.25 8.125 1.25C11.922 1.25 15 4.32804 15 8.125Z",fill:"#98A2B3"})})}),(0,W.jsx)("input",{type:"text",placeholder:"Search departments",value:D,onChange:e=>M(e.target.value),className:"border search-resource",style:{borderRadius:"4px",width:"260px",border:"1px solid #D0D5DD",color:"#424242",padding:"10px 10px 10px 36px",fontSize:"14px",height:"40px"}})]}),(0,W.jsxs)("div",{className:"department-dropdown",style:{height:"350px",overflow:"auto",marginLeft:"0px"},children:[null===y||void 0===y?void 0:y.map((e=>(0,W.jsxs)("div",{className:(0,u.A)(ne,"department-dropdown-item"),onClick:()=>k((s=>null!==s&&void 0!==s&&s.some((s=>s.id===e.id))?s.filter((s=>s.id!==e.id)):s?[...s,e]:[e])),children:[(0,W.jsx)("div",{className:"d-flex gap-2 align-items-center w-100",children:(0,W.jsx)("div",{className:"ellipsis-width",style:{maxWidth:"200px"},children:null===e||void 0===e?void 0:e.name})}),null!==$&&void 0!==$&&$.some((s=>s.id===e.id))?(0,W.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:(0,W.jsx)("path",{d:"M16.25 5.625L7.5 14.375L3.75 10.625",stroke:"#1AB2FF",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}):null]},e.id))),O&&(0,W.jsx)(h.p,{style:{width:"20px",height:"20px",color:"#1AB2FF"}})]}),(0,W.jsxs)("div",{className:"d-flex justify-content-end gap-2 p-3 border-top",children:[(0,W.jsx)(l.A,{className:"outline-button",style:{width:"115px",padding:"8px 14px"},onClick:oe,children:"Cancel"}),(0,W.jsx)(l.A,{className:"solid-button",style:{width:"115px",padding:"8px 14px"},onClick:ie,children:"Apply"})]})]}),(0,W.jsxs)(Q.A,{eventKey:"date",title:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(J.A,{color:"#667085",size:16})," Date"]}),children:[(0,W.jsx)("div",{className:"px-3 pt-2",children:(0,W.jsx)(X.A,{value:v,onChange:g,options:{dateFormat:"Y-m-d",mode:"range",inline:!0}})}),(0,W.jsxs)("div",{className:"d-flex justify-content-end gap-2 p-3 border-top",children:[(0,W.jsx)(l.A,{className:"outline-button",style:{width:"115px",padding:"8px 14px"},onClick:oe,children:"Cancel"}),(0,W.jsx)(l.A,{className:"solid-button",style:{width:"115px",padding:"8px 14px"},onClick:ie,children:"Apply"})]})]})]})]})},ue=e=>{var s,t;let{filter:n,setFilter:o}=e;const i=n||{};return(0,W.jsx)(W.Fragment,{children:(null===(s=Object.keys(i))||void 0===s?void 0:s.length)>0&&(0,W.jsx)("div",{className:le,children:null===(t=Object.entries(i))||void 0===t?void 0:t.map((e=>{let[s,t]=e;return(0,W.jsx)("div",{children:(null===t||void 0===t?void 0:t.length)>0&&(0,W.jsx)("div",{className:oe,children:(0,W.jsxs)("ul",{className:ie,children:[t.map(((e,n)=>(0,W.jsxs)("li",{className:ae,children:[null===e||void 0===e?void 0:e.name,(null===t||void 0===t?void 0:t.length)>1&&(0,W.jsx)(l.A,{variant:"link",size:"sm",style:{marginLeft:"5px",padding:0},onClick:()=>((e,s)=>{const t={...i},n=t[e].filter((e=>e!==s));0===n.length?delete t[e]:t[e]=n,o(t)})(s,e),children:(0,W.jsx)(j.A,{color:"#F96969",size:15})})]},n))),(0,W.jsx)(l.A,{variant:"link",size:"sm",style:{marginLeft:"0px",padding:0},onClick:()=>(e=>{const s={...i};delete s[e],o(s)})(s),children:(0,W.jsx)(j.A,{color:"#F96969",size:20})})]})})},s)}))})})};var xe=t(62284);const he=()=>{const e=(0,n.useRef)(null),s=(0,n.useRef)(null),[t]=(0,c.ok)(),g=t.get("isShowUnpaid"),[f,j]=(0,n.useState)(0),[y,w]=(0,n.useState)(0),[_,b]=(0,n.useState)(!1),[S,N]=(0,n.useState)(!1),[C,A]=(0,n.useState)(!!g),[k,F]=(0,n.useState)(null),[E,L,z]=(0,x.d7)("",400),[T,D]=(0,n.useState)({}),P=(0,p.n)({mutationFn:e=>(0,R.a_)(e),onSuccess:()=>{N((e=>!e)),F(null),v.oR.success("Expense successfully sent to Xero!")},onError:e=>{console.log("error: ",e),v.oR.error("Failed to send the expense to xero. Please try again.")}}),M=(0,p.n)({mutationFn:e=>(0,R.D3)(e),onSuccess:()=>{N((e=>!e)),F(null),v.oR.success("Expenses have been successfully marked as paid.")},onError:e=>{console.log("error: ",e),v.oR.error("Failed to mark the expenses as paid. Please try again.")}}),I=(0,p.n)({mutationFn:e=>(0,R.ik)(e),onSuccess:()=>{N((e=>!e)),F(null),v.oR.success("Expenses have been successfully marked as unpaid.")},onError:e=>{console.log("error: ",e),v.oR.error("Failed to mark the expenses as unpaid. Please try again.")}});return(0,W.jsxs)("div",{className:"peoples-page",children:[(0,W.jsx)(d.mg,{children:(0,W.jsx)("title",{children:"MeMate - Expenses"})}),(0,W.jsxs)("div",{className:`topbar ${null!==k&&void 0!==k&&k.length?$.active:""}`,style:{padding:"4px 32px 4px 23px",position:"relative",height:"48px"},children:[(0,W.jsx)("div",{className:"left-side d-flex align-items-center",style:{gap:"16px"},children:null!==k&&void 0!==k&&k.length?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("h6",{className:$.selectedCount,children:["Selected: ",null===k||void 0===k?void 0:k.length]}),(0,W.jsxs)("div",{className:"filtered-box d-flex align-items-center gap-2",children:[(0,W.jsxs)("button",{className:`danger-outline-button ${$.actionButton}`,onClick:()=>{const e=k.map((e=>e.id));I.mutate({ids:e})},disabled:null===I||void 0===I?void 0:I.isPending,children:["Mark as Unpaid ",null!==I&&void 0!==I&&I.isPending?(0,W.jsx)(h.p,{style:{width:"20px",height:"20px"}}):(0,W.jsx)(o.A,{color:"#B42318",size:20})," "]}),(0,W.jsxs)("button",{className:`success-outline-button ${$.actionButton}`,onClick:()=>{const e=k.map((e=>e.id));M.mutate({ids:e})},disabled:null===M||void 0===M?void 0:M.isPending,children:["Mark as Paid ",null!==M&&void 0!==M&&M.isPending?(0,W.jsx)(h.p,{style:{width:"20px",height:"20px"}}):(0,W.jsx)(i.A,{color:"#067647",size:20})," "]}),(0,W.jsxs)("button",{className:`outline-button ${$.actionButton}`,onClick:()=>{const e=k.map((e=>e.id));P.mutate({ids:e})},disabled:P.isPending,children:["Send to Xero/MYOB",P.isPending?(0,W.jsx)(h.p,{style:{width:"20px",height:"20px"}}):(0,W.jsx)(a.A,{color:"#1D2939",size:20})]}),(0,W.jsx)("button",{className:`${$.filterBox}`,onClick:()=>{return s=!0,void(e.current?e.current.exportCSV({selectionOnly:s}):console.error("DataTable ref is null"));var s},children:(0,W.jsx)(r.A,{})})]})]}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{className:"filtered-box",children:[(0,W.jsx)(pe,{filter:T,setFilters:e=>{D("function"===typeof e?s=>e(s||{}):e||{})}}),(0,W.jsx)(m.b,{model:[],className:(0,u.A)($.menu),popup:!0,ref:s,breakpoint:"767px"})]}),(0,W.jsxs)("div",{className:"searchBox",style:{position:"relative"},children:[(0,W.jsx)("div",{style:{position:"absolute",top:"2px",left:"6px"},children:(0,W.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:(0,W.jsx)("path",{d:"M14.6777 12.9299C15.6661 11.5841 16.25 9.92275 16.25 8.125C16.25 3.63769 12.6123 0 8.125 0C3.63769 0 0 3.63769 0 8.125C0 12.6123 3.63769 16.25 8.125 16.25C9.92323 16.25 11.585 15.6658 12.9309 14.6769L12.9299 14.6777C12.9667 14.7277 13.0078 14.7756 13.053 14.8208L17.8661 19.6339C18.3543 20.122 19.1457 20.122 19.6339 19.6339C20.122 19.1457 20.122 18.3543 19.6339 17.8661L14.8208 13.053C14.7756 13.0078 14.7277 12.9667 14.6777 12.9299ZM15 8.125C15 11.922 11.922 15 8.125 15C4.32804 15 1.25 11.922 1.25 8.125C1.25 4.32804 4.32804 1.25 8.125 1.25C11.922 1.25 15 4.32804 15 8.125Z",fill:"#98A2B3"})})}),(0,W.jsx)("input",{type:"text",placeholder:"Search",value:E,onChange:e=>z(e.target.value),className:"border search-resource",style:{borderRadius:"4px",width:"184px",border:"1px solid #D0D5DD",color:"#424242",paddingLeft:"36px",fontSize:"14px",height:"32px"}})]})]})}),!(null!==k&&void 0!==k&&k.length)&&(0,W.jsxs)("div",{className:"featureName d-flex align-items-center",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:[(0,W.jsx)("h1",{className:"title p-0",style:{marginRight:"16px"},children:"Expenses"}),(0,W.jsx)(l.A,{onClick:()=>b(!0),className:`${$.newButton}`,children:"New Expense"})]}),(0,W.jsxs)("div",{className:"right-side d-flex align-items-center",style:{gap:"8px"},children:[(0,W.jsx)(l.A,{className:C?$.unpaidMoneyButton:$.allMoneyButton,onClick:()=>{A(!C),"true"===g&&C&&window.history.pushState({},"","/expenses")},children:"Unpaid"}),C&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("h1",{className:`${$.total} mb-0`,children:"Total"}),(0,W.jsxs)("div",{className:`${$.totalCount}`,children:[f," Expenses"]}),(0,W.jsxs)("h1",{className:$.totalMoney,children:["$",(0,B.m)(y||0)]})]})]})]}),(0,W.jsx)(ue,{filter:T,setFilter:D}),(0,W.jsx)(Y,{ref:e,searchValue:L,setTotal:j,setTotalMoney:w,selected:k,setSelected:F,isShowDeleted:C,refetch:S,setRefetch:N,filter:T}),(0,W.jsx)(xe.A,{visible:_,setVisible:b,setRefetch:N})]})}}}]);
//# sourceMappingURL=7606.29d8847c.chunk.js.map