"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[3579,6731],{54967:(e,s,t)=>{t.d(s,{Ab:()=>o,dg:()=>c,fr:()=>d,Ay:()=>u});var a=t(65043),i=t(44541),n=t(95192);const r="image-avatar_clientImg__-nnRU";var l=t(70579);const o=e=>{let{has_photo:s,photo:t,is_business:r,size:o}=e;const[c,d]=(0,a.useState)(!1),u=r?i.A:n.A;return(0,l.jsx)(l.Fragment,{children:s&&t&&!c?(0,l.jsx)("img",{src:t,alt:"client avatar",className:"w-100",onError:()=>d(!0)}):(0,l.jsx)(u,{color:"#667085",size:o})})},c=e=>{var s,t,i;let{has_photo:n,photo:r,name:o}=e;const[c,d]=(0,a.useState)(!1),u=o&&(null===o||void 0===o||null===(s=o.split(" "))||void 0===s||null===(t=s.map((e=>e[0])))||void 0===t||null===(i=t.join(""))||void 0===i?void 0:i.toUpperCase())||"";return(0,l.jsx)(l.Fragment,{children:n&&r&&!c?(0,l.jsx)("img",{src:r,alt:"client avatar",className:"w-100",onError:()=>d(!0)}):u})},d=e=>{let{name:s,size:t=14}=e;const a=s.split(" ").map((e=>e[0])).join("").toUpperCase();return(0,l.jsx)("span",{style:{fontSize:`${t}px`},children:a})},u=e=>{let{has_photo:s,photo:t,is_business:o}=e;const[c,d]=(0,a.useState)(!1),u=o?i.A:n.A;return(0,l.jsx)("div",{className:`d-flex justify-content-center align-items-center ${r} ${o?"":"rounded-circle"}`,style:{overflow:"hidden"},children:s&&t&&!c?(0,l.jsx)("img",{src:t,alt:"client avatar",className:"w-100",onError:()=>d(!0)}):(0,l.jsx)(u,{color:"#667085"})})}},89707:(e,s,t)=>{t.r(s),t.d(s,{default:()=>ps});var a=t(65043),i=t(49367),n=t(73216),r=t(42104),l=t(56328);const o="chat-layout_chatContainer__qW3K4";var c=t(90386),d=t(57189),u=t(48417),h=t(27734),p=t(86213),m=t(70381),v=t.n(m),_=t(72018),g=t(27932),x=t(93740);const j={chatArea:"chat-area_chatArea__LcIUx",chatSidebar:"chat-area_chatSidebar__YWktj",slideIn:"chat-area_slideIn__YYoN5",chatContent:"chat-area_chatContent__uf9lg",chatBodyArea:"chat-area_chatBodyArea__pnfS9",messagesContainer:"chat-area_messagesContainer__jP8AR",loadingContainer:"chat-area_loadingContainer__GABMB",messageInputContainer:"chat-area_messageInputContainer__utwWT",messageInput:"chat-area_messageInput__IlSJP",messageInputIcons:"chat-area_messageInputIcons__hW5ZW",attachButton:"chat-area_attachButton__oHyZF",emojiButton:"chat-area_emojiButton__DtKy-",sendButton:"chat-area_sendButton__ZTAOh",emptyChat:"chat-area_emptyChat__Kcq0J",emptyChatIcon:"chat-area_emptyChatIcon__2jxD+",emptyChatText:"chat-area_emptyChatText__bUdhG",chatMenu:"chat-area_chatMenu__K57W1",attachmentLabel:"chat-area_attachmentLabel__Zt7sR"};var f=t(22927),C=t(43984),N=t(70579);function b(e){return e>=1048576?(e/1048576).toFixed(1)+" MB":e>=1024?(e/1024).toFixed(1)+" KB":e+" B"}const y=e=>{let{onFileChange:s,styles:t}=e;const[i,n]=(0,a.useState)(!1),r=(0,a.useRef)(),l=(0,a.useRef)(),o=e=>{const s=r.current,t=l.current;if(!s||!t)return;const a=s.contains(e.target),i=t.contains(e.target);a||i||n(!1)};return a.useEffect((()=>(document.addEventListener("click",o),()=>{document.removeEventListener("click",o)})),[]),(0,N.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,N.jsx)("button",{className:t.attachButton,type:"button","aria-label":"Attach file",ref:r,onClick:()=>n((e=>!e)),style:{padding:"6px 6px 6px 8px"},children:(0,N.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,N.jsx)("path",{d:"M18.0833 8.33333L9.16667 17.25C8.17221 18.2444 6.82407 18.8042 5.41667 18.8042C4.00926 18.8042 2.66112 18.2444 1.66667 17.25C0.672214 16.2556 0.112446 14.9074 0.112446 13.5C0.112446 12.0926 0.672214 10.7444 1.66667 9.75L10.5833 0.833329C11.2486 0.167998 12.1514 -0.149151 13.0833 0.0666624C14.0153 0.282476 14.8056 0.947998 15.25 1.83333C15.6944 2.71866 15.7361 3.75 15.3333 4.66666C14.9306 5.58333 14.1389 6.29166 13.1667 6.5L5.08333 14.5833C4.75 14.9167 4.31944 15.0833 3.83333 15.0833C3.34722 15.0833 2.91667 14.9167 2.58333 14.5833C2.25 14.25 2.08333 13.8194 2.08333 13.3333C2.08333 12.8472 2.25 12.4167 2.58333 12.0833L9.16667 5.5",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})})}),i&&(0,N.jsxs)("div",{ref:l,className:t.attachmentPopover,style:{position:"absolute",bottom:"40px",left:-200,zIndex:20,minWidth:220,background:"#fff",borderRadius:8,boxShadow:"0 4px 24px rgba(16,24,40,0.18)",padding:10},children:[(0,N.jsxs)("label",{className:t.attachmentLabel,style:{display:"flex",alignItems:"center",cursor:"pointer",gap:8,padding:"10px 6px"},children:[(0,N.jsx)("input",{type:"file",style:{display:"none"},onChange:e=>{s(e),n(!1)},accept:".pdf, .doc, .docx, .txt"}),(0,N.jsx)(f.A,{size:16,color:"#667085"}),(0,N.jsx)("span",{className:"font-16",children:"Document"})]}),(0,N.jsxs)("label",{className:t.attachmentLabel,style:{display:"flex",alignItems:"center",cursor:"pointer",gap:8,padding:"10px 6px"},children:[(0,N.jsx)("input",{type:"file",style:{display:"none"},onChange:e=>{s(e),n(!1)},accept:"image/*"}),(0,N.jsx)(C.A,{size:16,color:"#667085"}),(0,N.jsx)("span",{className:"font-16",children:"Photo "})]})]})]})};var w=t(58387),A=t(4258);const I=e=>{let{show:s,setShow:t,setMessage:i}=e;const n=e=>{const s=document.querySelector(".emoji-picker"),a=document.querySelector(".chat-emoji-button");!s||s.contains(e.target)||a.contains(e.target)||t(!1)};return a.useEffect((()=>(document.addEventListener("click",n),()=>{document.removeEventListener("click",n)})),[]),(0,N.jsxs)("div",{className:"chat-emoji-picker",children:[(0,N.jsx)("button",{type:"button",className:(0,w.A)(j.emojiButton,"chat-emoji-button"),onClick:()=>t((e=>!e)),tabIndex:-1,children:(0,N.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,N.jsx)("path",{d:"M10 18.3333C14.6024 18.3333 18.3334 14.6024 18.3334 10C18.3334 5.39763 14.6024 1.66667 10 1.66667C5.39765 1.66667 1.66669 5.39763 1.66669 10C1.66669 14.6024 5.39765 18.3333 10 18.3333Z",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),(0,N.jsx)("path",{d:"M6.66669 11.6667C6.66669 11.6667 7.91669 13.3333 10 13.3333C12.0834 13.3333 13.3334 11.6667 13.3334 11.6667",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),(0,N.jsx)("path",{d:"M7.5 7.5H7.50833",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),(0,N.jsx)("path",{d:"M12.5 7.5H12.5083",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]})}),s&&(0,N.jsx)("div",{className:"emoji-picker",style:{position:"absolute",bottom:"40px",right:0,zIndex:10},children:(0,N.jsx)(A.Ay,{onEmojiClick:e=>{i((s=>s+(e.emoji||""))),t(!1)},theme:"light"})})]})},k=()=>(0,N.jsxs)("div",{className:j.emptyChat,children:[(0,N.jsx)("div",{className:j.emptyChatIcon,children:(0,N.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"220",height:"171",viewBox:"0 0 220 171",fill:"none",children:[(0,N.jsx)("circle",{cx:"110",cy:"80",r:"80",fill:"#EAECF0"}),(0,N.jsx)("circle",{cx:"18",cy:"12",r:"8",fill:"#F2F4F7"}),(0,N.jsx)("circle",{cx:"198",cy:"142",r:"6",fill:"#F2F4F7"}),(0,N.jsx)("circle",{cx:"25",cy:"138",r:"10",fill:"#F2F4F7"}),(0,N.jsx)("circle",{cx:"210",cy:"46",r:"10",fill:"#F2F4F7"}),(0,N.jsx)("circle",{cx:"191",cy:"11",r:"7",fill:"#F2F4F7"}),(0,N.jsx)("path",{opacity:"0.7",d:"M140.356 4H75.0524C72.3887 4.00774 69.8364 5.06932 67.9528 6.95284C66.0693 8.83635 65.0077 11.3887 65 14.0524V20.7589C65.0077 23.4226 66.0693 25.975 67.9528 27.8585C69.8364 29.742 72.3887 30.8036 75.0524 30.8113H140.356L150.409 36.7694V14.0231C150.391 11.3651 149.326 8.82132 147.444 6.94454C145.561 5.06776 143.014 4.00961 140.356 4Z",fill:"#667085"}),(0,N.jsx)("path",{d:"M138.537 13.605H76.8355V15.2779H138.537V13.605Z",fill:"white"}),(0,N.jsx)("path",{d:"M138.537 19.5339H88.7074V21.2069H138.537V19.5339Z",fill:"white"}),(0,N.jsx)("path",{opacity:"0.15",d:"M75.0156 48.6416H140.32C142.983 48.6493 145.536 49.7109 147.419 51.5944C149.303 53.478 150.364 56.0303 150.372 58.694V65.3932C150.364 68.0569 149.303 70.6092 147.419 72.4928C145.536 74.3763 142.983 75.4378 140.32 75.4456H75.0156L64.9631 81.4037V58.6573C64.9786 55.9994 66.0438 53.4553 67.9267 51.5793C69.8096 49.7033 72.3576 48.6474 75.0156 48.6416Z",fill:"#667085"}),(0,N.jsx)("path",{opacity:"0.5",d:"M138.537 58.239H76.8355V59.912H138.537V58.239Z",fill:"#667085"}),(0,N.jsx)("path",{opacity:"0.5",d:"M105.452 64.175H76.8355V65.848H105.452V64.175Z",fill:"#667085"}),(0,N.jsx)("path",{opacity:"0.5",d:"M121.558 64.175H109.92V65.848H121.558V64.175Z",fill:"#667085"}),(0,N.jsx)("path",{opacity:"0.7",d:"M140.356 93.2759H75.0524C72.3887 93.2836 69.8364 94.3452 67.9528 96.2287C66.0693 98.1123 65.0077 100.665 65 103.328V110.027C65.0058 112.692 66.0668 115.245 67.9507 117.129C69.8346 119.013 72.3881 120.074 75.0524 120.08H140.356L150.409 126.038V103.292C150.39 100.635 149.323 98.093 147.441 96.2178C145.559 94.3426 143.013 93.2855 140.356 93.2759Z",fill:"#667085"}),(0,N.jsx)("path",{d:"M138.537 102.873H76.8355V104.546H138.537V102.873Z",fill:"white"}),(0,N.jsx)("path",{d:"M138.537 108.809H88.7074V110.482H138.537V108.809Z",fill:"white"}),(0,N.jsx)("path",{opacity:"0.15",d:"M75.0156 137.91H100.425C103.089 137.92 105.64 138.982 107.523 140.865C109.406 142.748 110.468 145.299 110.478 147.963V154.669C110.468 157.332 109.406 159.883 107.523 161.767C105.64 163.65 103.089 164.712 100.425 164.721H75.0156L64.9631 170.672V147.963C64.9709 145.299 66.0325 142.747 67.916 140.863C69.7995 138.979 72.3519 137.918 75.0156 137.91Z",fill:"#667085"}),(0,N.jsx)("path",{opacity:"0.5",d:"M80.1079 151.316C80.1079 151.896 79.9357 152.464 79.6132 152.946C79.2907 153.429 78.8324 153.805 78.2961 154.027C77.7598 154.249 77.1696 154.308 76.6003 154.194C76.0309 154.081 75.508 153.801 75.0975 153.391C74.687 152.981 74.4075 152.458 74.2942 151.888C74.181 151.319 74.2391 150.729 74.4613 150.192C74.6834 149.656 75.0596 149.198 75.5423 148.875C76.0249 148.553 76.5924 148.381 77.1729 148.381C77.9483 148.39 78.6893 148.702 79.2377 149.251C79.7861 149.799 80.0984 150.54 80.1079 151.316Z",fill:"#667085"}),(0,N.jsx)("path",{opacity:"0.5",d:"M86.0441 151.91C87.6853 151.91 89.0157 150.579 89.0157 148.938C89.0157 147.297 87.6853 145.967 86.0441 145.967C84.4028 145.967 83.0724 147.297 83.0724 148.938C83.0724 150.579 84.4028 151.91 86.0441 151.91Z",fill:"#667085"}),(0,N.jsx)("path",{opacity:"0.5",d:"M97.9162 154.874C97.9162 155.455 97.744 156.022 97.4215 156.505C97.099 156.988 96.6406 157.364 96.1043 157.586C95.568 157.808 94.9779 157.866 94.4086 157.753C93.8392 157.64 93.3163 157.36 92.9058 156.95C92.4953 156.539 92.2158 156.016 92.1025 155.447C91.9893 154.878 92.0474 154.288 92.2696 153.751C92.4917 153.215 92.8679 152.757 93.3506 152.434C93.8332 152.112 94.4007 151.939 94.9812 151.939C95.7596 151.939 96.5061 152.249 97.0565 152.799C97.6069 153.35 97.9162 154.096 97.9162 154.874Z",fill:"#667085"})]})}),(0,N.jsx)("p",{className:j.emptyChatText,children:"No chat group selected. Please choose a chat to start messaging."})]});var S=t(50565);const M="chat-header_chatHeader__NBNiP",$="chat-header_projectHeader__bh-f2",L="chat-header_projectReference__MYCPr",F="chat-header_projectNumber__ow5Ee",U="chat-header_userContainer__+afvT",E="chat-header_userAvatar__wKfvC",B="chat-header_userInfo__LWRrj",R="chat-header_userName__7Nea5",H="chat-header_statusContainer__HUydX",z="chat-header_statusIndicator__mg5ai",T="chat-header_statusText__mcVoz",W="chat-header_headerActions__ZniE4",D="chat-header_menuButton__pcyHE",P=e=>{var s,t,i,n,r;let{chat:l,userId:o,setParticipants:c,onlineUsers:d=[],setShowSidebar:u}=e;const h=a.useMemo((()=>{const e=(null===l||void 0===l?void 0:l.participants)||[];return null===e||void 0===e?void 0:e.reduce(((e,s)=>(e[s.id]=s.name,e)),{})}),[null===l||void 0===l?void 0:l.participants]);(0,a.useEffect)((()=>{c(h)}),[h,c]);const p=l.project_id||l.job_number,m=e=>{const s=e.participants.find((e=>e.id!==+o));return s?{name:(null===s||void 0===s?void 0:s.name)||"Unknown User",avatar:null!==s&&void 0!==s&&s.avatar&&"no_photo.png"!==(null===s||void 0===s?void 0:s.avatar)?s.avatar.startsWith("http")?s.avatar:`https://dev.memate.com.au/media/${s.avatar}`:"",id:s.id,status:null!==d&&void 0!==d&&d.includes(s.id)?"online":"offline"}:{name:"Unknown User",avatar:"",id:null,status:"offline"}};return(0,N.jsx)("div",{className:M,children:p?(0,N.jsxs)("div",{className:"d-flex w-100 justify-content-between align-items-center",children:[(0,N.jsxs)("div",{className:$,children:[(0,N.jsx)("span",{className:L,children:(null===l||void 0===l?void 0:l.name)||"Unknown"}),(0,N.jsx)("span",{className:F,children:(null===l||void 0===l?void 0:l.project_id)||l.job_number||"Unknown"})]}),(0,N.jsx)("div",{className:W,children:(0,N.jsx)("button",{className:D,onClick:()=>u((e=>!e)),children:(0,N.jsx)(S.A,{size:20,color:"#667085"})})})]}):(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("div",{className:U,children:[(0,N.jsx)("div",{className:E,children:null!==(s=m(l))&&void 0!==s&&s.avatar?(0,N.jsx)("img",{src:null===(t=m(l))||void 0===t?void 0:t.avatar,alt:"avatar"}):null===(i=m(l))||void 0===i||null===(n=i.name)||void 0===n?void 0:n.split(" ").map((e=>e[0])).join("").slice(0,2)}),(0,N.jsxs)("div",{className:B,children:[(0,N.jsx)("h2",{className:R,children:null===(r=m(l))||void 0===r?void 0:r.name}),(0,N.jsxs)("div",{className:H,children:[(0,N.jsx)("span",{className:z,"data-status":m(l).status}),(0,N.jsx)("span",{className:T,children:m(l).status})]})]})]}),(0,N.jsx)("div",{className:W,children:(0,N.jsx)("button",{className:D,onClick:()=>u((e=>!e)),children:(0,N.jsx)(S.A,{size:20,color:"#667085"})})})]})})};var Z=t(93202),V=t(56741),G=t(96141),O=t(94819),K=t(25721),Y=t(54972),q=t(55797);const J={chatInfoHeader:"chat-info-sidebar_chatInfoHeader__EJGoD",closeButton:"chat-info-sidebar_closeButton__F11xC",chatInfoContent:"chat-info-sidebar_chatInfoContent__LPT17",groupInfoAvatar:"chat-info-sidebar_groupInfoAvatar__qwdU8",scrollContainer:"chat-info-sidebar_scrollContainer__njhX1",participantsList:"chat-info-sidebar_participantsList__nm8XP",participantItem:"chat-info-sidebar_participantItem__dSQQf",participantAvatar:"chat-info-sidebar_participantAvatar__Rxfmr",participantName:"chat-info-sidebar_participantName__CQFtG",addParticipantAvatar:"chat-info-sidebar_addParticipantAvatar__h01WK",addParticipantButton:"chat-info-sidebar_addParticipantButton__oZGqt",circledesignstyle:"chat-info-sidebar_circledesignstyle__MmFQR",out:"chat-info-sidebar_out__+dukq",modal:"chat-info-sidebar_modal__9He2B",userContainer:"chat-info-sidebar_userContainer__1SFUL",contactItem:"chat-info-sidebar_contactItem__nRCMw",participantsFooter:"chat-info-sidebar_participantsFooter__B+Euk"};var Q=t(58027);const X=e=>{var s;let{chatId:t,userId:i,chatInfo:r,participants:o,closeSidebar:c,users:d,socket:u,refetchGroupChats:h}=e;const p=(0,n.Zp)(),[m,v]=a.useState(!1),[g,j]=a.useState(""),[f,C]=a.useState([]),[b,y]=a.useState([]),[A,I]=a.useState([]),[k,S]=a.useState(!1),[M,$]=a.useState(!1),L=(null===r||void 0===r?void 0:r.project_id)||(null===r||void 0===r?void 0:r.job_number),F=(null===r||void 0===r||null===(s=r.participants)||void 0===s?void 0:s.map((e=>({id:e.id,name:e.name,avatar:e.avatar&&"no_photo.png"!==e.avatar?e.avatar.startsWith("http")?e.avatar:`https://dev.memate.com.au/media/${e.avatar}`:""}))))||[],U=F.find((e=>e.id!==+i)),E=L?"":null===U||void 0===U?void 0:U.avatar,B=L?(null===r||void 0===r?void 0:r.name)||"Unknown Group":(null===U||void 0===U?void 0:U.name)||"Unknown User",R=()=>{v(!1),I([]),j(""),y(f)},H=()=>{0!==A.length&&(S(!0),u.emit("add_participant",{group_id:+t,user_id:+i,participant_id:A[0]},(e=>{"success"===e.status?(R(),h(),l.oR.success("Member added successfully")):l.oR.error("Failed to add member"),S(!1)})))};return(0,a.useEffect)((()=>{I([]),j("");const e=Object.keys(o),s=Object.values(d).filter((s=>!e.includes(String(s.id))));y(s||[]),C(s||[])}),[t,o,d]),(0,a.useEffect)((()=>{if(""===g.trim())return void y(f);const e=g.toLowerCase(),s=f.filter((s=>s.first_name.toLowerCase().includes(e)||s.last_name.toLowerCase().includes(e)||s.email.toLowerCase().includes(e)));y(s)}),[g,f]),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("div",{className:J.chatInfoSidebar,children:[(0,N.jsxs)("div",{className:J.chatInfoHeader,children:[(0,N.jsx)("button",{className:J.closeButton,onClick:c,children:(0,N.jsx)(V.A,{size:32})}),(0,N.jsx)("p",{className:"font-16 mb-0",children:L?"Group Info":"Contact Info"})]}),(0,N.jsxs)("div",{className:J.scrollContainer,children:[(0,N.jsxs)("div",{className:J.chatInfoContent,children:[(0,N.jsx)("div",{className:J.groupInfoAvatar,children:E?(0,N.jsx)("img",{src:E,alt:B}):(0,N.jsx)("div",{className:J.groupAvatarPlaceholder,children:B.split(" ").map((e=>e[0])).join("").slice(0,2)})}),(0,N.jsx)("p",{className:"mb-0",style:{fontSize:"20px"},children:B}),(0,N.jsx)("p",{className:"font-14 mb-0",children:L?(null===r||void 0===r?void 0:r.project_id)||(null===r||void 0===r?void 0:r.job_number):""})]}),(0,N.jsxs)("div",{className:J.participantsList,children:[(0,N.jsxs)("h3",{className:"font-14 ms-2 mb-2",style:{color:"var(--Gray-600, #344952)"},children:[Object.keys(o).length," members"]}),(0,N.jsxs)("ul",{className:"w-100 mb-3",children:[L&&(0,N.jsxs)("button",{className:J.addParticipantButton,onClick:()=>v(!0),children:[(0,N.jsx)("div",{className:J.addParticipantAvatar,children:(0,N.jsx)(G.A,{size:20,color:"#ffffff"})}),(0,N.jsx)("span",{className:J.participantName,children:"Add member"})]}),F.map((e=>{let{id:s,name:t,avatar:a}=e;return(0,N.jsxs)("li",{className:J.participantItem,children:[(0,N.jsx)("div",{className:J.participantAvatar,children:a?(0,N.jsx)("img",{src:a,alt:t}):t.split(" ").map((e=>e[0])).join("").slice(0,2)}),(0,N.jsx)("span",{className:J.participantName,children:t})]},s)}))]}),(0,N.jsx)("div",{className:J.participantsFooter,children:(0,N.jsxs)("button",{className:"danger-text-button",disabled:M,onClick:()=>{$(!0),u.emit("archive_chat_group",{group_id:t,user_id:i},(e=>{"success"===e.status?(c(),h(),p("/chat"),l.oR.success("Group archived successfully")):l.oR.error("Failed to archive group"),$(!1)}))},children:[(0,N.jsx)(O.A,{color:"#b42318",size:16,className:"me-1"})," Delete Group",M&&(0,N.jsx)(x.p,{style:{width:"16px",height:"16px"},className:"ms-2"})]})})]})]})]}),(0,N.jsxs)(q.l,{header:()=>(0,N.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,N.jsx)("div",{className:J.circledesignstyle,children:(0,N.jsx)("div",{className:J.out,children:(0,N.jsx)(Z.A,{size:24,color:"#17B26A"})})}),(0,N.jsx)("span",{style:{color:"344054",fontSize:"20px",fontWeight:600},children:"Add Member"})]}),footer:()=>(0,N.jsxs)("div",{className:"d-flex justify-content-end gap-3 pt-3",children:[(0,N.jsx)(_.$,{label:"Cancel",className:"outline-button",disabled:k,onClick:R}),(0,N.jsx)(_.$,{label:"Add",loading:k,disabled:k||0===A.length,className:"solid-button",onClick:H})]}),modal:!0,className:`${J.modal} custom-modal`,visible:m,onHide:R,children:[(0,N.jsx)("div",{className:"search-header w-100",children:(0,N.jsxs)("div",{className:"searchGroupFilter d-flex align-items-center",style:{gap:"10px",minWidth:"100%",maxWidth:"100%"},children:[(0,N.jsx)(K.A,{color:"#98A2B3",size:20}),(0,N.jsx)("input",{id:"search-box",placeholder:"Search",value:g,className:"pl-2",onChange:e=>j(e.target.value)})]})}),(0,N.jsx)("div",{className:J.userContainer,children:b.map((e=>(0,N.jsxs)("div",{className:(0,w.A)("d-flex align-items-center justify-content-start gap-2",J.contactItem),children:[(0,N.jsx)(Y.S,{inputId:`checkbox-${e.id}`,disabled:A.length,checked:A.includes(e.id),onChange:()=>I((s=>s.includes(e.id)?s.filter((s=>s!==e.id)):[...s,e.id]))}),(0,N.jsxs)("label",{htmlFor:`checkbox-${e.id}`,className:"d-flex align-items-center gap-1 cursor-pointer",children:[(0,N.jsx)(Q.h,{has_photo:e.has_photo,photo:e.photo,is_business:!1}),(0,N.jsxs)("div",{className:"d-flex flex-column",children:[(0,N.jsxs)("span",{className:"font-14",children:[e.first_name," ",e.last_name]}),(0,N.jsx)("span",{className:"font-12 text-muted",children:e.email})]})]})]},e.id)))})]})]})};var ee=t(60867),se=t(55850),te=t(96956);const ae="message-list_messageGroup__ErZtK",ie="message-list_dateHeader__eLUx6",ne="message-list_message__3UO-2",re="message-list_sent__lna8g",le="message-list_messageContent__-bYu5",oe="message-list_messageTime__GG1x5",ce="message-list_received__QjePJ",de="message-list_messageAttachment__9Xcs9",ue="message-list_messageContentSent__uivln",he="message-list_messageText__JpeJm",pe="message-list_emptyMessages__Zcq-I",me="message-list_typingIndicator__GbJ55",ve="message-list_typingDot__BlFvs",_e="message-list_userAvatar__UkK5U",ge="message-list_messageSenderName__UmAeW",xe="message-list_messageTimeSent__7OaoW";var je=t(11281),fe=t(33296),Ce=t(54967),Ne=t(75329),be=t(35475);const ye="file-attachment_fileName__hKqo3",we="file-attachment_fileSize__JE1wZ",Ae="file-attachment_fileAttachment__po3Wp",Ie="file-attachment_downloadButton__CRO8A",ke=e=>{let{file:s}=e;if(!s)return null;const{url:t,type:a}=s,i=t.split("?")[0],n=i.substring(i.lastIndexOf("/")+1),r=a.split("-")[0]||"",l=a.split("-")[1]||"";return(0,N.jsxs)("div",{className:(0,w.A)(Ae),style:{display:"flex",alignItems:"center",marginBottom:0,gap:12,padding:10,width:"508px",marginLeft:"auto",position:"relative"},children:[(0,je.I)(r),(0,N.jsxs)("div",{style:{width:"80%",textAlign:"left"},children:[(0,N.jsx)("div",{className:(0,w.A)(ye,"ellipsis-width"),children:n}),(0,N.jsx)("div",{className:(0,w.A)(we),children:l})]}),(0,N.jsx)(be.N_,{to:t,target:"_blank",className:(0,w.A)(Ie),children:(0,N.jsx)(Ne.A,{size:16,color:"var(--gray-600, #475467)"})})]})},Se=e=>{const s=new Date(1e3*e),t=s.toLocaleString("en-US",{weekday:"long"});let a=s.getHours();const i=a>=12?"pm":"am";return a=a%12||12,`${t} ${a}:${s.getMinutes().toString().padStart(2,"0")}${i}`},Me=(e,s)=>e.getFullYear()===s.getFullYear()&&e.getMonth()===s.getMonth()&&e.getDate()===s.getDate(),$e=e=>{var s,t,i,n,r,l,o,c,d;let{messages:u=[],isTyping:h={},loading:p=!0,currentUserId:m,participants:v,chatId:_,attachmentFile:g,setAttachmentFile:x}=e;const j=(0,a.useRef)(null),f=(0,a.useMemo)((()=>Array.isArray(u)?(null!==g&&void 0!==g&&g.file&&x(null),u.filter((e=>null===e||void 0===e?void 0:e.sent_at)).map(((e,s)=>{const t=Number(e.sent_at),a=new Date(1e3*t),i=e.sender_photo&&"/media/no_photo.png"!==e.sender_photo?e.sender_photo.startsWith("http")?e.sender_photo:`https://dev.memate.com.au${e.sender_photo}`:"";return{id:e.id||`msg-${s}`,text:e.message||"",sender:e.sender||"Unknown",photo:i,timestamp:t,sendingTime:Se(t),isOwn:m===e.sender,attachment:e.file_url?{url:e.file_url,type:e.file_type}:void 0,displayDate:a,fullDate:a.toLocaleDateString("en-US",{dateStyle:"medium"})}})).sort(((e,s)=>e.timestamp-s.timestamp))):(console.warn("Messages is not an array:",u),[])),[u,m]),C=(0,a.useMemo)((()=>{const e={},s=new Date,t=new Date;return t.setDate(s.getDate()-1),f.forEach((a=>{let i=a.fullDate;Me(a.displayDate,s)?i="Today":Me(a.displayDate,t)&&(i="Yesterday"),e[i]||(e[i]=[]),e[i].push(a)})),e}),[f]),y=(0,a.useMemo)((()=>Object.entries(C).sort(((e,s)=>{let[,t]=e,[,a]=s;return t[0].timestamp-a[0].timestamp})).map((e=>{let[s]=e;return s}))),[C]);return(0,a.useEffect)((()=>{(()=>{var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"auto"})})()}),[f,g]),(0,N.jsxs)(N.Fragment,{children:[y.map((e=>(0,N.jsxs)("div",{className:ae,children:[(0,N.jsx)("div",{className:(0,w.A)(ie,"dividerContainer"),children:(0,N.jsx)(te.c,{children:(0,N.jsx)("span",{children:e})})}),C[e].map((e=>(0,N.jsxs)("div",{className:(0,w.A)(ne,e.isOwn?re:ce),children:[(0,N.jsxs)("div",{className:(0,w.A)("w-100 d-flex align-items-center gap-2 justify-content-between"),children:[e.isOwn?(0,N.jsx)("span",{className:ge,children:"You"}):(0,N.jsxs)("div",{className:"d-flex gap-2",children:[(0,N.jsx)("div",{className:_e,children:(0,N.jsx)(Ce.dg,{has_photo:e.photo,photo:e.photo,name:(null===v||void 0===v?void 0:v[e.sender])||"Unknown"})}),(0,N.jsx)("span",{className:ge,children:(null===v||void 0===v?void 0:v[e.sender])||"Unknown"})]}),(0,N.jsx)("span",{className:(0,w.A)(oe,{[xe]:!e.isOwn}),children:e.sendingTime})]}),e.attachment?(0,N.jsx)("div",{className:(0,w.A)(de,{[ue]:!e.isOwn}),children:(0,N.jsx)(ke,{file:e.attachment})}):(0,N.jsx)("div",{className:(0,w.A)(le,{[ue]:!e.isOwn}),children:(0,N.jsx)("p",{className:he,children:e.text})})]},e.id)))]},e))),0===f.length&&!p&&(0,N.jsx)("div",{className:pe,children:(0,N.jsx)("p",{children:"No messages yet. Start the conversation!"})}),(null===g||void 0===g?void 0:g.file)&&(null===g||void 0===g?void 0:g.chatId)===_&&(0,N.jsxs)("div",{style:{display:"flex",alignItems:"center",background:"#F9FAFB",borderRadius:8,padding:12,marginBottom:0,gap:12,border:"1px solid #EAECF0",width:"508px",marginLeft:"auto",position:"relative"},children:[(0,je.I)(g.file.name.split(".").pop()),(0,N.jsxs)("div",{style:{flex:1,textAlign:"left"},children:[(0,N.jsx)("div",{style:{fontWeight:600,color:"#101828",fontSize:16,marginBottom:2},children:g.file.name}),(0,N.jsx)("div",{style:{color:"#667085",fontSize:14},children:b(g.file.size)})]}),null!==g&&void 0!==g&&g.error?(0,N.jsx)(ee.A,{color:"#F04438",size:20}):100==(null===g||void 0===g?void 0:g.progress)?(0,N.jsx)(se.A,{color:"#12B76A",size:20}):(0,N.jsx)(fe.A,{percentage:parseInt(null===g||void 0===g?void 0:g.progress)||0,size:30,color:"#158ECC"}),(0,N.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",right:"-6px",top:"-8px",background:"#d4d5d7ff",borderRadius:"50%",padding:"2px",cursor:"pointer"},onClick:()=>x({}),children:(0,N.jsx)(V.A,{size:18,color:"#667085"})})]}),h.isTyping&&(0,N.jsxs)("div",{className:(0,w.A)(ne,ce),children:[(0,N.jsx)("div",{className:(0,w.A)("w-100 d-flex align-items-center gap-2 justify-content-between"),children:(0,N.jsxs)("div",{className:"d-flex gap-2",children:[(0,N.jsx)("div",{className:_e,children:null!==h&&void 0!==h&&null!==(s=h.user)&&void 0!==s&&s.has_photo?(0,N.jsx)(Ce.dg,{has_photo:null===h||void 0===h||null===(t=h.user)||void 0===t?void 0:t.has_photo,photo:null===h||void 0===h||null===(i=h.user)||void 0===i?void 0:i.photo,name:`${null===h||void 0===h||null===(n=h.user)||void 0===n?void 0:n.first_name} ${null===h||void 0===h||null===(r=h.user)||void 0===r?void 0:r.last_name}`}):(0,N.jsx)(Ce.fr,{name:`${null===h||void 0===h||null===(l=h.user)||void 0===l?void 0:l.first_name} ${null===h||void 0===h||null===(o=h.user)||void 0===o?void 0:o.last_name}`})}),(0,N.jsxs)("span",{className:ge,children:[null===h||void 0===h||null===(c=h.user)||void 0===c?void 0:c.first_name," ",null===h||void 0===h||null===(d=h.user)||void 0===d?void 0:d.last_name]})]})}),(0,N.jsxs)("div",{className:me,children:[(0,N.jsx)("div",{className:ve}),(0,N.jsx)("div",{className:ve}),(0,N.jsx)("div",{className:ve})]})]}),(0,N.jsx)("div",{ref:j})]})},Le=e=>{let{currentChat:s,socket:t,userId:i,chatId:r,onlineUsers:o=[],setChatData:c,users:d,updatePrivateGroupChatId:u,refetchGroupChats:h}=e;const m=(0,n.Zp)(),f=localStorage.getItem("access_token"),[C,w]=(0,a.useState)(""),[A,S]=(0,a.useState)(!1),[M,$]=(0,a.useState)({}),[L,F]=(0,a.useState)([]),[U,E]=(0,a.useState)({}),[B,R]=(0,a.useState)(1),[H]=(0,a.useState)(20),[z,T]=(0,a.useState)(!1),[W,D]=(0,a.useState)(!0),[Z,V]=(0,a.useState)(!1),[G,O]=(0,a.useState)(null),K=(0,a.useRef)(null),Y=(0,a.useRef)(null),q=(0,a.useRef)(0),J=(0,a.useRef)(null),[Q,ee]=(0,a.useState)(!1),se=(0,a.useCallback)(((e,s,t)=>{F((s=>{const a=e.filter((e=>!s.some((s=>s.id===e.id))));return 1===t?a:[...a,...s]})),D(t<(s||1)),T(!1)}),[]);(0,a.useEffect)((()=>{r&&i&&t&&(null===r||void 0===r||!r.startsWith("private_group"))&&(T(!0),Y.current&&B>1&&(q.current=Y.current.scrollHeight),t.emit("get_group_messages",{user_id:i,group_id:r,page:B,page_size:H},(e=>{e&&"success"===e.status&&e.messages&&se(e.messages,e.total_pages,B)})))}),[r,i,t,B,H,se]),(0,a.useEffect)((()=>{var e;if(t&&!z&&s&&i&&!Number(r)&&null!==s&&void 0!==s&&null!==(e=s.participants)&&void 0!==e&&e.length&&null!==r&&void 0!==r&&r.startsWith("private_group")){const e=s.participants.map((e=>e.id)).filter((e=>e!==i)),a="Private Chat";t.emit("create_chat_group",{name:a,user_id:i,participants:e,project_id:null,job_id:null},(e=>{"success"===e.status&&e.chat_group_id?(T(!0),u(r,e.chat_group_id)):(T(!1),console.log("Error during creation chat group: ",e),l.oR.error("Could not start chat. Please try again."))}))}}),[r,i,t,s,m,z]);(0,a.useEffect)((()=>{if(!t||!r||null!==r&&void 0!==r&&r.startsWith("private_group"))return;const e=e=>{e.chat_group==r&&F((s=>s.some((s=>s.id==e.id))?s:[e,...s])),c((s=>{var t;const a={...s[e.chat_group],last_message:e,unread_count:((null===(t=s[e.chat_group])||void 0===t?void 0:t.unread_count)||0)+1};return{...s,[e.chat_group]:a}}))};return t.on("new_message",e),t.on("typing",(e=>{(null===e||void 0===e?void 0:e.group_id)===r&&$({isTyping:!0,user:d[e.user_id]})})),t.on("stop_typing",(e=>{(null===e||void 0===e?void 0:e.group_id)===r&&$({})})),()=>{t.off("new_message",e)}}),[t,r]),(0,a.useEffect)((()=>{if(t&&r&&(null===r||void 0===r||!r.startsWith("private_group")))return t.emit("join_group",{group_id:r},(e=>{"success"===e.status?console.log("Joined group successfully"):console.log("Failed to join group: ",e)})),()=>{t.emit("leave_group",{group_id:r})}}),[t,r]),(0,a.useEffect)((()=>{const e=Y.current;if(e)if(1===B&&K.current)K.current.scrollIntoView({behavior:"auto"}),q.current=0;else if(B>1&&q.current){const s=e.scrollHeight;e.scrollTop=s-q.current}}),[L,B]);const te=(e,a)=>{if((C.trim()||e)&&s&&t&&i&&!A){const s={user_id:i,chat_group_id:r,message:C.trim(),file_url:e,file_type:a};S(!0),t.emit("send_message",s,(e=>{"success"===e.status?(e=>{var s;(null===e||void 0===e||null===(s=e.sent_message)||void 0===s?void 0:s.chat_group)==r&&(F((s=>s.some((s=>s.id===e.message_id))?s:[e.sent_message,...s])),S(!1),w(""),q.current=0,setTimeout((()=>{J.current&&J.current.focus()}),500),c((s=>{var t,a;const i={...s[null===e||void 0===e||null===(t=e.sent_message)||void 0===t?void 0:t.chat_group],last_message:null===e||void 0===e?void 0:e.sent_message};return{...s,[null===e||void 0===e||null===(a=e.sent_message)||void 0===a?void 0:a.chat_group]:i}})))})(e):(S(!1),l.oR.error("Failed to send message:"))}))}};let ae;const ie=(0,a.useMemo)((()=>v()(((e,s)=>{t&&e&&s&&t.emit("typing",{group_id:e,user_id:s})}),2e3)),[t]),ne=async e=>{if(e&&r)try{var s,t,a;const i=null===e||void 0===e||null===(s=e.name)||void 0===s?void 0:s.split(".")[0],n=null===e||void 0===e||null===(t=e.name)||void 0===t||null===(a=t.split("."))||void 0===a?void 0:a.pop(),o=`${i}-${Date.now()}.${n}`,c=b(e.size),d=await p.A.post(`https://dev.memate.com.au/api/v1/chat/upload/${r}/`,{filename:o},{headers:{Authorization:`Bearer ${f}`}}),{url:u}=d.data;if(!u)return O((e=>({...e,progress:0,error:!0}))),void l.oR.error("Failed to get upload URL. Please try again.");await(async(e,s,t,a)=>p.A.put(s,e,{headers:{"Content-Type":""},onUploadProgress:e=>{const s=Math.round(e.loaded/e.total*100);O((e=>({...e,progress:s})))}}).then((()=>{O((e=>({...e,progress:100,success:!0})));const e=s.split("?")[0]||"";te(e,`${t}-${a}`)})).catch((e=>{console.log("Error uploading to S3: ",e),O((e=>({...e,progress:0,error:!0})))})))(e,u,n,c)}catch(i){O((e=>({...e,progress:0,error:!0}))),console.error("Error uploading file:",i),l.oR.error("Failed to upload file. Please try again.")}},re=(0,a.useCallback)((()=>{0===Y.current.scrollTop&&W&&!z&&R((e=>e+1))}),[W,z]);return(0,a.useEffect)((()=>{const e=Y.current;if(e)return e.addEventListener("scroll",re),()=>e.removeEventListener("scroll",re)}),[re,L]),(0,a.useEffect)((()=>{J.current&&J.current.focus(),q.current=0,R(1),F([]),D(!0),T(!1)}),[r]),(0,N.jsxs)("div",{className:"d-flex w-100 h-100",children:[(0,N.jsx)("div",{className:j.chatArea,children:s?(0,N.jsxs)("div",{className:j.chatContent,children:[(0,N.jsx)(P,{chat:s,userId:i,setParticipants:E,onlineUsers:o,setShowSidebar:ee}),(0,N.jsxs)("div",{className:j.chatBodyArea,children:[(0,N.jsxs)("div",{className:j.messagesContainer,ref:Y,children:[z&&(0,N.jsx)("div",{className:j.loadingContainer,children:(0,N.jsx)(x.p,{style:{width:"16px",height:"16px"}})}),(0,N.jsx)($e,{messages:L,isTyping:M,loading:z,currentUserId:i,chatId:r,participants:U,attachmentFile:G,setAttachmentFile:O}),(0,N.jsx)("div",{ref:K})]}),(0,N.jsx)("div",{className:j.messageInputContainer,children:(0,N.jsxs)("div",{className:"position-relative w-100",children:[(0,N.jsx)(g.Z,{placeholder:"Send a message...",value:C,onChange:e=>{w(e.target.value),ie(r,i),clearTimeout(ae),ae=setTimeout((()=>{t&&r&&i&&t.emit("stop_typing",{group_id:r,user_id:i})}),2e3)},autoFocus:!0,ref:J,disabled:A||(null===r||void 0===r?void 0:r.startsWith("private_group")),onKeyUp:e=>{"Enter"!==e.key||e.shiftKey||te()},className:j.messageInput}),(0,N.jsxs)("div",{className:j.messageInputIcons,children:[A&&(0,N.jsx)(x.p,{style:{width:"20px",height:"20px"}}),(0,N.jsx)("div",{className:j.attachWrapper,style:{position:"relative",display:"inline-block"},children:(0,N.jsx)(y,{onFileChange:e=>{const s=e.target.files[0];s&&(O({file:s,chatId:r,error:!1,progress:0}),ne(s))},styles:j,file:G,onRemoveFile:()=>O(null)})}),(0,N.jsx)(I,{show:Z,setShow:V,setMessage:w}),(0,N.jsx)(_.$,{className:j.sendButton,onClick:()=>te(),disabled:!C.trim()||A,children:"Send"})]})]})})]})]}):(0,N.jsx)(k,{})}),(0,N.jsx)("div",{style:Q?{display:"block"}:{display:"none"},className:j.chatSidebar,children:(0,N.jsx)(X,{chatId:r,userId:i,chatInfo:s,closeSidebar:()=>ee(!1),participants:U,users:d,socket:t,refetchGroupChats:h})})]})};var Fe=t(28676),Ue=t(74532),Ee=t(21080),Be=t(72052);const Re="chat-sidebar_chatSidebar__zzpNg",He="chat-sidebar_sidebarHeader__R0eP2",ze="chat-sidebar_headerFirstRow__QMmIk",Te="chat-sidebar_unreadCount__83KNP",We="chat-sidebar_sidebarTitle__3Np6U",De="chat-sidebar_archivedLabel__AGzqF",Pe="chat-sidebar_headerSecondRow__4diKO",Ze="chat-sidebar_headerThirdRow__9ynMU",Ve="chat-sidebar_tabButton__gHzm6",Ge="chat-sidebar_active__vtn5W",Oe="chat-sidebar_listContainer__A3eW3",Ke="project-list_projectList__9Df50",Ye="project-list_projectItem__eBp-6",qe="project-list_active__jFy-d",Je="project-list_projectHeader__OU-Of",Qe="project-list_projectInfo__LoSIl",Xe="project-list_projectTitleRow__EhGqR",es="project-list_projectName__w7dZI",ss="project-list_projectRef__Fhg0N",ts="project-list_messagePreviewContainer__uYIHz",as="project-list_userInfo__2ZVWv",is="project-list_lastMessage__iWohN",ns="project-list_lastMessageTime__HD-aX",rs="project-list_archivedBadge__uJ+Vf",ls="project-list_unreadCount__RJKbs",os=e=>{let{chatData:s,searchQuery:t,showArchived:a,userId:i}=e;const r=(0,n.zy)(),l=new URLSearchParams(r.search).get("id"),o=Object.entries(s).filter((e=>{let[,s]=e;return s.project_id||s.job_number})).sort(((e,s)=>{var t,a;const i=(null===(t=e[1].last_message)||void 0===t?void 0:t.sent_at)||0;return((null===(a=s[1].last_message)||void 0===a?void 0:a.sent_at)||0)-i})).filter((e=>{var s;let[,i]=e;const n=((null===i||void 0===i?void 0:i.name)||"Unknown Group").toLowerCase().includes(t.toLowerCase()),r=a||!((null===(s=i.archived_by)||void 0===s?void 0:s.length)>0);return n&&r}));return(0,N.jsx)("div",{className:Ke,children:o.map((e=>{var s,t;let[a,n]=e;const r=(e=>{var s;return(null===e||void 0===e||null===(s=e.last_message)||void 0===s?void 0:s.message)||null})(n),o=(e=>{if(!e)return"";const s=Date.now()-1e3*e,t=Math.floor(s/1e3),a=Math.floor(s/6e4),i=Math.floor(s/36e5),n=Math.floor(s/864e5),r=Math.floor(s/6048e5),l=Math.floor(s/2592e6),o=Math.floor(s/31536e6);return t<60?`${t} second${1!==t?"s":""} ago`:a<60?`${a} minute${1!==a?"s":""} ago`:i<24?`${i} hour${1!==i?"s":""} ago`:n<7?`${n} day${1!==n?"s":""} ago`:r<4?`${r} week${1!==r?"s":""} ago`:l<12?`${l} month${1!==l?"s":""} ago`:`${o} year${1!==o?"s":""} ago`})(null===n||void 0===n||null===(s=n.last_message)||void 0===s?void 0:s.sent_at),c=(e=>(null===e||void 0===e?void 0:e.unread_count)||0)(n),d=(e=>{const s=null===e||void 0===e?void 0:e.last_message;if(!s)return"";const t=e.participants.find((e=>e.id===s.sender));return t.id===i?"You: ":`${null===t||void 0===t?void 0:t.name}: `||"Unknown Sender: `"})(n),u=null===n||void 0===n?void 0:n.name,h=(null===n||void 0===n?void 0:n.job_number)||(null===n||void 0===n?void 0:n.project_id);return(0,N.jsxs)(be.N_,{to:`?id=${a}`,className:(0,w.A)(Ye,{[qe]:l==a}),children:[(0,N.jsxs)("div",{className:Je,children:[(0,N.jsxs)("div",{className:Qe,children:[(0,N.jsx)("div",{className:Xe,children:(0,N.jsx)("span",{className:es,children:u})}),(0,N.jsx)("span",{className:ss,children:h})]}),(0,N.jsxs)("div",{className:"d-flex flex-column gap-2",children:[(0,N.jsx)("span",{className:ns,children:o}),(0,N.jsxs)("div",{className:"d-flex align-items-center justify-content-end gap-2",children:[null!==(t=n.archived_by)&&void 0!==t&&t.length?(0,N.jsx)("span",{className:rs,children:"Archived"}):null,c>0&&(0,N.jsx)("span",{className:ls,children:c})]})]})]}),(0,N.jsxs)("div",{className:ts,children:[(0,N.jsx)("div",{className:as}),(0,N.jsx)("p",{className:(0,w.A)(is,"text-start"),children:r?`${d} ${r?r.substring(0,30):""}`:"No messages yet"})]})]},a)}))})},cs={userList:"user-list_userList__Tj5r8",userItem:"user-list_userItem__2vBej",active:"user-list_active__ylmYf",userItemContent:"user-list_userItemContent__a0bK2",userAvatarWrapper:"user-list_userAvatarWrapper__+CzoZ",onlineIndicator:"user-list_onlineIndicator__kRi92",userAvatar:"user-list_userAvatar__EhrPu",userInfo:"user-list_userInfo__tRZdB",userName:"user-list_userName__pjTE0",lastMessage:"user-list_lastMessage__LFBTg",lastMessageTime:"user-list_lastMessageTime__+6gj+",unreadCount:"user-list_unreadCount__2vYTB"},ds=e=>{let{chatData:s,searchQuery:t,showArchived:a,userId:i,onlineUsers:r}=e;const l=(0,n.zy)(),o=new URLSearchParams(l.search).get("id"),c=Object.entries(s).filter((e=>{let[,s]=e;return!s.project_id&&!s.job_number})).sort(((e,s)=>{var t,a;const i=(null===(t=e[1].last_message)||void 0===t?void 0:t.sent_at)||0;return((null===(a=s[1].last_message)||void 0===a?void 0:a.sent_at)||0)-i})).filter((e=>{let[,s]=e;const n=s.participants.find((e=>e.id!==+i)),r=((null===n||void 0===n?void 0:n.name)||(null===s||void 0===s?void 0:s.name)||"Unknown User").toLowerCase().includes(t.toLowerCase()),l=!!a||!s.archived;return r&&l}));return(0,N.jsx)("div",{className:cs.userList,children:c.map((e=>{var s,t;let[a,n]=e;const l=(e=>(null===e||void 0===e?void 0:e.last_message)||null)(n),c=(e=>{if(!e)return"";const s=Date.now()-1e3*e,t=Math.floor(s/1e3),a=Math.floor(s/6e4),i=Math.floor(s/36e5),n=Math.floor(s/864e5),r=Math.floor(s/6048e5),l=Math.floor(s/2592e6),o=Math.floor(s/31536e6);return t<60?`${t} second${1!==t?"s":""} ago`:a<60?`${a} minute${1!==a?"s":""} ago`:i<24?`${i} hour${1!==i?"s":""} ago`:n<7?`${n} day${1!==n?"s":""} ago`:r<4?`${r} week${1!==r?"s":""} ago`:l<12?`${l} month${1!==l?"s":""} ago`:`${o} year${1!==o?"s":""} ago`})(null===n||void 0===n||null===(s=n.last_message)||void 0===s?void 0:s.sent_at),d=(e=>(null===e||void 0===e?void 0:e.unread_count)||0)(n),u=(e=>{const s=null===e||void 0===e?void 0:e.last_message;if(!s)return"";const t=e.participants.find((e=>e.id===s.sender));return(null===t||void 0===t?void 0:t.id)===i?"You: ":null!==t&&void 0!==t&&t.name?`${null===t||void 0===t?void 0:t.name}: `:""})(n),h=(e=>{const s=e.participants.find((e=>e.id!==+i));return null!==s&&void 0!==s&&s.avatar&&"no_photo.png"!==(null===s||void 0===s?void 0:s.avatar)?s.avatar.startsWith("http")?s.avatar:`https://dev.memate.com.au/media/${s.avatar}`:""})(n),p=(e=>{const s=e.participants.find((e=>e.id!==+i));return(null===s||void 0===s?void 0:s.name)||(null===e||void 0===e?void 0:e.name)||"Unknown User"})(n),m=(e=>{const s=e.participants.find((e=>e.id!==+i));return s&&null!==r&&void 0!==r&&r.includes(s.id)?"online":"offline"})(n);return(0,N.jsx)(be.N_,{to:`?id=${a}`,className:(0,w.A)(cs.userItem,{[cs.active]:o==a}),children:(0,N.jsxs)("div",{className:cs.userItemContent,children:[(0,N.jsxs)("div",{className:cs.userAvatarWrapper,children:["online"===m&&(0,N.jsx)("div",{className:cs.onlineIndicator}),(0,N.jsx)("div",{className:cs.userAvatar,children:h?(0,N.jsx)("img",{src:h,alt:p}):(0,N.jsx)("span",{className:cs.avatarPlaceholder,children:null===p||void 0===p?void 0:p.split(" ").map((e=>e[0])).join("").slice(0,2)})})]}),(0,N.jsxs)("div",{className:cs.userInfo,children:[(0,N.jsx)("span",{className:cs.userName,children:p}),(0,N.jsx)("p",{className:cs.lastMessage,children:null!==l&&void 0!==l&&l.message?`${u} ${null!==l&&void 0!==l&&l.message?null===l||void 0===l||null===(t=l.message)||void 0===t?void 0:t.substring(0,30):""}`:"No messages yet"})]}),(0,N.jsxs)("div",{className:"d-flex flex-column align-items-end gap-1",children:[(0,N.jsx)("span",{className:cs.lastMessageTime,children:c||""}),d>0&&(0,N.jsx)("span",{className:cs.unreadCount,children:d>9?"9+":d})]})]})},a)}))})},us=e=>{let{activeTab:s,setActiveTab:t,archivedVisible:i,setArchivedVisible:n,chatData:r,userId:l,onlineUsers:o}=e;const[c,d]=(0,a.useState)(""),u=Object.entries(r).filter((e=>{let[,s]=e;return!s.project_id&&!s.job_number})),h=Object.entries(r).filter((e=>{let[,s]=e;return s.project_id||s.job_number})).filter((e=>{var s;let[,t]=e;const a=((null===t||void 0===t?void 0:t.name)||"Unknown Group").toLowerCase().includes(c.toLowerCase()),n=i||!((null===(s=t.archived_by)||void 0===s?void 0:s.length)>0);return a&&n}));return(0,N.jsxs)("div",{className:Re,children:[(0,N.jsxs)("div",{className:He,children:[(0,N.jsxs)("div",{className:ze,children:[(0,N.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,N.jsx)("h1",{className:We,children:"Messages"}),(0,N.jsxs)("div",{className:Te,children:[(0,N.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"9",viewBox:"0 0 8 9",fill:"none",children:(0,N.jsx)("circle",{cx:"4",cy:"4.5",r:"3",fill:"#17B26A"})}),(0,N.jsx)("span",{children:"0"})]})]}),(0,N.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,N.jsx)(Ee.H,{checked:i,onChange:e=>n(e.value)}),(0,N.jsx)("h1",{className:De,children:"Archived"})]})]}),(0,N.jsx)("div",{className:Pe,children:(0,N.jsxs)(Fe.C,{iconPosition:"left",className:"border w-100 rounded text-start",children:[(0,N.jsx)(Ue.m,{style:{position:"relative"},children:(0,N.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:(0,N.jsx)("path",{d:"M14.6777 12.9299C15.6661 11.5841 16.25 9.92275 16.25 8.125C16.25 3.63769 12.6123 0 8.125 0C3.63769 0 0 3.63769 0 8.125C0 12.6123 3.63769 16.25 8.125 16.25C9.92323 16.25 11.585 15.6658 12.9309 14.6769L12.9299 14.6777C12.9667 14.7277 13.0078 14.7756 13.053 14.8208L17.8661 19.6339C18.3543 20.122 19.1457 20.122 19.6339 19.6339C20.122 19.1457 20.122 18.3543 19.6339 17.8661L14.8208 13.053C14.7756 13.0078 14.7277 12.9667 14.6777 12.9299ZM15 8.125C15 11.922 11.922 15 8.125 15C4.32804 15 1.25 11.922 1.25 8.125C1.25 4.32804 4.32804 1.25 8.125 1.25C11.922 1.25 15 4.32804 15 8.125Z",fill:"#98A2B3"})})}),(0,N.jsx)(Be.S,{placeholder:"Search",style:{padding:"10px 10px 10px 20px"},value:c,onChange:e=>{d(e.target.value)}})]})}),(0,N.jsxs)("div",{className:Ze,children:[(0,N.jsxs)("div",{className:(0,w.A)(Ve,{[Ge]:"users"===s}),onClick:()=>t("users"),children:[(0,N.jsx)("span",{children:"Users"}),(0,N.jsx)("div",{children:(null===u||void 0===u?void 0:u.length)||0})]}),(0,N.jsxs)("div",{className:(0,w.A)(Ve,{[Ge]:"projects"===s}),onClick:()=>t("projects"),children:[(0,N.jsx)("span",{children:"Projects"}),(0,N.jsx)("div",{children:(null===h||void 0===h?void 0:h.length)||0})]})]})]}),(0,N.jsx)("div",{className:Oe,children:"users"===s?(0,N.jsx)(ds,{chatData:r,searchQuery:c,showArchived:i,userId:l,onlineUsers:o}):(0,N.jsx)(os,{chatData:r,searchQuery:c,showArchived:i,userId:l})})]})},hs=()=>{var e;const{session:s}=(0,d.As)(),t=null===s||void 0===s?void 0:s.desktop_user_id,i=null===s||void 0===s||null===(e=s.organization)||void 0===e?void 0:e.id,{trialHeight:p}=(0,u.$)(),m=(0,n.zy)(),v=(0,n.Zp)(),_=new URLSearchParams(m.search).get("id"),[g,x]=(0,a.useState)(!0),[j,f]=(0,a.useState)("users"),[C,b]=(0,a.useState)(!1),[y,w]=(0,a.useState)({}),[A,I]=(0,a.useState)(null),[k,S]=(0,a.useState)([]),[M,$]=(0,a.useState)({}),L=(0,a.useRef)(null);return(0,a.useEffect)((()=>{const e=(0,r.io)("https://chatd.memate.com.au",{transports:["websocket"],autoConnect:!0});return L.current=e,t?i?(e.emit("register_user",{user_id:t,org_id:i},(e=>{"success"===e.status?console.log("User registered successfully"):l.oR.error("Failed to connect to chat server")})),e.emit("get_user_chat_groups",{user_id:t},(e=>{if("success"===e.status&&e.chat_groups){const s={};e.chat_groups.forEach((e=>{s[e.id]=e})),console.log("groups chat groups : ",s),w((e=>({...e,...s}))),x(!1)}})),e.emit("get_organization_users",{user_id:t,organization_id:i},(e=>{var a;if("success"===e.status&&null!==e&&void 0!==e&&null!==(a=e.users)&&void 0!==a&&a.length){const a=(e=>{const a={};let i=1;return e.forEach((e=>{let n={id:null===e||void 0===e?void 0:e.group_id,archived_by:[],unread_count:(null===e||void 0===e?void 0:e.unread_count)||0,participants:[{id:e.id,name:`${e.full_name}`,avatar:e.avatar||""},{id:t,name:(null===s||void 0===s?void 0:s.full_name)||"You",avatar:null!==s&&void 0!==s&&s.has_photo?null===s||void 0===s?void 0:s.photo:""}],last_message:null===e||void 0===e?void 0:e.last_message};n.id?a[n.id]=n:a["private_group_"+i++]=n})),a})(e.users);console.log("private chatGroups: ",a),w((e=>({...e,...a})))}})),()=>{e.disconnect()}):l.oR.error("Organization ID is not available"):l.oR.error("User ID is not available")}),[t,i,s]),(0,a.useEffect)((()=>{if(!L.current)return;const e=L.current;return e.on("presence_list",(e=>{e.online&&S(e.online)})),e.on("presence_update",(e=>{e.user_id&&"offline"===e.status?S((s=>s.filter((s=>s!==e.user_id)))):e.user_id&&"online"===e.status&&S((s=>[...new Set([...s,e.user_id])]))})),()=>{e.off("presence_list"),e.off("presence_update")}}),[L]),(0,a.useEffect)((()=>{if(_&&y[_]){const e=y[_].project_id||y[_].job_number;f(e?"projects":"users"),I(y[_])}else I(null)}),[_,y]),(0,a.useEffect)((()=>{(async()=>{try{var e;const s=await(0,c.V_)();let t=null===s||void 0===s||null===(e=s.users)||void 0===e?void 0:e.filter((e=>e.is_active));const a={};t.forEach((e=>{a[e.id]=e})),$((e=>({...e,...a})))}catch(s){console.log(s)}})(),(async()=>{try{const e=await(0,c.tD)(),s=null===e||void 0===e?void 0:e.users.filter((e=>"disconnected"!==e.status)),t={};s.forEach((e=>{t[e.id]=e})),$((e=>({...e,...t})))}catch(e){console.log(e)}})()}),[]),(0,N.jsxs)("div",{className:"container-fluid px-0",children:[(0,N.jsxs)("div",{className:o,style:{height:`calc(100vh - 73px - 54px - ${p}px)`},children:[(0,N.jsx)(us,{activeTab:j,setActiveTab:f,archivedVisible:C,setArchivedVisible:b,chatData:y,userId:t,onlineUsers:k}),(0,N.jsx)(Le,{currentChat:A,setCurrentChat:I,socket:L.current,userId:t,chatId:_,onlineUsers:k,setChatData:w,users:M,updatePrivateGroupChatId:(e,s)=>{w((t=>{const a={...t};return e&&s&&a[e]&&(a[s]=a[e],delete a[e]),a})),v(`/chat?id=${s}`,{replace:!0})},refetchGroupChats:()=>{if(!L.current)return;L.current.emit("get_user_chat_groups",{user_id:t},(e=>{if("success"===e.status&&e.chat_groups){const s={};e.chat_groups.forEach((e=>{s[e.id]=e})),console.log("groups chat groups : ",s),w((e=>({...e,...s})))}}))}})]}),g&&(0,N.jsx)(h.A,{})]})},ps=()=>(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(i.mg,{children:(0,N.jsx)("title",{children:"MeMate - Chat"})}),(0,N.jsx)(hs,{})]})}}]);
//# sourceMappingURL=3579.ca4fffcb.chunk.js.map