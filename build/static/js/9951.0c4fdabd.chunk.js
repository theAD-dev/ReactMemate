"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[9951],{37990:(e,s,t)=>{t.d(s,{Dh:()=>c,Q3:()=>u,QL:()=>h,RN:()=>r,T_:()=>d,UU:()=>a,Ww:()=>o,b0:()=>m,bX:()=>x,hk:()=>g,ih:()=>p,jG:()=>f,m7:()=>v,xr:()=>i});var n=t(31342);const l="https://app.memate.com.au/api/v1",i=async()=>{const e=new URL(`${l}/assets/types/`);return(0,n.f)(e.toString(),{method:"GET"})},o=async()=>{const e=new URL(`${l}/assets/vehicles/dates/`);return(0,n.f)(e.toString(),{method:"GET"})},a=async()=>{const e=new URL(`${l}/assets/types/subscriptions/`);return(0,n.f)(e.toString(),{method:"GET"})},r=async function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4?arguments[4]:void 0;const a=(e-1)*s,r=new URL(`${l}/assets/vehicles/`);return r.searchParams.append("limit",s),r.searchParams.append("offset",a),t&&r.searchParams.append("q",t),i&&r.searchParams.append("ordering",i),o&&r.searchParams.append("is_deleted","true"),(0,n.f)(r.toString(),{method:"GET"})},d=async e=>{const s={method:"POST",body:e},t=new URL(`${l}/assets/vehicles/create/`);return(0,n.f)(t.toString(),s)},c=async e=>{const s=new URL(`${l}${`/assets/vehicles/${e}/`}`);return(0,n.f)(s.toString(),{method:"GET"})},u=async(e,s)=>{const t={method:"PUT",body:s},i=new URL(`${l}${`/assets/vehicles/${e}/update/`}`);return(0,n.f)(i.toString(),t)},p=async e=>{const s=new URL(`${l}${`/assets/vehicles/${e}/delete/`}`);return(0,n.f)(s.toString(),{method:"PATCH"})},m=async e=>{const s=new URL(`${l}${`/assets/vehicles/${e}/restore/`}`);return(0,n.f)(s.toString(),{method:"PATCH"})},x=async function(e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";const o=((arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)-1)*s,a=new URL(`${l}${`/assets/vehicles/${e}/services/`}`);return a.searchParams.append("limit",s),a.searchParams.append("offset",o),t&&a.searchParams.append("search",t),i&&a.searchParams.append("ordering",i),(0,n.f)(a.toString(),{method:"GET"})},h=async(e,s)=>{const t={method:"POST",body:s},i=new URL(`${l}${`/assets/vehicles/${e}/services/`}`);return(0,n.f)(i.toString(),t)},v=async e=>{const s={method:"POST",body:e},t=new URL(`${l}/assets/types/expense-links/create/`);return(0,n.f)(t.toString(),s)},g=async(e,s,t)=>{const i={method:"POST",body:{expense:t,asset_type:s,asset_id:e}},o=new URL(`${l}/assets/types/expense-links/delete/`);return(0,n.f)(o.toString(),i)},f=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1?arguments[1]:void 0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:25,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"-id";const o=((arguments.length>2&&void 0!==arguments[2]?arguments[2]:1)-1)*t,a=new URL(`${l}/assets/types/expense-links/`);return a.searchParams.append("limit",t),a.searchParams.append("offset",o),a.searchParams.append("asset_type",e),a.searchParams.append("asset_id",s),i&&a.searchParams.append("ordering",i),(0,n.f)(a.toString(),{method:"GET"})}},61427:(e,s,t)=>{t.d(s,{A:()=>v});var n=t(65043),l=t(14282),i=t(93202),o=t(56741),a=t(73216),r=t(64018),d=t(63712),c=t(20288),u=t(56328);const p="supplier-create_circledesignstyle__RXgvx",m="supplier-create_out__lEI-I";var x=t(1340),h=t(70579);const v=e=>{let{visible:s,setVisible:t,refetch:v}=e;const g=(0,n.useRef)(null),f=new URLSearchParams((0,a.zy)().search).get("addNewSupplier"),[j,y]=(0,n.useState)(!1),[b,N]=(0,n.useState)(null),[_]=(0,n.useState)({contact_persons:[{}],addresses:[{title:"Main Location",country:1}]}),A=async e=>{console.log("data: ",e),(async e=>{console.log("data: ",e);const s=new FormData;s.append("name",e.name),e.email&&s.append("email",e.email),e.website&&s.append("website",e.website),e.abn&&s.append("abn",e.abn);const n=(null===e||void 0===e?void 0:e.phone)&&(0,r.l)(e.phone);if(null!==n&&void 0!==n&&n.nationalNumber&&s.append("phone",e.phone),e.service&&s.append("service",e.service),e.note&&s.append("note",e.note),e.addresses.forEach(((e,t)=>{e.city&&(s.append(`addresses[${t}]address`,e.address),s.append(`addresses[${t}]city`,e.city),s.append(`addresses[${t}]postcode`,e.postcode),s.append(`addresses[${t}]is_main`,e.is_main),s.append(`addresses[${t}]title`,e.title))})),e.contact_persons.forEach(((e,t)=>{if(e.firstname||e.email){s.append(`contact_persons[${t}]firstname`,e.firstname),s.append(`contact_persons[${t}]lastname`,e.lastname),s.append(`contact_persons[${t}]email`,e.email);const n=(null===e||void 0===e?void 0:e.phone)&&(0,r.l)(e.phone);null!==n&&void 0!==n&&n.nationalNumber&&s.append(`contact_persons[${t}]phone`,e.phone),s.append(`contact_persons[${t}]position`,e.position),s.append(`contact_persons[${t}]is_main`,e.is_main)}})),null!==b&&void 0!==b&&b.croppedImageBlob){const e=(0,d.Ak)(6);s.append("photo",null===b||void 0===b?void 0:b.croppedImageBlob,`${e}.jpg`)}try{y(!0);const e=localStorage.getItem("access_token"),n=await fetch("https://app.memate.com.au/api/v1/suppliers/new/",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:s});n.ok?(console.log("response: ",n),u.oR.success("New supplier created successfully"),t(!1),v((e=>!e))):u.oR.error("Failed to create new supplier. Please try again.")}catch(l){u.oR.error("Failed to create new supplier. Please try again.")}finally{y(!1)}})(e)},w=()=>{g.current&&g.current.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))};return(0,n.useEffect)((()=>{s||N(null)}),[s]),(0,n.useEffect)((()=>{f&&t(!0)}),[f,t]),(0,h.jsx)(c.B,{visible:s,position:"right",onHide:()=>t(!1),modal:!1,dismissable:!1,style:{width:"702px"},content:e=>{let{closeIconRef:s,hide:n}=e;return(0,h.jsxs)("div",{className:"create-sidebar d-flex flex-column",children:[(0,h.jsxs)("div",{className:"d-flex align-items-center justify-content-between flex-shrink-0",style:{borderBottom:"1px solid #EAECF0",padding:"24px"},children:[(0,h.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,h.jsx)("div",{className:p,children:(0,h.jsx)("div",{className:m,children:(0,h.jsx)(i.A,{size:24,color:"#17B26A"})})}),(0,h.jsx)("span",{style:{color:"344054",fontSize:"20px",fontWeight:600},children:"Create new Supplier"})]}),(0,h.jsx)("span",{children:(0,h.jsx)(l.A,{type:"button",className:"text-button",ref:s,onClick:e=>n(e),children:(0,h.jsx)(o.A,{size:24,color:"#667085"})})})]}),(0,h.jsx)("div",{className:"modal-body",style:{padding:"24px",height:"calc(100vh - 72px - 122px)",overflow:"auto"},children:(0,h.jsx)(x.A,{photo:b,setPhoto:N,ref:g,onSubmit:A,defaultValues:_})}),(0,h.jsxs)("div",{className:"modal-footer d-flex align-items-center justify-content-end gap-3",style:{padding:"16px 24px",borderTop:"1px solid var(--Gray-200, #EAECF0)",height:"72px"},children:[(0,h.jsx)(l.A,{type:"button",onClick:e=>{e.stopPropagation(),t(!1)},className:"outline-button",children:"Cancel"}),(0,h.jsx)(l.A,{type:"button",disabled:j,onClick:w,className:"solid-button",style:{minWidth:"75px"},children:j?"Loading...":"Save"})]})]})}})}},62284:(e,s,t)=>{t.d(s,{A:()=>f});var n=t(65043),l=t(14282),i=t(93202),o=t(56741),a=t(47097),r=t(93740),d=t(20288),c=t(56328);const u="new-expense-create_circledesignstyle__Ke3sy",p="new-expense-create_out__C1Mi-",m="new-expense-create_expensesEditHead__xr-7V";var x=t(37990),h=t(10586),v=t(85049),g=t(70579);const f=e=>{let{visible:s,setVisible:t,setRefetch:f,expenseProjectId:j,assetForExpense:y,projectReference:b,createNewService:N=!1,createServiceFromExpense:_}=e;const A=window.location.href,w=new URL(A),S=new URLSearchParams(w.search),[E,C]=(0,n.useState)(null),[P,T]=(0,n.useState)(null),F=new Date,R=new Date(F);R.setDate(R.getDate()+1);const I=(0,n.useRef)(null),[$,k]=(0,n.useState)({option:"Assign to timeframe",type:2,notification:!1,date:F,due_date:R});(0,n.useEffect)((()=>{y&&y.id&&y.type&&(k((e=>({...e,option:"Assign to asset"}))),T({id:y.id,type:y.type}))}),[y]),(0,n.useEffect)((()=>{const e=S.get("projectId")||j,s=S.get("reference")||b;s&&(k((e=>({...e,invoice_reference:s}))),w.searchParams.delete("reference"),window.history.replaceState({},"",w)),e&&(C(e),k((e=>({...e,option:"Assign to project"}))),w.searchParams.delete("projectId"),window.history.replaceState({},"",w))}),[E,t]);const z=(0,a.n)({mutationFn:e=>(0,x.m7)(e),onSuccess:e=>{console.log("response: ",e),c.oR.success("Expense linked to asset successfully")},onError:e=>{console.error("Error linking expense to asset:",e),c.oR.error("Failed to link expense to asset. Please try again.")}}),B=(0,a.n)({mutationFn:e=>(0,h.Rv)(e),onSuccess:async e=>{if(console.log("response: ",e),c.oR.success("Expense created successfully"),P&&P.type&&P.id){const s={asset_type:P.type,asset_id:P.id,expense:e.id};await z.mutateAsync(s),N&&await _(e.id)}O(),f((e=>!e))},onError:e=>{console.error("Error creating expense:",e),c.oR.error("Failed to create expense. Please try again.")}}),L=(0,a.n)({mutationFn:e=>(0,h.sr)(e.id,e.code),onSuccess:e=>{console.log("response: ",e),c.oR.success("Account code assigned to supplier successfully")},onError:e=>{console.error("Error assigning supplier code:",e),c.oR.error("Failed to assign supplier code. Please try again.")}}),D=async e=>{delete e["gst-calculation"],delete e.option,delete e.subtotal,delete e.totalAmount,delete e.tax,e.assign_account_code&&e.service_code&&await L.mutateAsync({id:e.supplier,code:e.service_code}),delete e.assign_account_code,delete e.service_code,e.order||delete e.order,e.type||(e.type=1),e.date&&(e.date=new Date(e.date).toISOString().split("T")[0]),e.due_date&&(e.due_date=new Date(e.due_date).toISOString().split("T")[0]),B.mutate(e)},q=()=>{I.current&&I.current.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))},O=()=>{t(!1),C(null),k({option:"Assign to timeframe",type:2,notification:!1,date:F,due_date:R}),T(null)};return(0,g.jsx)(d.B,{visible:s,position:"right",onHide:O,modal:!1,dismissable:!1,style:{width:"702px"},content:e=>{let{closeIconRef:s,hide:t}=e;return(0,g.jsxs)("div",{className:"create-sidebar d-flex flex-column",children:[(0,g.jsxs)("div",{className:"d-flex align-items-center justify-content-between flex-shrink-0",style:{borderBottom:"1px solid #EAECF0",padding:"24px"},children:[(0,g.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,g.jsx)("div",{className:u,children:(0,g.jsx)("div",{className:p,children:(0,g.jsx)(i.A,{size:24,color:"#17B26A"})})}),(0,g.jsx)("span",{style:{color:"344054",fontSize:"20px",fontWeight:600},children:"Create new Expense"})]}),(0,g.jsx)("span",{children:(0,g.jsx)(l.A,{type:"button",className:"text-button",ref:s,onClick:e=>t(e),children:(0,g.jsx)(o.A,{size:24,color:"#667085"})})})]}),(0,g.jsxs)("div",{className:"modal-body",style:{padding:"24px",height:"calc(100vh - 72px - 122px)",overflow:"auto"},children:[(0,g.jsx)("div",{className:`d-flex align-items-center mb-2 justify-content-between ${m}`,children:(0,g.jsx)("h5",{children:"Expense Details"})}),(0,g.jsx)(v.A,{ref:I,onSubmit:D,defaultValues:$,projectId:E,asset:P,setAsset:T})]}),(0,g.jsxs)("div",{className:"modal-footer d-flex align-items-center justify-content-end gap-3",style:{padding:"16px 24px",borderTop:"1px solid var(--Gray-200, #EAECF0)",height:"72px"},children:[(0,g.jsx)(l.A,{type:"button",onClick:e=>{e.stopPropagation(),O()},className:"outline-button",disabled:B.isPending||z.isPending||L.isPending,children:"Cancel"}),(0,g.jsxs)(l.A,{type:"button",onClick:q,className:"solid-button",style:{minWidth:"70px"},disabled:B.isPending||z.isPending||L.isPending,children:["Save ",(B.isPending||z.isPending||L.isPending)&&(0,g.jsx)(r.p,{style:{width:"18px",height:"18px"}})]})]})]})}})}},85049:(e,s,t)=>{t.d(s,{A:()=>Re});var n=t(65043),l=t(61072),i=t(78602),o=t(14282),a=t(77918),r=t(96141),d=t(544),c=t(60867),u=t(55850),p=t(9634),m=t(93202),x=t(51038),h=t(94819),v=t(89488),g=t(24858),f=t(5293),j=t(35475),y=t(18403),b=t(28261),N=t(86213),_=t(58387),A=t(670),w=t(54972),S=t(55797),E=t(88060),C=t(28676),P=t(74532),T=t(79255),F=t(72052),R=t(27932),I=t(59690),$=t(20288),k=t(1356),z=t(56328),B=t(80899),L=t(37990);const D="expenses-form_circledesignstyle__mbb1-",q="expenses-form_out__KMiJx",O="expenses-form_bgGreay__JyrcA",U="expenses-form_lable__PwIbw",V="expenses-form_inputText__juz8k",G="expenses-form_error__BY34l",M="expenses-form_dropdownSelect__9h-UH",H="expenses-form_expensesCreateNew__okukP",W="expenses-form_dividerIcon__9TOjY",Y="expenses-form_expTotalRow__8u8o3",J="expenses-form_CalItem__5I8ic",Z="expenses-form_CalItemActive__NBMtY",K="expenses-form_fileBox__vJk+d",X="expenses-form_fileNameBox__Sb+Fy",Q="expenses-form_deleteBox__IPh+B",ee="expenses-form_aiProcessingBox__Xslof",se="expenses-form_aiProcessingSpinner__2Ykt8",te="expenses-form_aiProcessingText__r+NWH",ne="expenses-form_aiSuccessBox__5wZSk",le="expenses-form_aiSuccessText__g6HC8",ie="expenses-form_aiNoDataBox__dy9sT",oe="expenses-form_aiNoDataText__fTku6",ae="expenses-form_aiErrorBox__nCorV",re="expenses-form_aiErrorText__a5YuG",de="expenses-form_selectButton__z9PXk",ce="expenses-form_modal__lciui",ue="expenses-form_modalHeader__Kf8rL",pe="expenses-form_headerTitle__2VPHZ",me="expenses-form_iconStyle__s2Evh";var xe=t(70579);const he=e=>{var s;let{asset:t,setAsset:l,errors:o}=e;const a=(0,n.useRef)(null),[r,d]=(0,n.useState)([]),[c,u]=(0,n.useState)(1),[p,m]=(0,n.useState)(""),[x,h]=(0,n.useState)(!0),v=function(e,s){let t;return function(){for(var n=arguments.length,l=new Array(n),i=0;i<n;i++)l[i]=arguments[i];clearTimeout(t),t=setTimeout((()=>e(...l)),s)}}((e=>{var s;const t=(null===e||void 0===e||null===(s=e.filter)||void 0===s?void 0:s.toLowerCase())||"";m(t)}),300);return(0,n.useEffect)((()=>{u(1)}),[p]),(0,n.useEffect)((()=>{(async()=>{try{var e;const t=await(0,L.RN)(c,25,p,"registration_number");var s;if(1===c)d((null===t||void 0===t?void 0:t.results)||[]);else(null===t||void 0===t||null===(s=t.results)||void 0===s?void 0:s.length)>0&&d((e=>{const s=new Set(e.map((e=>e.id))),n=t.results.filter((e=>!s.has(e.id)));return[...e,...n]}));h(25===(null===t||void 0===t||null===(e=t.results)||void 0===e?void 0:e.length))}catch(t){console.error("Error loading vehicles:",t)}})()}),[c,p]),(0,n.useEffect)((()=>{if(r.length>0&&x){const e=setTimeout((()=>{const e=document.querySelector(".vehicle-dropdown .p-dropdown-items li.p-dropdown-item:last-child");e&&(a.current=new IntersectionObserver((e=>{e[0].isIntersecting&&u((e=>e+1))})),a.current.observe(e))}),1e3);return()=>{clearTimeout(e),a.current&&a.current.disconnect()}}}),[r,x]),(0,xe.jsxs)(i.A,{sm:6,children:[(0,xe.jsx)("label",{className:(0,_.A)(U),children:"Select Vehicle"}),(0,xe.jsx)(E.m,{value:(null===t||void 0===t?void 0:t.id)||null,options:r,optionLabel:"registration_number",optionValue:"id",onChange:e=>{l((()=>({...t,id:e.value})))},itemTemplate:e=>(0,xe.jsx)("div",{className:"d-flex gap-2 align-items-center w-100",children:(0,xe.jsxs)("div",{className:"ellipsis-width",style:{maxWidth:"350px"},children:[(0,xe.jsxs)("div",{style:{fontWeight:"400"},children:[null===e||void 0===e?void 0:e.make," ",null===e||void 0===e?void 0:e.model]}),(0,xe.jsxs)("div",{style:{fontSize:"12px",color:"#98A2B3"},children:[(null===e||void 0===e?void 0:e.registration_number)||"-"," ",(null===e||void 0===e?void 0:e.year_manufactured)&&`(${null===e||void 0===e?void 0:e.year_manufactured})`]})]})}),valueTemplate:e=>(null===t||void 0===t?void 0:t.id)===(null===e||void 0===e?void 0:e.id)?(0,xe.jsx)("div",{className:"d-flex gap-2 align-items-center w-100",children:(0,xe.jsxs)("div",{className:"ellipsis-width",style:{maxWidth:"350px"},children:[null===e||void 0===e?void 0:e.make," ",null===e||void 0===e?void 0:e.model]})}):null,className:(0,_.A)(M,"dropdown-height-fixed"),panelClassName:"vehicle-dropdown",style:{height:"46px"},scrollHeight:"350px",placeholder:"Search for vehicle",filter:!0,onFilter:v,filterInputAutoFocus:!0}),(null===o||void 0===o?void 0:o.assetId)&&(0,xe.jsx)("p",{className:"error-message",children:null===(s=o.assetId)||void 0===s?void 0:s.message})]})};var ve=t(10586),ge=t(52781);const fe=t.p+"static/media/ai-scan.5a0b826f54cf1e4e72f8.png";var je=t(27472);const ye=e=>{try{if("object"===typeof e&&null!==e){if(!(Array.isArray(e)&&e.length>0&&Array.isArray(e[0])))return e;{const s=e[0].find((e=>"text"===e[0]));s&&s[1]&&(e=s[1])}}if("string"===typeof e){const s=e.match(/```json\s*([\s\S]*?)\s*```/);if(s&&s[1])return JSON.parse(s[1]);const t=e.indexOf("{"),n=e.lastIndexOf("}");if(-1!==t&&-1!==n){const s=e.substring(t,n+1);return JSON.parse(s)}}return null}catch(s){return console.error("Error extracting AI response data:",s),null}},be=e=>{if(!e)return null;let s="0.00";e.total_amount&&(s=e.total_amount.replace(/[A-Za-z$,]/g,"").trim());let t="no";!0===e.gst_included?t="in":!1===e.gst_included&&(t="ex");const n=parseFloat(s)||0;let l=n,i=0;return"in"===t?(i=.1*n/1.1,l=n-i):"ex"===t&&(i=.1*l),{invoice_reference:e.invoice_number||"",amount:n.toFixed(2),"gst-calculation":t,gst:"ex"===t,nogst:"no"===t,subtotal:l.toFixed(2),tax:i.toFixed(2),totalAmount:(l+i).toFixed(2),note:e.description||""}};var Ne=t(14834),_e=t(33296),Ae=t(58027),we=t(11281),Se=(t(66601),t(61427));function Ee(e,s){let t;return function(){for(var n=arguments.length,l=new Array(n),i=0;i<n;i++)l[i]=arguments[i];clearTimeout(t),t=setTimeout((()=>e(...l)),s)}}const Ce=B.Ik({supplier:B.ai().typeError("Supplier must be a valid id").required("Supplier is required"),invoice_reference:B.Yj().required("Invoice reference is required"),date:B.Yj().required("Date is required"),due_date:B.Yj().required("Due date is required").test("is-after-date","Due date must be after the invoice date",(function(e){const{date:s}=this.parent;if(!s||!e)return!0;const t=new Date(s),n=new Date(e);return t.setHours(0,0,0,0),n.setHours(0,0,0,0),n>=t})),amount:B.Yj().required("Amount is required"),nogst:B.zM().required("NOGST must be a boolean"),gst:B.zM().required("GST must be a boolean")}).required(),Pe=(0,n.forwardRef)(((e,s)=>{var t,f,S,B,ce,ue,pe,me,Pe,Re,Ie,$e,ke,ze,Be,Le,De,qe,Oe,Ue;let{onSubmit:Ve,defaultValues:Ge,id:Me,defaultSupplier:He,projectId:We,asset:Ye,setAsset:Je}=e;(0,n.useRef)(null);const Ze=(0,n.useRef)(null),Ke=localStorage.getItem("access_token"),[Xe,Qe]=(0,n.useState)(!1),[es,ss]=(0,n.useState)((null===He||void 0===He?void 0:He.id)||""),[ts,ns]=(0,n.useState)(He||null),[ls,is]=(0,n.useState)([]),[os,as]=(0,n.useState)([]),[rs,ds]=(0,n.useState)(1),[cs,us]=(0,n.useState)(""),[ps,ms]=(0,n.useState)(!0),[xs,hs]=(0,n.useState)(!1),[vs,gs]=(0,n.useState)(!1),[fs,js]=(0,n.useState)(!1),[ys,bs]=(0,n.useState)([]),{control:Ns,reset:_s,register:As,handleSubmit:ws,setValue:Ss,getValues:Es,watch:Cs,setError:Ps,trigger:Ts,formState:{errors:Fs}}=(0,g.mN)({resolver:(0,y.t)(Ce),defaultValues:Ge}),{getRootProps:Rs,getInputProps:Is}=(0,v.VB)({maxFiles:1,multiple:!1,accept:{"application/pdf":[".pdf",".png",".jpg",".jpeg"]},maxSize:5242880,onDrop:e=>{const s=e.map((e=>Object.assign(e,{preview:URL.createObjectURL(e),progress:0})));as((()=>[...s])),Bs(s,!1)}}),{getRootProps:$s,getInputProps:ks}=(0,v.VB)({maxFiles:1,multiple:!1,accept:{"application/pdf":[".pdf",".png",".jpg",".jpeg"]},maxSize:5242880,onDrop:e=>{const s=e.map((e=>Object.assign(e,{preview:URL.createObjectURL(e),progress:0,aiAnalysis:!0})));as((()=>[...s])),Bs(s,!0)}}),zs=async(e,s)=>N.A.put(s,e,{headers:{"Content-Type":""},onUploadProgress:t=>{const n=Math.round(t.loaded/t.total*100);as((t=>t.map((t=>t.name===e.name?Object.assign(t,{progress:n,url:s}):t))))}}).catch((t=>{console.log("err: ",t),as((t=>t.map((t=>t.name===e.name?Object.assign(t,{progress:0,url:s,error:!0}):t))))})),Bs=async(e,s)=>{if(e.length)for(const l of e)try{const e=await N.A.post("https://app.memate.com.au/api/v1/expenses/file/",{file_name:l.name},{headers:{Authorization:`Bearer ${Ke}`}}),{url:n}=e.data;if(!n)return as([]),void z.oR.error(`Failed to upload ${l.name}. Please try again.`);await zs(l,n);const i=n.split("?")[0]||"";if(i&&(bs([i]),hs(!0)),!s)return Ss("file",i),void as((e=>e.map((e=>e.name===l.name?Object.assign(e,{progress:100}):e))));if(s){as((e=>e.map((e=>e.name===l.name?Object.assign(e,{progress:100,aiProcessing:!0}):e)))),z.oR.info("AI is analyzing your document...",{duration:3e3});try{const e=await N.A.post("https://app.memate.com.au/api/v1/expenses/recognize/",{file_url:i},{headers:{Authorization:`Bearer ${Ke}`}}),s=ye(null===e||void 0===e?void 0:e.data);if(s){const e=be(s);e?(Ss("file",i),Object.entries(e).forEach((e=>{let[s,t]=e;Ss(s,t)})),Ts(["invoice_reference","amount","gst","nogst"]),z.oR.success("Form prefilled with invoice data"),as((e=>e.map((e=>e.name===l.name?Object.assign(e,{aiProcessing:!1,aiSuccess:!0}):e))))):(as((e=>e.map((e=>e.name===l.name?Object.assign(e,{aiProcessing:!1,aiNoData:!0}):e)))),z.oR.warning("No invoice data could be extracted from the document"))}else as((e=>e.map((e=>e.name===l.name?Object.assign(e,{aiProcessing:!1,aiNoData:!0}):e)))),z.oR.warning("No invoice data could be extracted from the document")}catch(t){console.error("Error during AI recognition:",t),as((e=>e.map((e=>e.name===l.name?Object.assign(e,{aiProcessing:!1,aiError:!0}):e)))),z.oR.error("Failed to analyze the document. Please try again.")}}}catch(n){console.error("Error uploading file:",l.name,n),z.oR.error(`Failed to upload ${l.name}. Please try again.`)}},Ls=(0,b.I)({queryKey:["assetCategories"],queryFn:L.UU,staleTime:0}),Ds=(0,n.useMemo)((()=>{const e=null===Ls||void 0===Ls?void 0:Ls.data;return Array.isArray(e)?e.filter((e=>!1!==e.enabled)):null!==e&&void 0!==e&&e.results&&Array.isArray(e.results)?e.results.filter((e=>!1!==e.enabled)):[]}),[null===Ls||void 0===Ls?void 0:Ls.data]),qs=Ee((e=>{var s;const t=(null===e||void 0===e||null===(s=e.filter)||void 0===s?void 0:s.toLowerCase())||"";us(t)}),300);(0,n.useEffect)((()=>{ds(1)}),[cs,fs]),(0,n.useEffect)((()=>{(async()=>{const e=await(0,ge.Jj)(rs,25,cs,"name");if(1===rs){if(es){const s=e.results.filter((e=>e.id!==es));return is([ts,...s])}is(e.results)}else{var s;if((null===e||void 0===e||null===(s=e.results)||void 0===s?void 0:s.length)>0){let s=e.results;es&&(s=[ts,...e.results]),is((e=>{let t=e;es&&(t=[...e,ts]);const n=new Set(t.map((e=>e.id))),l=s.filter((e=>!n.has(e.id)));return[...e,...l]}))}}ms(e.count!==ls.length)})()}),[rs,cs,es,ts,fs]),(0,n.useEffect)((()=>{if(ls.length>0&&ps){const e=setTimeout((()=>{const e=document.querySelector(".supplier-dropdown .p-dropdown-items li.p-dropdown-item:last-child");e&&(Ze.current=new IntersectionObserver((e=>{e[0].isIntersecting&&ds((e=>e+1))})),Ze.current.observe(e))}),1e3);return()=>{clearTimeout(e),Ze.current&&Ze.current.disconnect()}}}),[ls,ps]);const Os=e=>{if(e){const s=parseFloat(Es("amount"))||0,{subtotal:t,calculatedTax:n,totalAmount:l}=((e,s)=>{let t=0,n=0;return"ex"===s?(n=e,t=.1*n):"in"===s?(t=.1*e/1.1,n=e-t):(n=e,t=0),{subtotal:n.toFixed(2),calculatedTax:t.toFixed(2),totalAmount:(parseFloat(n)+parseFloat(t)).toFixed(2)}})(s,e);Ss("tax",n),Ss("subtotal",t),Ss("totalAmount",l),Ss("nogst","no"===e),Ss("gst","ex"===e),Ts(["gst"])}},Us=(0,b.I)({queryKey:["getXeroCodesList"],queryFn:ve.JP}),Vs=(0,b.I)({queryKey:["getProjectsList"],queryFn:ve.Bu}),Gs=["Assign to project","Assign to timeframe","Assign to asset"],[Ms,Hs]=(0,n.useState)((null===Ge||void 0===Ge?void 0:Ge.option)||Gs[0]),Ws=Cs("order");(0,n.useEffect)((()=>{Ws&&Ts(["order"])}),[Ws]);const Ys=Cs("type"),Js=()=>{"Assign to project"!==Ms||Ws||Ps("order",{type:"manual",message:"Order is required"}),"Assign to timeframe"!==Ms||Ys||Ps("type",{type:"manual",message:"Type is required"}),"Assign to asset"===Ms&&(null!==Ye&&void 0!==Ye&&Ye.type||Ps("assetType",{type:"manual",message:"Asset Category is required"}),null!==Ye&&void 0!==Ye&&Ye.id||Ps("assetId",{type:"manual",message:"Asset is required"}))};(0,n.useEffect)((()=>{Object.keys(Fs).length>0&&Js()}),[Fs]),(0,n.useEffect)((()=>{"Assign to timeframe"===Ms?(Ss("order",""),null!==Ge&&void 0!==Ge&&Ge.type&&Ss("type",null===Ge||void 0===Ge?void 0:Ge.type)):"Assign to project"===Ms&&(Ss("type",""),null!==Ge&&void 0!==Ge&&Ge.order&&Ss("order",null===Ge||void 0===Ge?void 0:Ge.order)),Ss("option",Ms)}),[Ms]),(0,n.useEffect)((()=>{null!==Ge&&void 0!==Ge&&Ge.option&&Hs(null===Ge||void 0===Ge?void 0:Ge.option)}),[null===Ge||void 0===Ge?void 0:Ge.option]);(0,n.useEffect)((()=>{We&&Ss("order",+We)}),[We]),(0,n.useEffect)((()=>{Me||Ss("gst-calculation","in")}),[]),(0,n.useEffect)((()=>{var e,s;if(es&&Ss("supplier",+es),es&&Ts(["supplier"]),null!==ts&&void 0!==ts&&null!==(e=ts.service)&&void 0!==e&&e.code&&null!==Us&&void 0!==Us&&null!==(s=Us.data)&&void 0!==s&&s.length){var t;let e=null===Us||void 0===Us||null===(t=Us.data)||void 0===t?void 0:t.find((e=>{var s;return e.code===(null===ts||void 0===ts||null===(s=ts.service)||void 0===s?void 0:s.code)}));null!==e&&void 0!==e&&e.id&&Ss("account_code",null===e||void 0===e?void 0:e.id)}else Ge.account_code&&Ss("account_code",Ge.account_code||"")}),[es,null===Us||void 0===Us?void 0:Us.data,Ss,Ts,Ge.account_code,null===ts||void 0===ts||null===(t=ts.service)||void 0===t?void 0:t.code]);const Zs=(0,xe.jsx)("div",{className:"d-flex align-items-center justify-content-between flex-shrink-0 w-100",style:{borderBottom:"1px solid #EAECF0",padding:"4px 10px 24px 0px"},children:(0,xe.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,xe.jsx)("div",{className:D,children:(0,xe.jsx)("div",{className:q,children:(0,xe.jsx)(a.A,{size:24,color:"#17B26A"})})}),(0,xe.jsx)("span",{style:{color:"344054",fontSize:"20px",fontWeight:600},children:"Document Preview"})]})});(0,n.useEffect)((()=>{null!==Ge&&void 0!==Ge&&Ge.file&&(bs([null===Ge||void 0===Ge?void 0:Ge.file]),hs(!0))}),[null===Ge||void 0===Ge?void 0:Ge.file]);let Ks=Cs("account_code");(0,n.useEffect)((()=>{var e,s,t;const n=null===ts||void 0===ts||null===(e=ts.service)||void 0===e?void 0:e.code;let l=null===Us||void 0===Us||null===(s=Us.data)||void 0===s?void 0:s.find((e=>e.code===n));if(n&&null!==l&&void 0!==l&&l.id)Ss("assign_account_code",!1);else if(null!==l&&void 0!==l&&l.id||!Ks||null===Us||void 0===Us||null===(t=Us.data)||void 0===t||!t.length)Ss("service_code","");else{var i;let e=null===Us||void 0===Us||null===(i=Us.data)||void 0===i?void 0:i.find((e=>e.id===Ks));Ss("service_code",(null===e||void 0===e?void 0:e.code)||"")}}),[Ks,null===Us||void 0===Us?void 0:Us.data,Ss,null===ts||void 0===ts||null===(f=ts.service)||void 0===f?void 0:f.code]);return(0,xe.jsxs)("div",{children:[(0,xe.jsxs)("form",{ref:s,onSubmit:ws((e=>{Js(),Object.keys(Fs).length>0?console.log("Validation errors:",Fs):Ve(e,_s)})),children:[(0,xe.jsxs)(l.A,{className:(0,_.A)(O,"pt-3"),children:[(0,xe.jsx)(i.A,{sm:8,children:(0,xe.jsxs)("div",{className:"d-flex flex-column gap-1 mb-3",children:[(0,xe.jsxs)("label",{className:(0,_.A)(U),children:["Supplier",(0,xe.jsx)("span",{className:"required",children:"*"})]}),(0,xe.jsx)("input",{type:"hidden",...As("supplier")}),(0,xe.jsx)(E.m,{value:es,options:ls,optionLabel:"name",optionValue:"id",onChange:e=>{ss(+e.value);let s=ls.find((s=>s.id===e.value));ns(s||{})},itemTemplate:e=>(0,xe.jsxs)("div",{className:"d-flex gap-2 align-items-center w-100",children:[(0,xe.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{width:"24px",height:"24px",borderRadius:"4px",overflow:"hidden",border:"1px solid #dedede"},children:(0,xe.jsx)(Ae.A,{photo:null===e||void 0===e?void 0:e.photo,has_photo:null===e||void 0===e?void 0:e.has_photo,is_business:!0,size:17})}),(0,xe.jsx)("div",{className:"ellipsis-width",style:{maxWidth:"350px"},children:null===e||void 0===e?void 0:e.name})]}),valueTemplate:e=>es?(0,xe.jsxs)("div",{className:"d-flex gap-2 align-items-center w-100",children:[(0,xe.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{width:"24px",height:"24px",borderRadius:"4px",overflow:"hidden",border:"1px solid #dedede"},children:(0,xe.jsx)(Ae.A,{photo:null===e||void 0===e?void 0:e.photo,has_photo:null===e||void 0===e?void 0:e.has_photo,is_business:!0,size:17})}),(0,xe.jsx)("div",{className:"ellipsis-width",style:{maxWidth:"350px"},children:null===e||void 0===e?void 0:e.name})]}):null,className:(0,_.A)(M,"dropdown-height-fixed",{[G]:null===Fs||void 0===Fs?void 0:Fs.supplier}),panelClassName:"supplier-dropdown",style:{height:"46px"},scrollHeight:"350px",placeholder:"Search for supplier",filter:!0,onFilter:qs,filterInputAutoFocus:!0}),Fs.supplier&&(0,xe.jsx)("p",{className:"error-message",children:Fs.supplier.message})]})}),(0,xe.jsx)(i.A,{sm:4,children:(0,xe.jsx)("div",{className:"d-flex justify-content-end text-md-end flex-column gap-1 mt-3 pt-3 mb-3",children:(0,xe.jsxs)(o.A,{className:H,onClick:()=>gs(!0),children:["Create New Supplier",(0,xe.jsx)(r.A,{size:24,color:"#475467"})]})})}),(0,xe.jsx)(i.A,{sm:12,className:"mb-4",children:(0,xe.jsxs)("div",{className:"d-flex flex-column gap-1",children:[(0,xe.jsxs)("label",{className:(0,_.A)(U),children:["Invoice/#Ref",(0,xe.jsx)("span",{className:"required",children:"*"})]}),(0,xe.jsxs)(C.C,{children:[(0,xe.jsx)(P.m,{children:(null===Fs||void 0===Fs?void 0:Fs.invoice_reference)&&(0,xe.jsx)("img",{src:je.A,className:"mb-3"})}),(0,xe.jsx)(F.S,{...As("invoice_reference"),className:(0,_.A)(V,{[G]:Fs.invoice_reference}),placeholder:"Enter invoice reference"})]}),(null===Fs||void 0===Fs?void 0:Fs.invoice_reference)&&(0,xe.jsx)("p",{className:"error-message",children:null===(S=Fs.invoice_reference)||void 0===S?void 0:S.message})]})}),(0,xe.jsxs)(i.A,{sm:12,children:[(0,xe.jsxs)(l.A,{children:[(0,xe.jsxs)(i.A,{sm:6,children:[(0,xe.jsx)("label",{className:(0,_.A)(U),children:"Upload Only"}),(0,xe.jsxs)("div",{...Rs({className:"dropzone d-flex justify-content-center align-items-center flex-column"}),style:{width:"100%",height:"126px",background:"#fff",borderRadius:"4px",border:"1px solid #EAECF0",marginTop:"5px"},children:[(0,xe.jsx)("input",{...Is()}),(0,xe.jsx)("button",{type:"button",className:"d-flex justify-content-center align-items-center",style:{width:"40px",height:"40px",border:"1px solid #EAECF0",background:"#fff",borderRadius:"8px",marginBottom:"16px"},children:(0,xe.jsx)(d.A,{size:20,color:"#475467"})}),(0,xe.jsxs)("p",{className:"mb-0",style:{color:"#475467",fontSize:"14px"},children:[(0,xe.jsx)("span",{style:{color:"#106B99",fontWeight:"600"},children:"Click to upload"})," or drag and drop"]}),(0,xe.jsx)("span",{style:{color:"#475467",fontSize:"12px"},children:"PDF, SVG, PNG, JPG files \u2022 Max size: 5MB"})]})]}),(0,xe.jsxs)(i.A,{sm:6,children:[(0,xe.jsx)("label",{className:(0,_.A)(U),children:"Upload & Read With AI"}),(0,xe.jsxs)("div",{...$s({className:"dropzone d-flex justify-content-center align-items-center flex-column"}),style:{width:"100%",height:"126px",background:"#fff",borderRadius:"4px",border:"1px solid #EAECF0",marginTop:"5px"},children:[(0,xe.jsx)("input",{...ks()}),(0,xe.jsx)("button",{type:"button",className:"d-flex justify-content-center align-items-center",style:{width:"40px",height:"40px",border:"1px solid #FFF",background:"#f2f2f2",borderRadius:"8px",marginBottom:"16px"},children:(0,xe.jsx)("img",{src:fe,className:"w-100"})}),(0,xe.jsxs)("p",{className:"mb-0",style:{color:"#475467",fontSize:"14px"},children:[(0,xe.jsx)("span",{style:{color:"#106B99",fontWeight:"600"},children:"Click to upload"})," or drag and drop"]}),(0,xe.jsx)("span",{style:{color:"#475467",fontSize:"12px"},children:"PDF, PNG, JPG, JPEG files \u2022 Max size: 5MB"})]})]})]}),(0,xe.jsxs)("div",{className:"d-flex flex-column",children:[(null===os||void 0===os?void 0:os.length)>0&&(0,xe.jsx)("label",{className:(0,_.A)(U,"mt-4 mb-1"),children:"Photo/Document Of The Expense"}),null===os||void 0===os?void 0:os.map(((e,s)=>(0,xe.jsxs)("div",{className:K,children:[(0,we.I)(e.type),(0,xe.jsxs)("div",{className:X,children:[(0,xe.jsx)("p",{className:"mb-0",children:(null===e||void 0===e?void 0:e.name)||""}),(0,xe.jsxs)("p",{className:"mb-0",children:[parseFloat((null===e||void 0===e?void 0:e.size)/1024).toFixed(2)," KB - ",parseInt(null===e||void 0===e?void 0:e.progress)||0,"% uploaded"]})]}),(0,xe.jsx)("div",{className:"ms-auto",children:e.error?(0,xe.jsx)("div",{className:Q,children:(0,xe.jsx)(c.A,{color:"#F04438",size:16})}):e.aiProcessing?(0,xe.jsxs)("div",{className:ee,children:[(0,xe.jsx)("div",{className:se}),(0,xe.jsx)("span",{className:te,children:"AI analyzing..."})]}):e.aiSuccess?(0,xe.jsxs)("div",{className:ne,children:[(0,xe.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,xe.jsx)("path",{d:"M8 0C3.6 0 0 3.6 0 8C0 12.4 3.6 16 8 16C12.4 16 16 12.4 16 8C16 3.6 12.4 0 8 0ZM7 11.4L3.6 8L5 6.6L7 8.6L11 4.6L12.4 6L7 11.4Z",fill:"#12B76A"})}),(0,xe.jsx)("span",{className:le,children:"Data extracted"})]}):e.aiNoData?(0,xe.jsxs)("div",{className:ie,children:[(0,xe.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,xe.jsx)("path",{d:"M8 0C3.6 0 0 3.6 0 8C0 12.4 3.6 16 8 16C12.4 16 16 12.4 16 8C16 3.6 12.4 0 8 0ZM8 12C7.4 12 7 11.6 7 11C7 10.4 7.4 10 8 10C8.6 10 9 10.4 9 11C9 11.6 8.6 12 8 12ZM9 9H7V4H9V9Z",fill:"#F79009"})}),(0,xe.jsx)("span",{className:oe,children:"No data found"})]}):e.aiError?(0,xe.jsxs)("div",{className:ae,children:[(0,xe.jsx)(c.A,{color:"#F04438",size:16}),(0,xe.jsx)("span",{className:re,children:"AI error"})]}):100==e.progress?(0,xe.jsx)(u.A,{color:"#12B76A",size:20}):(0,xe.jsx)(_e.A,{percentage:parseInt(null===e||void 0===e?void 0:e.progress)||0,size:30,color:"#158ECC"})})]},s)))]})]}),(0,xe.jsx)(i.A,{sm:6,children:(0,xe.jsxs)("div",{className:"d-flex flex-column gap-1 mt-4 mb-4",children:[(0,xe.jsxs)("label",{className:(0,_.A)(U),children:["Date",(0,xe.jsx)("span",{className:"required",children:"*"})]}),(0,xe.jsx)(g.xI,{name:"date",control:Ns,render:e=>{let{field:s}=e;return(0,xe.jsx)(A.V,{...s,onChange:e=>{s.onChange(e.value),setTimeout((()=>Ts("due_date")),0)},showButtonBar:!0,placeholder:"DD/MM/YY",dateFormat:"dd/mm/yy",showIcon:!0,style:{height:"46px"},icon:(0,xe.jsx)(p.A,{color:"#667085",size:20}),className:(0,_.A)(V,{[G]:Fs.date},"p-0 outline-none")})}}),(null===Fs||void 0===Fs?void 0:Fs.date)&&(0,xe.jsx)("p",{className:"error-message",children:null===(B=Fs.date)||void 0===B?void 0:B.message})]})}),(0,xe.jsx)(i.A,{sm:6,children:(0,xe.jsxs)("div",{className:"d-flex flex-column gap-1 mt-4 mb-4",children:[(0,xe.jsxs)("label",{className:(0,_.A)(U),children:["Due Date",(0,xe.jsx)("span",{className:"required",children:"*"})]}),(0,xe.jsx)(g.xI,{name:"due_date",control:Ns,render:e=>{let{field:s}=e;const t=Cs("date"),n=t?new Date(t):null;return(0,xe.jsx)(A.V,{...s,onChange:e=>{s.onChange(e.value),Ts("due_date")},showButtonBar:!0,placeholder:"DD/MM/YY",dateFormat:"dd/mm/yy",locale:"en",showIcon:!0,minDate:n,style:{height:"46px"},icon:(0,xe.jsx)(p.A,{color:"#667085",size:20}),className:(0,_.A)(V,{[G]:Fs.due_date},"p-0 outline-none")})}}),(null===Fs||void 0===Fs?void 0:Fs.due_date)&&(0,xe.jsx)("p",{className:"error-message",children:null===(ce=Fs.due_date)||void 0===ce?void 0:ce.message})]})}),(0,xe.jsx)(i.A,{sm:6,children:(0,xe.jsxs)("div",{className:"d-flex flex-column gap-1",children:[(0,xe.jsxs)("label",{className:(0,_.A)(U),children:["Total Amount",(0,xe.jsx)("span",{className:"required",children:"*"})]}),(0,xe.jsxs)(C.C,{children:[(0,xe.jsx)(T.Y,{prefix:"$",value:Cs("amount"),onValueChange:e=>{Ss("amount",e.value),Os(Es("gst-calculation"))},onBlur:()=>Os(Es("gst-calculation")),style:{height:"46px",padding:"0px"},className:(0,_.A)(V,{[G]:Fs.amount}),placeholder:"$ Enter total amount",maxFractionDigits:2,minFractionDigits:2,inputId:"minmaxfraction"}),(0,xe.jsx)(P.m,{children:Fs.amount&&(0,xe.jsx)("img",{src:je.A,className:"mb-3"})})]}),(null===Fs||void 0===Fs?void 0:Fs.amount)&&(0,xe.jsx)("p",{className:"error-message",children:null===(ue=Fs.amount)||void 0===ue?void 0:ue.message})]})}),(0,xe.jsx)(i.A,{sm:6,children:(0,xe.jsxs)("div",{className:"d-flex flex-column gap-1 mb-2",children:[(0,xe.jsxs)("label",{className:(0,_.A)(U),children:["GST",(0,xe.jsx)("span",{className:"required",children:"*"})]}),(0,xe.jsx)("input",{type:"hidden",...As("nogst")}),(0,xe.jsx)(g.xI,{name:"gst-calculation",control:Ns,render:e=>{let{field:s}=e;return(0,xe.jsx)(E.m,{...s,options:[{value:"ex",label:"GST Exclusive"},{value:"in",label:"GST Inclusive"},{value:"no",label:"No GST"}]||0,onChange:e=>{s.onChange(e.value),Os(e.value)},className:(0,_.A)(M,"dropdown-height-fixed",{[G]:null===Fs||void 0===Fs?void 0:Fs.gst}),style:{height:"46px"},value:s.value,placeholder:"Select GST",filterInputAutoFocus:!0})}}),(null===Fs||void 0===Fs?void 0:Fs.gst)&&(0,xe.jsx)("p",{className:"error-message",children:null===(pe=Fs.gst)||void 0===pe?void 0:pe.message})]})})]}),(0,xe.jsxs)(l.A,{className:`${Y}`,children:[(0,xe.jsxs)(i.A,{className:"d-flex align-items-center justify-content-end",style:{position:"relative"},children:[(0,xe.jsx)("div",{className:J,children:(0,xe.jsxs)("div",{children:[(0,xe.jsx)("span",{children:"Subtotal"}),(0,xe.jsxs)("strong",{children:["$",(0,Ne.m)(Cs("subtotal")||"0.00")]})]})}),(0,xe.jsx)("div",{className:W,children:(0,xe.jsx)(m.A,{color:"#667085",size:20})})]}),(0,xe.jsxs)(i.A,{className:"d-flex align-items-center justify-content-end",style:{position:"relative"},children:[(0,xe.jsx)("div",{className:J,children:(0,xe.jsxs)("div",{children:[(0,xe.jsx)("span",{children:"Tax"}),(0,xe.jsxs)("strong",{children:["$",(0,Ne.m)(Cs("tax")||"0.00")]})]})}),(0,xe.jsx)("div",{className:W,children:(0,xe.jsx)("span",{style:{color:"#1D2939",fontSize:"14px",fontWeight:600},children:"="})})]}),(0,xe.jsx)(i.A,{style:{position:"relative"},children:(0,xe.jsx)("div",{className:`${Z} ${J}`,children:(0,xe.jsxs)("div",{children:[(0,xe.jsx)("span",{children:"Total"}),(0,xe.jsxs)("strong",{className:"text-nowrap",children:["$",(0,Ne.m)(Cs("totalAmount")||"0.00")]})]})})})]}),(0,xe.jsxs)(l.A,{className:(0,_.A)(O,"customSelectButton"),children:[(0,xe.jsx)("div",{className:"d-flex justify-content-between align-items-center",children:(0,xe.jsx)(I.J,{value:Ms,className:de,onChange:e=>Hs(e.value),options:Gs})}),"Assign to project"===Ms?(0,xe.jsx)(i.A,{sm:12,children:(0,xe.jsxs)("div",{className:"d-flex flex-column gap-1 mt-4 mb-4",children:[(0,xe.jsx)(k.m,{position:"top",target:".info-timeinterval"}),(0,xe.jsxs)("label",{className:(0,_.A)(U),children:["Link to Project",(0,xe.jsx)("span",{className:"required",children:"*"})," ",(0,xe.jsx)(x.A,{color:"#667085",style:{position:"relative",top:"-1px"},className:"ms-1 info-timeinterval","data-pr-tooltip":"Select an existing project to assign expenses and display the exact cost of using this asset."})]}),(0,xe.jsx)(g.xI,{name:"order",control:Ns,render:e=>{var s;let{field:t}=e;return(0,xe.jsx)(E.m,{...t,options:(null===Vs||void 0===Vs||null===(s=Vs.data)||void 0===s?void 0:s.map((e=>({value:e.id,label:`${e.number}: ${e.reference}`}))))||[],onChange:e=>{t.onChange(e.value)},className:(0,_.A)(M,"dropdown-height-fixed",{[G]:null===Fs||void 0===Fs?void 0:Fs.order}),style:{height:"46px"},value:t.value,loading:null===Vs||void 0===Vs?void 0:Vs.isFetching,placeholder:"Select project",filter:!0,filterInputAutoFocus:!0,scrollHeight:"400px"})}}),(null===Fs||void 0===Fs?void 0:Fs.order)&&(0,xe.jsx)("p",{className:"error-message",children:null===(me=Fs.order)||void 0===me?void 0:me.message})]})}):"Assign to asset"===Ms?(0,xe.jsx)(i.A,{sm:12,children:(0,xe.jsx)("div",{className:"d-flex flex-column gap-1 mt-4 mb-4",children:(0,xe.jsxs)(l.A,{children:[(0,xe.jsxs)(i.A,{sm:6,children:[(0,xe.jsx)("label",{className:(0,_.A)(U),children:"Asset Type"}),(0,xe.jsx)(E.m,{options:Ds.map((e=>({value:e.id,label:e.asset_name}))),onChange:e=>{Je({type:e.value})},className:(0,_.A)(M,"dropdown-height-fixed",{[G]:null===Fs||void 0===Fs?void 0:Fs.type}),style:{height:"46px"},value:null===Ye||void 0===Ye?void 0:Ye.type,placeholder:"Select asset type",filter:!1,loading:null===Ls||void 0===Ls?void 0:Ls.isFetching,emptyMessage:"No asset types available"}),(null===Fs||void 0===Fs?void 0:Fs.assetType)&&(0,xe.jsx)("p",{className:"error-message",children:null===(Pe=Fs.assetType)||void 0===Pe?void 0:Pe.message})]}),(null===Ye||void 0===Ye?void 0:Ye.type)&&"vehicles"===(null===(Re=Ds.find((e=>e.id===(null===Ye||void 0===Ye?void 0:Ye.type))))||void 0===Re||null===(Ie=Re.asset_name)||void 0===Ie?void 0:Ie.toLowerCase())&&(0,xe.jsx)(he,{asset:Ye,setAsset:Je,errors:Fs})]})})}):(0,xe.jsx)(i.A,{sm:12,children:(0,xe.jsxs)("div",{className:"d-flex flex-column gap-1 mt-4 mb-4",children:[(0,xe.jsx)(k.m,{position:"top",target:".info-timeinterval"}),(0,xe.jsxs)("label",{className:(0,_.A)(U),children:["Expense time interval",(0,xe.jsx)("span",{className:"required",children:"*"})," ",(0,xe.jsx)(x.A,{color:"#667085",style:{position:"relative",top:"-1px"},className:"ms-1 info-timeinterval","data-pr-tooltip":"Selecting this option will categorize the expense under 'Operational Expense' and distribute it evenly over the chosen timeframe."})]}),(0,xe.jsx)(g.xI,{name:"type",control:Ns,render:e=>{let{field:s}=e;return(0,xe.jsx)(E.m,{...s,options:[{value:1,label:"Monthly"},{value:2,label:"Yearly"}],onChange:e=>{s.onChange(e.value)},className:(0,_.A)(M,"dropdown-height-fixed",{[G]:null===Fs||void 0===Fs?void 0:Fs.type}),style:{height:"46px"},value:s.value,placeholder:"Select expense time interval",filterInputAutoFocus:!0})}}),(null===Fs||void 0===Fs?void 0:Fs.type)&&(0,xe.jsx)("p",{className:"error-message",children:null===($e=Fs.type)||void 0===$e?void 0:$e.message})]})})]}),(0,xe.jsx)(l.A,{className:(0,_.A)(O),children:(0,xe.jsx)(i.A,{sm:12,children:(0,xe.jsxs)("div",{className:"d-flex flex-column gap-1",children:[(0,xe.jsx)("label",{className:(0,_.A)(U),children:"Notes"}),(0,xe.jsxs)(C.C,{children:[(0,xe.jsx)(P.m,{style:{top:"75%"},children:Fs.note&&(0,xe.jsx)("img",{src:je.A,alt:"error-icon"})}),(0,xe.jsx)(R.Z,{...As("note"),rows:3,cols:30,className:(0,_.A)(V,{[G]:Fs.note}),style:{resize:"none"},placeholder:"Enter a note..."})]}),Fs.note&&(0,xe.jsx)("p",{className:"error-message",children:Fs.note.message})]})})}),(0,xe.jsx)(l.A,{className:(0,_.A)(O),children:(0,xe.jsxs)(i.A,{sm:12,children:[(0,xe.jsxs)("div",{className:"d-flex flex-column gap-1 mt-4 mb-4",children:[(0,xe.jsx)("label",{className:(0,_.A)(U),children:"Account Code"}),(0,xe.jsx)(g.xI,{name:"account_code",control:Ns,render:e=>{var s;let{field:t}=e;return(0,xe.jsx)(E.m,{...t,options:[...Us&&(null===Us||void 0===Us||null===(s=Us.data)||void 0===s?void 0:s.map((e=>({value:e.id,label:`${e.code}: ${e.name}`}))))||[]]||[],onChange:e=>{t.onChange(e.value)},className:(0,_.A)(M,"dropdown-height-fixed",{[G]:null===Fs||void 0===Fs?void 0:Fs.account_code}),style:{height:"46px"},scrollHeight:"400px",value:t.value,loading:null===Us||void 0===Us?void 0:Us.isFetching,placeholder:"Select account code",filter:!0,filterInputAutoFocus:!0})}}),(null===Fs||void 0===Fs?void 0:Fs.account_code)&&(0,xe.jsx)("p",{className:"error-message",children:null===(ke=Fs.account_code)||void 0===ke?void 0:ke.message})]}),(0,xe.jsxs)("div",{className:"flex align-items-center",children:[(0,xe.jsx)(g.xI,{name:"assign_account_code",control:Ns,render:e=>{var s;let{field:{onChange:t,onBlur:n,value:l,ref:i}}=e;return(0,xe.jsx)(w.S,{inputRef:i,checked:l,defaultChecked:!0,onChange:e=>{t(e.checked)},onBlur:n,disabled:!((null===ts||void 0===ts||null===(s=ts.service)||void 0===s||!s.code)&&es&&Ks)})}}),(0,xe.jsx)("label",{className:"ms-2",style:{position:"relative",top:"1px",color:"#475467",fontSize:"14px",opacity:""+(null!==ts&&void 0!==ts&&null!==(ze=ts.service)&&void 0!==ze&&ze.code||!es||!Ks?.5:1)},children:"Assign account code to the supplier"})]})]})}),null!==ys&&void 0!==ys&&ys.length?(0,xe.jsx)(l.A,{className:(0,_.A)(O),children:(0,xe.jsx)(i.A,{sm:12,children:(0,xe.jsx)("div",{className:"d-flex flex-column gap-1",children:(0,xe.jsxs)("div",{className:"d-flex flex-column",children:[(0,xe.jsx)("label",{className:(0,_.A)(U,"mb-2"),children:"Photo/Document Of The Expense"}),ys[0]&&(0,xe.jsxs)("div",{className:K,children:[(0,we.I)((null===(Be=ys[0])||void 0===Be||null===(Le=Be.split("."))||void 0===Le?void 0:Le[(null===(De=ys[0])||void 0===De?void 0:De.split(".").length)-1])||""),(0,xe.jsxs)("div",{className:X,children:[(0,xe.jsx)(j.N_,{className:"linkText",to:ys[0],target:"_blank",children:(0,xe.jsx)("p",{className:"mb-0",children:(null===(qe=ys[0])||void 0===qe||null===(Oe=qe.split("/"))||void 0===Oe?void 0:Oe[(null===(Ue=ys[0])||void 0===Ue?void 0:Ue.split("/").length)-1])||""})}),(0,xe.jsx)("p",{className:"mb-0"})]}),(0,xe.jsx)("div",{className:"ms-auto",children:(0,xe.jsx)("div",{className:"d-flex align-items-center justify-content-center",style:{background:"#FEE4E2",borderRadius:"200px",width:"30px",height:"30px"},children:(0,xe.jsx)(h.A,{size:16,color:"#F04438",style:{cursor:"pointer"},onClick:()=>{Ss("file",""),bs([]),hs(!1)}})})})]})]})})})}):""]}),(0,xe.jsx)($.B,{visible:xs&&(null===ys||void 0===ys?void 0:ys.length),header:Zs,position:"right",modal:!1,dismissable:!1,style:{width:"1200px",paddingRight:"720px"},maskClassName:"p-sidebar-mask-document",onHide:()=>hs(!1),children:(0,xe.jsx)(Te,{files:ys})}),Xe&&(0,xe.jsx)(Fe,{visible:Xe,onHide:()=>Qe(!1)}),vs&&(0,xe.jsx)(Se.A,{visible:vs,setVisible:gs,refetch:()=>js((e=>!e))})]})})),Te=e=>{let{files:s}=e;const[t,l]=(0,n.useState)({}),i=(e,s)=>{l((t=>{var n,l;const i=(null===(n=t[e])||void 0===n?void 0:n.currentPage)||1,o=(null===(l=t[e])||void 0===l?void 0:l.numPages)||1,a=Math.min(Math.max(i+s,1),o);return{...t,[e]:{...t[e],currentPage:a}}}))};return(0,xe.jsx)("div",{style:{display:"grid",gap:"2rem"},children:s.map(((e,s)=>{if(/\.(jpeg|jpg|png|webp|gif|svg)$/i.test(e))return(0,xe.jsx)("img",{src:e,alt:`preview-${s}`,style:{maxWidth:"100%",maxHeight:"400px",border:"1px solid #ccc"}},s);if((e=>/\.pdf$/i.test(e))(e)){const n=t[e]||{},{numPages:o=null,currentPage:a=1}=n;return(0,xe.jsxs)("div",{style:{border:"1px solid #ccc",padding:"1rem",maxWidth:"420px"},children:[(0,xe.jsx)(f.yo,{file:e,onLoadSuccess:s=>((e,s)=>{let{numPages:t}=s;l((s=>({...s,[e]:{...s[e],numPages:t,currentPage:1}})))})(e,s),onLoadError:e=>console.error("PDF load error:",e),children:(0,xe.jsx)(f.YW,{pageNumber:a,width:400})}),o&&(0,xe.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"1rem",gap:"1rem"},children:[(0,xe.jsx)("button",{className:"outline-button px-2",style:{height:"30px"},onClick:()=>i(e,-1),disabled:a<=1,children:"\u2039"}),(0,xe.jsxs)("span",{children:[a," of ",o]}),(0,xe.jsx)("button",{className:"outline-button px-2",style:{height:"30px"},onClick:()=>i(e,1),disabled:a>=o,children:"\u203a"})]})]},s)}return(0,xe.jsxs)("p",{children:["Unsupported file type: ",e]},s)}))})},Fe=n.memo((e=>{var s;let{visible:t,onHide:a,defaultValues:d={}}=e;const c=(0,n.useRef)(null),[u,p]=(0,n.useState)((null===(s=d.supplier)||void 0===s?void 0:s.id)||""),[m,x]=(0,n.useState)(d.supplier||null);console.log("selectedSupplier: ",m);const[h,v]=(0,n.useState)([]),[g,f]=(0,n.useState)(1),[y,b]=(0,n.useState)(""),[N,A]=(0,n.useState)(!0),w=Ee((e=>{var s;const t=(null===e||void 0===e||null===(s=e.filter)||void 0===s?void 0:s.toLowerCase())||"";b(t)}),300);(0,n.useEffect)((()=>{f(1)}),[y]),(0,n.useEffect)((()=>{(async()=>{const e=await(0,ge.Jj)(g,25,y,"name");if(1===g){if(u){const s=e.results.filter((e=>e.id!==u));return v([m,...s])}v(e.results)}else{var s;if((null===e||void 0===e||null===(s=e.results)||void 0===s?void 0:s.length)>0){let s=e.results;u&&(s=[m,...e.results]),v((e=>{let t=e;u&&(t=[...e,m]);const n=new Set(t.map((e=>e.id))),l=s.filter((e=>!n.has(e.id)));return[...e,...l]}))}}A(e.count!==h.length)})()}),[g,y,u,m]),(0,n.useEffect)((()=>{if(h.length>0&&N){const e=setTimeout((()=>{const e=document.querySelector(".supplier-dropdown .p-dropdown-items li.p-dropdown-item:last-child");e&&(c.current=new IntersectionObserver((e=>{e[0].isIntersecting&&f((e=>e+1))})),c.current.observe(e))}),1e3);return()=>{clearTimeout(e),c.current&&c.current.disconnect()}}}),[h,N]);const C=(0,xe.jsxs)("div",{className:`${ue}`,children:[(0,xe.jsx)("div",{className:me,children:(0,xe.jsx)("img",{src:fe,alt:"Review Icon"})}),(0,xe.jsx)("span",{className:`white-space-nowrap ${pe}`,children:"Review"})]}),P=(0,xe.jsx)("div",{className:"d-flex justify-content-end align-items-center gap-3"});return(0,xe.jsxs)(S.l,{visible:t,modal:!0,onHide:a,header:C,footer:P,className:`${ce} custom-modal`,children:[(0,xe.jsxs)(l.A,{className:"mb-2",children:[(0,xe.jsx)(i.A,{sm:8,children:(0,xe.jsxs)("div",{className:"d-flex flex-column gap-1",children:[(0,xe.jsxs)("label",{className:(0,_.A)(U),children:["Supplier",(0,xe.jsx)("span",{className:"required",children:"*"})]}),(0,xe.jsx)(E.m,{value:u,options:h,optionLabel:"name",optionValue:"id",onChange:e=>{p(+e.value);let s=h.find((s=>s.id===e.value));x(s||{})},itemTemplate:e=>(0,xe.jsxs)("div",{className:"d-flex gap-2 align-items-center w-100",children:[(0,xe.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{width:"24px",height:"24px",borderRadius:"4px",overflow:"hidden",border:"1px solid #dedede"},children:(0,xe.jsx)(Ae.A,{photo:null===e||void 0===e?void 0:e.photo,has_photo:null===e||void 0===e?void 0:e.has_photo,is_business:!0,size:17})}),(0,xe.jsx)("div",{className:"ellipsis-width",style:{maxWidth:"350px"},children:null===e||void 0===e?void 0:e.name})]}),valueTemplate:e=>u?(0,xe.jsxs)("div",{className:"d-flex gap-2 align-items-center w-100",children:[(0,xe.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{width:"24px",height:"24px",borderRadius:"4px",overflow:"hidden",border:"1px solid #dedede"},children:(0,xe.jsx)(Ae.A,{photo:null===e||void 0===e?void 0:e.photo,has_photo:null===e||void 0===e?void 0:e.has_photo,is_business:!0,size:17})}),(0,xe.jsx)("div",{className:"ellipsis-width",style:{maxWidth:"350px"},children:null===e||void 0===e?void 0:e.name})]}):null,className:(0,_.A)(M,"dropdown-height-fixed"),panelClassName:"supplier-dropdown",style:{height:"46px"},scrollHeight:"350px",placeholder:"Search for supplier",filter:!0,onFilter:w,filterInputAutoFocus:!0})]})}),(0,xe.jsx)(i.A,{sm:4,children:(0,xe.jsx)("div",{className:"d-flex justify-content-end text-md-end flex-column gap-1 mt-3 pt-3",children:(0,xe.jsx)(j.N_,{to:"/suppliers?addNewSupplier=true",target:"_blank",children:(0,xe.jsxs)(o.A,{className:H,children:["Create New Supplier",(0,xe.jsx)(r.A,{size:24,color:"#475467"})]})})})})]}),(0,xe.jsx)("hr",{}),(0,xe.jsx)(l.A,{})]})})),Re=Pe}}]);
//# sourceMappingURL=9951.0c4fdabd.chunk.js.map