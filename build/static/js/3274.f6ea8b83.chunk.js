"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[3274],{23274:(e,t,l)=>{l.d(t,{A:()=>w});var s=l(65043),a=l(14282),n=l(61072),o=l(78602),i=l(93747),r=l(58387),d=l(75758),c=l(55797),u=l(88060),m=l(8868),p=l(28676),g=l(74532),h=l(72052),v=l(93740);const x={headerTitle:"send-email_headerTitle__cXbQd",customLabel:"send-email_customLabel__ulebR",bag:"send-email_bag__+1Isj",lable:"send-email_lable__pfv8S",dropdownSelect:"send-email_dropdownSelect__yuxmj",autoCompleteBox:"send-email_autoCompleteBox__zqO6y",AutoComplete:"send-email_AutoComplete__peyFk",bcc:"send-email_bcc__vHuNY",box:"send-email_box__KRxo7",active:"send-email_active__sUnBO",inputBox:"send-email_inputBox__cV-UR"};var b=l(81047),f=l(70579);const j=(0,f.jsx)("div",{className:`${x.modalHeader}`,children:(0,f.jsx)("div",{className:"w-100 d-flex align-items-center gap-2",children:(0,f.jsx)("span",{className:`white-space-nowrap mt-2 mb-2 ${x.headerTitle}`,children:"Send a Quote"})})}),y=(0,f.jsxs)("span",{className:"ql-formats",children:[(0,f.jsx)("button",{className:"ql-bold","aria-label":"Bold"}),(0,f.jsx)("button",{className:"ql-italic","aria-label":"Italic"}),(0,f.jsx)("button",{className:"ql-underline","aria-label":"Underline"}),(0,f.jsx)("button",{className:"ql-strike","aria-label":"Strikethrough"}),(0,f.jsx)("button",{className:"ql-blockquote","aria-label":"Blockquote"}),(0,f.jsx)("button",{className:"ql-list",value:"ordered","aria-label":"Ordered List"}),(0,f.jsx)("button",{className:"ql-list",value:"bullet","aria-label":"Bullet List"}),(0,f.jsx)("button",{className:"ql-align",value:"","aria-label":"Align Left"}),(0,f.jsx)("button",{className:"ql-align",value:"center","aria-label":"Align Center"}),(0,f.jsx)("button",{className:"ql-align",value:"right","aria-label":"Align Right"}),(0,f.jsx)("button",{className:"ql-align",value:"justify","aria-label":"Justify"}),(0,f.jsx)("button",{className:"ql-link","aria-label":"Insert Link"}),(0,f.jsx)("button",{className:"ql-image","aria-label":"Insert Image"}),(0,f.jsx)("button",{className:"ql-code-block","aria-label":"Code Block"})]}),w=e=>{var t,l,w,S;let{show:$,setShow:N,contactPersons:L,setPayload:A,save:C,defaultTemplate:T="Quote"}=e;const _=JSON.parse(window.localStorage.getItem("profileData")||"{}"),[E,U]=(0,s.useState)(""),[R,q]=(0,s.useState)([]),[k,B]=(0,s.useState)([]),[F,I]=(0,s.useState)([]),[O,P]=(0,s.useState)(null),[G,K]=(0,s.useState)(null),[M,Q]=(0,s.useState)(null),[D,J]=(0,s.useState)({}),[H,z]=(0,s.useState)([]),V=(0,s.useRef)(null),X=(0,s.useRef)(null),Y=(0,s.useRef)(null),[W,Z]=(0,s.useState)(!1),[ee,te]=(0,s.useState)(!1),[le,se]=(0,s.useState)(!1),[ae,ne]=(0,s.useState)(null),oe=(0,i.I)({queryKey:["emailTemplate"],queryFn:b.SQ}),ie=(0,i.I)({queryKey:["getSignatureTemplates"],queryFn:b.AO}),re=(0,i.I)({queryKey:["getOutgoingEmail"],queryFn:b.hx}),de=(0,i.I)({queryKey:["emailQuery",ae],queryFn:()=>(0,b.hS)(ae),enabled:!!ae,retry:1});(0,s.useEffect)((()=>{var e,t,l;null!==re&&void 0!==re&&re.data&&(null!==re&&void 0!==re&&null!==(e=re.data)&&void 0!==e&&e.outgoing_email&&null!==re&&void 0!==re&&null!==(t=re.data)&&void 0!==t&&t.outgoing_email_verified?U(null===re||void 0===re||null===(l=re.data)||void 0===l?void 0:l.outgoing_email):U("no-reply@memate.com.au"));if(null!==oe&&void 0!==oe&&oe.data){var s;const e=null===oe||void 0===oe||null===(s=oe.data)||void 0===s?void 0:s.find((e=>e.type===T));null!==e&&void 0!==e&&e.id&&ne(null===e||void 0===e?void 0:e.id)}}),[oe,re]);const ce=(0,f.jsxs)("div",{className:"d-flex justify-content-end gap-2",children:[(0,f.jsx)(a.A,{className:"outline-button",onClick:()=>N(!1),children:"Cancel"}),(0,f.jsxs)(a.A,{disabled:le,className:"solid-button",onClick:async()=>{let e=0;J({}),E||(++e,J((e=>({...e,from:!0})))),0===(null===R||void 0===R?void 0:R.length)&&(++e,J((e=>({...e,to:!0})))),O||(++e,J((e=>({...e,subject:!0})))),G||(++e,J((e=>({...e,text:!0})))),e||(se(!0),await C(),se(!1))},children:["Send"," ",le&&(0,f.jsx)(v.p,{style:{width:"20px",height:"20px",color:"#fff"}})]})]}),ue=e=>{var t;const l=(null===e||void 0===e||null===(t=e.query)||void 0===t?void 0:t.toLowerCase())||"";let s=L.map((e=>e.email));s=s.filter((e=>!R.includes(e))),s=s.filter((e=>!k.includes(e))),s=s.filter((e=>!F.includes(e))),s=s.filter((e=>e.toLowerCase().includes(l))),console.log("emails: ",s),z(s)},me=()=>{ue(),V.current&&V.current.show()},pe=()=>{ue(),X.current&&X.current.show()},ge=()=>{ue(),Y.current&&Y.current.show()};return(0,s.useEffect)((()=>{if(null!==L&&void 0!==L&&L.length){let e=L.map((e=>e.email));z(e)}}),[L]),(0,s.useEffect)((()=>{A((e=>({...e,subject:O,email_body:G,from_email:E,to:null===R||void 0===R?void 0:R.toString(),...k.length>0&&{cc:k.toString()},...F.length>0&&{bcc:F.toString()},...M&&{signature:M}})))}),[O,G,E,R,k,F,M,A]),(0,s.useEffect)((()=>{var e,t;null!==ie&&void 0!==ie&&ie.data&&Q(null===ie||void 0===ie||null===(e=ie.data)||void 0===e||null===(t=e.find((e=>e.id===_.email_signature)))||void 0===t?void 0:t.id)}),[null===ie||void 0===ie?void 0:ie.data,_.email_signature]),(0,s.useEffect)((()=>{var e,t;K((null===de||void 0===de||null===(e=de.data)||void 0===e?void 0:e.body)||""),P(null===de||void 0===de||null===(t=de.data)||void 0===t?void 0:t.subject),J((e=>({...e,subject:!1}))),J((e=>({...e,text:!1})))}),[null===de||void 0===de?void 0:de.data]),(0,f.jsxs)(c.l,{visible:$,modal:!0,header:j,footer:ce,className:`${x.modal} custom-modal`,style:{width:"896px"},onHide:()=>N(!1),children:[(0,f.jsxs)(n.A,{children:[(0,f.jsxs)(o.A,{sm:6,className:"mb-3",children:[(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)("label",{className:(0,r.A)(x.customLabel),children:"FROM"}),(0,f.jsx)(u.m,{options:re&&(null===re||void 0===re?void 0:re.data)&&[{value:null===re||void 0===re||null===(t=re.data)||void 0===t?void 0:t.outgoing_email,label:`${null===re||void 0===re||null===(l=re.data)||void 0===l?void 0:l.outgoing_email}`}]||[],className:(0,r.A)(x.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"60px"},placeholder:"Select from email",onChange:e=>{U(e.value),J((e=>({...e,from:!1})))},value:E,filterInputAutoFocus:!0})]}),(null===D||void 0===D?void 0:D.from)&&(0,f.jsx)("p",{className:"error-message mb-0",children:"From email is required"})]}),(0,f.jsx)(o.A,{sm:6,className:"mb-3",children:(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)("label",{className:(0,r.A)(x.customLabel),children:"Templates"}),(0,f.jsx)(u.m,{options:oe&&(null===(w=oe.data)||void 0===w?void 0:w.map((e=>({value:e.id,label:`${e.name}`}))))||[],className:(0,r.A)(x.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select template",onChange:e=>{ne(e.value)},value:ae,loading:null===oe||void 0===oe?void 0:oe.isFetching,filterInputAutoFocus:!0})]})})]}),(0,f.jsxs)(n.A,{children:[(0,f.jsxs)(o.A,{sm:12,className:"mb-3",children:[(0,f.jsxs)("div",{className:"d-flex gap-3 w-100",children:[(0,f.jsxs)("div",{style:{position:"relative"},className:x.autoCompleteBox,children:[(0,f.jsx)("div",{style:{width:"50px"},className:x.bag}),(0,f.jsx)("label",{className:(0,r.A)(x.customLabel),children:"TO"}),(0,f.jsx)(d.j,{ref:V,value:R,completeMethod:ue,onChange:e=>{q(e.value),J((e=>({...e,to:!1})))},multiple:!0,suggestions:H,onClick:me,onFocus:me,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const l=t.split(/[\s,]+/).filter((e=>e));q((e=>[...new Set([...e,...l])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(q((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,r.A)(x.AutoComplete,"w-100"),placeholder:"TO"})]}),(0,f.jsx)(a.A,{className:(0,r.A)(x.box,{[x.active]:W}),onClick:()=>{Z(!W),B([])},children:"CC"}),(0,f.jsx)(a.A,{className:(0,r.A)(x.box,{[x.active]:ee}),onClick:()=>{te(!ee),I([])},children:"BCC"})]}),(null===D||void 0===D?void 0:D.to)&&(0,f.jsx)("p",{className:"error-message mb-0",children:"To email is required"})]}),W&&(0,f.jsx)(o.A,{sm:6,className:"mb-3",children:(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)("div",{style:{width:"50px"},className:x.bag}),(0,f.jsx)("label",{className:(0,r.A)(x.customLabel),children:"CC"}),(0,f.jsx)(d.j,{ref:X,value:k,completeMethod:ue,onChange:e=>{B(e.value)},multiple:!0,suggestions:H,onClick:pe,onFocus:pe,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const l=t.split(/[\s,]+/).filter((e=>e));B((e=>[...new Set([...e,...l])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(B((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,r.A)(x.AutoComplete,"w-100"),placeholder:"CC"})]})}),ee&&(0,f.jsx)(o.A,{sm:6,className:"mb-3",children:(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)("div",{style:{width:"60px"},className:x.bag}),(0,f.jsx)("label",{className:(0,r.A)(x.customLabel),children:"BCC"}),(0,f.jsx)(d.j,{ref:Y,value:F,completeMethod:ue,onChange:e=>{I(e.value)},multiple:!0,suggestions:H,onClick:ge,onFocus:ge,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const l=t.split(/[\s,]+/).filter((e=>e));I((e=>[...new Set([...e,...l])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(I((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,r.A)(x.AutoComplete,x.bcc,"w-100"),placeholder:"BCC"})]})}),(0,f.jsxs)(o.A,{sm:12,className:"mb-2",children:[(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)("div",{style:{width:"60px"},className:x.bag}),(0,f.jsx)("label",{className:(0,r.A)(x.customLabel),children:"SUBJECT"}),(0,f.jsxs)(p.C,{children:[(0,f.jsx)(g.m,{children:(null===de||void 0===de?void 0:de.isFetching)&&(0,f.jsx)(v.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,f.jsx)(h.S,{value:O,className:(0,r.A)(x.inputBox,"w-100"),style:{paddingLeft:"100px"},onChange:e=>{P(e.target.value),J((e=>({...e,subject:!1})))},placeholder:"{Organization} | Quotation: {number} | {reference}"})]})]}),(null===D||void 0===D?void 0:D.subject)&&(0,f.jsx)("p",{className:"error-message mb-0",children:"Subject is required"})]}),(0,f.jsxs)(o.A,{sm:12,className:"mb-3",children:[(0,f.jsxs)("div",{className:"d-flex flex-column gap-1",style:{position:"relative"},children:[(0,f.jsx)("label",{className:(0,r.A)(x.lable),children:"Message"}),(0,f.jsx)(g.m,{style:{position:"absolute",right:"15px",top:"40px",zIndex:1},children:(null===de||void 0===de?void 0:de.isFetching)&&(0,f.jsx)(v.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,f.jsx)(m.K,{style:{minHeight:"150px"},headerTemplate:y,value:G,placeholder:"Enter a description...",onTextChange:e=>{K(e.htmlValue),J((e=>({...e,text:!1})))}})]}),(null===D||void 0===D?void 0:D.text)&&(0,f.jsx)("p",{className:"error-message mb-0",children:"Message is required"})]}),(0,f.jsx)(o.A,{sm:12,children:(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)("label",{className:(0,r.A)(x.customLabel),children:"Signature"}),(0,f.jsx)(u.m,{options:ie&&(null===(S=ie.data)||void 0===S?void 0:S.map((e=>({value:e.id,label:`${e.name}`}))))||[],panelClassName:"px880-dropdown-item",className:(0,r.A)(x.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select signature",onChange:e=>{Q(e.value)},value:M,loading:null===ie||void 0===ie?void 0:ie.isFetching,filterInputAutoFocus:!0})]})})]})]})}},31342:(e,t,l)=>{l.d(t,{f:()=>s});const s=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{method:s="GET",headers:a={},body:n}=t,o=localStorage.getItem("access_token"),i=n instanceof FormData,r={"Content-Type":i?"multipart/form-data":"application/json",...a};l&&(r.Authorization=`Bearer ${o}`);const d={method:s,headers:r,body:i?n:JSON.stringify(n),redirect:"follow"};try{const t=new URL(e),l=await fetch(t,d),s=l.headers.get("Content-Type");if(!l.ok){var c;let e=null;e=s&&s.includes("application/json")?await l.json():await l.text(),401===l.status&&(localStorage.clear(),sessionStorage.clear(),window.location.replace("/login"));const t=new Error((null===(c=e)||void 0===c?void 0:c.message)||`HTTP error! Status: ${l.status}`);throw t.status=l.status,t.data=e,t}if(s&&s.includes("application/json"))return await l.json();return{message:"Non-JSON response",body:await l.text()}}catch(u){throw console.error("Fetch API error:",u),u}}},81047:(e,t,l)=>{l.d(t,{AO:()=>g,Ad:()=>w,Bz:()=>_,Hb:()=>u,IT:()=>T,Kb:()=>i,Mp:()=>y,Pf:()=>N,Rh:()=>S,SQ:()=>c,T6:()=>v,UM:()=>f,VQ:()=>C,Xm:()=>d,bd:()=>A,bj:()=>h,gY:()=>x,hS:()=>p,hx:()=>L,iS:()=>o,p4:()=>r,pJ:()=>j,rJ:()=>$,s:()=>m,sB:()=>b,tC:()=>n});var s=l(31342);const a="https://dev.memate.com.au/api/v1",n=async()=>{const e=new URL(`${a}/jobs/templates/`);return(0,s.f)(e.toString(),{method:"GET"})},o=async e=>{const t=new URL(`${a}${`/jobs/templates/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},i=async e=>{const t={method:"POST",body:e},l=new URL(`${a}/jobs/templates/`);return(0,s.f)(l.toString(),t)},r=async(e,t)=>{const l={method:"PUT",body:t},n=new URL(`${a}${`/jobs/templates/${e}/`}`);return(0,s.f)(n.toString(),l)},d=async e=>{const t=new URL(`${a}${`/jobs/templates/${e}/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},c=async()=>{const e=new URL(`${a}/settings/templates/email-templates/`);return(0,s.f)(e.toString(),{method:"GET"})},u=async e=>{const t={method:"POST",body:e},l=new URL(`${a}/settings/templates/email-templates/`);return(0,s.f)(l.toString(),t)},m=async(e,t)=>{const l={method:"PUT",body:t},n=new URL(`${a}${`/settings/templates/email-templates/${e}/`}`);return(0,s.f)(n.toString(),l)},p=async e=>{const t=new URL(`${a}${`/settings/templates/email-templates/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},g=async()=>{const e=new URL(`${a}/email-signatures/`);return(0,s.f)(e.toString(),{method:"GET"})},h=async e=>{const t=new URL(`${a}${`/email-signatures/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},v=async e=>{const t={method:"POST",body:e},l=new URL(`${a}/email-signatures/`);return(0,s.f)(l.toString(),t)},x=async(e,t)=>{const l={method:"PUT",body:t},n=new URL(`${a}${`/email-signatures/${e}/`}`);return(0,s.f)(n.toString(),l)},b=async e=>{const t=new URL(`${a}${`/email-signatures/${e}/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},f=async e=>{const t=new URL(`${a}${`/settings/email-signatures/default/${e}/`}`);return(0,s.f)(t.toString(),{method:"PUT"})},j=async()=>{const e=new URL(`${a}/sms-templates/`);return(0,s.f)(e.toString(),{method:"GET"})},y=async e=>{const t=new URL(`${a}${`/sms-templates/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},w=async e=>{const t={method:"POST",body:e},l=new URL(`${a}/sms-templates/`);return(0,s.f)(l.toString(),t)},S=async(e,t)=>{const l={method:"PUT",body:t},n=new URL(`${a}${`/sms-templates/${e}/`}`);return(0,s.f)(n.toString(),l)},$=async e=>{const t=new URL(`${a}${`/sms-templates/${e}/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},N=async e=>{const t=new URL(`${a}${`/proposals/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},L=async()=>{const e=new URL(`${a}/references/outgoing-email/`);return(0,s.f)(e.toString(),{method:"GET"})},A=async e=>{const t=new URL(`${a}${`/settings/templates/email-templates/${e}/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},C=async()=>{const e=new URL(`${a}/settings/proposals/`);return(0,s.f)(e.toString(),{method:"GET"})},T=async e=>{const t=new URL(`${a}${`/settings/proposals/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},_=async e=>{const t=new URL(`${a}${`/settings/proposals/delete/${e}/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})}}}]);
//# sourceMappingURL=3274.f6ea8b83.chunk.js.map