(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[9439],{32224:(e,t,o)=>{var a={"./ckb.js":23743,"./cs.js":7333,"./da.js":11664,"./de.js":30844,"./en.js":5460,"./es.js":6151,"./fa.js":96062,"./fr.js":27755,"./he.js":3296,"./hu.js":33776,"./index.js":70559,"./it.js":54762,"./ja.js":80074,"./km.js":27671,"./ko.js":20665,"./lv.js":90749,"./nl.js":66449,"./pl.js":48599,"./pt_br.js":48366,"./ro.js":73100,"./ru.js":34638,"./se.js":55111,"./tr.js":10057,"./ua.js":79657,"./ur.js":64640,"./zh_cn.js":25277};function s(e){var t=n(e);return o(t)}function n(e){if(!o.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}s.keys=function(){return Object.keys(a)},s.resolve=n,e.exports=s,s.id=32224},65425:(e,t,o)=>{"use strict";o.d(t,{R:()=>c});var a=o(65043),s=o(86213),n=o(56328),r=o(9266),l=o.n(r),i=(o(23475),o(70579));const c=e=>{let{value:t="",onChange:o,placeholder:r="Enter content...",height:c=299,showTable:d=!0,showLink:p=!0,disabled:u=!1,className:h="",customOptions:g={},onLoad:m,onFocus:x,onBlur:f,enableS3Upload:b=!1,s3UploadEndpoint:C=null,uploadId:j=null,...v}=e;const[w,F]=(0,a.useState)({}),[y,E]=(0,a.useState)(!1),[A,_]=(0,a.useState)(!1),S=(0,a.useRef)(new Map);(0,a.useEffect)((()=>{const e=setInterval((()=>{const e=S.current;if(e.size>50){const t=Array.from(e.entries()).slice(-25);S.current=new Map(t),console.log("Cleaned up upload cache, kept",t.length,"entries")}}),6e4);return()=>clearInterval(e)}),[]);const R=(0,a.useRef)(null),P=(0,a.useRef)(null),k=(0,a.useCallback)((e=>{if(!e||"string"!==typeof e)return!1;return[/^https?:\/\/.*\.s3\..*\.amazonaws\.com\//,/^https?:\/\/s3\..*\.amazonaws\.com\//,/^https?:\/\/.*\.s3\.amazonaws\.com\//,/^https?:\/\/.*\.digitaloceanspaces\.com\//,new RegExp(`^https?://${{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_BACKEND_API_URL:"https://app.memate.com.au/api/v1",REACT_APP_URL:"https://app.memate.com.au",REACT_APP_CHAT_API_URL:"https://chat.memate.com.au",REACT_APP_STATIC_WEBSITE_URL:"https://memate.com.au/",REACT_APP_XERO_CLIENT_ID:"CF33702DD2CA4E49ADF22C2BE94C9EBB",REACT_APP_STRIPE_PUBLISH_KEY:"pk_live_51KGzf3BrpZbmIWreM2EqPPXT1fl5FCl0hd5RX0NGjmNKWkMrz4m3ydFDhFSqV2TGXOYcl3AOdhBEzXILYRajp1LI00MOA7DM31",REACT_APP_HUBSPOT_PORTAL_ID:"241966069",REACT_APP_HUBSPOT_FORM_ID:"39ad4b7b-9757-48e2-97d1-ac46aa95862c"}.REACT_APP_S3_BUCKET||".*"}\\.s3\\..*\\.amazonaws\\.com/`)].some((t=>t.test(e)))}),[]),B=(0,a.useCallback)((e=>{const t=/<img[^>]+src="([^"]+)"[^>]*>/gi,o=[],a=[],s=[];let n;for(;null!==(n=t.exec(e));){const e=n[0],t=n[1];if(t.startsWith("data:image/")){const a=t.match(/^data:image\/([^;]+);base64,(.+)$/);a&&o.push({fullMatch:e,format:a[1],base64Data:a[2],src:t,index:n.index})}else k(t)?a.push({fullMatch:e,src:t,index:n.index}):s.push({fullMatch:e,src:t,index:n.index})}return{base64Images:o,s3Images:a,otherImages:s}}),[k]),I=(0,a.useCallback)(((e,t,o)=>{const a=e.replace(/^data:image\/[a-z]+;base64,/,""),s=atob(a),n=new Array(s.length);for(let i=0;i<s.length;i++)n[i]=s.charCodeAt(i);const r=new Uint8Array(n),l=new Blob([r],{type:`image/${t}`});return new File([l],o,{type:`image/${t}`})}),[]),D=(0,a.useCallback)((async(e,t)=>{if(!b)return null;const o=btoa(e.substring(0,100));if(S.current.has(o)){const e=S.current.get(o);return console.log("Using cached S3 URL for image:",e),e}try{const a=`image-${Date.now()}.${t}`,n=I(e,t,a),r=localStorage.getItem("access_token"),l=C||`https://app.memate.com.au/api/v1/proposals/file/${j}/`,i=await s.A.post(l,{file_name:a},{headers:{Authorization:`Bearer ${r}`}}),{url:c}=i.data;if(!c)throw new Error("Failed to get upload URL");await s.A.put(c,n,{headers:{"Content-Type":""}});const d=c.split("?")[0]||"";return S.current.set(o,d),console.log("Cached new upload:",d),d}catch(a){throw console.error("Error uploading base64 image to S3:",a),a}}),[b,C,j,I]),N=(0,a.useCallback)((async(e,t)=>s.A.put(t,e,{headers:{"Content-Type":""},onUploadProgress:e=>{const t=Math.round(e.loaded/e.total*100);F({progress:t,uploading:!0})}}).then((e=>{if(200!==e.status&&201!==e.status)throw new Error(`Upload failed with status: ${e.status}`);{F({progress:100,success:!0,uploading:!1});const e=t.split("?")[0]||"";console.log("S3 upload successful, inserting image:",e),n.oR.success("Image uploaded successfully"),setTimeout((()=>{F({})}),2e3)}})).catch((e=>{throw console.log("Error uploading to S3: ",e),console.log("Error response:",e.response),F({progress:0,error:!0,uploading:!1}),n.oR.error("Failed to upload image to S3"),e}))),[]),T=(0,a.useCallback)((async e=>{if(e&&b)try{var t,o,a;const r=null===e||void 0===e||null===(t=e.name)||void 0===t?void 0:t.split(".")[0],l=null===e||void 0===e||null===(o=e.name)||void 0===o||null===(a=o.split("."))||void 0===a?void 0:a.pop(),i=`proposal-images/${r}-${Date.now()}.${l}`;F({progress:0,uploading:!0});const c=localStorage.getItem("access_token"),d=C||`https://app.memate.com.au/api/v1/proposals/file/${j}/`,p=await s.A.post(d,{filename:i},{headers:{Authorization:`Bearer ${c}`}}),{url:u}=p.data;if(!u)return F({progress:0,error:!0,uploading:!1}),void n.oR.error("Failed to get upload URL. Please try again.");await N(e,u)}catch(l){var r;null!==(r=l.message)&&void 0!==r&&r.includes("Upload failed with status")||(F({progress:0,error:!0,uploading:!1}),console.error("Error in fileUploadBySignedURL:",l),n.oR.error("Failed to upload file. Please try again."))}}),[N,b,C,j]),U=(0,a.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),b&&E(!0)}),[b]),L=(0,a.useCallback)((e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget.getBoundingClientRect(),o=e.clientX,a=e.clientY;(o<t.left||o>t.right||a<t.top||a>t.bottom)&&E(!1)}),[]),z=(0,a.useCallback)((e=>{e.preventDefault(),e.stopPropagation()}),[]),$=(0,a.useCallback)((async e=>{if(e.preventDefault(),e.stopPropagation(),E(!1),!b)return;const t=e.dataTransfer.files;if(t&&t.length>0){const e=t[0];if(e.size>10485760)return void n.oR.error("File size must be less than 10MB");if(!e.type.startsWith("image/"))return void n.oR.error("Please select a valid image file");await T(e)}}),[T,b]),O={buttonList:(()=>{const e=[["undo","redo"],["bold","italic","underline","strike"],["formatBlock"],["list"],["align"],["image"]];return p&&e.push(["link"]),d&&e.push(["table"]),e})(),height:c,placeholder:r,showPathLabel:!1,charCounter:!1,resizingBar:!1,disable:u,imageUploadUrl:b?null:void 0,table:{headerStyle:"background-color: #f8f9fa; font-weight: bold; padding: 8px; min-width: 50px; border: none;",cellStyle:"padding: 8px; min-width: 50px; border: none;"},imageUploadHeader:b?void 0:{Authorization:`Bearer ${localStorage.getItem("access_token")||""}`},formats:["p","div","h1","h2","h3","h4","h5","h6"],font:["Arial","Helvetica","Georgia","Times New Roman","Courier New"],fontSize:[8,9,10,11,12,14,16,18,20,22,24,26,28,36,48,72],colorList:[["#000000","#424242","#636363","#9C9C94","#CEC6CE","#EFEFEF","#F7F3F7","#FFFFFF"],["#FF0000","#FF9C00","#FFFF00","#00FF00","#00FFFF","#0000FF","#9C00FF","#FF00FF"],["#F7C6CE","#FFE7CE","#FFEFC6","#D6EFD6","#CEDEE7","#CEE7F7","#D6D6E7","#E7D6DE"],["#E79C9C","#FFC69C","#FFE79C","#B5D6A5","#A5C6CE","#9CC6EF","#B5A5D6","#D6A5BD"],["#E76363","#FF9C63","#FFCE63","#9CDE9C","#63B5CE","#639CFF","#9C63E7","#CE639C"],["#E73131","#FF7031","#FFB531","#73DE73","#319CCE","#3173FF","#7331E7","#CE3173"],["#9C0000","#B56308","#9C9C00","#089C00","#008294","#0031FF","#4A0A77","#9C005A"],["#630000","#7B3900","#636300","#006300","#005A6B","#002173","#290A4A","#630039"]]},M={...O,...g,buttonList:g.buttonList||O.buttonList};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("style",{children:"\n                @keyframes spin {\n                    0% { transform: rotate(0deg); }\n                    100% { transform: rotate(360deg); }\n                }\n                \n                /* Remove all table borders in SunEditor */\n                .sun-editor-wrapper .se-wrapper-inner table,\n                .sun-editor-wrapper .se-wrapper-inner table td,\n                .sun-editor-wrapper .se-wrapper-inner table th,\n                .sun-editor-wrapper .se-wrapper-inner table tr {\n                    border: none !important;\n                    outline: none !important;\n                    border-collapse: collapse !important;\n                }\n                \n                /* Also remove borders when content is rendered outside editor */\n                .sun-editor-content table,\n                .sun-editor-content table td,\n                .sun-editor-content table th,\n                .sun-editor-content table tr {\n                    border: none !important;\n                    outline: none !important;\n                    border-collapse: collapse !important;\n                }\n            "}),(0,i.jsxs)("div",{className:`sun-editor-wrapper ${h}`,style:{position:"relative"},onDragEnter:U,onDragLeave:L,onDragOver:z,onDrop:$,children:[(0,i.jsx)(l(),{ref:R,setOptions:M,setContents:t,onChange:async e=>{if(console.log("content: ",e),b&&e&&"string"===typeof e){const{base64Images:a,s3Images:s}=B(e);if(console.log(`Image analysis: ${a.length} base64, ${s.length} S3, total images: ${a.length+s.length}`),a.length>0){console.log(`Found ${a.length} new base64 image(s) to upload (skipping ${s.length} existing S3 images)`),_(!0);try{let t=e;for(const e of a){const{fullMatch:o,format:a,base64Data:s}=e,n=await D(s,a);if(n){const e=o.replace(/src="data:image\/[^;]+;base64,[^"]+"/,`src="${n}"`);t=t.replace(o,e),console.log("Replaced base64 image with S3 URL:",n)}}if(_(!1),o&&t!==e)return void o(t)}catch(t){console.error("Error processing base64 images:",t),_(!1),n.oR.error("Failed to upload images. Please try again.")}}else s.length>0&&console.log("Content contains only S3 images, no upload needed")}o&&o(e)},onLoad:e=>{if(P.current=e,R.current){const e=R.current.getInstance();e&&Object.keys(e).length>0&&(P.current=e)}m&&m(e)},onFocus:(e,t)=>{x&&x(e,t)},onBlur:(e,t)=>{f&&f(e,t)},...v}),y&&b?(0,i.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(52, 152, 219, 0.1)",border:"2px dashed #3498db",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999,borderRadius:"4px"},children:(0,i.jsxs)("div",{style:{textAlign:"center",color:"#3498db",fontSize:"16px",fontWeight:"500"},children:[(0,i.jsx)("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"\ud83d\udcc1"}),"Drop your image here"]})}):null,null!==w&&void 0!==w&&w.uploading||null!==w&&void 0!==w&&w.success||null!==w&&void 0!==w&&w.error||A?(0,i.jsxs)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.9)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"4px"},children:[(w.uploading||A)&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{width:"60px",height:"60px",border:"4px solid #f3f3f3",borderTop:"4px solid #3498db",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"16px"}}),(0,i.jsx)("div",{style:{fontSize:"14px",fontWeight:"500",color:"#333",marginBottom:"8px"},children:A?"Processing images...":"Uploading image..."}),w.uploading&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{width:"200px",height:"6px",backgroundColor:"#f0f0f0",borderRadius:"3px",overflow:"hidden"},children:(0,i.jsx)("div",{style:{width:`${w.progress}%`,height:"100%",backgroundColor:"#3498db",transition:"width 0.3s ease"}})}),(0,i.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:[w.progress,"%"]})]})]}),w.success&&(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("div",{style:{width:"50px",height:"50px",backgroundColor:"#27ae60",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:(0,i.jsx)("span",{style:{color:"white",fontSize:"24px"},children:"\u2713"})}),(0,i.jsx)("div",{style:{fontSize:"14px",color:"#27ae60"},children:"Upload completed!"})]}),w.error&&(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("div",{style:{width:"50px",height:"50px",backgroundColor:"#e74c3c",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:(0,i.jsx)("span",{style:{color:"white",fontSize:"24px"},children:"\u2717"})}),(0,i.jsx)("div",{style:{fontSize:"14px",color:"#e74c3c"},children:"Upload failed"})]})]}):null]})]})};o(95903)},87160:(e,t,o)=>{"use strict";o.d(t,{A:()=>j});var a=o(65043),s=o(32952),n=o(14282),r=o(76163),l=o(69956),i=o(89488),c=o(55683),d=o(58387),p=o(29853),u=o(56328);const h="file-uploader_title__MJFJ7",g="file-uploader_previewSection__ot4jI",m="file-uploader_previewBox__KC4if",x="file-uploader_previewBoxImg1__rKP04",f="file-uploader_previewActions__r3LWm",b="file-uploader_label__pWhYK";var C=o(70579);const j=e=>{let{show:t,setShow:o,setPhoto:j,additionalDesign:v,shape:w="rect"}=e;const[F,y]=(0,a.useState)([]),[E,A]=(0,a.useState)({x:0,y:0}),[_,S]=(0,a.useState)(1),[R,P]=(0,a.useState)(0),[k,B]=(0,a.useState)(null),[I,D]=(0,a.useState)({}),N=(0,a.useCallback)(((e,t)=>{B(t)}),[]),T=(0,a.useCallback)((async()=>{if(!F.length||!k)return;const e=document.createElement("canvas"),t=e.getContext("2d"),o=new Image;o.src=F[0].preview,await new Promise((e=>o.onload=e)),e.width=k.width,e.height=k.height,t.translate(e.width/2,e.height/2),t.rotate(R*Math.PI/180),t.translate(-e.width/2,-e.height/2),t.drawImage(o,k.x,k.y,k.width,k.height,0,0,k.width,k.height);return e.toDataURL("image/jpeg")}),[F,k,R]),U=async()=>{const e=await T();e&&D({img2:e,img3:e,img4:e,img5:e})};(0,a.useEffect)((()=>{U()}),[_,E,R,F,k]);const{getRootProps:L,getInputProps:z}=(0,i.VB)({maxFiles:1,accept:{"image/*":[]},onDrop:e=>{y(e.map((e=>Object.assign(e,{preview:URL.createObjectURL(e)}))))}});return(0,C.jsxs)(s.A,{style:{zIndex:1111},show:t,centered:!0,onHide:()=>o(!1),onShow:U,children:[(0,C.jsx)(s.A.Header,{closeButton:!0,children:(0,C.jsx)(s.A.Title,{children:(0,C.jsx)("span",{className:`${h}`,children:"Edit Photo"})})}),(0,C.jsxs)(s.A.Body,{children:[v,(0,C.jsxs)("div",{className:`${g}`,children:[(0,C.jsx)("div",{className:`${m}`,children:(0,C.jsx)("div",{className:(0,d.A)(x,"round"===w?"rounded-circle":""),children:(0,C.jsx)(c.Ay,{image:F.length>0?F[0].preview:null,crop:E,zoom:_,cropShape:w,rotation:R,onCropChange:A,onZoomChange:S,onCropComplete:N,aspect:1.5,restrictPosition:!1,style:{containerStyle:{width:"100%",height:"100%",position:"relative"},cropAreaStyle:{width:"100%",height:"100%"},mediaStyle:{width:"100%",height:"100%",objectFit:"contain"}}})})}),(0,C.jsxs)("div",{className:`${f}`,children:[(0,C.jsxs)(p.A.Group,{children:[(0,C.jsx)(p.A.Label,{className:`${b}`,children:"Zoom"}),(0,C.jsx)(p.A.Range,{value:_,min:1,max:3,step:.1,className:"custom-range",onChange:e=>S(e.target.value)})]}),(0,C.jsx)("div",{className:"d-flex align-item-center pt-4 ms-4",style:{gap:"8px"},children:(0,C.jsxs)(n.A,{className:"text-button",onClick:()=>{P((e=>(e+90)%360))},children:[(0,C.jsx)(r.A,{color:"#106B99",size:24}),"Rotate"]})})]})]}),(0,C.jsxs)("div",{...L({className:"dropzone d-flex justify-content-center align-items-center flex-column"}),style:{width:"100%",height:"126px",background:"#fff",borderRadius:"4px",border:"1px solid #EAECF0",marginTop:"16px"},children:[(0,C.jsx)("input",{...z()}),(0,C.jsx)("button",{type:"button",className:"d-flex justify-content-center align-items-center",style:{width:"40px",height:"40px",border:"1px solid #EAECF0",background:"#fff",borderRadius:"8px",marginBottom:"16px"},children:(0,C.jsx)(l.A,{})}),(0,C.jsxs)("p",{className:"mb-0",style:{color:"#475467",fontSize:"14px"},children:[(0,C.jsx)("span",{style:{color:"#106B99",fontWeight:"600"},children:"Click to upload"})," or drag and drop"]}),(0,C.jsx)("span",{style:{color:"#475467",fontSize:"12px"},children:"SVG, PNG, JPG or GIF (max. 800x400px)"})]})]}),(0,C.jsxs)(s.A.Footer,{className:"d-flex justify-content-end",children:[(0,C.jsx)(n.A,{className:"outline-button",onClick:e=>{e.stopPropagation(),y([]),D({}),o(!1)},children:"Cancel"}),(0,C.jsx)(n.A,{className:"solid-button",onClick:async()=>{const e=await T();if(!e)return u.oR.error("Please select a photo");const t=function(e,t){const o=atob(e.split(",")[1]),a=new ArrayBuffer(o.length),s=new Uint8Array(a);for(let n=0;n<o.length;n++)s[n]=o.charCodeAt(n);return new Blob([a],{type:t})}(e,"image/jpeg");j({croppedImageBase64:e,croppedImageBlob:t}),o(!1),y([]),D({})},children:"Save Photo"})]})]})}},95903:(e,t,o)=>{"use strict";o.d(t,{w:()=>s});var a=o(70579);const s=()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{className:"ql-formats",children:[(0,a.jsx)("button",{className:"ql-bold me-1","aria-label":"Bold"}),(0,a.jsx)("button",{className:"ql-italic me-1","aria-label":"Italic"}),(0,a.jsx)("button",{className:"ql-underline me-1","aria-label":"Underline"})]}),(0,a.jsxs)("span",{className:"ql-formats",children:[(0,a.jsx)("button",{className:"ql-list me-1",value:"ordered","aria-label":"Ordered List"}),(0,a.jsx)("button",{className:"ql-list me-1",value:"bullet","aria-label":"Unordered List"}),(0,a.jsx)("button",{className:"ql-indent me-1",value:"-1","aria-label":"Indent"}),(0,a.jsx)("button",{className:"ql-indent me-1",value:"+1","aria-label":"Outdent"})]}),(0,a.jsxs)("span",{className:"ql-formats",children:[(0,a.jsxs)("select",{className:"ql-size me-1",children:[(0,a.jsx)("option",{value:"small",children:"Small"}),(0,a.jsx)("option",{value:"",selected:!0,children:"Normal"}),(0,a.jsx)("option",{value:"large",children:"Large"}),(0,a.jsx)("option",{value:"huge",children:"Huge"})]}),(0,a.jsx)("select",{className:"ql-color me-1"}),(0,a.jsx)("button",{className:"ql-link me-1",value:"+1","aria-label":"Outdent"})]})]})}}]);
//# sourceMappingURL=9439.1ef0831a.chunk.js.map