"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[1242],{81242:(e,l,a)=>{a.d(l,{A:()=>y});var s=a(65043),i=a(32952),t=a(61072),n=a(78602),o=a(14282),d=a(77918),c=a(28261),r=a(58387),u=a(75758),m=a(88060),v=a(8868),g=a(28676),h=a(74532),x=a(72052),p=a(18226),b=a(93740);const f={headerTitle:"send-email_headerTitle__50KUB",customLabel:"send-email_customLabel__r5xED",templateInfo:"send-email_templateInfo__mWkVT",bag:"send-email_bag__wtdwK",lable:"send-email_lable__+kNCa",dropdownSelect:"send-email_dropdownSelect__RY5w8",autoCompleteBox:"send-email_autoCompleteBox__fWZ7C",AutoComplete:"send-email_AutoComplete__m9YI5",bcc:"send-email_bcc__BwFzl",box:"send-email_box__Zlmer",active:"send-email_active__vEx4h",inputBox:"send-email_inputBox__NpU2b"};var j=a(81047),C=a(70579);const N=(0,C.jsxs)("span",{className:"ql-formats",children:[(0,C.jsx)("button",{className:"ql-bold","aria-label":"Bold"}),(0,C.jsx)("button",{className:"ql-italic","aria-label":"Italic"}),(0,C.jsx)("button",{className:"ql-underline","aria-label":"Underline"}),(0,C.jsx)("button",{className:"ql-strike","aria-label":"Strikethrough"}),(0,C.jsx)("button",{className:"ql-blockquote","aria-label":"Blockquote"}),(0,C.jsx)("button",{className:"ql-list",value:"ordered","aria-label":"Ordered List"}),(0,C.jsx)("button",{className:"ql-list",value:"bullet","aria-label":"Bullet List"}),(0,C.jsx)("button",{className:"ql-align",value:"","aria-label":"Align Left"}),(0,C.jsx)("button",{className:"ql-align",value:"center","aria-label":"Align Center"}),(0,C.jsx)("button",{className:"ql-align",value:"right","aria-label":"Align Right"}),(0,C.jsx)("button",{className:"ql-align",value:"justify","aria-label":"Justify"}),(0,C.jsx)("button",{className:"ql-link","aria-label":"Insert Link"}),(0,C.jsx)("button",{className:"ql-image","aria-label":"Insert Image"}),(0,C.jsx)("button",{className:"ql-code-block","aria-label":"Code Block"})]}),y=e=>{var l,a,y,A;let{show:w,setShow:S,mutation:_,contactPersons:I,setPayload:k,defaultTemplateId:q,isAddingContact:B=!1}=e;const E=(0,s.useRef)(null),T=JSON.parse(window.localStorage.getItem("profileData")||"{}"),[F,L]=(0,s.useState)(""),[O,K]=(0,s.useState)([]),[z,P]=(0,s.useState)([]),[R,U]=(0,s.useState)([]),[H,M]=(0,s.useState)(null),[$,J]=(0,s.useState)(null),[Q,D]=(0,s.useState)(null),[V,W]=(0,s.useState)({}),[Y,Z]=(0,s.useState)([]),G=(0,s.useRef)(null),X=(0,s.useRef)(null),ee=(0,s.useRef)(null),[le,ae]=(0,s.useState)(!1),[se,ie]=(0,s.useState)(!1),te=(0,s.useCallback)((e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim())),[]),ne=(0,s.useCallback)((e=>!e||0===e.length||e.every((e=>te(e)))),[te]),oe=(0,s.useCallback)((e=>e&&0!==e.length?e.filter((e=>!te(e))):[]),[te]),de=(0,s.useCallback)((e=>e&&0!==e.length?e.filter((e=>te(e))):[]),[te]),ce=(0,s.useCallback)((()=>{let e=!1;if(O.length>0){const l=oe(O);l.length>0&&(console.log("Found invalid TO emails:",l),K(de(O)),e=!0)}if(z.length>0){const l=oe(z);l.length>0&&(console.log("Found invalid CC emails:",l),P(de(z)),e=!0)}if(R.length>0){const l=oe(R);l.length>0&&(console.log("Found invalid BCC emails:",l),U(de(R)),e=!0)}return!e}),[O,z,R,oe,de]),[re,ue]=(0,s.useState)(null),me=()=>{S(!1),q||(L([]),K([]),P([]),U([]),M([]),J([]),ue(null))},ve=(0,c.I)({queryKey:["emailTemplate"],queryFn:j.SQ,enabled:!!w}),ge=(0,c.I)({queryKey:["getSignatureTemplates"],queryFn:j.AO,enabled:!!w}),he=(0,c.I)({queryKey:["getOutgoingEmail"],queryFn:j.hx,enabled:!!w}),xe=(0,c.I)({queryKey:["emailQuery",re],queryFn:()=>(0,j.hS)(re),enabled:!!re,retry:1});(0,s.useEffect)((()=>{var e,l,a;null!==he&&void 0!==he&&he.data&&(null!==he&&void 0!==he&&null!==(e=he.data)&&void 0!==e&&e.outgoing_email&&null!==he&&void 0!==he&&null!==(l=he.data)&&void 0!==l&&l.outgoing_email_verified?L(null===he||void 0===he||null===(a=he.data)||void 0===a?void 0:a.outgoing_email):L("no-reply@memate.com.au"));if(!re&&null!==ve&&void 0!==ve&&ve.data&&q){var s;const e=null===ve||void 0===ve||null===(s=ve.data)||void 0===s?void 0:s.find((e=>e.type===q));e&&ue(null===e||void 0===e?void 0:e.id)}}),[ve,he,q,re]);const pe=e=>{var l,a;const s=(null===e||void 0===e||null===(l=e.query)||void 0===l?void 0:l.toLowerCase())||"";let i=null===(a=I.map((e=>e.email)))||void 0===a?void 0:a.filter((e=>e));i=i.filter((e=>!O.includes(e))),i=i.filter((e=>!z.includes(e))),i=i.filter((e=>!R.includes(e))),i=i.filter((e=>e.toLowerCase().includes(s))),Z(i)},be=()=>{pe(),G.current&&G.current.show()},fe=()=>{pe(),X.current&&X.current.show()},je=()=>{pe(),ee.current&&ee.current.show()};return(0,s.useEffect)((()=>{if(null!==I&&void 0!==I&&I.length){var e;let l=null===(e=I.map((e=>e.email)))||void 0===e?void 0:e.filter((e=>e));Z(l)}}),[I]),(0,s.useEffect)((()=>{if(O.length>0){const e=oe(O);if(e.length>0){console.log("Auto-cleaning invalid TO emails:",e);const l=de(O);K(l)}}}),[O,oe,de]),(0,s.useEffect)((()=>{if(z.length>0){const e=oe(z);if(e.length>0){console.log("Auto-cleaning invalid CC emails:",e);const l=de(z);P(l)}}}),[z,oe,de]),(0,s.useEffect)((()=>{if(R.length>0){const e=oe(R);if(e.length>0){console.log("Auto-cleaning invalid BCC emails:",e);const l=de(R);U(l)}}}),[R,oe,de]),(0,s.useEffect)((()=>{k((e=>({...e,subject:H,email_body:$,from_email:F,to:null===O||void 0===O?void 0:O.toString(),...z.length>0&&{cc:z.toString()},...R.length>0&&{bcc:R.toString()},...Q&&{signature:Q}})))}),[H,$,F,O,z,R,Q,k]),(0,s.useEffect)((()=>{var e,l;null!==ge&&void 0!==ge&&ge.data&&D(null===ge||void 0===ge||null===(e=ge.data)||void 0===e||null===(l=e.find((e=>e.id===T.email_signature)))||void 0===l?void 0:l.id)}),[null===ge||void 0===ge?void 0:ge.data,T.email_signature]),(0,s.useEffect)((()=>{var e,l;J((null===xe||void 0===xe||null===(e=xe.data)||void 0===e?void 0:e.body)||""),M(null===xe||void 0===xe||null===(l=xe.data)||void 0===l?void 0:l.subject),W((e=>({...e,subject:!1}))),W((e=>({...e,text:!1})))}),[null===xe||void 0===xe?void 0:xe.data]),(0,C.jsxs)(i.A,{show:w,centered:!0,onHide:me,className:"invoice-form",size:"lg",children:[(0,C.jsx)(i.A.Header,{closeButton:!0,children:(0,C.jsx)("div",{className:`${f.modalHeader}`,children:(0,C.jsx)("div",{className:"w-100 d-flex align-items-center gap-2",children:(0,C.jsx)("span",{className:`white-space-nowrap mt-2 mb-2 ${f.headerTitle}`,children:"Send email"})})})}),(0,C.jsxs)(i.A.Body,{children:[(0,C.jsxs)(t.A,{children:[(0,C.jsxs)(n.A,{sm:6,className:"mb-3",children:[(0,C.jsxs)("div",{style:{position:"relative"},children:[(0,C.jsx)("label",{className:(0,r.A)(f.customLabel),children:"FROM"}),(0,C.jsx)(m.m,{options:he&&(null===he||void 0===he?void 0:he.data)&&[{value:null===he||void 0===he||null===(l=he.data)||void 0===l?void 0:l.outgoing_email,label:`${null===he||void 0===he||null===(a=he.data)||void 0===a?void 0:a.outgoing_email}`}]||[],className:(0,r.A)(f.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"60px"},placeholder:"Select from email",onChange:e=>{L(e.value),W((e=>({...e,from:!1})))},value:F,filterInputAutoFocus:!0})]}),(null===V||void 0===V?void 0:V.from)&&(0,C.jsx)("p",{className:"error-message mb-0",children:"From email is required"})]}),(0,C.jsx)(n.A,{sm:6,className:"mb-3",children:(0,C.jsxs)("div",{style:{position:"relative"},children:[(0,C.jsx)("label",{className:(0,r.A)(f.customLabel),children:"Templates"}),(0,C.jsx)(m.m,{options:ve&&(null===(y=ve.data)||void 0===y?void 0:y.map((e=>({value:e.id,label:`${e.name}`}))))||[],className:(0,r.A)(f.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select template",onChange:e=>{ue(e.value)},value:re,loading:null===ve||void 0===ve?void 0:ve.isFetching,filterInputAutoFocus:!0}),(0,C.jsx)("div",{className:f.templateInfo,onClick:e=>E.current.toggle(e),children:(0,C.jsx)(d.A,{size:16,color:"#737374ff"})}),(0,C.jsxs)(p.j,{ref:E,children:[(0,C.jsx)("p",{className:"font-12",style:{color:"#344054",lineHeight:"18px"},children:"Choose from your existing templates here."}),(0,C.jsxs)("div",{className:"font-12",style:{color:"#344054",lineHeight:"18px"},children:["To edit or add new templates, go to",(0,C.jsx)("br",{})," Profile Settings > Templates > Email",(0,C.jsx)("br",{})," Templates."]})]})]})})]}),(0,C.jsxs)(t.A,{children:[(0,C.jsxs)(n.A,{sm:12,className:"mb-3",children:[(0,C.jsxs)("div",{className:"d-flex gap-3 w-100",children:[(0,C.jsxs)("div",{style:{position:"relative"},className:f.autoCompleteBox,children:[(0,C.jsx)("div",{style:{width:"50px"},className:f.bag}),(0,C.jsx)("label",{className:(0,r.A)(f.customLabel),children:"TO"}),(0,C.jsx)(u.j,{ref:G,value:O,completeMethod:pe,onChange:e=>{K(e.value),W((e=>({...e,to:!1,toInvalid:!1})))},multiple:!0,suggestions:Y,onClick:be,onFocus:be,onKeyUp:e=>{const l=e.target.value;if(l.includes(",")||"Enter"===e.key){const a=l.split(/[\s,]+/).filter((e=>e)),s=a.filter((e=>te(e)));K((e=>[...new Set([...e,...s])])),s.length===a.length&&s.length>0&&W((e=>({...e,to:!1,toInvalid:!1}))),e.target.value=""}},onBlur:e=>{const l=e.target.value.trim();l&&(te(l)?(K((e=>[...new Set([...e,l])])),W((e=>({...e,to:!1,toInvalid:!1})))):W((e=>({...e,toInvalid:!0}))),e.target.value="")},className:(0,r.A)(f.AutoComplete,"w-100"),placeholder:"TO"})]}),(0,C.jsx)(o.A,{className:(0,r.A)(f.box,{[f.active]:le}),onClick:()=>{ae(!le),P([])},children:"CC"}),(0,C.jsx)(o.A,{className:(0,r.A)(f.box,{[f.active]:se}),onClick:()=>{ie(!se),U([])},children:"BCC"})]}),(null===V||void 0===V?void 0:V.to)&&!(null!==V&&void 0!==V&&V.toInvalid)&&(0,C.jsx)("p",{className:"error-message mb-0",children:"To email is required"}),(null===V||void 0===V?void 0:V.toInvalid)&&(0,C.jsxs)("div",{children:[(0,C.jsx)("p",{className:"error-message mb-0",children:"Please enter valid email addresses for TO"}),(null===V||void 0===V?void 0:V.invalidToEmails)&&V.invalidToEmails.length>0&&(0,C.jsxs)("p",{className:"error-message mb-0 mt-1",style:{fontSize:"12px",color:"#dc3545"},children:["Invalid emails: ",V.invalidToEmails.join(", ")]})]})]}),le&&(0,C.jsxs)(n.A,{sm:6,className:"mb-3",children:[(0,C.jsxs)("div",{style:{position:"relative"},children:[(0,C.jsx)("div",{style:{width:"50px"},className:f.bag}),(0,C.jsx)("label",{className:(0,r.A)(f.customLabel),children:"CC"}),(0,C.jsx)(u.j,{ref:X,value:z,completeMethod:pe,onChange:e=>{P(e.value),W((e=>({...e,cc:!1})))},multiple:!0,suggestions:Y,onClick:fe,onFocus:fe,onKeyUp:e=>{const l=e.target.value;if(l.includes(",")||"Enter"===e.key){const a=l.split(/[\s,]+/).filter((e=>e)),s=a.filter((e=>te(e)));P((e=>[...new Set([...e,...s])])),s.length===a.length&&W((e=>({...e,cc:!1}))),e.target.value=""}},onBlur:e=>{const l=e.target.value.trim();l&&(te(l)?(P((e=>[...new Set([...e,l])])),W((e=>({...e,cc:!1})))):W((e=>({...e,cc:!0}))),e.target.value="")},className:(0,r.A)(f.AutoComplete,"w-100"),placeholder:"CC"})]}),(null===V||void 0===V?void 0:V.cc)&&(0,C.jsxs)("div",{children:[(0,C.jsx)("p",{className:"error-message mb-0",children:"Please enter valid email addresses for CC"}),(null===V||void 0===V?void 0:V.invalidCcEmails)&&V.invalidCcEmails.length>0&&(0,C.jsxs)("p",{className:"error-message mb-0 mt-1",style:{fontSize:"12px",color:"#dc3545"},children:["Invalid emails: ",V.invalidCcEmails.join(", ")]})]})]}),se&&(0,C.jsxs)(n.A,{sm:6,className:"mb-3",children:[(0,C.jsxs)("div",{style:{position:"relative"},children:[(0,C.jsx)("div",{style:{width:"60px"},className:f.bag}),(0,C.jsx)("label",{className:(0,r.A)(f.customLabel),children:"BCC"}),(0,C.jsx)(u.j,{ref:ee,value:R,completeMethod:pe,onChange:e=>{U(e.value),W((e=>({...e,bcc:!1})))},multiple:!0,suggestions:Y,onClick:je,onFocus:je,onKeyUp:e=>{const l=e.target.value;if(l.includes(",")||"Enter"===e.key){const a=l.split(/[\s,]+/).filter((e=>e)),s=a.filter((e=>te(e)));U((e=>[...new Set([...e,...s])])),s.length===a.length&&W((e=>({...e,bcc:!1}))),e.target.value=""}},onBlur:e=>{const l=e.target.value.trim();l&&(te(l)?(U((e=>[...new Set([...e,l])])),W((e=>({...e,bcc:!1})))):W((e=>({...e,bcc:!0}))),e.target.value="")},className:(0,r.A)(f.AutoComplete,f.bcc,"w-100"),placeholder:"BCC"})]}),(null===V||void 0===V?void 0:V.bcc)&&(0,C.jsxs)("div",{children:[(0,C.jsx)("p",{className:"error-message mb-0",children:"Please enter valid email addresses for BCC"}),(null===V||void 0===V?void 0:V.invalidBccEmails)&&V.invalidBccEmails.length>0&&(0,C.jsxs)("p",{className:"error-message mb-0 mt-1",style:{fontSize:"12px",color:"#dc3545"},children:["Invalid emails: ",V.invalidBccEmails.join(", ")]})]})]}),(0,C.jsxs)(n.A,{sm:12,className:"mb-2",children:[(0,C.jsxs)("div",{style:{position:"relative"},children:[(0,C.jsx)("div",{style:{width:"60px"},className:f.bag}),(0,C.jsx)("label",{className:(0,r.A)(f.customLabel),children:"SUBJECT"}),(0,C.jsxs)(g.C,{children:[(0,C.jsx)(h.m,{children:(null===xe||void 0===xe?void 0:xe.isFetching)&&(0,C.jsx)(b.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,C.jsx)(x.S,{value:H,className:(0,r.A)(f.inputBox,"w-100"),style:{paddingLeft:"100px"},onChange:e=>{M(e.target.value),W((e=>({...e,subject:!1})))},placeholder:"{Organization} | Quotation: {number} | {reference}"})]})]}),(null===V||void 0===V?void 0:V.subject)&&(0,C.jsx)("p",{className:"error-message mb-0",children:"Subject is required"})]}),(0,C.jsxs)(n.A,{sm:12,className:"mb-3",children:[(0,C.jsxs)("div",{className:"d-flex flex-column gap-1",style:{position:"relative"},children:[(0,C.jsx)("label",{className:(0,r.A)(f.lable),children:"Message"}),(0,C.jsx)(h.m,{style:{position:"absolute",right:"15px",top:"40px",zIndex:1},children:(null===xe||void 0===xe?void 0:xe.isFetching)&&(0,C.jsx)(b.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,C.jsx)(v.K,{style:{minHeight:"150px"},headerTemplate:N,value:$,placeholder:"Enter a description...",onTextChange:e=>{J(e.htmlValue),W((e=>({...e,text:!1})))}})]}),(null===V||void 0===V?void 0:V.text)&&(0,C.jsx)("p",{className:"error-message mb-0",children:"Message is required"})]}),(0,C.jsx)(n.A,{sm:12,children:(0,C.jsxs)("div",{style:{position:"relative"},children:[(0,C.jsx)("label",{className:(0,r.A)(f.customLabel),children:"Signature"}),(0,C.jsx)(m.m,{options:ge&&(null===(A=ge.data)||void 0===A?void 0:A.map((e=>({value:e.id,label:`${e.name}`}))))||[],panelClassName:"px880-dropdown-item",className:(0,r.A)(f.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select signature",onChange:e=>{D(e.value)},value:Q,loading:null===ge||void 0===ge?void 0:ge.isFetching,filterInputAutoFocus:!0})]})})]})]}),(0,C.jsxs)(i.A.Footer,{className:"d-flex justify-content-between",children:[(0,C.jsx)("span",{}),(0,C.jsxs)("div",{className:"d-flex justify-content-end gap-2",children:[(0,C.jsxs)(o.A,{className:"outline-button",onClick:me,children:["Cancel"," "]}),(0,C.jsxs)(o.A,{disabled:null===_||void 0===_?void 0:_.isPending,className:"solid-button",onClick:async()=>{let e=0;W({});if(ce()||console.log("Some emails were invalid and have been cleaned"),F||(++e,W((e=>({...e,from:!0})))),0===(null===O||void 0===O?void 0:O.length))++e,W((e=>({...e,to:!0})));else if(!ne(O)){++e;const l=oe(O);console.log("Invalid TO emails:",l),W((e=>({...e,to:!0,toInvalid:!0,invalidToEmails:l})))}if(z.length>0&&!ne(z)){++e;const l=oe(z);console.log("Invalid CC emails:",l),W((e=>({...e,cc:!0,invalidCcEmails:l})))}if(R.length>0&&!ne(R)){++e;const l=oe(R);console.log("Invalid BCC emails:",l),W((e=>({...e,bcc:!0,invalidBccEmails:l})))}H||(++e,W((e=>({...e,subject:!0})))),$||(++e,W((e=>({...e,text:!0})))),e||_.mutate({subject:H,email_body:$,from_email:F,to:null===O||void 0===O?void 0:O.toString(),...z.length>0&&{cc:z.toString()},...R.length>0&&{bcc:R.toString()},...Q&&{signature:Q}})},children:["Send"," ",((null===_||void 0===_?void 0:_.isPending)||B)&&(0,C.jsx)(b.p,{style:{width:"20px",height:"20px",color:"#fff"}})]})]})]})]})}}}]);
//# sourceMappingURL=1242.57193211.chunk.js.map