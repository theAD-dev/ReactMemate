"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[6731,9824],{32864:(e,s,t)=>{t.r(s),t.d(s,{default:()=>ps});var a=t(65043),i=t(49367),n=t(73216),r=t(42104),o=t(56328);const l="chat-layout_chatContainer__qW3K4";var c=t(90386),d=t(57189),u=t(48417),h=t(27734),p=t(86213),m=t(70381),v=t.n(m),_=t(72018),g=t(27932),x=t(93740);const j={chatArea:"chat-area_chatArea__LcIUx",chatSidebar:"chat-area_chatSidebar__YWktj",slideIn:"chat-area_slideIn__YYoN5",chatContent:"chat-area_chatContent__uf9lg",chatBodyArea:"chat-area_chatBodyArea__pnfS9",messagesContainer:"chat-area_messagesContainer__jP8AR",dragOver:"chat-area_dragOver__zUubn",loadingContainer:"chat-area_loadingContainer__GABMB",messageInputContainer:"chat-area_messageInputContainer__utwWT",messageInput:"chat-area_messageInput__IlSJP",messageInputIcons:"chat-area_messageInputIcons__hW5ZW",attachButton:"chat-area_attachButton__oHyZF",emojiButton:"chat-area_emojiButton__DtKy-",sendButton:"chat-area_sendButton__ZTAOh",emptyChat:"chat-area_emptyChat__Kcq0J",emptyChatIcon:"chat-area_emptyChatIcon__2jxD+",emptyChatText:"chat-area_emptyChatText__bUdhG",chatMenu:"chat-area_chatMenu__K57W1",attachmentLabel:"chat-area_attachmentLabel__Zt7sR"};var f=t(95753),C=t(58387),N=t(4258),b=t(70579);const y=e=>{let{show:s,setShow:t,setMessage:i}=e;const n=e=>{const s=document.querySelector(".emoji-picker"),a=document.querySelector(".chat-emoji-button");!s||s.contains(e.target)||a.contains(e.target)||t(!1)};return a.useEffect((()=>(document.addEventListener("click",n),()=>{document.removeEventListener("click",n)})),[]),(0,b.jsxs)("div",{className:"chat-emoji-picker",children:[(0,b.jsx)("button",{type:"button",className:(0,C.A)(j.emojiButton,"chat-emoji-button"),onClick:()=>t((e=>!e)),tabIndex:-1,children:(0,b.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("path",{d:"M10 18.3333C14.6024 18.3333 18.3334 14.6024 18.3334 10C18.3334 5.39763 14.6024 1.66667 10 1.66667C5.39765 1.66667 1.66669 5.39763 1.66669 10C1.66669 14.6024 5.39765 18.3333 10 18.3333Z",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("path",{d:"M6.66669 11.6667C6.66669 11.6667 7.91669 13.3333 10 13.3333C12.0834 13.3333 13.3334 11.6667 13.3334 11.6667",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("path",{d:"M7.5 7.5H7.50833",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("path",{d:"M12.5 7.5H12.5083",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]})}),s&&(0,b.jsx)("div",{className:"emoji-picker",style:{position:"absolute",bottom:"40px",right:0,zIndex:10},children:(0,b.jsx)(N.Ay,{onEmojiClick:e=>{i((s=>s+(e.emoji||""))),t(!1)},theme:"light"})})]})},w=()=>(0,b.jsxs)("div",{className:j.emptyChat,children:[(0,b.jsx)("div",{className:j.emptyChatIcon,children:(0,b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"220",height:"171",viewBox:"0 0 220 171",fill:"none",children:[(0,b.jsx)("circle",{cx:"110",cy:"80",r:"80",fill:"#EAECF0"}),(0,b.jsx)("circle",{cx:"18",cy:"12",r:"8",fill:"#F2F4F7"}),(0,b.jsx)("circle",{cx:"198",cy:"142",r:"6",fill:"#F2F4F7"}),(0,b.jsx)("circle",{cx:"25",cy:"138",r:"10",fill:"#F2F4F7"}),(0,b.jsx)("circle",{cx:"210",cy:"46",r:"10",fill:"#F2F4F7"}),(0,b.jsx)("circle",{cx:"191",cy:"11",r:"7",fill:"#F2F4F7"}),(0,b.jsx)("path",{opacity:"0.7",d:"M140.356 4H75.0524C72.3887 4.00774 69.8364 5.06932 67.9528 6.95284C66.0693 8.83635 65.0077 11.3887 65 14.0524V20.7589C65.0077 23.4226 66.0693 25.975 67.9528 27.8585C69.8364 29.742 72.3887 30.8036 75.0524 30.8113H140.356L150.409 36.7694V14.0231C150.391 11.3651 149.326 8.82132 147.444 6.94454C145.561 5.06776 143.014 4.00961 140.356 4Z",fill:"#667085"}),(0,b.jsx)("path",{d:"M138.537 13.605H76.8355V15.2779H138.537V13.605Z",fill:"white"}),(0,b.jsx)("path",{d:"M138.537 19.5339H88.7074V21.2069H138.537V19.5339Z",fill:"white"}),(0,b.jsx)("path",{opacity:"0.15",d:"M75.0156 48.6416H140.32C142.983 48.6493 145.536 49.7109 147.419 51.5944C149.303 53.478 150.364 56.0303 150.372 58.694V65.3932C150.364 68.0569 149.303 70.6092 147.419 72.4928C145.536 74.3763 142.983 75.4378 140.32 75.4456H75.0156L64.9631 81.4037V58.6573C64.9786 55.9994 66.0438 53.4553 67.9267 51.5793C69.8096 49.7033 72.3576 48.6474 75.0156 48.6416Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.5",d:"M138.537 58.239H76.8355V59.912H138.537V58.239Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.5",d:"M105.452 64.175H76.8355V65.848H105.452V64.175Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.5",d:"M121.558 64.175H109.92V65.848H121.558V64.175Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.7",d:"M140.356 93.2759H75.0524C72.3887 93.2836 69.8364 94.3452 67.9528 96.2287C66.0693 98.1123 65.0077 100.665 65 103.328V110.027C65.0058 112.692 66.0668 115.245 67.9507 117.129C69.8346 119.013 72.3881 120.074 75.0524 120.08H140.356L150.409 126.038V103.292C150.39 100.635 149.323 98.093 147.441 96.2178C145.559 94.3426 143.013 93.2855 140.356 93.2759Z",fill:"#667085"}),(0,b.jsx)("path",{d:"M138.537 102.873H76.8355V104.546H138.537V102.873Z",fill:"white"}),(0,b.jsx)("path",{d:"M138.537 108.809H88.7074V110.482H138.537V108.809Z",fill:"white"}),(0,b.jsx)("path",{opacity:"0.15",d:"M75.0156 137.91H100.425C103.089 137.92 105.64 138.982 107.523 140.865C109.406 142.748 110.468 145.299 110.478 147.963V154.669C110.468 157.332 109.406 159.883 107.523 161.767C105.64 163.65 103.089 164.712 100.425 164.721H75.0156L64.9631 170.672V147.963C64.9709 145.299 66.0325 142.747 67.916 140.863C69.7995 138.979 72.3519 137.918 75.0156 137.91Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.5",d:"M80.1079 151.316C80.1079 151.896 79.9357 152.464 79.6132 152.946C79.2907 153.429 78.8324 153.805 78.2961 154.027C77.7598 154.249 77.1696 154.308 76.6003 154.194C76.0309 154.081 75.508 153.801 75.0975 153.391C74.687 152.981 74.4075 152.458 74.2942 151.888C74.181 151.319 74.2391 150.729 74.4613 150.192C74.6834 149.656 75.0596 149.198 75.5423 148.875C76.0249 148.553 76.5924 148.381 77.1729 148.381C77.9483 148.39 78.6893 148.702 79.2377 149.251C79.7861 149.799 80.0984 150.54 80.1079 151.316Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.5",d:"M86.0441 151.91C87.6853 151.91 89.0157 150.579 89.0157 148.938C89.0157 147.297 87.6853 145.967 86.0441 145.967C84.4028 145.967 83.0724 147.297 83.0724 148.938C83.0724 150.579 84.4028 151.91 86.0441 151.91Z",fill:"#667085"}),(0,b.jsx)("path",{opacity:"0.5",d:"M97.9162 154.874C97.9162 155.455 97.744 156.022 97.4215 156.505C97.099 156.988 96.6406 157.364 96.1043 157.586C95.568 157.808 94.9779 157.866 94.4086 157.753C93.8392 157.64 93.3163 157.36 92.9058 156.95C92.4953 156.539 92.2158 156.016 92.1025 155.447C91.9893 154.878 92.0474 154.288 92.2696 153.751C92.4917 153.215 92.8679 152.757 93.3506 152.434C93.8332 152.112 94.4007 151.939 94.9812 151.939C95.7596 151.939 96.5061 152.249 97.0565 152.799C97.6069 153.35 97.9162 154.096 97.9162 154.874Z",fill:"#667085"})]})}),(0,b.jsx)("p",{className:j.emptyChatText,children:"No chat group selected. Please choose a chat to start messaging."})]});var A=t(50565);const I="chat-header_chatHeader__NBNiP",k="chat-header_headerContent__eonUD",S="chat-header_projectHeader__bh-f2",$="chat-header_projectReference__MYCPr",M="chat-header_projectNumber__ow5Ee",L="chat-header_userContainer__+afvT",F="chat-header_userAvatar__wKfvC",U="chat-header_userInfo__LWRrj",E="chat-header_userName__7Nea5",B="chat-header_statusContainer__HUydX",z="chat-header_statusIndicator__mg5ai",D="chat-header_statusText__mcVoz",R="chat-header_headerActions__ZniE4",H="chat-header_menuButton__pcyHE",T=e=>{var s,t,i,n,r;let{chat:o,userId:l,setParticipants:c,onlineUsers:d=[],setShowSidebar:u}=e;const h=a.useMemo((()=>{const e=(null===o||void 0===o?void 0:o.participants)||[];return null===e||void 0===e?void 0:e.reduce(((e,s)=>(e[s.id]=s.name,e)),{})}),[null===o||void 0===o?void 0:o.participants]);(0,a.useEffect)((()=>{c(h)}),[h,c]);const p=o.project_id||o.job_number,m=e=>{const s=e.participants.find((e=>e.id!==+l));return s?{name:(null===s||void 0===s?void 0:s.name)||"Unknown User",avatar:null!==s&&void 0!==s&&s.avatar&&"no_photo.png"!==(null===s||void 0===s?void 0:s.avatar)?s.avatar.startsWith("http")?s.avatar:`https://dev.memate.com.au/media/${s.avatar}`:"",id:s.id,status:null!==d&&void 0!==d&&d.includes(s.id)?"online":"offline"}:{name:"Unknown User",avatar:"",id:null,status:"offline"}};return(0,b.jsx)("div",{className:I,children:(0,b.jsx)("div",{className:k,children:p?(0,b.jsxs)("div",{className:"d-flex w-100 justify-content-between align-items-center",children:[(0,b.jsxs)("div",{className:S,children:[(0,b.jsx)("span",{className:$,children:(null===o||void 0===o?void 0:o.name)||"Unknown"}),(0,b.jsx)("span",{className:M,children:(null===o||void 0===o?void 0:o.project_id)||o.job_number||"Unknown"})]}),(0,b.jsx)("div",{className:R,children:(0,b.jsx)("button",{className:H,onClick:()=>u((e=>!e)),children:(0,b.jsx)(A.A,{size:20,color:"#667085"})})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:L,children:[(0,b.jsx)("div",{className:F,children:null!==(s=m(o))&&void 0!==s&&s.avatar?(0,b.jsx)("img",{src:null===(t=m(o))||void 0===t?void 0:t.avatar,alt:"avatar"}):null===(i=m(o))||void 0===i||null===(n=i.name)||void 0===n?void 0:n.split(" ").map((e=>e[0])).join("").slice(0,2)}),(0,b.jsxs)("div",{className:U,children:[(0,b.jsx)("h2",{className:E,children:null===(r=m(o))||void 0===r?void 0:r.name}),(0,b.jsxs)("div",{className:B,children:[(0,b.jsx)("span",{className:z,"data-status":m(o).status}),(0,b.jsx)("span",{className:D,children:m(o).status})]})]})]}),(0,b.jsx)("div",{className:R,children:(0,b.jsx)("button",{className:H,onClick:()=>u((e=>!e)),children:(0,b.jsx)(A.A,{size:20,color:"#667085"})})})]})})})};var P=t(93202),W=t(56741),Z=t(96141),V=t(94819),G=t(25721),O=t(54972),K=t(55797);const Y={chatInfoSidebar:"chat-info-sidebar_chatInfoSidebar__B2GSA",chatInfoHeader:"chat-info-sidebar_chatInfoHeader__EJGoD",closeButton:"chat-info-sidebar_closeButton__F11xC",chatInfoContent:"chat-info-sidebar_chatInfoContent__LPT17",groupInfoAvatar:"chat-info-sidebar_groupInfoAvatar__qwdU8",scrollContainer:"chat-info-sidebar_scrollContainer__njhX1",participantsList:"chat-info-sidebar_participantsList__nm8XP",participantItem:"chat-info-sidebar_participantItem__dSQQf",participantAvatar:"chat-info-sidebar_participantAvatar__Rxfmr",participantName:"chat-info-sidebar_participantName__CQFtG",addParticipantAvatar:"chat-info-sidebar_addParticipantAvatar__h01WK",addParticipantButton:"chat-info-sidebar_addParticipantButton__oZGqt",circledesignstyle:"chat-info-sidebar_circledesignstyle__MmFQR",out:"chat-info-sidebar_out__+dukq",modal:"chat-info-sidebar_modal__9He2B",userContainer:"chat-info-sidebar_userContainer__1SFUL",contactItem:"chat-info-sidebar_contactItem__nRCMw",participantsFooter:"chat-info-sidebar_participantsFooter__B+Euk"};var q=t(58027);const J=e=>{var s;let{chatId:t,userId:i,chatInfo:r,participants:l,closeSidebar:c,users:d,socket:u,refetchGroupChats:h}=e;const p=(0,n.Zp)(),[m,v]=a.useState(!1),[g,j]=a.useState(""),[f,N]=a.useState([]),[y,w]=a.useState([]),[A,I]=a.useState([]),[k,S]=a.useState(!1),[$,M]=a.useState(!1),L=(null===r||void 0===r?void 0:r.project_id)||(null===r||void 0===r?void 0:r.job_number),F=(null===r||void 0===r||null===(s=r.participants)||void 0===s?void 0:s.map((e=>({id:e.id,name:e.name,avatar:e.avatar&&"no_photo.png"!==e.avatar?e.avatar.startsWith("http")?e.avatar:`https://dev.memate.com.au/media/${e.avatar}`:""}))))||[],U=F.find((e=>e.id!==+i)),E=L?"":null===U||void 0===U?void 0:U.avatar,B=L?(null===r||void 0===r?void 0:r.name)||"Unknown Group":(null===U||void 0===U?void 0:U.name)||"Unknown User",z=()=>{v(!1),I([]),j(""),w(f)},D=()=>{0!==A.length&&(S(!0),u.emit("add_participant",{group_id:+t,user_id:+i,participant_id:A[0]},(e=>{"success"===e.status?(z(),h(),o.oR.success("Member added successfully")):o.oR.error("Failed to add member"),S(!1)})))};return(0,a.useEffect)((()=>{I([]),j("");const e=Object.keys(l),s=Object.values(d).filter((s=>!e.includes(String(s.id))));w(s||[]),N(s||[])}),[t,l,d]),(0,a.useEffect)((()=>{if(""===g.trim())return void w(f);const e=g.toLowerCase(),s=f.filter((s=>s.first_name.toLowerCase().includes(e)||s.last_name.toLowerCase().includes(e)||s.email.toLowerCase().includes(e)));w(s)}),[g,f]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:Y.chatInfoSidebar,children:[(0,b.jsxs)("div",{className:Y.chatInfoHeader,children:[(0,b.jsx)("p",{className:"font-18 mb-0",style:{fontWeight:600,color:"#344054"},children:L?"Group Info":"Contact Info"}),(0,b.jsx)("button",{className:Y.closeButton,onClick:c,children:(0,b.jsx)(W.A,{size:32})})]}),(0,b.jsxs)("div",{className:Y.scrollContainer,children:[(0,b.jsxs)("div",{className:Y.chatInfoContent,children:[(0,b.jsx)("div",{className:Y.groupInfoAvatar,children:E?(0,b.jsx)("img",{src:E,alt:B}):(0,b.jsx)("div",{className:Y.groupAvatarPlaceholder,children:B.split(" ").map((e=>e[0])).join("").slice(0,2)})}),(0,b.jsx)("p",{className:"mb-0",style:{fontSize:"20px"},children:B}),(0,b.jsx)("p",{className:"font-14 mb-0",children:L?(null===r||void 0===r?void 0:r.project_id)||(null===r||void 0===r?void 0:r.job_number):""})]}),(0,b.jsxs)("div",{className:Y.participantsList,children:[(0,b.jsxs)("h3",{className:"font-14 ms-2 mb-2",style:{color:"var(--Gray-600, #344952)"},children:[Object.keys(l).length," members"]}),(0,b.jsxs)("ul",{className:"w-100 mb-3",children:[F.map((e=>{let{id:s,name:t,avatar:a}=e;return(0,b.jsxs)("li",{className:Y.participantItem,children:[(0,b.jsx)("div",{className:Y.participantAvatar,children:a?(0,b.jsx)("img",{src:a,alt:t}):t.split(" ").map((e=>e[0])).join("").slice(0,2)}),(0,b.jsx)("span",{className:Y.participantName,children:t})]},s)})),L&&(0,b.jsxs)("button",{className:Y.addParticipantButton,onClick:()=>v(!0),children:[(0,b.jsx)("div",{className:Y.addParticipantAvatar,children:(0,b.jsx)(Z.A,{size:20,color:"#1AB2FF"})}),(0,b.jsx)("span",{className:Y.participantName,children:"Add Member"})]})]})]})]}),(0,b.jsx)("div",{className:Y.participantsFooter,children:(0,b.jsxs)("button",{className:"danger-text-button",disabled:$,onClick:()=>{M(!0),u.emit("archive_chat_group",{group_id:t,user_id:i},(e=>{"success"===e.status?(c(),h(),p("/chat"),o.oR.success("Group archived successfully")):o.oR.error("Failed to archive group"),M(!1)}))},children:[(0,b.jsx)(V.A,{color:"#b42318",size:16,className:"me-1"})," Delete Group",$&&(0,b.jsx)(x.p,{style:{width:"16px",height:"16px"},className:"ms-2"})]})})]}),(0,b.jsxs)(K.l,{header:()=>(0,b.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,b.jsx)("div",{className:Y.circledesignstyle,children:(0,b.jsx)("div",{className:Y.out,children:(0,b.jsx)(P.A,{size:24,color:"#17B26A"})})}),(0,b.jsx)("span",{style:{color:"344054",fontSize:"20px",fontWeight:600},children:"Add Member"})]}),footer:()=>(0,b.jsxs)("div",{className:"d-flex justify-content-end gap-3 pt-3",children:[(0,b.jsx)(_.$,{label:"Cancel",className:"outline-button",disabled:k,onClick:z}),(0,b.jsx)(_.$,{label:"Add",loading:k,disabled:k||0===A.length,className:"solid-button",onClick:D})]}),modal:!0,className:`${Y.modal} custom-modal`,visible:m,onHide:z,children:[(0,b.jsx)("div",{className:"search-header w-100",children:(0,b.jsxs)("div",{className:"searchGroupFilter d-flex align-items-center",style:{gap:"10px",minWidth:"100%",maxWidth:"100%"},children:[(0,b.jsx)(G.A,{color:"#98A2B3",size:20}),(0,b.jsx)("input",{id:"search-box",placeholder:"Search",value:g,className:"pl-2",onChange:e=>j(e.target.value)})]})}),(0,b.jsx)("div",{className:Y.userContainer,children:y.map((e=>(0,b.jsxs)("div",{className:(0,C.A)("d-flex align-items-center justify-content-start gap-2",Y.contactItem),children:[(0,b.jsx)(O.S,{inputId:`checkbox-${e.id}`,disabled:A.length,checked:A.includes(e.id),onChange:()=>I((s=>s.includes(e.id)?s.filter((s=>s!==e.id)):[...s,e.id]))}),(0,b.jsxs)("label",{htmlFor:`checkbox-${e.id}`,className:"d-flex align-items-center gap-1 cursor-pointer",children:[(0,b.jsx)(q.h,{has_photo:e.has_photo,photo:e.photo,is_business:!1}),(0,b.jsxs)("div",{className:"d-flex flex-column",children:[(0,b.jsxs)("span",{className:"font-14",children:[e.first_name," ",e.last_name]}),(0,b.jsx)("span",{className:"font-12 text-muted",children:e.email})]})]})]},e.id)))})]})]})};var Q=t(60867),X=t(55850),ee=t(96956);const se="message-list_messageGroup__ErZtK",te="message-list_dateHeader__eLUx6",ae="message-list_message__3UO-2",ie="message-list_sent__lna8g",ne="message-list_messageContent__-bYu5",re="message-list_messageTime__GG1x5",oe="message-list_received__QjePJ",le="message-list_messageAttachment__9Xcs9",ce="message-list_messageContentSent__uivln",de="message-list_messageText__JpeJm",ue="message-list_emptyMessages__Zcq-I",he="message-list_typingIndicator__GbJ55",pe="message-list_typingDot__BlFvs",me="message-list_userAvatar__UkK5U",ve="message-list_messageSenderName__UmAeW",_e="message-list_messageTimeSent__7OaoW";var ge=t(11281),xe=t(33296),je=t(54967),fe=t(75329),Ce=t(35475);const Ne="file-attachment_fileName__hKqo3",be="file-attachment_fileSize__JE1wZ",ye="file-attachment_fileAttachment__po3Wp",we="file-attachment_downloadButton__CRO8A",Ae=e=>{let{file:s}=e;if(!s)return null;const{url:t,type:a}=s,i=t.split("?")[0],n=i.substring(i.lastIndexOf("/")+1),r=a.split("-")[0]||"",o=a.split("-")[1]||"";return(0,b.jsxs)("div",{className:(0,C.A)(ye),style:{display:"flex",alignItems:"center",marginBottom:0,gap:12,padding:10,width:"508px",marginLeft:"auto",position:"relative"},children:[(0,ge.I)(r),(0,b.jsxs)("div",{style:{width:"80%",textAlign:"left"},children:[(0,b.jsx)("div",{className:(0,C.A)(Ne,"ellipsis-width"),children:n}),(0,b.jsx)("div",{className:(0,C.A)(be),children:o})]}),(0,b.jsx)(Ce.N_,{to:t,target:"_blank",className:(0,C.A)(we),children:(0,b.jsx)(fe.A,{size:16,color:"var(--gray-600, #475467)"})})]})},Ie=e=>{const s=new Date(1e3*e),t=s.toLocaleString("en-US",{weekday:"long"});let a=s.getHours();const i=a>=12?"pm":"am";return a=a%12||12,`${t} ${a}:${s.getMinutes().toString().padStart(2,"0")}${i}`},ke=(e,s)=>e.getFullYear()===s.getFullYear()&&e.getMonth()===s.getMonth()&&e.getDate()===s.getDate(),Se=e=>{var s,t,i,n,r,o,l,c,d;let{messages:u=[],isTyping:h={},loading:p=!0,currentUserId:m,participants:v,chatId:_,attachmentFile:g,setAttachmentFile:x}=e;const j=(0,a.useRef)(null),N=(0,a.useMemo)((()=>Array.isArray(u)?(null!==g&&void 0!==g&&g.file&&x(null),u.filter((e=>null===e||void 0===e?void 0:e.sent_at)).map(((e,s)=>{const t=Number(e.sent_at),a=new Date(1e3*t),i=e.sender_photo&&"/media/no_photo.png"!==e.sender_photo?e.sender_photo.startsWith("http")?e.sender_photo:`https://dev.memate.com.au${e.sender_photo}`:"";return{id:e.id||`msg-${s}`,text:e.message||"",sender:e.sender||"Unknown",photo:i,timestamp:t,sendingTime:Ie(t),isOwn:m===e.sender,attachment:e.file_url?{url:e.file_url,type:e.file_type}:void 0,displayDate:a,fullDate:a.toLocaleDateString("en-US",{dateStyle:"medium"})}})).sort(((e,s)=>e.timestamp-s.timestamp))):(console.warn("Messages is not an array:",u),[])),[u,m]),y=(0,a.useMemo)((()=>{const e={},s=new Date,t=new Date;return t.setDate(s.getDate()-1),N.forEach((a=>{let i=a.fullDate;ke(a.displayDate,s)?i="Today":ke(a.displayDate,t)&&(i="Yesterday"),e[i]||(e[i]=[]),e[i].push(a)})),e}),[N]),w=(0,a.useMemo)((()=>Object.entries(y).sort(((e,s)=>{let[,t]=e,[,a]=s;return t[0].timestamp-a[0].timestamp})).map((e=>{let[s]=e;return s}))),[y]);return(0,a.useEffect)((()=>{(()=>{var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"auto"})})()}),[N,g]),(0,b.jsxs)(b.Fragment,{children:[w.map((e=>(0,b.jsxs)("div",{className:se,children:[(0,b.jsx)("div",{className:(0,C.A)(te,"dividerContainer"),children:(0,b.jsx)(ee.c,{children:(0,b.jsx)("span",{children:e})})}),y[e].map((e=>(0,b.jsxs)("div",{className:(0,C.A)(ae,e.isOwn?ie:oe),children:[(0,b.jsxs)("div",{className:(0,C.A)("w-100 d-flex align-items-center gap-2 justify-content-between"),children:[e.isOwn?(0,b.jsx)("span",{className:ve,children:"You"}):(0,b.jsxs)("div",{className:"d-flex gap-2",children:[(0,b.jsx)("div",{className:me,children:(0,b.jsx)(je.dg,{has_photo:e.photo,photo:e.photo,name:(null===v||void 0===v?void 0:v[e.sender])||"Unknown"})}),(0,b.jsx)("span",{className:ve,children:(null===v||void 0===v?void 0:v[e.sender])||"Unknown"})]}),(0,b.jsx)("span",{className:(0,C.A)(re,{[_e]:!e.isOwn}),children:e.sendingTime})]}),e.attachment?(0,b.jsx)("div",{className:(0,C.A)(le,{[ce]:!e.isOwn}),children:(0,b.jsx)(Ae,{file:e.attachment})}):(0,b.jsx)("div",{className:(0,C.A)(ne,{[ce]:!e.isOwn}),children:(0,b.jsx)("p",{className:de,children:e.text})})]},e.id)))]},e))),0===N.length&&!p&&(0,b.jsx)("div",{className:ue,children:(0,b.jsx)("p",{children:"No messages yet. Start the conversation!"})}),(null===g||void 0===g?void 0:g.file)&&(null===g||void 0===g?void 0:g.chatId)===_&&(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",background:"#F9FAFB",borderRadius:8,padding:12,marginBottom:0,gap:12,border:"1px solid #EAECF0",width:"508px",marginLeft:"auto",position:"relative"},children:[(0,ge.I)(g.file.name.split(".").pop()),(0,b.jsxs)("div",{style:{flex:1,textAlign:"left"},children:[(0,b.jsx)("div",{style:{fontWeight:600,color:"#101828",fontSize:16,marginBottom:2},children:g.file.name}),(0,b.jsx)("div",{style:{color:"#667085",fontSize:14},children:(0,f.v)(g.file.size)})]}),null!==g&&void 0!==g&&g.error?(0,b.jsx)(Q.A,{color:"#F04438",size:20}):100==(null===g||void 0===g?void 0:g.progress)?(0,b.jsx)(X.A,{color:"#12B76A",size:20}):(0,b.jsx)(xe.A,{percentage:parseInt(null===g||void 0===g?void 0:g.progress)||0,size:30,color:"#158ECC"}),(0,b.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",right:"-6px",top:"-8px",background:"#d4d5d7ff",borderRadius:"50%",padding:"2px",cursor:"pointer"},onClick:()=>x({}),children:(0,b.jsx)(W.A,{size:18,color:"#667085"})})]}),h.isTyping&&(0,b.jsxs)("div",{className:(0,C.A)(ae,oe),children:[(0,b.jsx)("div",{className:(0,C.A)("w-100 d-flex align-items-center gap-2 justify-content-between"),children:(0,b.jsxs)("div",{className:"d-flex gap-2",children:[(0,b.jsx)("div",{className:me,children:null!==h&&void 0!==h&&null!==(s=h.user)&&void 0!==s&&s.has_photo?(0,b.jsx)(je.dg,{has_photo:null===h||void 0===h||null===(t=h.user)||void 0===t?void 0:t.has_photo,photo:null===h||void 0===h||null===(i=h.user)||void 0===i?void 0:i.photo,name:`${null===h||void 0===h||null===(n=h.user)||void 0===n?void 0:n.first_name} ${null===h||void 0===h||null===(r=h.user)||void 0===r?void 0:r.last_name}`}):(0,b.jsx)(je.fr,{name:`${null===h||void 0===h||null===(o=h.user)||void 0===o?void 0:o.first_name} ${null===h||void 0===h||null===(l=h.user)||void 0===l?void 0:l.last_name}`})}),(0,b.jsxs)("span",{className:ve,children:[null===h||void 0===h||null===(c=h.user)||void 0===c?void 0:c.first_name," ",null===h||void 0===h||null===(d=h.user)||void 0===d?void 0:d.last_name]})]})}),(0,b.jsxs)("div",{className:he,children:[(0,b.jsx)("div",{className:pe}),(0,b.jsx)("div",{className:pe}),(0,b.jsx)("div",{className:pe})]})]}),(0,b.jsx)("div",{ref:j})]})},$e=e=>{let{currentChat:s,socket:t,userId:i,chatId:r,onlineUsers:l=[],setChatData:c,users:d,updatePrivateGroupChatId:u,refetchGroupChats:h}=e;const m=(0,n.Zp)(),C=localStorage.getItem("access_token"),[N,A]=(0,a.useState)(""),[I,k]=(0,a.useState)(!1),[S,$]=(0,a.useState)({}),[M,L]=(0,a.useState)([]),[F,U]=(0,a.useState)({}),[E,B]=(0,a.useState)(1),[z]=(0,a.useState)(20),[D,R]=(0,a.useState)(!1),[H,P]=(0,a.useState)(!0),[W,Z]=(0,a.useState)(!1),[V,G]=(0,a.useState)(null),[O,K]=(0,a.useState)(!1),Y=(0,a.useRef)(null),q=(0,a.useRef)(null),Q=(0,a.useRef)(0),X=(0,a.useRef)(null),[ee,se]=(0,a.useState)(!1),te=(0,a.useCallback)(((e,s,t)=>{L((s=>{const a=e.filter((e=>!s.some((s=>s.id===e.id))));return 1===t?a:[...a,...s]})),P(t<(s||1)),R(!1)}),[]);(0,a.useEffect)((()=>{r&&i&&t&&(null===r||void 0===r||!r.startsWith("private_group"))&&(R(!0),q.current&&E>1&&(Q.current=q.current.scrollHeight),t.emit("get_group_messages",{user_id:i,group_id:r,page:E,page_size:z},(e=>{e&&"success"===e.status&&e.messages&&te(e.messages,e.total_pages,E)})))}),[r,i,t,E,z,te]),(0,a.useEffect)((()=>{var e;if(t&&!D&&s&&i&&!Number(r)&&null!==s&&void 0!==s&&null!==(e=s.participants)&&void 0!==e&&e.length&&null!==r&&void 0!==r&&r.startsWith("private_group")){const e=s.participants.map((e=>e.id)).filter((e=>e!==i)),a="Private Chat";t.emit("create_chat_group",{name:a,user_id:i,participants:e,project_id:null,job_id:null},(e=>{"success"===e.status&&e.chat_group_id?(R(!0),u(r,e.chat_group_id)):(R(!1),console.log("Error during creation chat group: ",e),o.oR.error("Could not start chat. Please try again."))}))}}),[r,i,t,s,m,D]);(0,a.useEffect)((()=>{if(!t||!r||null!==r&&void 0!==r&&r.startsWith("private_group"))return;const e=e=>{e.chat_group==r&&L((s=>s.some((s=>s.id==e.id))?s:[e,...s])),c((s=>{var t;const a={...s[e.chat_group],last_message:e,unread_count:((null===(t=s[e.chat_group])||void 0===t?void 0:t.unread_count)||0)+1};return{...s,[e.chat_group]:a}}))};return t.on("new_message",e),t.on("typing",(e=>{(null===e||void 0===e?void 0:e.group_id)===r&&$({isTyping:!0,user:d[e.user_id]})})),t.on("stop_typing",(e=>{(null===e||void 0===e?void 0:e.group_id)===r&&$({})})),()=>{t.off("new_message",e)}}),[t,r]),(0,a.useEffect)((()=>{if(t&&r&&(null===r||void 0===r||!r.startsWith("private_group")))return t.emit("join_group",{group_id:r},(e=>{"success"===e.status?console.log("Joined group successfully"):console.log("Failed to join group: ",e)})),()=>{t.emit("leave_group",{group_id:r})}}),[t,r]),(0,a.useEffect)((()=>{const e=q.current;if(e)if(1===E&&Y.current)Y.current.scrollIntoView({behavior:"auto"}),Q.current=0;else if(E>1&&Q.current){const s=e.scrollHeight;e.scrollTop=s-Q.current}}),[M,E]);const ae=(e,a)=>{if((N.trim()||e)&&s&&t&&i&&!I){const s={user_id:i,chat_group_id:r,message:N.trim(),file_url:e,file_type:a};k(!0),t.emit("send_message",s,(e=>{"success"===e.status?(e=>{var s;(null===e||void 0===e||null===(s=e.sent_message)||void 0===s?void 0:s.chat_group)==r&&(L((s=>s.some((s=>s.id===e.message_id))?s:[e.sent_message,...s])),k(!1),A(""),Q.current=0,setTimeout((()=>{X.current&&X.current.focus()}),500),c((s=>{var t,a;const i={...s[null===e||void 0===e||null===(t=e.sent_message)||void 0===t?void 0:t.chat_group],last_message:null===e||void 0===e?void 0:e.sent_message};return{...s,[null===e||void 0===e||null===(a=e.sent_message)||void 0===a?void 0:a.chat_group]:i}})))})(e):(k(!1),o.oR.error("Failed to send message:"))}))}};let ie;const ne=(0,a.useMemo)((()=>v()(((e,s)=>{t&&e&&s&&t.emit("typing",{group_id:e,user_id:s})}),2e3)),[t]),re=async e=>{if(e&&r)try{var s,t,a;const i=null===e||void 0===e||null===(s=e.name)||void 0===s?void 0:s.split(".")[0],n=null===e||void 0===e||null===(t=e.name)||void 0===t||null===(a=t.split("."))||void 0===a?void 0:a.pop(),l=`${i}-${Date.now()}.${n}`,c=(0,f.v)(e.size),d=await p.A.post(`https://dev.memate.com.au/api/v1/chat/upload/${r}/`,{filename:l},{headers:{Authorization:`Bearer ${C}`}}),{url:u}=d.data;if(!u)return G((e=>({...e,progress:0,error:!0}))),void o.oR.error("Failed to get upload URL. Please try again.");await(async(e,s,t,a)=>p.A.put(s,e,{headers:{"Content-Type":""},onUploadProgress:e=>{const s=Math.round(e.loaded/e.total*100);G((e=>({...e,progress:s})))}}).then((()=>{G((e=>({...e,progress:100,success:!0})));const e=s.split("?")[0]||"";ae(e,`${t}-${a}`)})).catch((e=>{console.log("Error uploading to S3: ",e),G((e=>({...e,progress:0,error:!0})))})))(e,u,n,c)}catch(i){G((e=>({...e,progress:0,error:!0}))),console.error("Error uploading file:",i),o.oR.error("Failed to upload file. Please try again.")}},oe=(0,a.useCallback)((()=>{0===q.current.scrollTop&&H&&!D&&B((e=>e+1))}),[H,D]);return(0,a.useEffect)((()=>{const e=q.current;if(e)return e.addEventListener("scroll",oe),()=>e.removeEventListener("scroll",oe)}),[oe,M]),(0,a.useEffect)((()=>{X.current&&X.current.focus(),Q.current=0,B(1),L([]),P(!0),R(!1)}),[r]),(0,b.jsxs)("div",{className:"d-flex w-100 h-100",children:[(0,b.jsx)("div",{className:j.chatArea,children:s?(0,b.jsxs)("div",{className:j.chatContent,style:{position:"relative"},children:[(0,b.jsx)(T,{chat:s,userId:i,setParticipants:U,onlineUsers:l,setShowSidebar:se}),(0,b.jsxs)("div",{className:`${j.chatBodyArea}  ${O?j.dragOver:""}`,onDragOver:e=>{e.preventDefault(),e.stopPropagation(),K(!0)},onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),K(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.contains(e.relatedTarget)||K(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),K(!1);const s=e.dataTransfer.files;if(s&&s.length>0){const e=s[0];G({file:e,chatId:r,error:!1,progress:0}),re(e)}},children:[(0,b.jsxs)("div",{className:`${j.messagesContainer}`,ref:q,children:[D&&(0,b.jsx)("div",{className:j.loadingContainer,children:(0,b.jsx)(x.p,{style:{width:"16px",height:"16px"}})}),(0,b.jsx)(Se,{messages:M,isTyping:S,loading:D,currentUserId:i,chatId:r,participants:F,attachmentFile:V,setAttachmentFile:G}),(0,b.jsx)("div",{ref:Y})]}),(0,b.jsx)("div",{className:`${j.messageInputContainer}`,children:(0,b.jsxs)("div",{className:"position-relative w-100",children:[(0,b.jsx)(g.Z,{placeholder:"Send a message...",value:N,onChange:e=>{A(e.target.value),ne(r,i),clearTimeout(ie),ie=setTimeout((()=>{t&&r&&i&&t.emit("stop_typing",{group_id:r,user_id:i})}),2e3)},autoFocus:!0,ref:X,disabled:I||(null===r||void 0===r?void 0:r.startsWith("private_group")),onKeyUp:e=>{"Enter"!==e.key||e.shiftKey||ae()},className:j.messageInput}),(0,b.jsxs)("div",{className:j.messageInputIcons,children:[I&&(0,b.jsx)(x.p,{style:{width:"20px",height:"20px"}}),(0,b.jsx)("div",{className:j.attachWrapper,style:{position:"relative",display:"inline-block"},children:(0,b.jsx)(f.A,{onFileChange:e=>{const s=e.target.files[0];s&&(G({file:s,chatId:r,error:!1,progress:0}),re(s))},styles:j,file:V,onRemoveFile:()=>G(null)})}),(0,b.jsx)(y,{show:W,setShow:Z,setMessage:A}),(0,b.jsx)(_.$,{className:j.sendButton,onClick:()=>ae(),disabled:!N.trim()||I,children:"Send"})]})]})})]})]}):(0,b.jsx)(w,{})}),(0,b.jsx)("div",{style:ee?{position:"absolute",right:"16px"}:{display:"none"},className:j.chatSidebar,children:(0,b.jsx)(J,{chatId:r,userId:i,chatInfo:s,closeSidebar:()=>se(!1),participants:F,users:d,socket:t,refetchGroupChats:h})})]})};var Me=t(28676),Le=t(74532),Fe=t(21080),Ue=t(72052);const Ee="chat-sidebar_chatSidebar__zzpNg",Be="chat-sidebar_sidebarHeader__R0eP2",ze="chat-sidebar_headerFirstRow__QMmIk",De="chat-sidebar_unreadCount__83KNP",Re="chat-sidebar_sidebarTitle__3Np6U",He="chat-sidebar_archivedLabel__AGzqF",Te="chat-sidebar_headerSecondRow__4diKO",Pe="chat-sidebar_headerThirdRow__9ynMU",We="chat-sidebar_tabButton__gHzm6",Ze="chat-sidebar_active__vtn5W",Ve="chat-sidebar_listContainer__A3eW3";var Ge=t(65148),Oe=t(16484);const Ke="project-list_projectList__9Df50",Ye="project-list_projectItem__eBp-6",qe="project-list_active__jFy-d",Je="project-list_projectHeader__OU-Of",Qe="project-list_projectInfo__LoSIl",Xe="project-list_projectTitleRow__EhGqR",es="project-list_projectName__w7dZI",ss="project-list_projectRef__Fhg0N",ts="project-list_messagePreviewContainer__uYIHz",as="project-list_userInfo__2ZVWv",is="project-list_lastMessage__iWohN",ns="project-list_lastMessageTime__HD-aX",rs="project-list_archivedBadge__uJ+Vf",os="project-list_unreadCount__RJKbs",ls=e=>{let{chatData:s,searchQuery:t,showArchived:a,userId:i}=e;console.log("chatData: ",s);const r=(0,n.zy)(),o=new URLSearchParams(r.search).get("id"),l=Object.entries(s).filter((e=>{let[,s]=e;return s.project_id||s.job_number})).sort(((e,s)=>{var t,a;const i=(null===(t=e[1].last_message)||void 0===t?void 0:t.sent_at)||0;return((null===(a=s[1].last_message)||void 0===a?void 0:a.sent_at)||0)-i})).filter((e=>{var s;let[,i]=e;const n=((null===i||void 0===i?void 0:i.name)||"Unknown Group").toLowerCase().includes(t.toLowerCase()),r=a||!((null===(s=i.archived_by)||void 0===s?void 0:s.length)>0);return n&&r}));return(0,b.jsx)("div",{className:Ke,children:l.map((e=>{var s,t,a;let[n,r]=e;const l=(e=>{var s;return(null===e||void 0===e||null===(s=e.last_message)||void 0===s?void 0:s.message)||null})(r),c=(e=>{if(!e)return"";const s=Date.now()-1e3*e,t=Math.floor(s/1e3),a=Math.floor(s/6e4),i=Math.floor(s/36e5),n=Math.floor(s/864e5),r=Math.floor(s/6048e5),o=Math.floor(s/2592e6),l=Math.floor(s/31536e6);return t<60?`${t} second${1!==t?"s":""} ago`:a<60?`${a} minute${1!==a?"s":""} ago`:i<24?`${i} hour${1!==i?"s":""} ago`:n<7?`${n} day${1!==n?"s":""} ago`:r<4?`${r} week${1!==r?"s":""} ago`:o<12?`${o} month${1!==o?"s":""} ago`:`${l} year${1!==l?"s":""} ago`})(null===r||void 0===r||null===(s=r.last_message)||void 0===s?void 0:s.sent_at),d=(e=>(null===e||void 0===e?void 0:e.unread_count)||0)(r),u=(e=>{const s=null===e||void 0===e?void 0:e.last_message;if(!s)return"";const t=e.participants.find((e=>e.id===s.sender));return t.id===i?"You: ":`${null===t||void 0===t?void 0:t.name}: `||"Unknown Sender: `"})(r),h=null===r||void 0===r?void 0:r.name,p=(null===r||void 0===r?void 0:r.job_number)||(null===r||void 0===r?void 0:r.project_id),m=(null===r||void 0===r||null===(t=r.participants)||void 0===t?void 0:t.map((e=>({id:e.id,name:e.name,avatar:e.photo&&"no_photo.png"!==e.photo?e.photo.startsWith("http")?e.photo:`https://dev.memate.com.au${e.photo}`:""}))))||[];return console.log("members: ",null===r||void 0===r?void 0:r.participants,m),(0,b.jsxs)(Ce.N_,{to:`?id=${n}`,className:(0,C.A)(Ye,{[qe]:o==n}),children:[(0,b.jsxs)("div",{className:Je,children:[(0,b.jsxs)("div",{className:Qe,children:[(0,b.jsx)("div",{className:Xe,children:(0,b.jsx)("span",{className:es,children:h})}),(0,b.jsx)("span",{className:ss,children:p})]}),(0,b.jsxs)("div",{className:"d-flex flex-column gap-2",children:[(0,b.jsx)("span",{className:ns,children:c}),(0,b.jsxs)("div",{className:"d-flex align-items-center justify-content-end gap-2",children:[null!==(a=r.archived_by)&&void 0!==a&&a.length?(0,b.jsx)("span",{className:rs,children:"Archived"}):null,d>0&&(0,b.jsx)("span",{className:os,children:d})]})]})]}),(0,b.jsxs)("div",{className:ts,children:[(0,b.jsx)("div",{className:as,children:(0,b.jsx)(Oe.Z,{children:m.map((e=>(0,b.jsx)(Ge.e,{image:e.avatar,size:"small",shape:"circle"},e.id)))})}),(0,b.jsx)("p",{className:(0,C.A)(is,"text-start"),children:l?`${u} ${l?l.substring(0,30):""}`:"No messages yet"})]})]},n)}))})},cs={userList:"user-list_userList__Tj5r8",userItem:"user-list_userItem__2vBej",active:"user-list_active__ylmYf",userItemContent:"user-list_userItemContent__a0bK2",userAvatarWrapper:"user-list_userAvatarWrapper__+CzoZ",onlineIndicator:"user-list_onlineIndicator__kRi92",userAvatar:"user-list_userAvatar__EhrPu",userInfo:"user-list_userInfo__tRZdB",userName:"user-list_userName__pjTE0",lastMessage:"user-list_lastMessage__LFBTg",lastMessageTime:"user-list_lastMessageTime__+6gj+",unreadCount:"user-list_unreadCount__2vYTB"},ds=e=>{let{chatData:s,searchQuery:t,showArchived:a,userId:i,onlineUsers:r}=e;const o=(0,n.zy)(),l=new URLSearchParams(o.search).get("id"),c=Object.entries(s).filter((e=>{let[,s]=e;return!s.project_id&&!s.job_number})).sort(((e,s)=>{var t,a;const i=(null===(t=e[1].last_message)||void 0===t?void 0:t.sent_at)||0;return((null===(a=s[1].last_message)||void 0===a?void 0:a.sent_at)||0)-i})).filter((e=>{let[,s]=e;const n=s.participants.find((e=>e.id!==+i)),r=((null===n||void 0===n?void 0:n.name)||(null===s||void 0===s?void 0:s.name)||"Unknown User").toLowerCase().includes(t.toLowerCase()),o=!!a||!s.archived;return r&&o}));return(0,b.jsx)("div",{className:cs.userList,children:c.map((e=>{var s,t;let[a,n]=e;const o=(e=>(null===e||void 0===e?void 0:e.last_message)||null)(n),c=(e=>{if(!e)return"";const s=Date.now()-1e3*e,t=Math.floor(s/1e3),a=Math.floor(s/6e4),i=Math.floor(s/36e5),n=Math.floor(s/864e5),r=Math.floor(s/6048e5),o=Math.floor(s/2592e6),l=Math.floor(s/31536e6);return t<60?`${t} second${1!==t?"s":""} ago`:a<60?`${a} minute${1!==a?"s":""} ago`:i<24?`${i} hour${1!==i?"s":""} ago`:n<7?`${n} day${1!==n?"s":""} ago`:r<4?`${r} week${1!==r?"s":""} ago`:o<12?`${o} month${1!==o?"s":""} ago`:`${l} year${1!==l?"s":""} ago`})(null===n||void 0===n||null===(s=n.last_message)||void 0===s?void 0:s.sent_at),d=(e=>(null===e||void 0===e?void 0:e.unread_count)||0)(n),u=(e=>{const s=null===e||void 0===e?void 0:e.last_message;if(!s)return"";const t=e.participants.find((e=>e.id===s.sender));return(null===t||void 0===t?void 0:t.id)===i?"You: ":null!==t&&void 0!==t&&t.name?`${null===t||void 0===t?void 0:t.name}: `:""})(n),h=(e=>{const s=e.participants.find((e=>e.id!==+i));return null!==s&&void 0!==s&&s.avatar&&"no_photo.png"!==(null===s||void 0===s?void 0:s.avatar)?s.avatar.startsWith("http")?s.avatar:`https://dev.memate.com.au/media/${s.avatar}`:""})(n),p=(e=>{const s=e.participants.find((e=>e.id!==+i));return(null===s||void 0===s?void 0:s.name)||(null===e||void 0===e?void 0:e.name)||"Unknown User"})(n),m=(e=>{const s=e.participants.find((e=>e.id!==+i));return s&&null!==r&&void 0!==r&&r.includes(s.id)?"online":"offline"})(n);return(0,b.jsxs)(Ce.N_,{to:`?id=${a}`,className:(0,C.A)(cs.userItem,{[cs.active]:l==a}),children:[(0,b.jsxs)("div",{className:cs.userItemContent,children:[(0,b.jsxs)("div",{className:cs.userAvatarWrapper,children:["online"===m&&(0,b.jsx)("div",{className:cs.onlineIndicator}),(0,b.jsx)("div",{className:cs.userAvatar,children:h?(0,b.jsx)("img",{src:h,alt:p}):(0,b.jsx)("span",{className:cs.avatarPlaceholder,children:null===p||void 0===p?void 0:p.split(" ").map((e=>e[0])).join("").slice(0,2)})})]}),(0,b.jsx)("div",{className:cs.userInfo,children:(0,b.jsx)("span",{className:cs.userName,children:p})}),(0,b.jsxs)("div",{className:"d-flex flex-column align-items-end gap-1",children:[(0,b.jsx)("span",{className:cs.lastMessageTime,children:c||""}),d>0&&(0,b.jsx)("span",{className:cs.unreadCount,children:d>9?"9+":d})]})]}),(0,b.jsx)("p",{className:cs.lastMessage,children:null!==o&&void 0!==o&&o.message?`${u} ${null!==o&&void 0!==o&&o.message?null===o||void 0===o||null===(t=o.message)||void 0===t?void 0:t.substring(0,30):""}`:"No messages yet"})]},a)}))})},us=e=>{let{activeTab:s,setActiveTab:t,archivedVisible:i,setArchivedVisible:n,chatData:r,userId:o,onlineUsers:l}=e;const[c,d]=(0,a.useState)(""),u=Object.entries(r).filter((e=>{let[,s]=e;return!s.project_id&&!s.job_number})),h=Object.entries(r).filter((e=>{let[,s]=e;return s.project_id||s.job_number})).filter((e=>{var s;let[,t]=e;const a=((null===t||void 0===t?void 0:t.name)||"Unknown Group").toLowerCase().includes(c.toLowerCase()),n=i||!((null===(s=t.archived_by)||void 0===s?void 0:s.length)>0);return a&&n}));return(0,b.jsxs)("div",{className:Ee,children:[(0,b.jsxs)("div",{className:Be,children:[(0,b.jsxs)("div",{className:ze,children:[(0,b.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,b.jsx)("h1",{className:Re,children:"Messages"}),(0,b.jsxs)("div",{className:De,children:[(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"9",viewBox:"0 0 8 9",fill:"none",children:(0,b.jsx)("circle",{cx:"4",cy:"4.5",r:"3",fill:"#17B26A"})}),(0,b.jsx)("span",{children:"0"})]})]}),(0,b.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,b.jsx)(Fe.H,{checked:i,onChange:e=>n(e.value)}),(0,b.jsx)("h1",{className:He,children:"Archived"})]})]}),(0,b.jsx)("div",{className:Te,children:(0,b.jsxs)(Me.C,{iconPosition:"left",className:"border w-100 rounded text-start",children:[(0,b.jsx)(Le.m,{style:{position:"relative"},children:(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:(0,b.jsx)("path",{d:"M14.6777 12.9299C15.6661 11.5841 16.25 9.92275 16.25 8.125C16.25 3.63769 12.6123 0 8.125 0C3.63769 0 0 3.63769 0 8.125C0 12.6123 3.63769 16.25 8.125 16.25C9.92323 16.25 11.585 15.6658 12.9309 14.6769L12.9299 14.6777C12.9667 14.7277 13.0078 14.7756 13.053 14.8208L17.8661 19.6339C18.3543 20.122 19.1457 20.122 19.6339 19.6339C20.122 19.1457 20.122 18.3543 19.6339 17.8661L14.8208 13.053C14.7756 13.0078 14.7277 12.9667 14.6777 12.9299ZM15 8.125C15 11.922 11.922 15 8.125 15C4.32804 15 1.25 11.922 1.25 8.125C1.25 4.32804 4.32804 1.25 8.125 1.25C11.922 1.25 15 4.32804 15 8.125Z",fill:"#98A2B3"})})}),(0,b.jsx)(Ue.S,{placeholder:"Search",style:{padding:"10px 10px 10px 20px"},value:c,onChange:e=>{d(e.target.value)}})]})}),(0,b.jsxs)("div",{className:Pe,children:[(0,b.jsxs)("div",{className:(0,C.A)(We,{[Ze]:"users"===s}),onClick:()=>t("users"),children:[(0,b.jsx)("span",{children:"Users"}),(0,b.jsx)("div",{children:(null===u||void 0===u?void 0:u.length)||0})]}),(0,b.jsxs)("div",{className:(0,C.A)(We,{[Ze]:"projects"===s}),onClick:()=>t("projects"),children:[(0,b.jsx)("span",{children:"Projects"}),(0,b.jsx)("div",{children:(null===h||void 0===h?void 0:h.length)||0})]})]})]}),(0,b.jsx)("div",{className:Ve,children:"users"===s?(0,b.jsx)(ds,{chatData:r,searchQuery:c,showArchived:i,userId:o,onlineUsers:l}):(0,b.jsx)(ls,{chatData:r,searchQuery:c,showArchived:i,userId:o})})]})},hs=()=>{var e;const{session:s}=(0,d.As)(),t=null===s||void 0===s?void 0:s.desktop_user_id,i=null===s||void 0===s||null===(e=s.organization)||void 0===e?void 0:e.id,{trialHeight:p}=(0,u.$)(),m=(0,n.zy)(),v=(0,n.Zp)(),_=new URLSearchParams(m.search).get("id"),[g,x]=(0,a.useState)(!0),[j,f]=(0,a.useState)("users"),[C,N]=(0,a.useState)(!1),[y,w]=(0,a.useState)({}),[A,I]=(0,a.useState)(null),[k,S]=(0,a.useState)([]),[$,M]=(0,a.useState)({}),L=(0,a.useRef)(null),F=e=>{const a={};let i=1;return e.forEach((e=>{let n={id:null===e||void 0===e?void 0:e.group_id,archived_by:[],unread_count:(null===e||void 0===e?void 0:e.unread_count)||0,participants:[{id:e.id,name:`${e.full_name}`,avatar:e.avatar||""},{id:t,name:(null===s||void 0===s?void 0:s.full_name)||"You",avatar:null!==s&&void 0!==s&&s.has_photo?null===s||void 0===s?void 0:s.photo:""}],last_message:null===e||void 0===e?void 0:e.last_message};n.id?a[n.id]=n:a["private_group_"+i++]=n})),a};return(0,a.useEffect)((()=>{const e=(0,r.io)("https://chatd.memate.com.au",{transports:["websocket"],autoConnect:!0});return L.current=e,t?i?(e.emit("register_user",{user_id:t,org_id:i},(e=>{"success"===e.status?console.log("User registered successfully"):o.oR.error("Failed to connect to chat server")})),e.emit("get_user_chat_groups",{user_id:t},(e=>{if("success"===e.status&&e.chat_groups){const s={};e.chat_groups.forEach((e=>{s[e.id]=e})),console.log("groups chat groups : ",s),w((e=>({...e,...s}))),x(!1)}})),e.on("get_user_chat_groups",(e=>{if("success"===e.status&&e.chat_groups){const s={};e.chat_groups.forEach((e=>{s[e.id]=e})),console.log("groups chat groups : ",s),w((e=>({...e,...s})))}})),e.emit("get_organization_users",{user_id:t,organization_id:i},(e=>{var s;if("success"===e.status&&null!==e&&void 0!==e&&null!==(s=e.users)&&void 0!==s&&s.length){const s=F(e.users);console.log("private chatGroups: ",s),w((e=>({...e,...s})))}})),e.on("get_organization_users",(e=>{var s;if("success"===e.status&&null!==e&&void 0!==e&&null!==(s=e.users)&&void 0!==s&&s.length){const s=F(e.users);console.log("private chatGroups: ",s),w((e=>({...e,...s})))}})),()=>{e.disconnect()}):o.oR.error("Organization ID is not available"):o.oR.error("User ID is not available")}),[t,i,s]),(0,a.useEffect)((()=>{if(!L.current)return;const e=L.current;return e.on("presence_list",(e=>{e.online&&S(e.online)})),e.on("presence_update",(e=>{e.user_id&&"offline"===e.status?S((s=>s.filter((s=>s!==e.user_id)))):e.user_id&&"online"===e.status&&S((s=>[...new Set([...s,e.user_id])]))})),()=>{e.off("presence_list"),e.off("presence_update")}}),[L]),(0,a.useEffect)((()=>{if(_&&y[_]){const e=y[_].project_id||y[_].job_number;f(e?"projects":"users"),I(y[_])}else I(null)}),[_,y]),(0,a.useEffect)((()=>{(async()=>{try{var e;const s=await(0,c.V_)();let t=null===s||void 0===s||null===(e=s.users)||void 0===e?void 0:e.filter((e=>e.is_active));const a={};t.forEach((e=>{a[e.id]=e})),M((e=>({...e,...a})))}catch(s){console.log(s)}})(),(async()=>{try{const e=await(0,c.tD)(),s=null===e||void 0===e?void 0:e.users.filter((e=>"disconnected"!==e.status)),t={};s.forEach((e=>{t[e.id]=e})),M((e=>({...e,...t})))}catch(e){console.log(e)}})()}),[]),(0,b.jsxs)("div",{className:"container-fluid px-0",children:[(0,b.jsxs)("div",{className:l,style:{height:`calc(100vh - 73px - ${p}px)`},children:[(0,b.jsx)(us,{activeTab:j,setActiveTab:f,archivedVisible:C,setArchivedVisible:N,chatData:y,userId:t,onlineUsers:k}),(0,b.jsx)($e,{currentChat:A,setCurrentChat:I,socket:L.current,userId:t,chatId:_,onlineUsers:k,setChatData:w,users:$,updatePrivateGroupChatId:(e,s)=>{w((t=>{const a={...t};return e&&s&&a[e]&&(a[s]=a[e],delete a[e]),a})),v(`/chat?id=${s}`,{replace:!0})},refetchGroupChats:()=>{if(!L.current)return;L.current.emit("get_user_chat_groups",{user_id:t},(e=>{if("success"===e.status&&e.chat_groups){const s={};e.chat_groups.forEach((e=>{s[e.id]=e})),console.log("groups chat groups : ",s),w((e=>({...e,...s})))}}))}})]}),g&&(0,b.jsx)(h.A,{})]})},ps=()=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.mg,{children:(0,b.jsx)("title",{children:"MeMate - Chat"})}),(0,b.jsx)(hs,{})]})},54967:(e,s,t)=>{t.d(s,{Ab:()=>l,dg:()=>c,fr:()=>d,Ay:()=>u});var a=t(65043),i=t(44541),n=t(95192);const r="image-avatar_clientImg__-nnRU";var o=t(70579);const l=e=>{let{has_photo:s,photo:t,is_business:r,size:l}=e;const[c,d]=(0,a.useState)(!1),u=r?i.A:n.A;return(0,o.jsx)(o.Fragment,{children:s&&t&&!c?(0,o.jsx)("img",{src:t,alt:"client avatar",className:"w-100",onError:()=>d(!0)}):(0,o.jsx)(u,{color:"#667085",size:l})})},c=e=>{var s,t,i;let{has_photo:n,photo:r,name:l}=e;const[c,d]=(0,a.useState)(!1),u=l&&(null===l||void 0===l||null===(s=l.split(" "))||void 0===s||null===(t=s.map((e=>e[0])))||void 0===t||null===(i=t.join(""))||void 0===i?void 0:i.toUpperCase())||"";return(0,o.jsx)(o.Fragment,{children:n&&r&&!c?(0,o.jsx)("img",{src:r,alt:"client avatar",className:"w-100",onError:()=>d(!0)}):u})},d=e=>{let{name:s,size:t=14}=e;const a=s.split(" ").map((e=>e[0])).join("").toUpperCase();return(0,o.jsx)("span",{style:{fontSize:`${t}px`},children:a})},u=e=>{let{has_photo:s,photo:t,is_business:l}=e;const[c,d]=(0,a.useState)(!1),u=l?i.A:n.A;return(0,o.jsx)("div",{className:`d-flex justify-content-center align-items-center ${r} ${l?"":"rounded-circle"}`,style:{overflow:"hidden"},children:s&&t&&!c?(0,o.jsx)("img",{src:t,alt:"client avatar",className:"w-100",onError:()=>d(!0)}):(0,o.jsx)(u,{color:"#667085"})})}},95753:(e,s,t)=>{t.d(s,{A:()=>l,v:()=>o});var a=t(65043),i=t(22927),n=t(43984),r=t(70579);function o(e){return e>=1048576?(e/1048576).toFixed(1)+" MB":e>=1024?(e/1024).toFixed(1)+" KB":e+" B"}const l=e=>{let{onFileChange:s,styles:t}=e;const[o,l]=(0,a.useState)(!1),c=(0,a.useRef)(),d=(0,a.useRef)(),u=e=>{const s=c.current,t=d.current;if(!s||!t)return;const a=s.contains(e.target),i=t.contains(e.target);a||i||l(!1)};return a.useEffect((()=>(document.addEventListener("click",u),()=>{document.removeEventListener("click",u)})),[]),(0,r.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,r.jsx)("button",{className:t.attachButton,type:"button","aria-label":"Attach file",ref:c,onClick:()=>l((e=>!e)),style:{padding:"6px 6px 6px 8px"},children:(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M18.0833 8.33333L9.16667 17.25C8.17221 18.2444 6.82407 18.8042 5.41667 18.8042C4.00926 18.8042 2.66112 18.2444 1.66667 17.25C0.672214 16.2556 0.112446 14.9074 0.112446 13.5C0.112446 12.0926 0.672214 10.7444 1.66667 9.75L10.5833 0.833329C11.2486 0.167998 12.1514 -0.149151 13.0833 0.0666624C14.0153 0.282476 14.8056 0.947998 15.25 1.83333C15.6944 2.71866 15.7361 3.75 15.3333 4.66666C14.9306 5.58333 14.1389 6.29166 13.1667 6.5L5.08333 14.5833C4.75 14.9167 4.31944 15.0833 3.83333 15.0833C3.34722 15.0833 2.91667 14.9167 2.58333 14.5833C2.25 14.25 2.08333 13.8194 2.08333 13.3333C2.08333 12.8472 2.25 12.4167 2.58333 12.0833L9.16667 5.5",stroke:"#667085",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})})}),o&&(0,r.jsxs)("div",{ref:d,className:t.attachmentPopover,style:{position:"absolute",bottom:"40px",left:-200,zIndex:20,minWidth:220,background:"#fff",borderRadius:8,boxShadow:"0 4px 24px rgba(16,24,40,0.18)",padding:10},children:[(0,r.jsxs)("label",{className:t.attachmentLabel,style:{display:"flex",alignItems:"center",cursor:"pointer",gap:8,padding:"10px 6px"},children:[(0,r.jsx)("input",{type:"file",style:{display:"none"},onChange:e=>{s(e),l(!1)},accept:".pdf, .doc, .docx, .txt"}),(0,r.jsx)(i.A,{size:16,color:"#667085"}),(0,r.jsx)("span",{className:"font-16",children:"Document"})]}),(0,r.jsxs)("label",{className:t.attachmentLabel,style:{display:"flex",alignItems:"center",cursor:"pointer",gap:8,padding:"10px 6px"},children:[(0,r.jsx)("input",{type:"file",style:{display:"none"},onChange:e=>{s(e),l(!1)},accept:"image/*"}),(0,r.jsx)(n.A,{size:16,color:"#667085"}),(0,r.jsx)("span",{className:"font-16",children:"Photo "})]})]})]})}}}]);
//# sourceMappingURL=9824.11c05d3c.chunk.js.map