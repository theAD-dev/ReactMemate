{"version":3,"file":"static/js/6608.c7c88722.chunk.js","mappings":"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","sources":["../node_modules/react-bootstrap-icons/dist/icons/chevron-right.js","pages/business/enquiries/form-builder/builder/init-builder.js","pages/business/enquiries/form-builder/form-builder.jsx","../node_modules/react-bootstrap-icons/dist/icons/arrow-counterclockwise.js","../node_modules/react-bootstrap-icons/dist/icons/arrow-clockwise.js","APIs/email-template.js","pages/business/enquiries/form-builder/api.js","../node_modules/react-bootstrap-icons/dist/icons/save.js"],"sourcesContent":["var _excluded = [\"color\", \"size\", \"title\", \"className\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var s = Object.getOwnPropertySymbols(e); for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (e.includes(n)) continue; t[n] = r[n]; } return t; }\nimport React, { forwardRef } from 'react';\nimport PropTypes from 'prop-types';\nvar ChevronRight = /*#__PURE__*/forwardRef(function (_ref, ref) {\n  var _ref$color = _ref.color,\n    color = _ref$color === void 0 ? 'currentColor' : _ref$color,\n    _ref$size = _ref.size,\n    size = _ref$size === void 0 ? '1em' : _ref$size,\n    _ref$title = _ref.title,\n    title = _ref$title === void 0 ? null : _ref$title,\n    _ref$className = _ref.className,\n    className = _ref$className === void 0 ? '' : _ref$className,\n    rest = _objectWithoutProperties(_ref, _excluded);\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    ref: ref,\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 16 16\",\n    width: size,\n    height: size,\n    fill: color,\n    className: ['bi', 'bi-chevron-right', className].filter(Boolean).join(' ')\n  }, rest), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    d: \"M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708\"\n  }));\n});\nChevronRight.propTypes = {\n  color: PropTypes.string,\n  size: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  title: PropTypes.string,\n  className: PropTypes.string\n};\nexport default ChevronRight;","// src/builder/initBuilder.js\nimport { saveFormToApi, updateFormToApi } from \"../api\";\n\nexport function initBuilder({ defaultOrgId, initialForm = null }) {\n  // Guard against double binding in React StrictMode (dev) or accidental re-calls\n  if (typeof window === \"undefined\") {\n    return;\n  }\n  // Scope all DOM lookups to the builder root to avoid collisions with host app\n  const root = document.querySelector(\".mf-builder\") || document;\n\n  // Prevent duplicate initialization\n  if (root.dataset.builderInitialized === \"true\") {\n    console.log(\"Builder already initialized, skipping...\");\n    return;\n  }\n  root.dataset.builderInitialized = \"true\";\n\n  // Core nodes\n  const preview = root.querySelector(\"#preview-container\");\n  const properties = root.querySelector(\"#properties-container\");\n  const cssTextarea = root.querySelector(\"#form_style\");\n  const previewBtn = root.querySelector(\"#preview-btn\");\n  const saveBtn = root.querySelector(\"#save-btn\");\n\n  // Internal state (must exist before any hydration uses it)\n  let fieldCounter = 1;\n  let fieldsData = {};\n  let currentField = null;\n  // If we're editing an existing form, keep its id so subsequent saves PATCH instead of POST\n  let currentFormId = initialForm?.id || null;\n\n  // Undo/Redo history\n  let history = [];\n  let historyIndex = -1;\n  const MAX_HISTORY = 50;\n\n  // Save state to history\n  function saveHistory() {\n    // Remove any future history if we're not at the end\n    if (historyIndex < history.length - 1) {\n      history = history.slice(0, historyIndex + 1);\n    }\n\n    // Save current state\n    history.push(JSON.parse(JSON.stringify(fieldsData)));\n\n    // Limit history size\n    if (history.length > MAX_HISTORY) {\n      history.shift();\n    } else {\n      historyIndex++;\n    }\n  }\n\n  // Undo\n  function undo() {\n    if (historyIndex > 0) {\n      historyIndex--;\n      restoreFromHistory(history[historyIndex]);\n    }\n  }\n\n  // Redo\n  function redo() {\n    if (historyIndex < history.length - 1) {\n      historyIndex++;\n      restoreFromHistory(history[historyIndex]);\n    }\n  }\n\n  // Restore state from history\n  function restoreFromHistory(state) {\n    fieldsData = JSON.parse(JSON.stringify(state));\n    rebuildPreview();\n  }\n\n  // Rebuild preview from fieldsData\n  function rebuildPreview() {\n    // Clear preview but keep page header and empty state\n    preview.querySelectorAll(\".preview-field\").forEach((f) => f.remove());\n\n    // Rebuild all fields\n    Object.keys(fieldsData).forEach((id) => {\n      const data = fieldsData[id];\n      const type = data.field_type || data.type;\n      const el = document.createElement(\"div\");\n      el.className = \"preview-field\";\n      el.id = id;\n      el.dataset.type = type;\n      el.innerHTML = getTemplate(type) + actionBar();\n      preview.appendChild(el);\n      wireField(el, id, type);\n      updateFieldDisplay(el, id, type, data);\n    });\n\n    updateMoveButtons();\n    applyConditionalVisibilityRecursively();\n\n    // Show/hide empty state\n    const emptyState = preview.querySelector(\".empty-state\");\n    if (emptyState) {\n      emptyState.style.display =\n        Object.keys(fieldsData).length === 0 ? \"flex\" : \"none\";\n    }\n  }\n\n  // Update field display based on data\n  function updateFieldDisplay(el, id, type, data) {\n    const labelEl = el.querySelector(\n      \".form-field > label, .checkbox-field label\"\n    );\n    if (labelEl && data.label) labelEl.textContent = data.label;\n\n    if (\n      [\"text\", \"email\", \"number\", \"phone\", \"url\", \"date\", \"time\"].includes(type)\n    ) {\n      const input = el.querySelector(\"input\");\n      if (input && data.placeholder) input.placeholder = data.placeholder;\n    } else if (type === \"textarea\") {\n      const ta = el.querySelector(\"textarea\");\n      if (ta && data.placeholder) ta.placeholder = data.placeholder;\n    }\n  }\n\n  // ----- Conditional visibility (visible_if) -----\n  function getControllerValue(controllerFieldId) {\n    const controllerHost = root.querySelector(`#${controllerFieldId}`);\n    if (!controllerHost) return null;\n\n    const controllerType = controllerHost.dataset.type;\n\n    if (controllerType === \"select\") {\n      const sel = controllerHost.querySelector(\"select\");\n      if (!sel) return null;\n      const opt = sel.options?.[sel.selectedIndex];\n      const text = opt ? (opt.textContent || \"\").trim() : \"\";\n      return text || null;\n    }\n\n    if (controllerType === \"radio\") {\n      const checked = controllerHost.querySelector(\n        'input[type=\"radio\"]:checked'\n      );\n      if (!checked) return null;\n      const lbl = controllerHost.querySelector(`label[for=\"${checked.id}\"]`);\n      return (lbl?.textContent || \"\").trim() || null;\n    }\n\n    if (controllerType === \"multicheckbox\") {\n      const checked = Array.from(\n        controllerHost.querySelectorAll('input[type=\"checkbox\"]:checked')\n      );\n      if (!checked.length) return [];\n      return checked\n        .map((cb) => {\n          const lbl = controllerHost.querySelector(`label[for=\"${cb.id}\"]`);\n          return (lbl?.textContent || \"\").trim();\n        })\n        .filter(Boolean);\n    }\n\n    if (controllerType === \"checkbox\" || controllerType === \"consent\") {\n      const cb = controllerHost.querySelector('input[type=\"checkbox\"]');\n      if (!cb) return null;\n      return cb.checked ? \"Checked\" : \"Unchecked\";\n    }\n\n    const input = controllerHost.querySelector(\"input, select, textarea\");\n    if (!input) return null;\n    const v = (input.value || \"\").trim();\n    return v || null;\n  }\n\n  function isFieldVisible(fieldId) {\n    const data = fieldsData[fieldId];\n    if (!data || !data.visible_if) return true;\n\n    const { field_id: controllerId, value: expected } = data.visible_if;\n    if (!controllerId || expected == null || expected === \"\") return true;\n\n    const actual = getControllerValue(controllerId);\n\n    if (Array.isArray(actual)) {\n      return actual.includes(expected);\n    }\n\n    return actual === expected;\n  }\n\n  // Track if we're in preview mode (conditional visibility only applies in preview)\n  let isPreviewMode = false;\n\n  function applyConditionalVisibilityRecursively() {\n    // In designer mode, don't hide fields - just show visual indicator\n    if (!isPreviewMode) {\n      Object.keys(fieldsData).forEach((fid) => {\n        const host = root.querySelector(`#${fid}`);\n        if (!host) return;\n        const hasCondition = !!fieldsData[fid]?.visible_if;\n        // Show all fields in designer mode but add visual indicator for conditional fields\n        host.style.display = \"\";\n        if (hasCondition) {\n          host.classList.add(\"has-condition\");\n        } else {\n          host.classList.remove(\"has-condition\");\n        }\n      });\n      return;\n    }\n\n    // Preview mode - actually apply visibility\n    const maxPasses = 5;\n    let prevSignature = \"\";\n\n    for (let pass = 0; pass < maxPasses; pass++) {\n      Object.keys(fieldsData).forEach((fid) => {\n        const host = root.querySelector(`#${fid}`);\n        if (!host) return;\n        const visible = isFieldVisible(fid);\n        host.style.display = visible ? \"\" : \"none\";\n\n        if (!visible && currentField === fid) {\n          currentField = null;\n          properties.classList.remove(\"has-selection\");\n          preview\n            .querySelectorAll(\".preview-field\")\n            .forEach((f) => f.classList.remove(\"selected\"));\n        }\n      });\n\n      const sig = Object.keys(fieldsData)\n        .map((fid) => {\n          const host = root.querySelector(`#${fid}`);\n          return `${fid}:${host?.style.display === \"none\" ? 0 : 1}`;\n        })\n        .join(\"|\");\n\n      if (sig === prevSignature) break;\n      prevSignature = sig;\n    }\n  }\n\n  // Listen for undo/redo events\n  window.addEventListener(\"builder-undo\", undo);\n  window.addEventListener(\"builder-redo\", redo);\n\n  // If an existing form was passed in, hydrate all UI\n  if (initialForm) {\n    try {\n      hydrateInitialForm(initialForm);\n\n      // Force update preview after hydration\n      setTimeout(() => {\n        const previewTitleEl = root.querySelector(\"#preview-form-title\");\n        const previewDescriptionEl = root.querySelector(\n          \"#preview-form-description\"\n        );\n        const formTitleEl = root.querySelector(\"#form-title\");\n        const formDescriptionEl = root.querySelector(\"#form-description\");\n\n        if (previewTitleEl && formTitleEl && formTitleEl.value) {\n          previewTitleEl.textContent = formTitleEl.value;\n        }\n        if (\n          previewDescriptionEl &&\n          formDescriptionEl &&\n          formDescriptionEl.value\n        ) {\n          previewDescriptionEl.textContent = formDescriptionEl.value;\n        }\n      }, 100);\n    } catch (err) {\n      console.error(\"Hydration failed:\", err);\n    }\n  }\n\n  // Update preview title and description in real-time\n  const formTitleEl = root.querySelector(\"#form-title\");\n  const formDescriptionEl = root.querySelector(\"#form-description\");\n  const previewTitleEl = root.querySelector(\"#preview-form-title\");\n  const previewDescriptionEl = root.querySelector(\"#preview-form-description\");\n\n  if (formTitleEl && previewTitleEl) {\n    formTitleEl.addEventListener(\"input\", (e) => {\n      previewTitleEl.textContent = e.target.value || \"Title\";\n    });\n  }\n\n  if (formDescriptionEl && previewDescriptionEl) {\n    formDescriptionEl.addEventListener(\"input\", (e) => {\n      previewDescriptionEl.textContent = e.target.value || \"Description\";\n    });\n  }\n\n  // Field palette (delegated to support dragging from child elements reliably)\n  const palette = root.querySelector(\".field-types\");\n  if (palette) {\n    palette.addEventListener(\n      \"dragstart\",\n      (e) => {\n        const item = e.target && e.target.closest(\".field-type\");\n        if (!item) return;\n        try {\n          if (e.dataTransfer) {\n            e.dataTransfer.effectAllowed = \"copy\";\n            // Set both a standard and a custom MIME so all browsers carry data\n            e.dataTransfer.setData(\"text/plain\", item.dataset.type);\n            e.dataTransfer.setData(\n              \"application/x-field-type\",\n              item.dataset.type\n            );\n          }\n        } catch (_) {\n          /* Silently ignore errors */\n        }\n      },\n      true\n    );\n  }\n\n  // Drop target - improved with insertion between fields\n  let dragOverField = null;\n  let dropPosition = null; // 'before' or 'after'\n\n  preview.addEventListener(\"dragenter\", (e) => {\n    e.preventDefault();\n    preview.classList.add(\"dragover\");\n  });\n\n  preview.addEventListener(\"dragover\", (e) => {\n    e.preventDefault();\n    if (e.dataTransfer) e.dataTransfer.dropEffect = \"copy\";\n\n    // Find which field we're hovering over\n    const target = e.target.closest(\".preview-field\");\n    if (target) {\n      const rect = target.getBoundingClientRect();\n      const midpoint = rect.top + rect.height / 2;\n      const mouseY = e.clientY;\n\n      // Remove previous indicators\n      preview.querySelectorAll(\".preview-field\").forEach((f) => {\n        f.classList.remove(\"drag-over-top\", \"drag-over-bottom\");\n      });\n\n      // Determine if we're in top or bottom half\n      if (mouseY < midpoint) {\n        target.classList.add(\"drag-over-top\");\n        dragOverField = target;\n        dropPosition = \"before\";\n      } else {\n        target.classList.add(\"drag-over-bottom\");\n        dragOverField = target;\n        dropPosition = \"after\";\n      }\n    } else {\n      // Clear indicators if not over a field\n      preview.querySelectorAll(\".preview-field\").forEach((f) => {\n        f.classList.remove(\"drag-over-top\", \"drag-over-bottom\");\n      });\n      dragOverField = null;\n      dropPosition = null;\n    }\n  });\n\n  preview.addEventListener(\"dragleave\", (e) => {\n    if (!preview.contains(e.relatedTarget)) {\n      preview.classList.remove(\"dragover\");\n      preview.querySelectorAll(\".preview-field\").forEach((f) => {\n        f.classList.remove(\"drag-over-top\", \"drag-over-bottom\");\n      });\n      dragOverField = null;\n      dropPosition = null;\n    }\n  });\n\n  preview.addEventListener(\"drop\", (e) => {\n    e.preventDefault();\n    preview.classList.remove(\"dragover\");\n    preview.querySelectorAll(\".preview-field\").forEach((f) => {\n      f.classList.remove(\"drag-over-top\", \"drag-over-bottom\");\n    });\n\n    let type = \"\";\n    try {\n      type =\n        (e.dataTransfer &&\n          (e.dataTransfer.getData(\"application/x-field-type\") ||\n            e.dataTransfer.getData(\"text/plain\") ||\n            e.dataTransfer.getData(\"field-type\"))) ||\n        \"\";\n    } catch (_) {\n      /* Silently ignore errors */\n    }\n    if (!type) return;\n\n    // Add field at the determined position\n    addField(type, dragOverField, dropPosition);\n    dragOverField = null;\n    dropPosition = null;\n  });\n\n  preview.addEventListener(\"change\", () => {\n    applyConditionalVisibilityRecursively();\n  });\n\n  // Show selected file names for image fields\n  preview.addEventListener(\"change\", (e) => {\n    const input = e.target;\n    if (!input || input.type !== \"file\") return;\n\n    const host = input.closest(\".preview-field\");\n    if (!host) return;\n\n    const fileNameEl = host.querySelector(\".upload-filename\");\n    if (!fileNameEl) return;\n\n    const files = Array.from(input.files || []);\n    fileNameEl.textContent = files.length\n      ? files.map((f) => f.name).join(\", \")\n      : \"\";\n\n    applyConditionalVisibilityRecursively();\n  });\n\n  function addField(type, referenceField = null, position = null) {\n    const id = `field-${fieldCounter++}`;\n    const el = document.createElement(\"div\");\n    el.className = \"preview-field\";\n    el.id = id;\n    el.dataset.type = type;\n    el.innerHTML = getTemplate(type) + actionBar();\n\n    // Insert at the appropriate position\n    if (referenceField && position === \"before\") {\n      preview.insertBefore(el, referenceField);\n    } else if (referenceField && position === \"after\") {\n      if (referenceField.nextSibling) {\n        preview.insertBefore(el, referenceField.nextSibling);\n      } else {\n        preview.appendChild(el);\n      }\n    } else {\n      // Default: append to end (or insert in fields container if it exists)\n      const fieldsContainer = preview.querySelector(\".form-fields-container\");\n      if (fieldsContainer) {\n        fieldsContainer.appendChild(el);\n      } else {\n        preview.appendChild(el);\n      }\n    }\n\n    fieldsData[id] = seedDataFor(type);\n\n    // Ensure every field starts with a unique, stable name.\n    // Some field types define a preferred name (e.g. address/image), but we must guarantee uniqueness.\n    const existingNames = new Set(\n      Object.keys(fieldsData)\n        .filter((fid) => fid !== id)\n        .map((fid) => (fieldsData[fid]?.name || \"\").trim())\n        .filter(Boolean)\n    );\n\n    const preferredBaseName = (fieldsData[id].name || \"\").trim();\n    const fallbackBaseName = `${type}_${String(id).replace(\"field-\", \"\")}`;\n    const baseName = preferredBaseName || fallbackBaseName;\n\n    let uniqueName = baseName;\n    let suffix = 2;\n    while (existingNames.has(uniqueName)) {\n      uniqueName = `${baseName}_${suffix++}`;\n    }\n    fieldsData[id].name = uniqueName;\n\n    wireField(el, id, type);\n    // Do not auto-select field when adding - let user click to select\n    // selectField(id, type);\n    updateMoveButtons();\n\n    applyConditionalVisibilityRecursively();\n\n    // Save to history after adding field\n    saveHistory();\n\n    // Hide empty state if it exists\n    const emptyState = preview.querySelector(\".empty-state\");\n    if (emptyState) {\n      emptyState.style.display = \"none\";\n    }\n  }\n\n  function getTemplate(type) {\n    const map = {\n      text: `<div class=\"form-field\"><label>Text Field</label><input type=\"text\" placeholder=\"Enter text\"></div>`,\n      email: `<div class=\"form-field\"><label>Email Field</label><input type=\"email\" placeholder=\"Enter email\"></div>`,\n      number: `<div class=\"form-field\"><label>Number Field</label><input type=\"number\" placeholder=\"Enter number\"></div>`,\n      phone: `<div class=\"form-field\"><label>Phone Field</label><input type=\"tel\" placeholder=\"Enter phone\"></div>`,\n      textarea: `<div class=\"form-field\"><label>Text Area</label><textarea placeholder=\"Enter text\"></textarea></div>`,\n      select: `<div class=\"form-field\"><label>Dropdown</label><select><option value=\"\">Select an option</option><option>Option 1</option><option>Option 2</option></select></div>`,\n      radio: `<div class=\"form-field\"><label>Radio Buttons</label><div class=\"radio-field\"><input id=\"r1\" type=\"radio\" name=\"rg\"><label for=\"r1\">Option 1</label></div><div class=\"radio-field\"><input id=\"r2\" type=\"radio\" name=\"rg\"><label for=\"r2\">Option 2</label></div></div>`,\n      checkbox: `<div class=\"form-field\"><div class=\"checkbox-field\"><input id=\"cb\" type=\"checkbox\"><label for=\"cb\" class=\"mb-0\">Checkbox</label></div></div>`,\n      multicheckbox: `<div class=\"form-field\"><label>Multi Checkbox</label><div class=\"checkbox-field\"><input id=\"m1\" type=\"checkbox\"><label for=\"m1\">Option 1</label></div><div class=\"checkbox-field\"><input id=\"m2\" type=\"checkbox\"><label for=\"m2\">Option 2</label></div></div>`,\n      date: `<div class=\"form-field\"><label>Date</label><input type=\"date\"></div>`,\n      time: `<div class=\"form-field\"><label>Time</label><input type=\"time\"></div>`,\n      url: `<div class=\"form-field\"><label>Website URL</label><input type=\"url\" placeholder=\"https://example.com\"></div>`,\n      address: `<div class=\"form-field\"><label>Address</label><div class=\"address-grid\" style=\"display:grid;grid-template-columns:1fr 1fr;gap:10px;\">\n        <input type=\"text\" placeholder=\"Address line 1\">\n        <input type=\"text\" placeholder=\"Address line 2\">\n        <input type=\"text\" placeholder=\"City\">\n        <input type=\"text\" placeholder=\"State\">\n        <input type=\"text\" placeholder=\"Postcode\">\n        <input type=\"text\" placeholder=\"Country\">\n      </div></div>`,\n      image: `<div class=\"form-field\"><label>Image Upload</label>\n        <div class=\"upload-box\" style=\"border:1px dashed #d0d5dd;border-radius:10px;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;gap:16px;background:#fff;\">\n          <div style=\"display:flex;flex-direction:column;gap:2px;\">\n            <div style=\"font-weight:600;font-size:14px;color:#101828;\">Drop image here</div>\n            <div style=\"font-size:13px;color:#158ecc;\">or click <span style=\"color:#158ecc;font-weight:500;\">Browse</span></div>\n          </div>\n          <label class=\"upload-browse-btn\" style=\"margin:0;cursor:pointer;padding:8px 16px;border-radius:8px;border:1px solid #d0d5dd;background:#fff;font-size:14px;font-weight:500;color:#344054;transition:all 0.2s;\">\n            Browse\n            <input type=\"file\" accept=\"image/*\" style=\"display:none;\" />\n          </label>\n        </div>\n        <div class=\"upload-filename\" style=\"margin-top:8px;font-size:12px;color:#667085;\"></div>\n      </div>`,\n      html: `<div class=\"form-field html-content\"><p>HTML Content</p></div>`,\n      consent: `<div class=\"form-field\"><div class=\"checkbox-field\"><input id=\"consent\" type=\"checkbox\"><label for=\"consent\" class=\"mb-0\">I agree to the terms and conditions</label></div></div>`,\n      submit_button: `<div class=\"form-field\"><button type=\"submit\" class=\"btn-primary\">Submit</button></div>`,\n    };\n    return map[type] || map.text;\n  }\n\n  function actionBar(isRequired = false) {\n    return `\n      <div class=\"field-actions\">\n        <input type=\"checkbox\" class=\"required-toggle\" title=\"Required\" ${\n          isRequired ? \"checked\" : \"\"\n        } />\n        <button class=\"move-field-up\" title=\"Up\"></button>\n        <button class=\"move-field-down\" title=\"Down\"></button>\n        <button class=\"edit-field\" title=\"Edit\"></button>\n        <button class=\"remove-field\" title=\"Remove\"></button>\n      </div>`;\n  }\n\n  function seedDataFor(type) {\n    const base = {\n      type,\n      field_type: type,\n      label: `${capitalize(type)} Field`,\n      name: ``,\n      required: false,\n      visible_if: null,\n      custom_class: \"\",\n      placeholder: `Enter ${type}`,\n      maxlength: \"\",\n      regex: \"\",\n      error_message: \"\",\n      options: [],\n    };\n    if ([\"select\", \"radio\", \"multicheckbox\"].includes(type)) {\n      base.options = [\"Option 1\", \"Option 2\"];\n    }\n    if (type === \"submit_button\") {\n      base.button_text = \"Submit\";\n      base.custom_style = \"\";\n    }\n    if (type === \"html\") {\n      base.html = \"<p>HTML Content</p>\";\n    }\n    if (type === \"consent\") {\n      base.label = \"I agree to the terms and conditions\";\n    }\n    if (type === \"address\") {\n      base.label = \"Address\";\n      base.name = \"address\";\n      base.placeholder = \"\";\n      // NOTE: for address we store structured parts in options (object, not array)\n      base.options = {\n        parts: [\n          {\n            key: \"line1\",\n            label: \"Address Line 1\",\n            required: true,\n            placeholder: \"Address line 1\",\n          },\n          {\n            key: \"line2\",\n            label: \"Address Line 2\",\n            required: false,\n            placeholder: \"Address line 2\",\n          },\n          { key: \"city\", label: \"City\", required: true, placeholder: \"City\" },\n          {\n            key: \"state\",\n            label: \"State\",\n            required: true,\n            placeholder: \"State\",\n          },\n          {\n            key: \"postcode\",\n            label: \"Postcode\",\n            required: true,\n            placeholder: \"Postcode\",\n          },\n          {\n            key: \"country\",\n            label: \"Country\",\n            required: false,\n            placeholder: \"Country\",\n          },\n        ],\n      };\n    }\n    if (type === \"image\") {\n      base.label = \"Image Upload\";\n      base.name = \"image\";\n      base.placeholder = \"\";\n      base.options = {\n        accept: \"image/*\",\n        multiple: false,\n      };\n    }\n    return base;\n  }\n\n  function updateFieldRequiredUI(id) {\n    const data = fieldsData[id];\n    const host = root.querySelector(`#${id}`);\n    if (!host) return;\n    const type = host.dataset.type;\n\n    // --- Action bar checkbox ---\n    const actionReq = host.querySelector(\".required-toggle\");\n    if (actionReq) actionReq.checked = !!data.required;\n\n    // --- Properties panel checkbox ---\n    const propReq = root.querySelector(\"#fp-req\");\n    if (propReq) propReq.checked = !!data.required;\n\n    // --- Handle address field specially ---\n    if (type === \"address\") {\n      const addressGrid = host.querySelector(\".address-grid\");\n      if (addressGrid) {\n        const inputs = addressGrid.querySelectorAll(\"input\");\n        const parts = data.options?.parts || [];\n        inputs.forEach((input, idx) => {\n          const part = parts[idx];\n          // Child input is required only if parent is required AND part.required is true\n          if (data.required && part?.required) {\n            input.setAttribute(\"required\", \"\");\n          } else {\n            input.removeAttribute(\"required\");\n          }\n        });\n      }\n    } else {\n      // --- Required attribute for non-address fields ---\n      host.querySelectorAll(\"input, textarea, select\").forEach((el) => {\n        if (data.required) el.setAttribute(\"required\", \"\");\n        else el.removeAttribute(\"required\");\n      });\n    }\n\n    // --- Required star ---\n    const label = host.querySelector(\".form-field > label\");\n    if (label) {\n      let star = label.querySelector(\".required-star\");\n\n      if (data.required && !star) {\n        label.insertAdjacentHTML(\n          \"beforeend\",\n          ' <span class=\"required-star\">*</span>'\n        );\n      } else if (!data.required && star) {\n        star.remove();\n      }\n    }\n  }\n\n  function wireField(el, id, type) {\n    el.addEventListener(\"click\", (e) => {\n      if (!e.target.closest(\".field-actions\")) selectField(id, type);\n    });\n    const reqToggle = el.querySelector(\".required-toggle\");\n    if (reqToggle) {\n      reqToggle.addEventListener(\"change\", (e) => {\n        fieldsData[id].required = e.target.checked;\n\n        // sync preview + properties\n        updateFieldRequiredUI(id);\n\n        saveHistory();\n      });\n    }\n    el.querySelector(\".remove-field\").addEventListener(\"click\", () => {\n      delete fieldsData[id];\n      el.remove();\n      updateMoveButtons();\n\n      // Save to history after removing field\n      saveHistory();\n\n      // If the removed field was selected, clear selection\n      if (currentField === id) {\n        properties.classList.remove(\"has-selection\");\n        // Reset to placeholder\n        const placeholder = properties.querySelector(\n          \".field-props-placeholder\"\n        );\n        if (placeholder) {\n          placeholder.innerHTML = `\n            <div class=\"panel-header\">\n              <h2>Properties</h2>\n            </div>\n            <div class=\"no-selection\">\n              <svg width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" opacity=\"0.2\">\n                <rect x=\"3\" y=\"5\" width=\"18\" height=\"14\" rx=\"2\"/>\n                <path d=\"M7 10h10M7 14h6\"/>\n              </svg>\n              <p>Select a field to edit its properties</p>\n            </div>\n          `;\n        }\n      }\n\n      // Show empty state if no fields left\n      const remainingFields = preview.querySelectorAll(\".preview-field\");\n      const emptyState = preview.querySelector(\".empty-state\");\n      if (remainingFields.length === 0 && emptyState) {\n        emptyState.style.display = \"flex\";\n      }\n    });\n    el.querySelector(\".move-field-up\").addEventListener(\"click\", (e) => {\n      e.stopPropagation();\n      if (\n        el.previousElementSibling &&\n        el.previousElementSibling.classList.contains(\"preview-field\")\n      ) {\n        el.parentNode.insertBefore(el, el.previousElementSibling);\n      }\n      reindex();\n      updateMoveButtons();\n      saveHistory(); // Save to history after moving\n    });\n    el.querySelector(\".move-field-down\").addEventListener(\"click\", (e) => {\n      e.stopPropagation();\n      const next = el.nextElementSibling;\n      if (next && next.classList.contains(\"preview-field\")) {\n        el.parentNode.insertBefore(next, el);\n      }\n      reindex();\n      updateMoveButtons();\n      saveHistory(); // Save to history after moving\n    });\n    el.querySelector(\".edit-field\").addEventListener(\"click\", (e) => {\n      e.stopPropagation();\n      selectField(id, type);\n    });\n  }\n\n  function reindex() {\n    const newOrder = {};\n    preview.querySelectorAll(\".preview-field\").forEach((node) => {\n      newOrder[node.id] = fieldsData[node.id];\n    });\n    fieldsData = newOrder;\n    updateMoveButtons();\n  }\n\n  function updateMoveButtons() {\n    const nodes = Array.from(preview.querySelectorAll(\".preview-field\"));\n    nodes.forEach((node, idx) => {\n      const upBtn = node.querySelector(\".move-field-up\");\n      const downBtn = node.querySelector(\".move-field-down\");\n      if (upBtn) upBtn.disabled = idx === 0;\n      if (downBtn) downBtn.disabled = idx === nodes.length - 1;\n    });\n  }\n\n  function selectField(id, type) {\n    currentField = id;\n    const data = fieldsData[id];\n\n    // Remove selected class from all fields\n    preview\n      .querySelectorAll(\".preview-field\")\n      .forEach((f) => f.classList.remove(\"selected\"));\n    // Add selected class to current field\n    const selectedEl = preview.querySelector(`#${id}`);\n    if (selectedEl) selectedEl.classList.add(\"selected\");\n\n    // Add has-selection class to properties container\n    properties.classList.add(\"has-selection\");\n\n    // Find or create field properties container\n    let fieldPropsContainer = properties.querySelector(\n      \".field-props-placeholder\"\n    );\n    if (!fieldPropsContainer) {\n      fieldPropsContainer = document.createElement(\"div\");\n      fieldPropsContainer.className = \"field-props-placeholder\";\n      properties.insertBefore(fieldPropsContainer, properties.firstChild);\n    }\n\n    fieldPropsContainer.innerHTML = `\n      <div class=\"panel-header\">\n        <h2>Properties</h2>\n      </div>\n      <div class=\"property-group\">\n        <h3>Basic</h3>\n        <label>Label <input id=\"fp-label\" value=\"${escapeHtml(\n          data.label\n        )}\"></label>\n        <label>CSS class (optional)\n          <input id=\"fp-class\" value=\"${escapeAttr(data.custom_class || \"\")}\" placeholder=\"e.g. contact-form__field\" />\n        </label>\n        <p class=\"help-text\">\n          Optional. Adds a class on this field wrapper so your website can style it. Leave blank if youre not sure.\n        </p>\n        ${\n          [\"text\", \"email\", \"number\", \"phone\", \"url\", \"textarea\"].includes(type)\n            ? `<label>Placeholder <input id=\"fp-ph\" value=\"${escapeHtml(\n                data.placeholder || \"\"\n              )}\"></label>`\n            : \"\"\n        }\n        ${\n          [\"text\", \"email\", \"number\", \"phone\", \"url\", \"textarea\"].includes(type)\n            ? `<label>Max Length <input id=\"fp-max\" min=\"0\" type=\"number\" value=\"${escapeAttr(\n                data.maxlength || \"\"\n              )}\"></label>`\n            : \"\"\n        }\n        ${\n          [\"text\", \"email\", \"number\", \"phone\", \"url\", \"textarea\"].includes(type)\n            ? `\n          <div class=\"property-subtle\">\n            <label>Validation Pattern (Regex)\n              <input id=\"fp-regex\" placeholder=\"e.g. ^[A-Za-z]{3,}$\" value=\"${escapeAttr(\n                data.regex || \"\"\n              )}\">\n            </label>\n            <p class=\"help-text text-start\">Optional. Add a regex pattern for validation.</p>\n            <label>Regex Error Message <span id=\"fp-errmsg-required\" class=\"required\" style=\"display: ${\n              data.regex ? \"inline\" : \"none\"\n            };\">*</span>\n              <input id=\"fp-errmsg\" placeholder=\"e.g. Please enter only letters\" value=\"${escapeAttr(\n                data.error_message || \"\"\n              )}\" style=\"border-color: ${\n                data.regex && !data.error_message ? \"#dc3545\" : \"\"\n              };\">\n            </label>\n            <p class=\"help-text\">Required when Validation Pattern is set. Custom message to show when validation fails.</p>\n          </div>`\n            : \"\"\n        }\n        <label class=\"inline\"><input type=\"checkbox\" id=\"fp-req\" ${\n          data.required ? \"checked\" : \"\"\n        }> <span>Required</span></label>\n      </div>\n      ${(() => {\n        // Only show conditional section if there are eligible controller fields\n        if (type === \"submit_button\") return \"\";\n        const allowedTypes = [\"select\", \"radio\", \"multicheckbox\", \"checkbox\", \"consent\"];\n        const eligibleControllers = Object.keys(fieldsData)\n          .filter((fid) => fid !== id)\n          .map((fid) => fieldsData[fid])\n          .filter((d) => allowedTypes.includes(d.field_type || d.type));\n        if (eligibleControllers.length === 0) return \"\";\n        return `\n      <div class=\"property-group\" id=\"fp-conditional-group\">\n        <h3>Conditional</h3>\n        <label class=\"inline\">\n          <input type=\"checkbox\" id=\"fp-cond-enabled\" ${\n            data.visible_if ? \"checked\" : \"\"\n          }>\n          <span>Show this field conditionally</span>\n        </label>\n        <div id=\"fp-cond-wrap\" style=\"display:${\n          data.visible_if ? \"block\" : \"none\"\n        }; margin-top: 12px;\">\n          <label>Controlling field\n            <select id=\"fp-cond-field\"></select>\n          </label>\n          <label>Value\n            <select id=\"fp-cond-value\"></select>\n          </label>\n        </div>\n        <p class=\"help-text\">Show this field only when the selected field above has a specific value.</p>\n      </div>\n      `;\n      })()}\n      ${\n        type === \"image\"\n          ? `\n        <div class=\"property-group\">\n          <h3>Upload</h3>\n          <label>Allowed types\n            <input id=\"fp-accept\" value=\"${escapeAttr(\n              (data.options && !Array.isArray(data.options) && data.options.accept) || \"image/*\"\n            )}\" placeholder=\"image/*\">\n          </label>\n          <label class=\"inline\" style=\"margin-top:8px;\">\n            <input type=\"checkbox\" id=\"fp-multiple\" ${\n              data.options && !Array.isArray(data.options) && data.options.multiple ? \"checked\" : \"\"\n            }>\n            <span>Allow multiple</span>\n          </label>\n          <p class=\"help-text\">Frontend-only. Stored in form JSON for renderer.</p>\n        </div>`\n          : \"\"\n      }\n      ${\n        [\"select\", \"radio\", \"multicheckbox\"].includes(type)\n          ? `\n        <div class=\"property-group\">\n          <h3>Options</h3>\n          <div id=\"fp-options\"></div>\n          <button id=\"fp-addopt\" type=\"button\" class=\"fp-addopt\">Add Option</button>\n        </div>`\n          : \"\"\n      }\n      ${\n        type === \"html\"\n          ? `\n        <div class=\"property-group\">\n          <h3>HTML</h3>\n          <textarea id=\"fp-html\" rows=\"5\">${escapeHtml(\n            data.html || \"\"\n          )}</textarea>\n        </div>`\n          : \"\"\n      }\n      ${\n        type === \"submit_button\"\n          ? `\n        <div class=\"property-group\">\n          <h3>Button</h3>\n          <label>Text <input id=\"fp-btntext\" value=\"${escapeHtml(\n            data.button_text || \"Submit\"\n          )}\"></label>\n          <label>Style (CSS) <textarea id=\"fp-btncss\" rows=\"3\">${escapeHtml(\n            data.custom_style || \"\"\n          )}</textarea></label>\n        </div>`\n          : \"\"\n      }\n      <div class=\"property-group\"><button id=\"fp-apply\" type=\"button\">Update Field</button></div>\n    `;\n\n    // Helper function to update preview in real-time - Comprehensive\n    const updateFieldPreview = () => {\n      const host = root.querySelector(\"#\" + id);\n      if (!host) return;\n\n      // Update label\n      const label = host.querySelector(\n        \".form-field > label, .checkbox-field label\"\n      );\n      if (label) label.textContent = data.label;\n\n      // Update text-like inputs (text, email, number, phone, url, date, time)\n      if (\n        [\"text\", \"email\", \"number\", \"phone\", \"url\", \"date\", \"time\"].includes(\n          type\n        )\n      ) {\n        const input = host.querySelector(\"input\");\n        if (input) {\n          if (data.placeholder) input.placeholder = data.placeholder;\n          if (data.maxlength && !isNaN(data.maxlength) && data.maxlength > 0) {\n            input.maxLength = parseInt(data.maxlength, 10);\n          }\n          if (data.required) input.setAttribute(\"required\", \"\");\n          else input.removeAttribute(\"required\");\n        }\n      }\n      // Update textarea\n      else if (type === \"textarea\") {\n        const ta = host.querySelector(\"textarea\");\n        if (ta) {\n          if (data.placeholder) ta.placeholder = data.placeholder;\n          if (data.maxlength && !isNaN(data.maxlength) && data.maxlength > 0) {\n            ta.maxLength = parseInt(data.maxlength, 10);\n          }\n          if (data.required) ta.setAttribute(\"required\", \"\");\n          else ta.removeAttribute(\"required\");\n        }\n      }\n      else if (type === \"image\") {\n        const lbl = host.querySelector(\".form-field > label\");\n        if (lbl) lbl.textContent = data.label;\n\n        const fileInput = host.querySelector('input[type=\"file\"]');\n        if (fileInput) {\n          const accept =\n            data?.options && !Array.isArray(data.options)\n              ? data.options.accept\n              : \"image/*\";\n          fileInput.setAttribute(\"accept\", accept || \"image/*\");\n\n          if (data?.options && !Array.isArray(data.options) && data.options.multiple) {\n            fileInput.setAttribute(\"multiple\", \"\");\n          } else {\n            fileInput.removeAttribute(\"multiple\");\n          }\n\n          if (data.required) fileInput.setAttribute(\"required\", \"\");\n          else fileInput.removeAttribute(\"required\");\n        }\n      }\n      // Update select\n      else if (type === \"select\") {\n        const sel = host.querySelector(\"select\");\n        if (sel) {\n          sel.innerHTML =\n            `<option value=\"\">${\n              data.placeholder || \"Select an option\"\n            }</option>` +\n            (data.options || [])\n              .map((o) => `<option>${escapeHtml(o)}</option>`)\n              .join(\"\");\n          if (data.required) sel.setAttribute(\"required\", \"\");\n          else sel.removeAttribute(\"required\");\n        }\n      }\n      // Update radio buttons\n      else if (type === \"radio\") {\n        normalizeOptionFieldDom(host, id, type, data);\n      }\n      // Update multicheckbox\n      else if (type === \"multicheckbox\") {\n        normalizeOptionFieldDom(host, id, type, data);\n      }\n      // Update checkbox\n      else if (type === \"checkbox\") {\n        const cbl = host.querySelector(\".checkbox-field label\");\n        if (cbl) cbl.textContent = data.label;\n        const cbinput = host.querySelector(\".checkbox-field input\");\n        if (cbinput) {\n          if (data.required) cbinput.setAttribute(\"required\", \"\");\n          else cbinput.removeAttribute(\"required\");\n        }\n      }\n      // Update consent\n      else if (type === \"consent\") {\n        const cbl = host.querySelector(\".checkbox-field label\");\n        if (cbl) cbl.textContent = data.label;\n        const cbinput = host.querySelector(\".checkbox-field input\");\n        if (cbinput) {\n          if (data.required) cbinput.setAttribute(\"required\", \"\");\n          else cbinput.removeAttribute(\"required\");\n        }\n      }\n      // Update button\n      else if (type === \"submit_button\") {\n        const btn = host.querySelector(\"button\");\n        if (btn) {\n          btn.textContent = data.button_text || \"Submit\";\n          if (data.custom_style) btn.setAttribute(\"style\", data.custom_style);\n          else btn.removeAttribute(\"style\");\n        }\n      }\n      // Update HTML\n      else if (type === \"html\") {\n        const block = host.querySelector(\".html-content\");\n        if (block) block.innerHTML = data.html || \"<p></p>\";\n      }\n\n      applyConditionalVisibilityRecursively();\n    };\n\n    if ([\"select\", \"radio\", \"multicheckbox\"].includes(type)) {\n      const wrap = root.querySelector(\"#fp-options\");\n\n      const renderOptions = () => {\n        wrap.innerHTML = \"\";\n        (data.options || []).forEach((opt, i) => {\n          const row = document.createElement(\"div\");\n          row.innerHTML = `<input data-i=\"${i}\" value=\"${escapeAttr(\n            opt\n          )}\"> <button data-i=\"${i}\" class=\"rm\" type=\"button\">x</button>`;\n          wrap.appendChild(row);\n        });\n      };\n\n      renderOptions();\n\n      root.querySelector(\"#fp-addopt\").onclick = () => {\n        data.options.push(`Option ${data.options.length + 1}`);\n        renderOptions();\n        attachRealtimeListeners(); // Re-attach listeners to new options\n        updateFieldPreview(); // Update preview\n        saveHistory();\n      };\n\n      wrap.addEventListener(\"click\", (e) => {\n        if (e.target.classList.contains(\"rm\")) {\n          const i = +e.target.dataset.i;\n          data.options.splice(i, 1);\n          renderOptions();\n          updateFieldPreview(); // Update preview when option removed\n          saveHistory();\n        }\n      });\n\n      wrap.addEventListener(\"input\", (e) => {\n        if (e.target.matches(\"input[data-i]\")) {\n          data.options[+e.target.dataset.i] = e.target.value;\n          updateFieldPreview(); // Update preview when option text changed\n          saveHistory();\n        }\n      });\n    }\n\n    // ----- Conditional visibility UI (visible_if) -----\n    const getConditionalControllers = () => {\n      // Controllers are fields that have discrete options (including yes/no checkboxes)\n      const allowed = new Set([\n        \"select\",\n        \"radio\",\n        \"multicheckbox\",\n        \"checkbox\",\n        \"consent\",\n      ]);\n      return Object.keys(fieldsData)\n        .filter((fid) => fid !== id)\n        .map((fid) => ({ id: fid, data: fieldsData[fid] }))\n        .filter(({ data }) => allowed.has(data.field_type || data.type));\n    };\n\n    const renderConditionalUI = () => {\n      const enabledEl = root.querySelector(\"#fp-cond-enabled\");\n      const wrapEl = root.querySelector(\"#fp-cond-wrap\");\n      const fieldSel = root.querySelector(\"#fp-cond-field\");\n      const valueSel = root.querySelector(\"#fp-cond-value\");\n      if (!enabledEl || !wrapEl || !fieldSel || !valueSel) return;\n\n      const controllers = getConditionalControllers();\n\n      // Populate controlling field select\n      fieldSel.innerHTML = controllers.length\n        ? controllers\n            .map((c) => {\n              const label = c.data.label || c.id;\n              return `<option value=\"${c.id}\">${escapeHtml(label)}</option>`;\n            })\n            .join(\"\")\n        : `<option value=\"\">No eligible fields</option>`;\n\n      // Decide current controller\n      let currentControllerId = controllers[0]?.id || \"\";\n\n      if (data.visible_if?.field_name) {\n        const match = controllers.find(\n          (c) => (c.data.name || \"\").trim() === data.visible_if.field_name\n        );\n        if (match) currentControllerId = match.id;\n      } else if (data.visible_if?.field_id) {\n        currentControllerId = data.visible_if.field_id;\n      }\n\n      if (currentControllerId) fieldSel.value = currentControllerId;\n\n      const controller = controllers.find((c) => c.id === fieldSel.value);\n      let opts = [];\n      const controllerType =\n        controller?.data?.field_type || controller?.data?.type;\n\n      if (controllerType === \"checkbox\" || controllerType === \"consent\") {\n        opts = [\"Checked\", \"Unchecked\"];\n      } else {\n        opts = Array.isArray(controller?.data?.options)\n          ? controller.data.options\n          : [];\n      }\n\n      valueSel.innerHTML = opts.length\n        ? opts\n            .map(\n              (o) =>\n                `<option value=\"${escapeAttr(o)}\">${escapeHtml(o)}</option>`\n            )\n            .join(\"\")\n        : `<option value=\"\">No options</option>`;\n\n      if (data.visible_if?.value) {\n        valueSel.value = data.visible_if.value;\n      }\n\n      // If enabled but no controllers, force disable the UI\n      if (!controllers.length) {\n        enabledEl.checked = false;\n        wrapEl.style.display = \"none\";\n        data.visible_if = null;\n      }\n    };\n\n    // Initial render\n    renderConditionalUI();\n\n    // Wire conditional enable/disable toggle explicitly\n    const condEnabledEl = root.querySelector(\"#fp-cond-enabled\");\n    const condWrapEl = root.querySelector(\"#fp-cond-wrap\");\n\n    if (condEnabledEl && condWrapEl) {\n      condEnabledEl.addEventListener(\"change\", (e) => {\n        const enabled = e.target.checked;\n\n        if (!enabled) {\n          data.visible_if = null;\n          condWrapEl.style.display = \"none\";\n        } else {\n          // initialize with defaults if enabling\n          const controllers = Object.keys(fieldsData)\n            .filter((fid) => fid !== id)\n            .map((fid) => ({ id: fid, data: fieldsData[fid] }))\n            .filter(({ data }) =>\n              [\"select\", \"radio\", \"multicheckbox\", \"checkbox\", \"consent\"].includes(\n                data.field_type || data.type\n              )\n            );\n\n          if (controllers.length) {\n            const controllerType = controllers[0].data.field_type || controllers[0].data.type;\n            let initialValue = \"\";\n            if (controllerType === \"checkbox\" || controllerType === \"consent\") {\n              initialValue = \"Checked\";\n            } else {\n              initialValue = controllers[0].data.options?.[0] || \"\";\n            }\n            data.visible_if = {\n              field_id: controllers[0].id,\n              field_name: (controllers[0].data?.name || \"\").trim(),\n              operator: \"equals\",\n              value: initialValue,\n            };\n            condWrapEl.style.display = \"block\";\n            // Re-render to show the controller and value dropdowns\n            renderConditionalUI();\n          } else {\n            // no valid controllers  auto-disable\n            e.target.checked = false;\n            data.visible_if = null;\n            condWrapEl.style.display = \"none\";\n          }\n        }\n\n        applyConditionalVisibilityRecursively();\n        saveHistory();\n      });\n    }\n\n    // Real-time property updates with event listeners\n    const attachRealtimeListeners = () => {\n      const labelEl = root.querySelector(\"#fp-label\");\n      const phEl = root.querySelector(\"#fp-ph\");\n      const isRequiredEl = root.querySelector(\"#fp-req\");\n      const classEl = root.querySelector(\"#fp-class\");\n      const condFieldEl = root.querySelector(\"#fp-cond-field\");\n      const condValueEl = root.querySelector(\"#fp-cond-value\");\n      const maxEl = root.querySelector(\"#fp-max\");\n      const regexEl = root.querySelector(\"#fp-regex\");\n      const errmsgEl = root.querySelector(\"#fp-errmsg\");\n      const htmlEl = root.querySelector(\"#fp-html\");\n      const btntextEl = root.querySelector(\"#fp-btntext\");\n      const btncssEl = root.querySelector(\"#fp-btncss\");\n      const acceptEl = root.querySelector(\"#fp-accept\");\n      const multipleEl = root.querySelector(\"#fp-multiple\");\n\n      if (labelEl) {\n        labelEl.addEventListener(\"input\", (e) => {\n          data.label = e.target.value;\n          updateFieldPreview();\n          saveHistory();\n        });\n      }\n      if (classEl) {\n        classEl.addEventListener(\"input\", (e) => {\n          data.custom_class = e.target.value;\n          saveHistory();\n        });\n      }\n      if (phEl) {\n        phEl.addEventListener(\"input\", (e) => {\n          data.placeholder = e.target.value;\n          updateFieldPreview();\n          saveHistory();\n        });\n      }\n      if (isRequiredEl) {\n        isRequiredEl.addEventListener(\"change\", (e) => {\n          data.required = e.target.checked;\n          updateFieldPreview();\n          updateFieldRequiredUI(id);\n          saveHistory();\n        });\n      }\n      if (maxEl) {\n        maxEl.addEventListener(\"input\", (e) => {\n          data.maxlength = e.target.value;\n          updateFieldPreview();\n          saveHistory();\n        });\n      }\n      if (regexEl) {\n        regexEl.addEventListener(\"input\", (e) => {\n          data.regex = e.target.value;\n\n          // Show/hide required indicator for error message\n          const requiredSpan = root.querySelector(\"#fp-errmsg-required\");\n          const errmsgInput = root.querySelector(\"#fp-errmsg\");\n\n          if (requiredSpan) {\n            requiredSpan.style.display = data.regex ? \"inline\" : \"none\";\n          }\n\n          // Highlight error message field if regex is set but error message is empty\n          if (errmsgInput) {\n            if (data.regex && !data.error_message) {\n              errmsgInput.style.borderColor = \"#dc3545\";\n            } else {\n              errmsgInput.style.borderColor = \"\";\n            }\n          }\n\n          saveHistory();\n        });\n      }\n      if (errmsgEl) {\n        errmsgEl.addEventListener(\"input\", (e) => {\n          data.error_message = e.target.value;\n\n          // Remove red border when error message is filled\n          if (data.regex && data.error_message) {\n            e.target.style.borderColor = \"\";\n          } else if (data.regex && !data.error_message) {\n            e.target.style.borderColor = \"#dc3545\";\n          }\n\n          saveHistory();\n        });\n      }\n      if (htmlEl) {\n        htmlEl.addEventListener(\"input\", (e) => {\n          data.html = e.target.value;\n          updateFieldPreview();\n          saveHistory();\n        });\n      }\n      if (btntextEl) {\n        btntextEl.addEventListener(\"input\", (e) => {\n          data.button_text = e.target.value || \"Submit\";\n          updateFieldPreview();\n          saveHistory();\n        });\n      }\n      if (btncssEl) {\n        btncssEl.addEventListener(\"input\", (e) => {\n          data.custom_style = e.target.value || \"\";\n          updateFieldPreview();\n          saveHistory();\n        });\n      }\n      if (acceptEl) {\n        acceptEl.addEventListener(\"input\", (e) => {\n          if (!data.options || Array.isArray(data.options)) {\n            data.options = { accept: \"image/*\", multiple: false };\n          }\n          data.options.accept = e.target.value || \"image/*\";\n          updateFieldPreview();\n          saveHistory();\n        });\n      }\n\n      if (multipleEl) {\n        multipleEl.addEventListener(\"change\", (e) => {\n          if (!data.options || Array.isArray(data.options)) {\n            data.options = { accept: \"image/*\", multiple: false };\n          }\n          data.options.multiple = !!e.target.checked;\n          updateFieldPreview();\n          saveHistory();\n        });\n      }\n\n      if (condFieldEl) {\n        condFieldEl.addEventListener(\"change\", (e) => {\n          const newControllerId = e.target.value;\n\n          // Update first, then re-render\n          const controller = Object.keys(fieldsData)\n            .map((fid) => ({ id: fid, data: fieldsData[fid] }))\n            .find((x) => x.id === newControllerId);\n\n          data.visible_if = {\n            field_id: newControllerId,\n            field_name: (controller?.data?.name || \"\").trim(),\n            operator: \"equals\",\n            value: data.visible_if?.value || \"\",\n          };\n\n          // Re-render values for this controller\n          renderConditionalUI();\n\n          // Pull current value after re-render\n          const valueSel = root.querySelector(\"#fp-cond-value\");\n          const value = valueSel ? valueSel.value : \"\";\n          data.visible_if.value = value;\n\n          applyConditionalVisibilityRecursively();\n          saveHistory();\n        });\n      }\n\n      if (condValueEl) {\n        condValueEl.addEventListener(\"change\", (e) => {\n          if (data.visible_if) {\n            data.visible_if.value = e.target.value;\n            data.visible_if.operator = \"equals\";\n            applyConditionalVisibilityRecursively();\n            saveHistory();\n          }\n        });\n      }\n    };\n\n    // Attach listeners and hide the update button\n    setTimeout(() => {\n      attachRealtimeListeners();\n      const applyBtn = root.querySelector(\"#fp-apply\");\n      if (applyBtn) {\n        applyBtn.style.display = \"none\";\n      }\n    }, 0);\n  }\n\n  // Deselect field and hide properties\n  function deselectField() {\n    currentField = null;\n    // Remove selected class from all fields\n    preview\n      .querySelectorAll(\".preview-field\")\n      .forEach((f) => f.classList.remove(\"selected\"));\n\n    // Remove has-selection class from properties container\n    properties.classList.remove(\"has-selection\");\n\n    // Reset to placeholder\n    const placeholder = properties.querySelector(\".field-props-placeholder\");\n    if (placeholder) {\n      placeholder.innerHTML = `\n        <div class=\"panel-header\">\n          <h2>Properties</h2>\n        </div>\n        <div class=\"no-selection\">\n          <svg width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" opacity=\"0.2\">\n            <rect x=\"3\" y=\"5\" width=\"18\" height=\"14\" rx=\"2\" />\n            <path d=\"M7 10h10M7 14h6\" />\n          </svg>\n          <p>Select a field to edit its properties</p>\n        </div>\n      `;\n    }\n  }\n\n  // Click outside handler to deselect fields\n  properties.addEventListener(\"click\", (e) => {\n    // Check if click is outside of any input/select/textarea within properties\n    const isClickInProperties = e.target.closest(\n      \".property-group, .field-props-placeholder, .general-settings\"\n    );\n    if (!isClickInProperties) {\n      deselectField();\n    }\n  });\n\n  // Also handle clicks on the preview area background to deselect\n  preview.addEventListener(\"click\", (e) => {\n    // If click is not on a preview-field or its action buttons, deselect\n    const clickedField = e.target.closest(\".preview-field\");\n    if (!clickedField) {\n      deselectField();\n    }\n  });\n\n  // Preview modal and tab\n\n  if (previewBtn) {\n    previewBtn.addEventListener(\"click\", () => {\n      // Get fields in DOM order to maintain correct sequence\n      const orderedFields = [];\n      preview.querySelectorAll(\".preview-field\").forEach((el) => {\n        const fieldId = el.id;\n        if (fieldsData[fieldId]) {\n          orderedFields.push(fieldsData[fieldId]);\n        }\n      });\n      \n      const html = renderPreview(orderedFields);\n\n      // Only update tab preview (don't show modal)\n      const tabPreviewContainer = root.querySelector(\n        \"#preview-form-container-tab\"\n      );\n      if (tabPreviewContainer) {\n        const formTitleEl = root.querySelector(\"#form-title\");\n        const formDescriptionEl = root.querySelector(\"#form-description\");\n        const title = document.createElement(\"h6\");\n        title.textContent = formTitleEl\n          ? formTitleEl.value || \"Title\"\n          : \"Title\";\n        const desc = document.createElement(\"small\");\n        desc.style.color = \"#6b7280\";\n        desc.textContent = formDescriptionEl\n          ? formDescriptionEl.value || \"Description\"\n          : \"Description\";\n\n        let htmlWithHeader = `<b>${escapeHtml(title.textContent)}</b>`;\n        if (desc.textContent) {\n          htmlWithHeader += `<small style=\"color: #6b7280;display: block;\">${escapeHtml(\n            desc.textContent\n          )}</small>`;\n        }\n        htmlWithHeader += html;\n\n        tabPreviewContainer.innerHTML = htmlWithHeader;\n\n        // Add conditional visibility handler\n        applyPreviewConditionalVisibility(tabPreviewContainer);\n        \n        // Listen for changes to update visibility\n        tabPreviewContainer.addEventListener(\"change\", () => {\n          applyPreviewConditionalVisibility(tabPreviewContainer);\n        });\n\n        // Add validation handler to submit button\n        setTimeout(() => {\n          const submitBtn = tabPreviewContainer.querySelector(\n            \".preview-submit-btn\"\n          );\n          if (submitBtn) {\n            submitBtn.addEventListener(\"click\", (e) => {\n              e.preventDefault();\n              const form = submitBtn.closest(\"form\");\n              if (form && form.checkValidity()) {\n                alert(\n                  \"Form is valid! (This is a preview - form will not be submitted)\"\n                );\n              } else {\n                form.reportValidity();\n              }\n            });\n          }\n        }, 100);\n      }\n    });\n  }\n  \n  // Apply conditional visibility in preview mode\n  function applyPreviewConditionalVisibility(container) {\n    const conditionalFields = container.querySelectorAll(\"[data-visible-if]\");\n    \n    conditionalFields.forEach((field) => {\n      try {\n        const visibleIf = JSON.parse(field.dataset.visibleIf);\n        const { controller_name, value: expectedValue } = visibleIf;\n        \n        if (!controller_name || expectedValue == null || expectedValue === \"\") {\n          field.style.display = \"\";\n          return;\n        }\n        \n        // Find the controller field by name\n        let actualValue = null;\n        let controllerFound = false;\n        \n        // Check for radio buttons\n        const radios = container.querySelectorAll(`input[type=\"radio\"][name=\"${controller_name}\"]`);\n        \n        if (radios.length > 0) {\n          controllerFound = true;\n          const checkedRadio = container.querySelector(`input[type=\"radio\"][name=\"${controller_name}\"]:checked`);\n          if (checkedRadio) {\n            const label = container.querySelector(`label[for=\"${checkedRadio.id}\"]`);\n            actualValue = label ? label.textContent.trim() : checkedRadio.value;\n          } else {\n            // No radio selected - hide conditional field\n            field.style.display = \"none\";\n            return;\n          }\n        }\n        \n        // Check for select\n        const select = container.querySelector(`select[name=\"${controller_name}\"]`);\n        if (select && !controllerFound) {\n          controllerFound = true;\n          const opt = select.options[select.selectedIndex];\n          // Only count as having a value if not the placeholder option\n          if (opt && opt.value !== \"\") {\n            actualValue = opt.textContent.trim();\n          } else {\n            // No option selected - hide conditional field\n            field.style.display = \"none\";\n            return;\n          }\n        }\n        \n        // Check for checkboxes (single checkbox)\n        const checkbox = container.querySelector(`input[type=\"checkbox\"][name=\"${controller_name}\"]`);\n        if (checkbox && !controllerFound) {\n          controllerFound = true;\n          actualValue = checkbox.checked ? \"Checked\" : \"Unchecked\";\n        }\n        \n        // Check for multi-checkboxes\n        const multiCheckboxes = container.querySelectorAll(`input[type=\"checkbox\"][name=\"${controller_name}[]\"]:checked`);\n        if (multiCheckboxes.length > 0) {\n          const values = Array.from(multiCheckboxes).map((cb) => {\n            const label = container.querySelector(`label[for=\"${cb.id}\"]`);\n            return label ? label.textContent.trim() : cb.value;\n          });\n          // Show if expected value is in the checked values\n          field.style.display = values.includes(expectedValue) ? \"\" : \"none\";\n          return;\n        }\n        \n        // If controller not found, hide field\n        if (!controllerFound) {\n          field.style.display = \"none\";\n          return;\n        }\n        \n        // Compare values - show only if value matches\n        if (actualValue === expectedValue) {\n          field.style.display = \"\";\n        } else {\n          field.style.display = \"none\";\n        }\n      } catch (e) {\n        console.error(\"Error parsing visible_if:\", e);\n        field.style.display = \"\";\n      }\n    });\n  }\n  root.querySelectorAll(\".modal-close\").forEach((btn) => {\n    btn.addEventListener(\n      \"click\",\n      () => (btn.closest(\".modal\").style.display = \"none\")\n    );\n  });\n  // Initial move button state (in case of zero nodes, this is a no-op)\n  updateMoveButtons();\n\n  // Seed default first four fields for brand-new forms\n  if (!initialForm && preview.querySelectorAll(\".preview-field\").length === 0) {\n    seedDefaultFields();\n  }\n\n  function renderPreview(fields) {\n    let out = `<form class=\"preview-form-rendered\">`;\n\n    // Create a map of field names for conditional visibility\n    const fieldNameMap = {};\n    fields.forEach((f) => {\n      if (f.name) fieldNameMap[f.name] = f;\n    });\n\n    fields.forEach((f) => {\n      const t = f.field_type || f.type;\n      \n      // Build visible_if data attribute if this field has conditional visibility\n      let visibleIfAttr = \"\";\n      if (f.visible_if && f.visible_if.field_name && f.visible_if.value) {\n        const visibleIfData = {\n          controller_name: f.visible_if.field_name,\n          value: f.visible_if.value\n        };\n        visibleIfAttr = ` data-visible-if='${JSON.stringify(visibleIfData).replace(/'/g, \"&apos;\")}'`;\n      }\n\n      if (t === \"address\") {\n        const parts =\n          f.options && !Array.isArray(f.options) && f.options.parts\n            ? f.options.parts\n            : [];\n\n        const customClass = (f.custom_class || \"\").trim();\n        out += `<div class=\"form-field ${f.required ? \"required\" : \"\"}${customClass ? \" \" + escapeAttr(customClass) : \"\"}\"${visibleIfAttr}>`;\n        \n        out += `<label>${escapeHtml(f.label || \"Address\")}${\n          f.required ? '<span class=\"required-star\">*</span>' : \"\"\n        }</label>`;\n        out += `<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:12px;\">`;\n        parts.forEach((p) => {\n          // Child is required only if parent is required AND part.required is true\n          const isChildRequired = f.required && p.required;\n          out += `<div class=\"form-field\">`;\n          out += `<label>${escapeHtml(p.label || p.key || \"\")}${\n            isChildRequired ? '<span class=\"required-star\">*</span>' : \"\"\n          }</label>`;\n          out += `<input type=\"text\" placeholder=\"${escapeAttr(\n            p.placeholder || \"\"\n          )}\" ${isChildRequired ? \"required\" : \"\"} />`;\n          out += `</div>`;\n        });\n        out += `</div>`;\n        out += `</div>`;\n        return;\n      }\n      if (t === \"image\") {\n        const accept =\n          f.options && !Array.isArray(f.options) ? (f.options.accept || \"image/*\") : \"image/*\";\n        const multiple =\n          f.options && !Array.isArray(f.options) ? !!f.options.multiple : false;\n\n\n        const customClass = (f.custom_class || \"\").trim();\n        out += `<div class=\"form-field ${f.required ? \"required\" : \"\"}${customClass ? \" \" + escapeAttr(customClass) : \"\"}\"${visibleIfAttr}>`;\n\n\n        out += `<label>${escapeHtml(f.label || \"Image Upload\")}${\n          f.required ? '<span class=\"required-star\">*</span>' : \"\"\n        }</label>`;\n        out += `<input type=\"file\" accept=\"${escapeAttr(accept)}\" ${multiple ? \"multiple\" : \"\"} ${\n          f.required ? \"required\" : \"\"\n        } />`;\n        out += `</div>`;\n        return;\n      }\n\n      if (t === \"html\") {\n        out += `<div class=\"form-field html-content\"${visibleIfAttr}>${f.html || \"\"}</div>`;\n        return;\n      }\n\n      const customClass = (f.custom_class || \"\").trim();\n      out += `<div class=\"form-field ${f.required ? \"required\" : \"\"}${customClass ? \" \" + escapeAttr(customClass) : \"\"}\"${visibleIfAttr}>`;\n\n      // LABEL (with required star)\n      if (![\"checkbox\", \"consent\"].includes(t)) {\n        out += `<label>\n        ${escapeHtml(f.label || \"\")}\n        ${f.required ? '<span class=\"required-star\">*</span>' : \"\"}\n      </label>`;\n      }\n\n      // INPUT TYPES\n      if (\n        [\"text\", \"email\", \"number\", \"phone\", \"url\", \"date\", \"time\"].includes(t)\n      ) {\n        const inputType = t === \"phone\" ? \"tel\" : t;\n        out += `<input \n        type=\"${inputType}\" \n        placeholder=\"${escapeAttr(f.placeholder || \"\")}\" \n        ${f.maxlength ? `maxlength=\"${f.maxlength}\"` : \"\"} \n        ${f.required ? \"required\" : \"\"} \n      />`;\n      } else if (t === \"textarea\") {\n        out += `<textarea \n        placeholder=\"${escapeAttr(f.placeholder || \"\")}\" \n        ${f.required ? \"required\" : \"\"}>\n      </textarea>`;\n      } else if (t === \"select\") {\n        out += `<select name=\"${escapeAttr(f.name)}\" ${f.required ? \"required\" : \"\"}>\n        <option value=\"\">\n          ${escapeHtml(f.placeholder || \"Select an option\")}\n        </option>\n        ${(f.options || [])\n          .map((o) => `<option>${escapeHtml(o)}</option>`)\n          .join(\"\")}\n      </select>`;\n      } else if (t === \"radio\") {\n        out += (f.options || [])\n          .map(\n            (o, i) => `\n          <div class=\"radio-field\">\n            <input type=\"radio\" id=\"${escapeAttr(f.name)}-${i}\" name=\"${escapeAttr(f.name)}\">\n            <label for=\"${escapeAttr(f.name)}-${i}\">\n              ${escapeHtml(o)}\n            </label>\n          </div>`\n          )\n          .join(\"\");\n      } else if (t === \"multicheckbox\") {\n        out += (f.options || [])\n          .map(\n            (o, i) => `\n          <div class=\"checkbox-field\">\n            <input type=\"checkbox\" id=\"${escapeAttr(f.name)}-${i}\" name=\"${escapeAttr(f.name)}[]\">\n            <label for=\"${escapeAttr(f.name)}-${i}\">\n              ${escapeHtml(o)}\n            </label>\n          </div>`\n          )\n          .join(\"\");\n      } else if (t === \"checkbox\" || t === \"consent\") {\n        out += `\n        <div class=\"checkbox-field\">\n          <input type=\"checkbox\" id=\"${f.name}\" name=\"${escapeAttr(f.name)}\" ${f.required ? \"required\" : \"\"}>\n          <label for=\"${f.name}\">\n            ${escapeHtml(f.label || \"\")}\n            ${f.required ? '<span class=\"required-star\">*</span>' : \"\"}\n          </label>\n        </div>\n      `;\n      } else if (t === \"submit_button\") {\n        out += `<button \n        type=\"button\" \n        class=\"preview-submit-btn\" \n        style=\"${escapeAttr(f.custom_style || \"\")}\">\n        ${escapeHtml(f.button_text || \"Submit\")}\n      </button>`;\n      }\n\n      out += `</div>`;\n    });\n\n    // Safety submit button in preview\n    if (!fields.some((f) => (f.type || f.field_type) === \"submit_button\")) {\n      out += `\n      <div class=\"form-field\">\n        <button type=\"button\" class=\"preview-submit-btn\">Submit</button>\n      </div>\n    `;\n    }\n\n    out += `</form>`;\n    return out;\n  }\n\n  // Save -> API\n  saveBtn.addEventListener(\"click\", async () => {\n    // Add loading state\n    saveBtn.disabled = true;\n    const originalHTML = saveBtn.innerHTML;\n    saveBtn.innerHTML = `\n      <svg class=\"spin\" style=\"width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 6px;\" viewBox=\"0 0 50 50\">\n        <circle cx=\"25\" cy=\"25\" r=\"20\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"4\" stroke-dasharray=\"80\" stroke-dashoffset=\"60\" />\n      </svg>\n      Saving...\n    `;\n\n    // Clear previous errors\n    window.dispatchEvent(new CustomEvent(\"builder-clear-error\"));\n\n    try {\n      // Validate form title\n      const titleEl = root.querySelector(\"#form-title\");\n      if (!titleEl || !titleEl.value.trim()) {\n        throw new Error(\"Form title is required\");\n      }\n\n      // Validate Submit To email\n      const submitToEl = root.querySelector(\"#form-submit-to\");\n      if (!submitToEl || !submitToEl.value.trim()) {\n        throw new Error(\"Submit To email address is required\");\n      }\n\n      // Get form type\n      const formTypeEl = root.querySelector(\"#form-type\");\n      const formType = formTypeEl?.value || \"web\";\n\n      // Only validate reCAPTCHA fields for 'web' type forms\n      if (formType === \"web\") {\n        // Enforce Google reCAPTCHA site key required\n        const siteKeyEl = root.querySelector(\"#form-recaptcha-key\");\n        if (!siteKeyEl || !siteKeyEl.value.trim()) {\n          throw new Error(\"Google reCAPTCHA site key is required\");\n        }\n        // Enforce Google reCAPTCHA secret key required\n        const secretKeyEl = root.querySelector(\"#form-recaptcha-secret\");\n        if (!secretKeyEl || !secretKeyEl.value.trim()) {\n          throw new Error(\"Google reCAPTCHA secret key is required\");\n        }\n      }\n\n      // Check if form has at least one field\n      const fieldCount = Object.keys(fieldsData).length;\n      if (fieldCount === 0) {\n        throw new Error(\"Please add at least one field to your form\");\n      }\n\n      // Validate that name and email fields are present and required\n      const fields = Object.values(fieldsData);\n      console.log(\"fields: \", fields);\n      const nameField = fields.find((f) => f.name?.toLowerCase() === \"name\");\n      const emailField = fields.find((f) => f.name?.toLowerCase() === \"email\");\n\n      if (!nameField) {\n        throw new Error(\n          'A \"name\" field is required. Please add a field with name \"name\".'\n        );\n      }\n      if (!nameField.required) {\n        throw new Error('The \"name\" field must be marked as required.');\n      }\n\n      if (!emailField) {\n        throw new Error(\n          'An \"email\" field is required. Please add a field with name \"email\".'\n        );\n      }\n      if (!emailField.required) {\n        throw new Error('The \"email\" field must be marked as required.');\n      }\n\n      // Validate that if regex is set, error_message is required\n      Object.values(fieldsData).forEach((field) => {\n        if (field.regex && field.regex.trim() && !field.error_message) {\n          throw new Error(\n            `Field \"${field.label}\" has a Validation Pattern but is missing a Custom Error Message. Custom Error Message is required when Validation Pattern is set.`\n          );\n        }\n      });\n\n      // Validate that field names are unique (no duplicates)\n      const fieldNames = Object.values(fieldsData)\n        .map((f) => (f.name || \"\").trim())\n        .filter((name) => name); // Filter out empty names\n\n      const duplicateNames = fieldNames.filter(\n        (name, idx, arr) => arr.indexOf(name) !== idx\n      );\n      if (duplicateNames.length > 0) {\n        throw new Error(\n          `Duplicate field name(s) found: \"${duplicateNames.join(\n            '\", \"'\n          )}\". Each field must have a unique name.`\n        );\n      }\n\n      const payload = buildApiPayload();\n      const json = currentFormId\n        ? await updateFormToApi(currentFormId, payload)\n        : await saveFormToApi(payload);\n\n      // If we just created, remember the id so next saves will update\n      if (!currentFormId && json && json.id) {\n        currentFormId = json.id;\n      }\n\n      // Get public_key and determine content to show based on form type\n      const publicKey = json?.public_key || json?.id;\n      const savedFormType = formTypeEl?.value || \"web\";\n\n      // Build embed code or direct link based on form type\n      let contentToShow;\n      if (savedFormType === \"form\") {\n        // For type \"form\", show the direct link\n        const apiBase =\n          process.env.REACT_APP_BACKEND_API_URL ||\n          \"https://app.memate.com.au/api/v1\";\n        contentToShow = `${apiBase}/inquiries/form/page/${publicKey}/`;\n      } else {\n        // For type \"web\", show the embed code using the domain from response\n        const host = process.env.REACT_APP_URL || window.location.origin;\n        contentToShow =\n          `<script src=\"${host}/astatic/inquiries/embed.js\" data-form-id=\"${publicKey}\"></` +\n          `script>`;\n      }\n\n      const embedModal = root.querySelector(\"#embed-modal\");\n      const snippetEl = root.querySelector(\"#embed-snippet\");\n      const copyBtn = root.querySelector(\"#copy-embed-btn\");\n      const closeBtn = root.querySelector(\"#close-embed-btn\");\n      const xBtn = embedModal\n        ? embedModal.querySelector(\"[data-close-embed]\")\n        : null;\n      const modalTitle = embedModal\n        ? embedModal.querySelector(\".modal-header h2\")\n        : null;\n      const modalDescription = embedModal\n        ? embedModal.querySelector(\".modal-content > p\")\n        : null;\n\n      // Update modal content based on form type\n      if (modalTitle) {\n        modalTitle.textContent =\n          savedFormType === \"form\" ? \"Form Link\" : \"Embed this Form\";\n      }\n      if (modalDescription) {\n        modalDescription.textContent =\n          savedFormType === \"form\"\n            ? \"Copy the link below to share your form.\"\n            : \"Copy the snippet below and paste it into your website where you want the form to appear.\";\n      }\n\n      if (snippetEl) snippetEl.value = contentToShow;\n      if (closeBtn) closeBtn.disabled = true; // must copy before closing\n      if (embedModal) embedModal.style.display = \"block\";\n\n      const doCopy = async () => {\n        try {\n          await navigator.clipboard.writeText(contentToShow);\n        } catch (_) {\n          // Fallback for older browsers\n          if (snippetEl && snippetEl.select) {\n            snippetEl.select();\n            document.execCommand && document.execCommand(\"copy\");\n          }\n        }\n        if (copyBtn) copyBtn.textContent = \"Copied!\";\n        if (closeBtn) closeBtn.disabled = false;\n\n        // Redirect to forms list after 1 second\n        setTimeout(() => {\n          window.location.href = \"/enquiries/forms\";\n        }, 1000);\n      };\n\n      if (copyBtn) copyBtn.onclick = doCopy;\n      if (closeBtn)\n        closeBtn.onclick = () => {\n          if (embedModal) embedModal.style.display = \"none\";\n          window.location.href = \"/enquiries/forms\";\n        };\n      if (xBtn)\n        xBtn.onclick = () => {\n          if (closeBtn && !closeBtn.disabled && embedModal)\n            embedModal.style.display = \"none\";\n          window.location.href = \"/enquiries/forms\";\n        };\n\n      // Notify success\n      window.dispatchEvent(new CustomEvent(\"builder-save-success\"));\n    } catch (e) {\n      // Log to console for debugging\n      console.error(\"Form save error:\", e.message || e);\n\n      // Dispatch error event to React component\n      window.dispatchEvent(\n        new CustomEvent(\"builder-save-error\", {\n          detail: { message: e.message || \"Failed to save form\" },\n        })\n      );\n    } finally {\n      // Restore button state\n      saveBtn.disabled = false;\n      saveBtn.innerHTML = originalHTML;\n    }\n  });\n\n  function buildApiPayload() {\n    // Get fields in DOM order to preserve the correct sequence\n    const orderedFieldIds = [];\n    preview.querySelectorAll(\".preview-field\").forEach((el) => {\n      if (fieldsData[el.id]) {\n        orderedFieldIds.push(el.id);\n      }\n    });\n    \n    const fields = orderedFieldIds.map((fid, idx) => {\n      const f = fieldsData[fid];\n      return {\n        id: f._id || undefined, // include id when editing\n        name: f.name || `${f.type}_field`,\n        label: f.label || capitalize(f.type),\n        placeholder: f.placeholder || \"\",\n        field_type: f.field_type || f.type,\n        required: !!f.required,\n        custom_class: (f.custom_class || \"\").trim() || undefined,\n        visible_if: f.visible_if && (f.visible_if.field_name || f.visible_if.field_id)\n          ? {\n              // Persist by controller field NAME (stable across hydration)\n              field_name: f.visible_if.field_name\n                ? f.visible_if.field_name\n                : (fieldsData[f.visible_if.field_id]?.name || \"\"),\n              value: f.visible_if.value ?? \"\",\n              operator: f.visible_if.operator || \"equals\",\n            }\n          : null,\n        max_length: f.maxlength || null,\n        error_message: f.error_message || null,\n        options: Array.isArray(f.options)\n        ? f.options\n        : (f.field_type || f.type) === \"address\" || (f.field_type || f.type) === \"image\"\n        ? f.options\n        : undefined,\n        regex: f.regex || undefined,\n        html: f.type === \"html\" ? f.html : undefined,\n        button_text:\n          f.type === \"submit_button\" ? f.button_text || undefined : undefined,\n        custom_style:\n          f.type === \"submit_button\" ? f.custom_style || undefined : undefined,\n        order: idx,\n      };\n    });\n\n    const get = (id) => (root.querySelector(\"#\" + id)?.value || \"\").trim();\n    const formType = get(\"form-type\") || \"web\";\n\n    const payload = {\n      organization: defaultOrgId, // hard default as requested\n      title: get(\"form-title\"),\n      description: get(\"form-description\"),\n      type: formType,\n      submit_to: get(\"form-submit-to\"),\n      submit_from: get(\"form-submit-from\"),\n      cc_email: get(\"form-cc-email\"),\n      bcc_email: get(\"form-bcc-email\"),\n      thank_you_message:\n        get(\"form-thank-you\") ||\n        \"Thank you for reaching out. We'll get back to you soon!\",\n      error_message:\n        get(\"form-error-message\") ||\n        \"Something went wrong. Please try again later.\",\n      submit_button_label: get(\"form-submit-label\") || \"Submit\",\n      custom_css: cssTextarea?.value ?? \"\",\n      fields,\n    };\n\n    // Only include domain and reCAPTCHA fields for 'web' type forms\n    if (formType === \"web\") {\n      payload.domain = get(\"form-domain\");\n      payload.recaptcha_site_key = get(\"form-recaptcha-key\");\n      payload.recaptcha_secret_key = get(\"form-recaptcha-secret\");\n    }\n\n    const redirect = get(\"form-redirect-url\");\n    if (redirect) payload.redirect_url = redirect;\n    return payload;\n  }\n\n  // helpers\n  function capitalize(s) {\n    return (s || \"\").charAt(0).toUpperCase() + (s || \"\").slice(1);\n  }\n  function normalizeOptionFieldDom(host, id, type, data) {\n    if (!host) return;\n\n    const groupName = data?.name || id;\n\n    if (type === \"radio\") {\n      const wrap = host.querySelector(\".form-field\");\n      if (!wrap) return;\n\n      wrap.querySelectorAll(\".radio-field\").forEach((n) => n.remove());\n\n      const opts = Array.isArray(data.options) ? data.options : [];\n      opts.forEach((o, i) => {\n        const div = document.createElement(\"div\");\n        div.className = \"radio-field\";\n        const rid = `${groupName}-r-${i}`;\n        div.innerHTML = `<input id=\"${rid}\" type=\"radio\" name=\"${escapeHtml(\n          groupName\n        )}\" ${data.required ? \"required\" : \"\"}>\n                       <label for=\"${rid}\">${escapeHtml(o)}</label>`;\n        wrap.appendChild(div);\n      });\n      return;\n    }\n\n    if (type === \"multicheckbox\") {\n      const wrap = host.querySelector(\".form-field\");\n      if (!wrap) return;\n\n      wrap.querySelectorAll(\".checkbox-field\").forEach((n) => n.remove());\n\n      const opts = Array.isArray(data.options) ? data.options : [];\n      opts.forEach((o, i) => {\n        const div = document.createElement(\"div\");\n        div.className = \"checkbox-field\";\n        const cid = `${groupName}-c-${i}`;\n        div.innerHTML = `<input id=\"${cid}\" type=\"checkbox\" name=\"${escapeHtml(\n          groupName\n        )}[]\" ${data.required ? \"required\" : \"\"}>\n                       <label for=\"${cid}\">${escapeHtml(o)}</label>`;\n        wrap.appendChild(div);\n      });\n    }\n  }\n  function escapeHtml(s = \"\") {\n    const str = String(s || \"\");\n    return str.replace(\n      /[&<>\"']/g,\n      (c) =>\n        ({\n          \"&\": \"&amp;\",\n          \"<\": \"&lt;\",\n          \">\": \"&gt;\",\n          '\"': \"&quot;\",\n          \"'\": \"&#39;\",\n        }[c])\n    );\n  }\n  function escapeAttr(s = \"\") {\n    return escapeHtml(s).replace(/\"/g, \"&quot;\");\n  }\n\n  function seedDefaultFields() {\n    const defaults = [\n      {\n        field_type: \"text\",\n        name: \"name\",\n        label: \"Name\",\n        placeholder: \"Enter your name\",\n        required: true,\n        order: 0,\n      },\n      {\n        field_type: \"email\",\n        name: \"email\",\n        label: \"Email\",\n        placeholder: \"Enter your email\",\n        required: true,\n        order: 1,\n      },\n      {\n        field_type: \"phone\",\n        name: \"phone\",\n        label: \"Phone\",\n        placeholder: \"Enter your phone\",\n        order: 2,\n      },\n      {\n        field_type: \"textarea\",\n        name: \"message\",\n        label: \"Message\",\n        placeholder: \"Type your message\",\n        order: 3,\n      },\n    ];\n    defaults.forEach(addFieldFromData);\n  }\n\n  // ----- Hydration helpers -----\n  function setVal(id, v) {\n    const el = document.getElementById(id);\n    if (el) el.value = v ?? \"\";\n  }\n\n  function hydrateInitialForm(form) {\n    // right-column details\n    setVal(\"form-title\", form.title);\n    setVal(\"form-type\", form.type || \"web\");\n    setVal(\"form-domain\", form.domain);\n    setVal(\n      \"form-description\",\n      form.description || form.meta?.description || \"\"\n    );\n    setVal(\"form-submit-to\", form.submit_to);\n    setVal(\"form-submit-from\", form.submit_from);\n    setVal(\"form-cc-email\", form.cc_email);\n    setVal(\"form-bcc-email\", form.bcc_email);\n    setVal(\"form-thank-you\", form.thank_you_message);\n    setVal(\"form-error-message\", form.error_message);\n    setVal(\"form-submit-label\", form.submit_button_label || \"Submit\");\n    setVal(\"form-redirect-url\", form.redirect_url);\n    setVal(\"form-recaptcha-key\", form.recaptcha_site_key);\n    setVal(\"form-recaptcha-secret\", form.recaptcha_secret_key);\n\n    // Update preview title and description\n    const previewTitleEl = root.querySelector(\"#preview-form-title\");\n    const previewDescriptionEl = root.querySelector(\n      \"#preview-form-description\"\n    );\n    if (previewTitleEl) previewTitleEl.textContent = form.title || \"Title\";\n    if (previewDescriptionEl)\n      previewDescriptionEl.textContent =\n        form.description || form.meta?.description || \"\" || \"Description\";\n\n    // custom css\n    if (cssTextarea && form.custom_css) {\n      cssTextarea.value = form.custom_css;\n    }\n\n    // fields canvas - only remove field elements, keep page header\n    const fields = (form.fields || [])\n      .slice()\n      .sort((a, b) => (a.order ?? 0) - (b.order ?? 0));\n    preview.querySelectorAll(\".preview-field\").forEach((f) => f.remove());\n    fieldsData = {};\n    fieldCounter = 1;\n\n    fields.forEach(addFieldFromData);\n    updateMoveButtons();\n\n    // Hide empty state if fields exist\n    if (fields.length > 0) {\n      const emptyState = preview.querySelector(\".empty-state\");\n      if (emptyState) {\n        emptyState.style.display = \"none\";\n      }\n    }\n    \n    // After all fields are hydrated, resolve field_id from field_name for visible_if\n    // This is needed because field_id is session-specific and field_name is the stable identifier\n    Object.keys(fieldsData).forEach((fid) => {\n      const data = fieldsData[fid];\n      if (data.visible_if && data.visible_if.field_name) {\n        // Find the controller field by name\n        const controllerId = Object.keys(fieldsData).find(\n          (id) => (fieldsData[id]?.name || \"\").trim() === data.visible_if.field_name\n        );\n        if (controllerId) {\n          data.visible_if.field_id = controllerId;\n        }\n      }\n    });\n    \n    // Apply conditional visibility after resolving field_ids\n    applyConditionalVisibilityRecursively();\n  }\n\n  function addFieldFromData(f) {\n    const type = f.field_type || f.type || \"text\";\n    const id = `field-${fieldCounter++}`;\n    const el = document.createElement(\"div\");\n    el.className = \"preview-field\";\n    el.id = id;\n    el.dataset.type = type;\n    el.innerHTML = getTemplate(type) + actionBar(!!f.required);\n    preview.appendChild(el);\n\n    const data = {\n      type,\n      field_type: type,\n      _id: f.id,\n      label: f.label ?? `${capitalize(type)} Field`,\n      name: f.name ?? `${type}_field`,\n      required: !!f.required,\n      visible_if: f.visible_if ?? null,\n      custom_class: f.custom_class ?? \"\",\n      placeholder: f.placeholder ?? \"\",\n      maxlength: f.max_length ?? f.maxlength ?? \"\",\n      regex: f.regex ?? \"\",\n      error_message: f.error_message ?? \"\",\n      options: Array.isArray(f.options)\n        ? [...f.options]\n        : f.options && typeof f.options === \"object\"\n        ? { ...f.options }\n        : [],\n      html: f.html ?? undefined,\n      button_text: f.button_text ?? undefined,\n      custom_style: f.custom_style ?? undefined,\n    };\n\n    fieldsData[id] = data;\n    // Ensure hydrated field names are unique (legacy forms may contain duplicates)\n    const used = new Set(\n      Object.keys(fieldsData)\n        .filter((fid) => fid !== id)\n        .map((fid) => (fieldsData[fid]?.name || \"\").trim())\n        .filter(Boolean)\n    );\n\n    const t = fieldsData[id].field_type || fieldsData[id].type;\n    const baseName =\n      (fieldsData[id].name || \"\").trim() || `${t}_${String(id).replace(\"field-\", \"\")}`;\n\n    let unique = baseName;\n    let s = 2;\n    while (used.has(unique)) {\n      unique = `${baseName}_${s++}`;\n    }\n    fieldsData[id].name = unique;\n    wireField(el, id, type);\n\n    // Do not auto-select field when hydrating - let user click to select\n    // selectField(id, type);\n\n    const labelEl = el.querySelector(\n      \".form-field > label, .checkbox-field label\"\n    );\n    if (labelEl && data.label) {\n      labelEl.innerHTML = `${data.label} ${\n        data.required ? ' <span class=\"required-star\">*</span>' : \"\"\n      }`;\n    }\n\n    if (\n      [\"text\", \"email\", \"number\", \"phone\", \"url\", \"date\", \"time\"].includes(type)\n    ) {\n      const input = el.querySelector(\"input\");\n      if (input) {\n        if (type === \"phone\") input.type = \"tel\";\n        if (data.placeholder) input.placeholder = data.placeholder;\n        if (data.maxlength && !isNaN(data.maxlength) && data.maxlength > 0) {\n          input.maxLength = parseInt(data.maxlength, 10);\n        }\n        if (data.required) input.required = true;\n      }\n    } else if (type === \"textarea\") {\n      const ta = el.querySelector(\"textarea\");\n      if (ta) {\n        if (data.placeholder) ta.placeholder = data.placeholder;\n        if (data.maxlength && !isNaN(data.maxlength) && data.maxlength > 0) {\n          ta.maxLength = parseInt(data.maxlength, 10);\n        }\n        if (data.required) ta.required = true;\n      }\n    } else if (type === \"select\") {\n      const sel = el.querySelector(\"select\");\n      if (sel) {\n        sel.innerHTML =\n          `<option value=\"\">${\n            data.placeholder || \"Select an option\"\n          }</option>` +\n          (data.options || [])\n            .map((o) => `<option>${escapeHtml(o)}</option>`)\n            .join(\"\");\n        if (data.required) sel.required = true;\n      }\n    } else if (type === \"radio\") {\n      const wrap = el.querySelector(\".form-field\");\n      if (wrap) {\n        wrap.querySelectorAll(\".radio-field\").forEach((n) => n.remove());\n        (data.options || []).forEach((o, i) => {\n          const div = document.createElement(\"div\");\n          div.className = \"radio-field\";\n          const rid = `${data.name}-${i}`;\n          div.innerHTML = `<input id=\"${rid}\" type=\"radio\" name=\"${escapeHtml(\n            data.name\n          )}\">\n                           <label for=\"${rid}\">${escapeHtml(o)}</label>`;\n          wrap.appendChild(div);\n        });\n      }\n    } else if (type === \"multicheckbox\") {\n      const wrap = el.querySelector(\".form-field\");\n      if (wrap) {\n        wrap.querySelectorAll(\".checkbox-field\").forEach((n) => n.remove());\n        (data.options || []).forEach((o, i) => {\n          const div = document.createElement(\"div\");\n          div.className = \"checkbox-field\";\n          const cid = `${data.name}-${i}`;\n          div.innerHTML = `<input id=\"${cid}\" type=\"checkbox\" name=\"${escapeHtml(\n            data.name\n          )}[]\">\n                           <label for=\"${cid}\">${escapeHtml(o)}</label>`;\n          wrap.appendChild(div);\n        });\n      }\n    } else if (type === \"checkbox\" || type === \"consent\") {\n      const lab = el.querySelector(\".checkbox-field label\");\n      if (lab && data.label) lab.textContent = data.label;\n    } else if (type === \"html\") {\n      const block = el.querySelector(\".html-content\");\n      if (block) block.innerHTML = data.html || \"<p></p>\";\n    } else if (type === \"submit_button\") {\n      const btn = el.querySelector(\"button\");\n      if (btn) {\n        btn.textContent = data.button_text || \"Submit\";\n        if (data.custom_style) btn.setAttribute(\"style\", data.custom_style);\n      }\n    }\n\n    // Do not auto-select field when adding from data - let user click to select\n    // selectField(id, type);\n  }\n}\n\n// Cleanup function to reset builder state\nexport function cleanupBuilder() {\n  const root = document.querySelector(\".mf-builder\");\n  if (root) {\n    delete root.dataset.builderInitialized;\n\n    // Clear the preview container\n    const preview = root.querySelector(\"#preview-container\");\n    if (preview) {\n      // Remove all field elements but keep the page header and empty state\n      preview\n        .querySelectorAll(\".preview-field\")\n        .forEach((field) => field.remove());\n    }\n  }\n}\n","import { useEffect, useRef, useState, useCallback } from 'react';\nimport * as Icon from 'react-bootstrap-icons';\nimport { useParams } from 'react-router-dom';\nimport { useQuery } from '@tanstack/react-query';\nimport { ProgressSpinner } from 'primereact/progressspinner';\nimport { toast } from 'sonner';\nimport { getFormById } from './api';\nimport { initBuilder, cleanupBuilder } from './builder/init-builder';\nimport './form-builder.css';\nimport { getOutgoingEmail } from '../../../../APIs/email-template';\nimport { useAuth } from '../../../../app/providers/auth-provider';\nimport { useTrialHeight } from '../../../../app/providers/trial-height-provider';\n\n// Inline SVG Icon component for field types\nconst FieldIcon = ({ type }) => {\n  const props = { width: 22, height: 22, viewBox: '0 0 24 24', fill: 'none', stroke: '#2563eb', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round' };\n  switch (type) {\n    case 'text':\n      return (<svg {...props}><path d=\"M4 6h16\" /><path d=\"M9 6v12\" /><path d=\"M15 6v12\" /></svg>);\n    case 'email':\n      return (<svg {...props}><path d=\"M4 6h16v12H4z\" /><path d=\"M22 6l-10 7L2 6\" /></svg>);\n    case 'number':\n      return (<svg {...props}><path d=\"M6 10h12\" /><path d=\"M6 14h12\" /><path d=\"M9 7v10\" /><path d=\"M15 7v10\" /></svg>);\n    case 'phone':\n      return (<svg {...props}><path d=\"M22 16.92v3a2 2 0 0 1-2.18 2 19.8 19.8 0 0 1-8.62-3.07 19.5 19.5 0 0 1-6-6A19.8 19.8 0 0 1 2.09 4.18 2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.9 12.9 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 10a16 16 0 0 0 6 6l1.36-1.27a2 2 0 0 1 2.11-.45 12.9 12.9 0 0 0 2.81.7A2 2 0 0 1 22 16.92z\" /></svg>);\n    case 'textarea':\n      return (<svg {...props}><rect x=\"3\" y=\"5\" width=\"18\" height=\"14\" rx=\"2\" /><path d=\"M7 9h10\" /><path d=\"M7 13h6\" /></svg>);\n    case 'select':\n      return (<svg {...props}><rect x=\"3\" y=\"5\" width=\"18\" height=\"6\" rx=\"2\" /><path d=\"M8 15l4 4 4-4\" /></svg>);\n    case 'radio':\n      return (<svg {...props}><circle cx=\"8\" cy=\"12\" r=\"3\" /><circle cx=\"16\" cy=\"12\" r=\"6\" /></svg>);\n    case 'checkbox':\n      return (<svg {...props}><rect x=\"3\" y=\"5\" width=\"18\" height=\"14\" rx=\"2\" /><path d=\"M7 12l3 3 7-7\" /></svg>);\n    case 'multicheckbox':\n      return (<svg {...props}><rect x=\"3\" y=\"5\" width=\"18\" height=\"14\" rx=\"2\" /><path d=\"M7 10l3 3\" /><path d=\"M7 14l3 3\" /><path d=\"M14 10h3\" /><path d=\"M14 14h3\" /></svg>);\n    case 'date':\n      return (<svg {...props}><rect x=\"3\" y=\"5\" width=\"18\" height=\"16\" rx=\"2\" /><path d=\"M8 3v4\" /><path d=\"M16 3v4\" /><path d=\"M3 9h18\" /></svg>);\n    case 'time':\n      return (<svg {...props}><circle cx=\"12\" cy=\"12\" r=\"9\" /><path d=\"M12 7v6l4 2\" /></svg>);\n    case 'html':\n      return (<svg {...props}><path d=\"M10 15l-3-3 3-3\" /><path d=\"M14 9l3 3-3 3\" /><path d=\"M4 19h16\" /></svg>);\n    case 'consent':\n      return (<svg {...props}><rect x=\"3\" y=\"5\" width=\"18\" height=\"14\" rx=\"2\" /><path d=\"M7 12l3 3 7-7\" /></svg>);\n    case 'image':\n      return (\n        <svg {...props}>\n          <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" />\n          <path d=\"M8 14l2-2 3 3 2-2 4 4\" />\n          <circle cx=\"9\" cy=\"9\" r=\"1\" />\n        </svg>\n      );\n    default:\n      return (<svg {...props}><circle cx=\"12\" cy=\"12\" r=\"9\" /></svg>);\n  }\n};\n\nexport default function TempFormBuilder() {\n  const { session } = useAuth();\n  const { trialHeight } = useTrialHeight();\n  const bootstrappedRef = useRef(false);\n  const { id } = useParams();\n  const editId = id !== 'new' ? id : null;\n\n  // State management\n  const [toolboxCollapsed, setToolboxCollapsed] = useState(false);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [saving, setSaving] = useState(false);\n  const [activeTab, setActiveTab] = useState('designer'); // 'designer' or 'preview'\n  const [formType, setFormType] = useState('web');\n\n  // Field types data\n  const fieldTypes = [\n    ['text', 'Single-Line Input'],\n    ['email', 'Email'],\n    ['number', 'Number'],\n    ['phone', 'Phone'],\n    ['textarea', 'Text Area'],\n    ['select', 'Dropdown'],\n    ['radio', 'Radio Button Group'],\n    ['checkbox', 'Checkboxes'],\n    ['multicheckbox', 'Multi-Select Checkboxes'],\n    ['date', 'Date'],\n    ['time', 'Time'],\n    ['address', 'Address'],\n    ['image', 'Image Upload'],\n    ['html', 'HTML Block'],\n    ['consent', 'Consent']\n  ];\n\n  // Filter field types based on search\n  const filteredFieldTypes = fieldTypes.filter(([type, label]) =>\n    label.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    type.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  // Handle preview\n  const handlePreview = useCallback(() => {\n    setActiveTab('preview');\n    // Trigger preview build from init-builder\n    setTimeout(() => {\n      const previewBtn = document.querySelector('#preview-btn');\n      if (previewBtn) {\n        previewBtn.click();\n      }\n    }, 100);\n  }, []);\n\n  // Handle undo/redo (these will be wired to init-builder)\n  const handleUndo = useCallback(() => {\n    window.dispatchEvent(new CustomEvent('builder-undo'));\n  }, []);\n\n  const handleRedo = useCallback(() => {\n    window.dispatchEvent(new CustomEvent('builder-redo'));\n  }, []);\n\n  const outgoingEmailTemplateQuery = useQuery({\n    queryKey: [\"getOutgoingEmail\"],\n    queryFn: getOutgoingEmail\n  });\n  const fromEmail = outgoingEmailTemplateQuery?.data?.outgoing_email || 'no-reply@memate.com.au';\n\n  useEffect(() => {\n    const orgId = session?.organization?.id;\n    if (!orgId) return;               // wait until session is ready\n    if (bootstrappedRef.current) return; // run only once\n\n    // Wait for DOM to be fully rendered\n    const timer = setTimeout(async () => {\n      bootstrappedRef.current = true;\n\n      try {\n        if (editId) {\n          const formJson = await getFormById(editId);\n          console.log('formJson: ', formJson);\n          // Set form type from loaded data\n          setFormType(formJson.type || 'web');\n          initBuilder({\n            defaultOrgId: orgId,\n            initialForm: formJson,\n          });\n        } else {\n          initBuilder({\n            defaultOrgId: orgId,\n          });\n        }\n      } catch (e) {\n        console.error('Failed to load form for editing:', e);\n        initBuilder({\n          defaultOrgId: orgId,\n        });\n      }\n    }, 100);\n\n    return () => {\n      clearTimeout(timer);\n      cleanupBuilder(); // Clean up on unmount\n    };\n  }, [session?.organization?.id, editId]);\n\n  // Listen for save events from init-builder\n  useEffect(() => {\n    const handleSaveError = (e) => {\n      const errorMessage = e.detail?.message || 'Failed to save form';\n      toast.error(errorMessage, {\n        duration: 5000,\n      });\n      setSaving(false);\n    };\n\n    const handleSaveSuccess = () => {\n      toast.success('Form saved successfully!', {\n        duration: 3000,\n      });\n      setSaving(false);\n    };\n\n    const handleClearError = () => {\n      toast.dismiss();\n    };\n\n    window.addEventListener('builder-save-error', handleSaveError);\n    window.addEventListener('builder-save-success', handleSaveSuccess);\n    window.addEventListener('builder-clear-error', handleClearError);\n\n    return () => {\n      window.removeEventListener('builder-save-error', handleSaveError);\n      window.removeEventListener('builder-save-success', handleSaveSuccess);\n      window.removeEventListener('builder-clear-error', handleClearError);\n    };\n  }, []);\n\n  return (\n    <>\n      <div className=\"mf-builder\" style={{\n        overflow: 'auto',\n        height: `calc(100vh - 127px - ${trialHeight}px)`,\n        '--trial-height': `${trialHeight}px`\n      }}>\n        <div className=\"mf-container\">\n          {/* Tabs Navigation */}\n          <div className=\"builder-tabs\">\n            <div className=\"tabs-left\">\n              <button\n                className={`tab-btn ${activeTab === 'designer' ? 'active' : ''}`}\n                onClick={() => setActiveTab('designer')}\n              >\n                Designer\n              </button>\n              <button\n                className={`tab-btn ${activeTab === 'preview' ? 'active' : ''}`}\n                onClick={handlePreview}\n              >\n                Preview\n              </button>\n            </div>\n            <div className=\"tabs-right\">\n              <button className=\"icon-btn\" title=\"Undo\" onClick={handleUndo}>\n                <Icon.ArrowCounterclockwise size={18} />\n              </button>\n              <button className=\"icon-btn\" title=\"Redo\" onClick={handleRedo}>\n                <Icon.ArrowClockwise size={18} />\n              </button>\n              <button\n                className=\"btn btn-primary\"\n                id=\"save-btn\"\n                disabled={saving}\n              >\n                {saving ? (\n                  <>\n                    <ProgressSpinner style={{ width: '16px', height: '16px' }} strokeWidth=\"2\" />\n                    Saving...\n                  </>\n                ) : (\n                  <>\n                    <Icon.Save size={16} />\n                    Save Form\n                  </>\n                )}\n              </button>\n            </div>\n          </div>\n\n          {/* Designer Tab - Main Form Builder */}\n          <div className=\"editor-container\" style={{ display: activeTab === 'designer' ? 'grid' : 'none' }}>\n            {/* Toolbox (Field Types) */}\n            <div className={`fields-panel ${toolboxCollapsed ? 'collapsed' : ''}`}>\n              <div className=\"panel-header\">\n                <div className=\"panel-header-top\">\n                  <h2>{toolboxCollapsed ? '' : 'Toolbox'}</h2>\n                  <button\n                    className=\"collapse-btn\"\n                    onClick={() => setToolboxCollapsed(!toolboxCollapsed)}\n                    title={toolboxCollapsed ? 'Expand Toolbox' : 'Collapse Toolbox'}\n                  >\n                    {toolboxCollapsed ? <Icon.ChevronRight size={18} /> : <Icon.ChevronLeft size={18} />}\n                  </button>\n                </div>\n                {!toolboxCollapsed && (\n                  <input\n                    type=\"text\"\n                    placeholder=\"Type to search...\"\n                    className=\"search-input\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                  />\n                )}\n              </div>\n              <div className=\"field-types\">\n                {filteredFieldTypes.map(([type, label]) => (\n                  <div\n                    key={type}\n                    className=\"field-type\"\n                    draggable\n                    data-type={type}\n                    role=\"button\"\n                    aria-label={`Drag ${label} field`}\n                    title={`Drag ${label} field`}\n                  >\n                    <span className=\"icon\"><FieldIcon type={type} /></span>\n                    {!toolboxCollapsed && <span>{label}</span>}\n                  </div>\n                ))}\n              </div>\n\n              {!toolboxCollapsed && (\n                <div className=\"css-editor-container\">\n                  <h3>Custom CSS</h3>\n                  <textarea id=\"form_style\" className=\"code-editor\" rows={10} defaultValue='' placeholder=\"Add custom CSS here (optional)\" />\n                  <p className=\"help-text\">These styles will be applied to the embedded form.</p>\n                </div>\n              )}\n            </div>\n\n            {/* Design Surface (Canvas) */}\n            <div className=\"editor-panel\">\n              <div className=\"panel-header-inline\">\n                <h3>Design Surface</h3>\n              </div>\n              <div className=\"form-preview\" id=\"preview-container\">\n                <div className=\"page-header\">\n                  <div>\n                    <h4 id=\"preview-form-title\">Title</h4>\n                    <p className=\"page-description\" id=\"preview-form-description\">Description</p>\n                  </div>\n                </div>\n                <div className=\"empty-state\" style={{ display: 'none' }}>\n                  <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" opacity=\"0.2\">\n                    <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" />\n                    <path d=\"M3 9h18M9 21V9\" />\n                  </svg>\n                  <p>Drag and drop fields from the Toolbox to build your form</p>\n                </div>\n              </div>\n            </div>\n\n            {/* Property Grid - Field Properties First, then General settings */}\n            <div className=\"field-properties\" id=\"properties-container\">\n              {/* This will be dynamically filled by field properties when a field is selected */}\n              <div className=\"field-props-placeholder\">\n                <div className=\"panel-header\">\n                  <h2>Properties</h2>\n                </div>\n                <div className=\"no-selection\">\n                  <svg width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" opacity=\"0.2\">\n                    <rect x=\"3\" y=\"5\" width=\"18\" height=\"14\" rx=\"2\" />\n                    <path d=\"M7 10h10M7 14h6\" />\n                  </svg>\n                  <p>Select a field to edit its properties</p>\n                </div>\n              </div>\n\n              {/* General Settings - Always visible below field properties */}\n              <div className=\"general-settings\">\n                <div className=\"panel-header\">\n                  <h2>General</h2>\n                </div>\n\n                {/* Form Settings */}\n                <div className=\"property-section\">\n                  <div className=\"form-field\">\n                    <label>Form Type</label>\n                    <select id=\"form-type\" defaultValue=\"web\" onChange={(e) => setFormType(e.target.value)}>\n                      <option value=\"web\">Web</option>\n                      <option value=\"form\">Form</option>\n                    </select>\n                  </div>\n                  <div className=\"form-field\">\n                    <label>Form title<span style={{ color: '#f04438' }}>*</span></label>\n                    <input id=\"form-title\" placeholder=\"Enter form title\" />\n                  </div>\n                  <div className=\"form-field\">\n                    <label>Form description</label>\n                    <textarea id=\"form-description\" placeholder=\"Enter description\" rows=\"3\" />\n                  </div>\n                </div>\n\n                {/* Additional Settings */}\n                <div className=\"property-section\">\n                  <h3 className=\"section-title\">Settings</h3>\n                  {formType === 'web' && (\n                    <div className=\"form-field\">\n                      <label>Domain</label>\n                      <input id=\"form-domain\" placeholder=\"Enter domain\" defaultValue=\"https://memate.com.au/\" />\n                    </div>\n                  )}\n                  <div className=\"form-field\">\n                    <label>To Email<span style={{ color: '#f04438' }}>*</span></label>\n                    <input id=\"form-submit-to\" placeholder=\"Enter email\" />\n                  </div>\n                  <div className=\"form-field\">\n                    <label>From Email</label>\n                    <input id=\"form-submit-from\" placeholder=\"Enter email\" defaultValue={fromEmail} />\n                  </div>\n                  <div className=\"form-field\">\n                    <label>CC Email</label>\n                    <input id=\"form-cc-email\" placeholder=\"Enter email\" />\n                  </div>\n                  <div className=\"form-field\">\n                    <label>BCC Email</label>\n                    <input id=\"form-bcc-email\" placeholder=\"Enter email\" />\n                  </div>\n                </div>\n\n                {/* Messages */}\n                <div className=\"property-section\">\n                  <h3 className=\"section-title\">Messages</h3>\n                  <div className=\"form-field\">\n                    <label>Thank you message</label>\n                    <input id=\"form-thank-you\" placeholder=\"Enter message\" />\n                  </div>\n                  <div className=\"form-field\">\n                    <label>Error message</label>\n                    <input id=\"form-error-message\" placeholder=\"Enter message\" />\n                  </div>\n                  <div className=\"form-field\">\n                    <label>Submit Button Label</label>\n                    <input id=\"form-submit-label\" defaultValue=\"Submit\" />\n                  </div>\n                  <div className=\"form-field\">\n                    <label>Redirect URL</label>\n                    <input id=\"form-redirect-url\" placeholder=\"Enter URL\" />\n                  </div>\n                </div>\n\n                {/* reCAPTCHA */}\n                {formType === 'web' && (\n                  <div className=\"property-section\">\n                    <h3 className=\"section-title\">reCAPTCHA</h3>\n                    <div className=\"form-field\">\n                      <label>Site Key<span style={{ color: '#f04438' }}>*</span></label>\n                      <input id=\"form-recaptcha-key\" placeholder=\"Enter site key\" />\n                    </div>\n                    <div className=\"form-field\">\n                      <label>Secret Key<span style={{ color: '#f04438' }}>*</span></label>\n                      <input id=\"form-recaptcha-secret\" placeholder=\"Enter secret key\" />\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Preview Tab - Shows the form preview */}\n          <div className=\"preview-tab-container\" style={{ display: activeTab === 'preview' ? 'block' : 'none' }}>\n            {/* <div className=\"preview-tab-header\">\n              <h3>Form Preview</h3>\n              <button className=\"btn btn-secondary\" onClick={() => setActiveTab('designer')}>\n                Back to Designer\n              </button>\n            </div> */}\n            <div id=\"preview-form-container-tab\" className=\"preview-form-content\" />\n          </div>\n\n          {/* Footer actions - Removed from here, now in header */}\n\n          {/* Hidden button for preview trigger */}\n          <button id=\"preview-btn\" style={{ display: 'none' }} />\n\n          {/* Preview Modal */}\n          <div className=\"modal\" id=\"preview-modal\" style={{ display: 'none' }}>\n            <div className=\"modal-content\">\n              <div className=\"modal-header\">\n                <h2>Form Preview</h2>\n                <button className=\"modal-close\"></button>\n              </div>\n              <div id=\"preview-form-container\" />\n            </div>\n          </div>\n\n          {/* Embed Code Modal */}\n          <div className=\"modal\" id=\"embed-modal\" style={{ display: 'none' }}>\n            <div className=\"modal-content\">\n              <div className=\"modal-header\">\n                <h2>Embed this Form</h2>\n                <button className=\"modal-close\" data-close-embed></button>\n              </div>\n              <p>Copy the snippet below and paste it into your website where you want the form to appear.</p>\n              <textarea\n                id=\"embed-snippet\"\n                readOnly\n                rows={4}\n                style={{\n                  boxSizing: 'border-box',\n                  fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace'\n                }}\n              />\n              <div className=\"editor-actions\" style={{ justifyContent: 'flex-end' }}>\n                <button className=\"btn\" id=\"copy-embed-btn\">Copy</button>\n                <button className=\"btn btn-primary\" id=\"close-embed-btn\" disabled>OK</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}","var _excluded = [\"color\", \"size\", \"title\", \"className\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var s = Object.getOwnPropertySymbols(e); for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (e.includes(n)) continue; t[n] = r[n]; } return t; }\nimport React, { forwardRef } from 'react';\nimport PropTypes from 'prop-types';\nvar ArrowCounterclockwise = /*#__PURE__*/forwardRef(function (_ref, ref) {\n  var _ref$color = _ref.color,\n    color = _ref$color === void 0 ? 'currentColor' : _ref$color,\n    _ref$size = _ref.size,\n    size = _ref$size === void 0 ? '1em' : _ref$size,\n    _ref$title = _ref.title,\n    title = _ref$title === void 0 ? null : _ref$title,\n    _ref$className = _ref.className,\n    className = _ref$className === void 0 ? '' : _ref$className,\n    rest = _objectWithoutProperties(_ref, _excluded);\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    ref: ref,\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 16 16\",\n    width: size,\n    height: size,\n    fill: color,\n    className: ['bi', 'bi-arrow-counterclockwise', className].filter(Boolean).join(' ')\n  }, rest), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    d: \"M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2z\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466\"\n  }));\n});\nArrowCounterclockwise.propTypes = {\n  color: PropTypes.string,\n  size: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  title: PropTypes.string,\n  className: PropTypes.string\n};\nexport default ArrowCounterclockwise;","var _excluded = [\"color\", \"size\", \"title\", \"className\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var s = Object.getOwnPropertySymbols(e); for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (e.includes(n)) continue; t[n] = r[n]; } return t; }\nimport React, { forwardRef } from 'react';\nimport PropTypes from 'prop-types';\nvar ArrowClockwise = /*#__PURE__*/forwardRef(function (_ref, ref) {\n  var _ref$color = _ref.color,\n    color = _ref$color === void 0 ? 'currentColor' : _ref$color,\n    _ref$size = _ref.size,\n    size = _ref$size === void 0 ? '1em' : _ref$size,\n    _ref$title = _ref.title,\n    title = _ref$title === void 0 ? null : _ref$title,\n    _ref$className = _ref.className,\n    className = _ref$className === void 0 ? '' : _ref$className,\n    rest = _objectWithoutProperties(_ref, _excluded);\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    ref: ref,\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 16 16\",\n    width: size,\n    height: size,\n    fill: color,\n    className: ['bi', 'bi-arrow-clockwise', className].filter(Boolean).join(' ')\n  }, rest), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    d: \"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466\"\n  }));\n});\nArrowClockwise.propTypes = {\n  color: PropTypes.string,\n  size: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  title: PropTypes.string,\n  className: PropTypes.string\n};\nexport default ArrowClockwise;","import { fetchAPI } from \"./base-api\";\nconst API_BASE_URL = process.env.REACT_APP_BACKEND_API_URL;\n\nexport const getJobTemplates = async () => {\n  const endpoint = `/jobs/templates/`;\n  const options = {\n    method: 'GET',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const getJobTemplate = async (id) => {\n  const endpoint = `/jobs/templates/${id}/`;\n  const options = {\n    method: 'GET',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const createJobTemplate = async (data) => {\n  const endpoint = `/jobs/templates/`;\n  const options = {\n    method: 'POST',\n    body: data\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const updateJobTemplate = async (id, data) => {\n  const endpoint = `/jobs/templates/${id}/`;\n  const options = {\n    method: 'PUT',\n    body: data\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const deleteJobTemplate = async (id) => {\n  const endpoint = `/jobs/templates/${id}/`;\n  const options = {\n    method: 'DELETE',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const getEmailTemplates = async () => {\n  const endpoint = `/settings/templates/email-templates/`;\n  const options = {\n    method: 'GET',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const createEmailTemplate = async (data) => {\n  const endpoint = `/settings/templates/email-templates/`;\n  const options = {\n    method: 'POST',\n    body: data\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const updateEmailTemplate = async (id, data) => {\n  const endpoint = `/settings/templates/email-templates/${id}/`;\n  const options = {\n    method: 'PUT',\n    body: data\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const getEmail = async (id) => {\n  const endpoint = `/settings/templates/email-templates/${id}/`;\n  const options = {\n    method: 'GET',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const getSignatureTemplates = async () => {\n  const endpoint = `/email-signatures/`;\n  const options = {\n    method: 'GET',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const getEmailSignature = async (id) => {\n  const endpoint = `/email-signatures/${id}/`;\n  const options = {\n    method: 'GET',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const createEmailSignature = async (data) => {\n  const endpoint = `/email-signatures/`;\n  const options = {\n    method: 'POST',\n    body: data\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const updateEmailSignature = async (id, data) => {\n  const endpoint = `/email-signatures/${id}/`;\n  const options = {\n    method: 'PUT',\n    body: data\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const deleteEmailSignature = async (id) => {\n  const endpoint = `/email-signatures/${id}/`;\n  const options = {\n    method: 'DELETE',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const setDefaultEmailSignature = async (id) => {\n  const endpoint = `/settings/email-signatures/default/${id}/`;\n  const options = {\n    method: 'PUT',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const getSMSTemplates = async () => {\n  const endpoint = `/sms-templates/`;\n  const options = {\n    method: 'GET',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const getSMS = async (id) => {\n  const endpoint = `/sms-templates/${id}/`;\n  const options = {\n    method: 'GET',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const createSMSTemplate = async (data) => {\n  const endpoint = `/sms-templates/`;\n  const options = {\n    method: 'POST',\n    body: data\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const updateSMSTemplate = async (id, data) => {\n  const endpoint = `/sms-templates/${id}/`;\n  const options = {\n    method: 'PUT',\n    body: data\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const deleteSMSTemplate = async (id) => {\n  const endpoint = `/sms-templates/${id}/`;\n  const options = {\n    method: 'DELETE',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const getProposalBySalesId = async (id) => {\n  const endpoint = `/proposals/${id}/`;\n  const options = {\n    method: 'GET',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const getOutgoingEmail = async () => {\n  const endpoint = `/references/outgoing-email/`;\n  const options = {\n    method: 'GET',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const deleteEmailTemplates = async (id) => {\n  const endpoint = `/settings/templates/email-templates/${id}/`;\n  const options = {\n    method: 'DELETE',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const getProposalsTemplates = async () => {\n  const endpoint = `/settings/proposals/`;\n  const options = {\n    method: 'GET',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const getProposalsTemplate = async (id) => {\n  const endpoint = `/settings/proposals/${id}/`;\n  const options = {\n    method: 'GET',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const createProposalTemplate = async (data) => {\n  const endpoint = `/settings/proposals/new/`;\n  const options = {\n    method: 'POST',\n    body: data\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};\n\nexport const deleteProposalTemplates = async (id) => {\n  const endpoint = `/settings/proposals/delete/${id}/`;\n  const options = {\n    method: 'DELETE',\n  };\n  const url = new URL(`${API_BASE_URL}${endpoint}`);\n  return fetchAPI(url.toString(), options);\n};","import { fetchAPI } from \"../../../../APIs/base-api\";\nconst API_BASE_URL = process.env.REACT_APP_BACKEND_API_URL;\n\nexport async function saveFormToApi(payload) {\n  const endpoint = `${API_BASE_URL}/inquiries/form/`;\n  const options = {\n    method: 'POST',\n    body: payload,\n  };\n  return fetchAPI(endpoint, options);\n}\n\nexport async function listFormsByOrganization(orgId) {\n  const url = new URL(`${API_BASE_URL}/inquiries/forms/`);\n  url.searchParams.append(\"organization\", orgId);\n  const options = {\n    method: 'GET',\n  };\n  return fetchAPI(url.toString(), options);\n}\n\nexport async function getFormById(id) {\n  const endpoint = `${API_BASE_URL}/inquiries/form/${id}/`;\n  const options = {\n    method: 'GET',\n  };\n  return fetchAPI(endpoint, options);\n}\n\nexport async function updateFormToApi(id, payload) {\n  const endpoint = `${API_BASE_URL}/inquiries/form/${id}/update/`;\n  const options = {\n    method: 'PATCH',\n    body: payload,\n  };\n  return fetchAPI(endpoint, options);\n}\n\nexport async function listFormSubmissions(formId, params = {}) {\n  if (!formId) throw new Error('formId is required');\n  \n  const url = new URL(`${API_BASE_URL}/inquiries/form/${formId}/submissions/`);\n  \n  // Optional filters/pagination if backend supports them\n  if (params.page) url.searchParams.append('page', params.page);\n  if (params.page_size) url.searchParams.append('page_size', params.page_size);\n  if (params.status != null) url.searchParams.append('status', params.status);\n  if (params.assigned_to) url.searchParams.append('assigned_to', params.assigned_to);\n  if (params.search) url.searchParams.append('search', params.search);\n  if (params.ordering) url.searchParams.append('ordering', params.ordering);\n\n  const options = {\n    method: 'GET',\n  };\n  return fetchAPI(url.toString(), options);\n}\n\nexport async function deleteForm(id) {\n  const endpoint = `${API_BASE_URL}/inquiries/form/${id}/delete/`;\n  const options = {\n    method: 'DELETE',\n  };\n  return fetchAPI(endpoint, options);\n}","var _excluded = [\"color\", \"size\", \"title\", \"className\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var s = Object.getOwnPropertySymbols(e); for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (e.includes(n)) continue; t[n] = r[n]; } return t; }\nimport React, { forwardRef } from 'react';\nimport PropTypes from 'prop-types';\nvar Save = /*#__PURE__*/forwardRef(function (_ref, ref) {\n  var _ref$color = _ref.color,\n    color = _ref$color === void 0 ? 'currentColor' : _ref$color,\n    _ref$size = _ref.size,\n    size = _ref$size === void 0 ? '1em' : _ref$size,\n    _ref$title = _ref.title,\n    title = _ref$title === void 0 ? null : _ref$title,\n    _ref$className = _ref.className,\n    className = _ref$className === void 0 ? '' : _ref$className,\n    rest = _objectWithoutProperties(_ref, _excluded);\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    ref: ref,\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 16 16\",\n    width: size,\n    height: size,\n    fill: color,\n    className: ['bi', 'bi-save', className].filter(Boolean).join(' ')\n  }, rest), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1z\"\n  }));\n});\nSave.propTypes = {\n  color: PropTypes.string,\n  size: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  title: PropTypes.string,\n  className: PropTypes.string\n};\nexport default Save;"],"names":["_excluded","_extends","Object","assign","bind","n","e","arguments","length","t","r","hasOwnProperty","call","apply","ChevronRight","forwardRef","_ref","ref","_ref$color","color","_ref$size","size","_ref$title","title","_ref$className","className","rest","o","i","includes","_objectWithoutPropertiesLoose","getOwnPropertySymbols","s","propertyIsEnumerable","_objectWithoutProperties","React","xmlns","viewBox","width","height","fill","filter","Boolean","join","fillRule","d","propTypes","PropTypes","initBuilder","defaultOrgId","initialForm","window","root","document","querySelector","dataset","builderInitialized","console","log","preview","properties","cssTextarea","previewBtn","saveBtn","fieldCounter","fieldsData","currentField","currentFormId","id","history","historyIndex","saveHistory","slice","push","JSON","parse","stringify","shift","restoreFromHistory","state","querySelectorAll","forEach","f","remove","keys","data","type","field_type","el","createElement","innerHTML","getTemplate","actionBar","appendChild","wireField","labelEl","label","textContent","input","placeholder","ta","updateFieldDisplay","updateMoveButtons","applyConditionalVisibilityRecursively","emptyState","style","display","rebuildPreview","isFieldVisible","fieldId","visible_if","field_id","controllerId","value","expected","actual","controllerFieldId","controllerHost","controllerType","_sel$options","sel","opt","options","selectedIndex","trim","checked","lbl","Array","from","map","cb","getControllerValue","isArray","isPreviewMode","fid","_fieldsData$fid","host","hasCondition","classList","add","prevSignature","pass","visible","sig","addEventListener","form","_form$meta","_form$meta2","setVal","domain","description","meta","submit_to","submit_from","cc_email","bcc_email","thank_you_message","error_message","submit_button_label","redirect_url","recaptcha_site_key","recaptcha_secret_key","previewTitleEl","previewDescriptionEl","custom_css","fields","sort","a","b","_a$order","_b$order","order","addFieldFromData","field_name","find","_fieldsData$id","name","hydrateInitialForm","setTimeout","formTitleEl","formDescriptionEl","err","error","target","palette","item","closest","dataTransfer","effectAllowed","setData","_","dragOverField","dropPosition","text","email","number","phone","textarea","select","radio","checkbox","multicheckbox","date","time","url","address","image","html","consent","submit_button","undefined","updateFieldRequiredUI","actionReq","required","propReq","addressGrid","_data$options","inputs","parts","idx","part","setAttribute","removeAttribute","star","insertAdjacentHTML","selectField","reqToggle","remainingFields","stopPropagation","previousElementSibling","contains","parentNode","insertBefore","reindex","next","nextElementSibling","newOrder","node","nodes","upBtn","downBtn","disabled","selectedEl","fieldPropsContainer","firstChild","escapeHtml","escapeAttr","custom_class","maxlength","regex","allowedTypes","accept","multiple","button_text","custom_style","updateFieldPreview","isNaN","maxLength","parseInt","fileInput","normalizeOptionFieldDom","cbl","cbinput","btn","block","wrap","renderOptions","row","onclick","attachRealtimeListeners","splice","matches","renderConditionalUI","_controllers$","_data$visible_if","_data$visible_if2","_controller$data","_controller$data2","_data$visible_if3","enabledEl","wrapEl","fieldSel","valueSel","controllers","getConditionalControllers","allowed","Set","_ref2","has","c","currentControllerId","match","controller","opts","_controller$data3","condEnabledEl","condWrapEl","_ref3","_controllers$0$data","initialValue","_controllers$0$data$o","operator","phEl","isRequiredEl","classEl","condFieldEl","condValueEl","maxEl","regexEl","errmsgEl","htmlEl","btntextEl","btncssEl","acceptEl","multipleEl","requiredSpan","errmsgInput","borderColor","_controller$data4","_data$visible_if4","newControllerId","x","applyBtn","deselectField","applyPreviewConditionalVisibility","container","field","visibleIf","controller_name","expectedValue","actualValue","controllerFound","checkedRadio","multiCheckboxes","values","capitalize","charAt","toUpperCase","groupName","div","cid","rid","String","replace","v","getElementById","_f$label","_f$name3","_f$visible_if","_f$custom_class","_f$placeholder","_ref4","_f$max_length","_f$regex","_f$error_message","_f$html","_f$button_text","_f$custom_style","_id","max_length","used","_fieldsData$fid3","baseName","unique","lab","preventDefault","dropEffect","rect","getBoundingClientRect","midpoint","top","mouseY","clientY","relatedTarget","getData","referenceField","position","nextSibling","fieldsContainer","base","key","seedDataFor","existingNames","_fieldsData$fid2","preferredBaseName","fallbackBaseName","uniqueName","suffix","addField","fileNameEl","files","orderedFields","out","fieldNameMap","visibleIfAttr","visibleIfData","customClass","p","isChildRequired","some","renderPreview","tabPreviewContainer","desc","htmlWithHeader","submitBtn","checkValidity","alert","reportValidity","async","originalHTML","dispatchEvent","CustomEvent","titleEl","Error","submitToEl","formTypeEl","siteKeyEl","secretKeyEl","nameField","_f$name","toLowerCase","emailField","_f$name2","duplicateNames","arr","indexOf","payload","_cssTextarea$value","orderedFieldIds","_fieldsData$f$visible","_f$visible_if$value","get","_root$querySelector","formType","organization","redirect","buildApiPayload","json","updateFormToApi","saveFormToApi","publicKey","public_key","savedFormType","contentToShow","process","embedModal","snippetEl","copyBtn","closeBtn","xBtn","modalTitle","modalDescription","doCopy","navigator","clipboard","writeText","execCommand","location","href","message","detail","FieldIcon","props","stroke","strokeWidth","strokeLinecap","strokeLinejoin","_jsxs","children","_jsx","y","rx","cx","cy","TempFormBuilder","_outgoingEmailTemplat","_session$organization2","session","useAuth","trialHeight","useTrialHeight","bootstrappedRef","useRef","useParams","editId","toolboxCollapsed","setToolboxCollapsed","useState","searchTerm","setSearchTerm","saving","setSaving","activeTab","setActiveTab","setFormType","filteredFieldTypes","handlePreview","useCallback","click","handleUndo","handleRedo","outgoingEmailTemplateQuery","useQuery","queryKey","queryFn","getOutgoingEmail","fromEmail","outgoing_email","useEffect","_session$organization","orgId","current","timer","formJson","getFormById","clearTimeout","cleanupBuilder","handleSaveError","_e$detail","errorMessage","toast","duration","handleSaveSuccess","success","handleClearError","dismiss","removeEventListener","_Fragment","overflow","onClick","Icon","ProgressSpinner","onChange","draggable","role","rows","defaultValue","opacity","readOnly","boxSizing","fontFamily","justifyContent","ArrowCounterclockwise","ArrowClockwise","API_BASE_URL","getJobTemplates","URL","fetchAPI","toString","method","getJobTemplate","createJobTemplate","body","updateJobTemplate","deleteJobTemplate","getEmailTemplates","createEmailTemplate","updateEmailTemplate","getEmail","getSignatureTemplates","getEmailSignature","createEmailSignature","updateEmailSignature","deleteEmailSignature","setDefaultEmailSignature","getSMSTemplates","getSMS","createSMSTemplate","updateSMSTemplate","deleteSMSTemplate","getProposalBySalesId","deleteEmailTemplates","getProposalsTemplates","getProposalsTemplate","deleteProposalTemplates","endpoint","Save"],"sourceRoot":""}