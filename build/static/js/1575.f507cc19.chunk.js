"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[1575],{6391:(e,s,t)=>{t.r(s),t.d(s,{default:()=>ce});var i=t(65043),l=t(75329),o=t(38294),n=t(49367),r=t(73216),d=t(35475),a=t(93747),c=t(58387),h=t(72018),x=t(2028),u=t(56328),p=t(88166),m=t(43666),v=t(33817),f=t(56741),y=t(50565),j=t(94819),_=t(90688),g=t(88120),b=t(47097),w=t(9642),N=t(64824),C=t(93740),S=t(76104);const A="expense-history_gobackBtn__4M07y",E="expense-history_filterBox__EYI8q",k="expense-history_active__MSXK7",D="expense-history_selectedCount__TSiH8",F="expense-history_vehicleName__5ZpO+",z="expense-history_dueSoon__tRCPM",R="expense-history_dueMonth__gCYBB",V="expense-history_overdue__P16SK",$="expense-history_paidTrue__+wtO5",W="expense-history_paidFalse__5eujf",L="expense-history_paidButton__kQHPA",B="expense-history_notPaidButton__WEXJS",M="expense-history_customToast__M70uA",T="expense-history_outerToastIcon__2kbHQ",O="expense-history_toastIcon__556vT",H="expense-history_toastTitle__5MVpd",I="expense-history_toastMessage__iD44N",P="expense-history_shakeText__cOmHh",Z="expense-history_newButton__EVdDj";var q=t(37990),X=t(10586),G=t(57189),K=t(48417),Y=t(2514),J=t(83624),Q=t(568),U=t(74737),ee=t(99678),se=t(14834),te=t(58027),ie=t(27734),le=t(99868),oe=t(70579);const ne=e=>{if(!e)return"-";const s=new Date(1e3*+e);return new Intl.DateTimeFormat("en-AU",{timeZone:"Australia/Sydney",day:"numeric",month:"short",year:"numeric"}).format(s)},re=(0,i.forwardRef)(((e,s)=>{let{selected:t,setSelected:l,searchValue:o,refetch:n}=e;const{id:a}=(0,r.g)(),{role:c}=(0,G.As)(),{trialHeight:x}=(0,K.$)(),A=(0,i.useRef)(null),E=(0,i.useRef)(null),[k,D]=(0,i.useState)([]),[F,Z]=(0,i.useState)(1),[re,de]=(0,i.useState)({sortField:"id",sortOrder:-1}),[ae,ce]=(0,i.useState)({sortField:"id",sortOrder:-1}),[he,xe]=(0,i.useState)(!0),[ue,pe]=(0,i.useState)(!1),[me,ve]=(0,i.useState)(!1),[fe,ye]=(0,i.useState)(""),[je,_e]=(0,i.useState)(!1),[ge,be]=(0,i.useState)({data:null,show:!1});(0,i.useEffect)((()=>{xe(!0),Z(1)}),[o,n,me]),(0,i.useEffect)((()=>{a&&(async()=>{pe(!0);let e="";1===(null===ae||void 0===ae?void 0:ae.sortOrder)?e=`${ae.sortField}`:-1===(null===ae||void 0===ae?void 0:ae.sortOrder)&&(e=`-${ae.sortField}`);try{const s=await(0,q.jG)(1,a,F,25,e);1===F?D(s||[]):(null===s||void 0===s?void 0:s.length)>0&&D((e=>{const t=new Set(e.map((e=>e.id))),i=s.filter((e=>!t.has(e.id)));return[...e,...i]})),de(ae),xe(25===(null===s||void 0===s?void 0:s.length))}catch(s){console.error("Error fetching linked expenses:",s)}finally{pe(!1)}})()}),[a,F,o,ae,n]),(0,i.useEffect)((()=>{if((null===k||void 0===k?void 0:k.length)>0&&he){A.current=new IntersectionObserver((e=>{e[0].isIntersecting&&!ue&&Z((e=>e+1))}));const e=document.querySelector(".p-datatable-tbody tr:not(.p-datatable-emptymessage):last-child");e&&A.current.observe(e)}return()=>{A.current&&A.current.disconnect()}}),[k,he,ue]);const we=(0,b.n)({mutationFn:e=>(0,X.Wz)(e),onSuccess:()=>{u.oR.success("Expense deleted successfully"),we.reset()},onError:e=>{we.reset(),console.log("error: ",e),u.oR.error("Failed to delete expense. Please try again.")}}),Ne=e=>{let{rowData:s}=e;const t=(0,i.useRef)(null),[l,o]=(0,i.useState)(!1),n=(0,_.k)(l,o);return(0,oe.jsxs)(i.Fragment,{children:[(0,oe.jsx)(y.A,{size:24,color:"#667085",className:"cursor-pointer",ref:t,...n}),(0,oe.jsx)(g.k,{state:l?"open":"closed",anchorRef:t,onClose:()=>o(!1),className:"threeDots",menuStyle:{padding:"4px",width:"241px",textAlign:"left"},children:(0,oe.jsxs)("div",{className:"d-flex align-items-center cursor-pointer gap-2 hover-greay px-2 py-2",onClick:()=>{o(!1),D((e=>e.filter((e=>e.id!==s.id)))),E.current=setTimeout((()=>{s.asset&&(0,q.hk)(s.asset.asset_id,s.asset.asset_type_id,s.id),we.mutate(s.id)}),5e3),u.oR.custom((e=>(0,oe.jsxs)("div",{className:M,children:[(0,oe.jsxs)("div",{className:"d-flex align-items-center justify-content-between w-100 mb-3",children:[(0,oe.jsx)("div",{className:T,children:(0,oe.jsx)("div",{className:O,children:(0,oe.jsx)(v.A,{color:"#DC6803",size:20})})}),(0,oe.jsx)(h.$,{className:"close-button border-0",onClick:()=>u.oR.dismiss(e),children:(0,oe.jsx)(f.A,{size:20,color:"#344054"})})]}),(0,oe.jsxs)("div",{className:"ps-2",children:[(0,oe.jsx)("p",{className:H,children:"Expense has been deleted"}),(0,oe.jsx)("p",{className:I,children:"You can undo this action within a few seconds."}),(0,oe.jsx)(h.$,{className:"text-button ps-0",onClick:()=>{var t;clearTimeout(E.current),null===(t=we.reset)||void 0===t||t.call(we),u.oR.success("Expense has been restored"),u.oR.dismiss(e),D((e=>{const t=k.findIndex((e=>e.id===s.id));return[...e.slice(0,t),s,...e.slice(t)]}))},children:"Undo action"})]})]})),{position:"bottom-right"})},children:[(0,oe.jsx)(j.A,{color:"#B42318",size:20}),(0,oe.jsx)("span",{style:{color:"#B42318",fontSize:"16px",fontWeight:500},children:"Delete expense"}),(null===we||void 0===we?void 0:we.variables)===s.id?(0,oe.jsx)(C.p,{style:{width:"20px",height:"20px"}}):""]})})]})},Ce=k.filter((e=>{var s,t,i,l,n,r,d,a;if(!o)return!0;const c=o.toLowerCase();return(null===(s=e.number)||void 0===s?void 0:s.toLowerCase().includes(c))||(null===(t=e.supplier)||void 0===t||null===(i=t.name)||void 0===i?void 0:i.toLowerCase().includes(c))||(null===(l=e.invoice_reference)||void 0===l?void 0:l.toLowerCase().includes(c))||(null===(n=e.account_code)||void 0===n||null===(r=n.code)||void 0===r?void 0:r.toLowerCase().includes(c))||(null===(d=e.account_code)||void 0===d||null===(a=d.name)||void 0===a?void 0:a.toLowerCase().includes(c))}));return(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsxs)(N.b,{ref:s,value:Ce,scrollable:!0,selectionMode:"checkbox",columnResizeMode:"expand",resizableColumns:!0,showGridlines:!0,size:"large",scrollHeight:`calc(100vh - 175px - ${x}px)`,className:"border",selection:t,onSelectionChange:e=>l(e.value),loading:ue,loadingIcon:ie.A,emptyMessage:(0,oe.jsx)(le.A,{isDataExist:!(null===k||void 0===k||!k.length)}),sortField:null===re||void 0===re?void 0:re.sortField,sortOrder:null===re||void 0===re?void 0:re.sortOrder,onSort:e=>{const{sortField:s,sortOrder:t}=e;Z(1),xe(!0),ce({sortField:s,sortOrder:t})},children:[(0,oe.jsx)(w.V,{selectionMode:"multiple",headerClassName:"ps-4 border-end-0",bodyClassName:"show-on-hover border-end-0 ps-4",headerStyle:{width:"3rem",textAlign:"center"},frozen:!0}),(0,oe.jsx)(w.V,{field:"number",header:"Expense ID",body:e=>{var s;return(0,oe.jsxs)("div",{className:"d-flex align-items-center justify-content-between show-on-hover",children:[(0,oe.jsxs)("div",{className:"d-flex flex-column",style:{lineHeight:"1.385"},children:[(0,oe.jsx)("span",{style:{fontWeight:"500",color:"#344054"},children:(null===(s=e.number)||void 0===s?void 0:s.split("-")[1])||e.number}),(0,oe.jsx)("span",{className:"font-12",style:{color:"#98A2B3"},children:e.created?ne(e.created):"-"})]}),(0,oe.jsx)(h.$,{label:"Open",onClick:()=>{var s;_e(!0),ye({id:null===e||void 0===e?void 0:e.id,name:null===e||void 0===e||null===(s=e.supplier)||void 0===s?void 0:s.name})},className:"primary-text-button ms-3 show-on-hover-element not-show-checked",text:!0})]})},frozen:!0,sortable:!0,headerClassName:"paddingLeftHide shadowRight",bodyClassName:"paddingLeftHide shadowRight",style:{minWidth:"150px",width:"150px",maxWidth:"150px"}}),(0,oe.jsx)(w.V,{field:"supplier__name",header:"Supplier A\u2192Z",body:e=>{var s,t,i;return(0,oe.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,oe.jsx)(te.h,{has_photo:null===e||void 0===e||null===(s=e.supplier)||void 0===s?void 0:s.has_photo,photo:null===e||void 0===e||null===(t=e.supplier)||void 0===t?void 0:t.photo,is_business:!0,size:24}),(0,oe.jsxs)("div",{className:"d-flex flex-column gap-1",children:[(0,oe.jsx)("div",{style:{fontSize:"14px",color:"#344054"},children:(null===(i=e.supplier)||void 0===i?void 0:i.name)||"-"}),e.deleted&&(0,oe.jsx)(S.v,{value:"Deleted",style:{height:"22px",width:"59px",borderRadius:"16px",border:"1px solid #FECDCA",background:"#FEF3F2",color:"#912018",fontSize:"12px",fontWeight:500}})]})]})},sortable:!0,style:{minWidth:"224px"}}),(0,oe.jsx)(w.V,{field:"invoice_reference",header:"Reference",body:e=>(0,oe.jsx)("span",{style:{color:"#667085",fontSize:"14px"},title:e.invoice_reference,children:e.invoice_reference||"-"}),style:{minWidth:"150px"}}),(0,oe.jsx)(w.V,{field:"file",header:"File",body:e=>{var s,t,i;if(!e.file)return"";const l=e.paid,o=e.file?null===(s=e.file.split("."))||void 0===s||null===(t=s[(null===(i=e.file.split("."))||void 0===i?void 0:i.length)-1])||void 0===t?void 0:t.toLowerCase():"";return e.file?(0,oe.jsx)(d.N_,{to:e.file,target:"_blank",children:(0,oe.jsx)(ee.L,{extension:o,color:l?"#98A2B3":"#FF0000",size:16})}):void 0},style:{minWidth:"60px",textAlign:"center",maxWidth:"60px",width:"60px"}}),(0,oe.jsx)(w.V,{field:"due_date",header:"Due Date",body:e=>{if(!e.due_date)return"-";const s=new Date(1e3*e.due_date)-new Date,t=Math.ceil(s/864e5);let i="";return t<0?i=V:t<=7?i=z:t<=30&&(i=R),(0,oe.jsx)("span",{className:i,children:ne(e.due_date)})},sortable:!0,style:{minWidth:"120px"}}),(0,oe.jsx)(w.V,{field:"total",header:"Total",body:e=>(0,oe.jsx)("div",{className:"d-flex align-items-center justify-content-end",children:(0,oe.jsxs)("span",{className:e.paid?$:W,style:{fontWeight:"500",fontSize:"14px"},children:["$",(0,se.m)(e.total||0)]})}),sortable:!0,style:{minWidth:"100px"},bodyClassName:"text-end"}),(0,oe.jsx)(w.V,{field:"account_code.code",header:"Account Code",body:e=>(0,oe.jsx)("span",{style:{color:"#667085",fontSize:"14px"},children:e.account_code?`${e.account_code.code}:${e.account_code.name}`:"-"}),sortable:!0,style:{minWidth:"200px"}}),(0,oe.jsx)(w.V,{field:"xero_status",header:"Xero/Myob",body:e=>(0,oe.jsx)("div",{className:"d-flex align-items-center justify-content-center",children:"in_progress"===(null===e||void 0===e?void 0:e.xero_status)?(0,oe.jsx)("span",{style:{color:"#158ECC",fontSize:"12px"},className:P,children:"xero"}):"completed"===(null===e||void 0===e?void 0:e.xero_status)?(0,oe.jsx)("span",{style:{color:"#158ECC",fontSize:"12px"},children:"xero"}):(0,oe.jsx)("span",{})}),style:{minWidth:"89px",textAlign:"center"}}),(0,oe.jsx)(w.V,{field:"paid",header:"Status",body:e=>e.paid?(0,oe.jsxs)(h.$,{onClick:()=>be({data:e,show:!0}),className:L,style:{height:"36px",width:"97px"},children:["Paid ",(0,oe.jsx)(p.A,{color:"#17B26A",size:16})]}):(0,oe.jsxs)(h.$,{onClick:()=>be({data:e,show:!0}),className:B,style:{height:"36px",width:"97px"},children:["Not Paid ",(0,oe.jsx)(m.A,{color:"#F04438",size:16})," "]}),sortable:!0,style:{minWidth:"130px",maxWidth:"130px",width:"130px"},bodyClassName:"text-center",headerClassName:"text-center"}),(0,U._)(c,Q.J.EXPENSE.DELETE)&&(0,oe.jsx)(w.V,{header:"Actions",body:e=>(0,oe.jsx)(Ne,{rowData:e}),style:{minWidth:"75px",maxWidth:"75px",width:"75px",textAlign:"center"}})]}),(0,oe.jsx)(Y.A,{id:null===fe||void 0===fe?void 0:fe.id,name:null===fe||void 0===fe?void 0:fe.name,visible:je,setVisible:_e,setEditData:ye,setRefetch:ve},null===fe||void 0===fe?void 0:fe.id),(0,oe.jsx)(J.A,{showDialog:ge,setShowDialog:be,setRefetch:ve})]})}));re.displayName="ExpenseHistoryTable";const de=re;var ae=t(62284);const ce=()=>{var e,s;const{id:t}=(0,r.g)(),p=(0,r.Zp)(),m=(0,i.useRef)(null),[v,f]=(0,i.useState)(null),[y,j,_]=(0,x.d7)("",400),[g,b]=(0,i.useState)(!0),[w,N]=(0,i.useState)(!1),C=(0,a.I)({queryKey:["vehicle",t],queryFn:()=>(0,q.Dh)(t),enabled:!!t,retry:1,cacheTime:0});return"Not found"===(null===C||void 0===C||null===(e=C.error)||void 0===e?void 0:e.message)&&(u.oR.error("Vehicle not found"),p("/assets?type=vehicles")),(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsx)(n.mg,{children:(0,oe.jsxs)("title",{children:["Expense History - ",(null===C||void 0===C||null===(s=C.data)||void 0===s?void 0:s.registration_number)||"Vehicle"]})}),(0,oe.jsx)("div",{className:"expense-history-page",children:(0,oe.jsxs)("div",{className:"expense-history",style:{width:"100%"},children:[(0,oe.jsxs)("div",{className:`topbar ${null!==v&&void 0!==v&&v.length?k:""}`,style:{padding:"4px 32px 4px 23px",position:"relative",height:"48px"},children:[(0,oe.jsx)("div",{className:"left-side d-flex align-items-center",style:{gap:"16px"},children:null!==v&&void 0!==v&&v.length?(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsxs)("h6",{className:D,children:["Selected: ",null===v||void 0===v?void 0:v.length]}),(0,oe.jsx)("div",{className:"filtered-box",children:(0,oe.jsx)("button",{className:`${E}`,onClick:()=>{return e=!0,void(m.current?m.current.exportCSV({selectionOnly:e}):console.error("DataTable ref is null"));var e},children:(0,oe.jsx)(l.A,{})})})]}):(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsxs)(d.N_,{to:"/assets?type=vehicles",className:`${A}`,children:[(0,oe.jsx)(o.A,{color:"#106b99",size:20})," Go Back"]}),(0,oe.jsxs)("div",{className:"searchBox",style:{position:"relative"},children:[(0,oe.jsx)("div",{style:{position:"absolute",top:"2px",left:"6px"},children:(0,oe.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:(0,oe.jsx)("path",{d:"M14.6777 12.9299C15.6661 11.5841 16.25 9.92275 16.25 8.125C16.25 3.63769 12.6123 0 8.125 0C3.63769 0 0 3.63769 0 8.125C0 12.6123 3.63769 16.25 8.125 16.25C9.92323 16.25 11.585 15.6658 12.9309 14.6769L12.9299 14.6777C12.9667 14.7277 13.0078 14.7756 13.053 14.8208L17.8661 19.6339C18.3543 20.122 19.1457 20.122 19.6339 19.6339C20.122 19.1457 20.122 18.3543 19.6339 17.8661L14.8208 13.053C14.7756 13.0078 14.7277 12.9667 14.6777 12.9299ZM15 8.125C15 11.922 11.922 15 8.125 15C4.32804 15 1.25 11.922 1.25 8.125C1.25 4.32804 4.32804 1.25 8.125 1.25C11.922 1.25 15 4.32804 15 8.125Z",fill:"#98A2B3"})})}),(0,oe.jsx)("input",{type:"text",placeholder:"Search",value:y,onChange:e=>_(e.target.value),className:"border search-resource",style:{borderRadius:"4px",width:"184px",border:"1px solid #D0D5DD",color:"#424242",paddingLeft:"36px",fontSize:"14px",height:"32px"}})]})]})}),(0,oe.jsx)("div",{className:"featureName d-flex align-items-center",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:(0,oe.jsx)("h1",{className:(0,c.A)(F,"m-0 p-0"),title:null!==C&&void 0!==C&&C.data?`${C.data.make} ${C.data.model}`:"Loading...",children:null!==C&&void 0!==C&&C.data?`${C.data.make||""} ${C.data.model||""}`.trim()||"Vehicle":"Loading..."})}),(0,oe.jsx)("div",{className:"right-side d-flex align-items-center",style:{gap:"8px"},children:(0,oe.jsx)(h.$,{onClick:()=>b(!0),className:`${Z}`,children:"New Expense"})})]}),(0,oe.jsx)(de,{ref:m,selected:v,setSelected:f,searchValue:j,refetch:w})]})}),g&&(0,oe.jsx)(ae.A,{visible:g,setVisible:b,setRefetch:N,assetForExpense:{id:+t,type:1}})]})}}}]);
//# sourceMappingURL=1575.f507cc19.chunk.js.map