"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[8273],{18273:(e,t,s)=>{s.r(t),s.d(t,{default:()=>C});var r=s(65043),n=s(61072),o=s(78602),a=s(52572),i=s(84843),c=s(22927),l=s(62624),d=s(34305),h=s(38294),u=s(95192),p=s(36237),m=s(64416),f=s(544),g=s(94819),w=s(24858),x=s(73216),y=s(35475),j=s(18403),S=s(47097),$=s(93747),b=s(93740),v=s(56328),N=s(51238),T=s(80899),P=s(59638),E=s(67046),A=s(27472),U=s(70579);const k=T.Ik({reference:T.Yj().required("Project reference is required")}).required(),C=()=>{const e=(0,x.Zp)(),{id:t}=(0,x.g)();let s={};const T=JSON.parse(window.localStorage.getItem("profileData")||"{}");try{const e=window.sessionStorage.getItem("new-request");e&&(s=JSON.parse(e))}catch(B){console.error("Failed to parse form data from sessionStorage",B)}const[C,q]=(0,r.useState)([]),[D]=(0,r.useState)({reference:s.reference||"",requirements:s.requirements||""}),{register:R,handleSubmit:L,trigger:O,formState:{errors:_},watch:I}=(0,w.mN)({resolver:(0,j.t)(k),defaultValues:D}),z=(0,S.n)({mutationFn:e=>(0,E.D7)(e),onSuccess:()=>{e("/sales"),v.oR.success("New request created as draft successfully.")},onError:e=>{console.error("Error creating draft new request:",e),v.oR.error("Failed to create new request. Please try again.")}}),G=(0,$.I)({queryKey:["id",t],queryFn:()=>(0,P.EZ)(t),enabled:!!t,retry:1});return(0,U.jsx)("form",{onSubmit:L((s=>{const r={id:t,reference:s.reference,requirements:s.requirements,files:C.map((e=>e.file))};window.sessionStorage.setItem("new-request",JSON.stringify(r)),e("/sales/quote-calculation")})),children:(0,U.jsx)("div",{className:"newQuotePage existingClients borderSkyColor",children:(0,U.jsxs)("div",{style:{height:"calc(100vh - 249px)"},children:[(0,U.jsx)("div",{className:"newQuoteBack",children:(0,U.jsx)(y.k2,{to:"/sales/newquote/selectyourclient",children:(0,U.jsxs)("button",{children:[(0,U.jsx)(h.A,{color:"#000000",size:20})," \xa0\xa0Go Back"]})})}),(0,U.jsxs)("div",{className:"newQuoteContent h-100",children:[(0,U.jsx)("div",{className:"navStepClient",children:(0,U.jsxs)("ul",{children:[(0,U.jsxs)("li",{children:[(0,U.jsx)("span",{children:(0,U.jsx)(u.A,{color:"#D0D5DD",size:15})})," ",(0,U.jsx)("p",{children:"Choose Client"})]}),(0,U.jsxs)("li",{children:[(0,U.jsx)("span",{children:(0,U.jsx)(p.A,{color:"#D0D5DD",size:15})})," ",(0,U.jsx)("p",{children:"Client Information"})," "]}),(0,U.jsxs)("li",{className:"activeClientTab",children:[(0,U.jsx)("span",{children:(0,U.jsx)(m.A,{color:"#D0D5DD",size:15})})," ",(0,U.jsx)("p",{children:"Scope of Work"})," "]})]})}),(0,U.jsx)("div",{className:"individual height",children:(0,U.jsx)("div",{className:"formgroupboxs",style:{paddingTop:"32px"},children:(0,U.jsxs)(n.A,{className:"text-left",children:[(0,U.jsx)(o.A,{sm:12,children:(0,U.jsxs)("div",{className:"formgroup mb-3 mt-0",children:[(0,U.jsxs)("label",{children:["Project Reference",(0,U.jsx)("span",{className:"required",children:"*"})]}),(0,U.jsxs)("div",{className:"inputInfo "+(_.reference?"error-border":""),children:[(0,U.jsx)("input",{...R("reference"),placeholder:"Add Reference for your Project"}),_.reference&&(0,U.jsx)("img",{className:"ExclamationCircle",src:A.A,alt:"Exclamation Circle"})]}),_.reference&&(0,U.jsx)("p",{className:"error-message",children:_.reference.message})]})}),(0,U.jsx)(o.A,{sm:12,children:(0,U.jsxs)("div",{className:"formgroup mb-2 mt-0",children:[(0,U.jsxs)("label",{children:["Describe requirements for the order below",(0,U.jsx)("br",{}),(0,U.jsx)("small",{style:{color:"#475467",fontWeight:400},children:"Use for organisation. Not customer-facing."})]}),(0,U.jsxs)("div",{style:{position:"relative"},className:"inputInfo textarea "+(_.requirements?"error-border":""),children:[(0,U.jsx)("textarea",{...R("requirements"),placeholder:"Enter a description..."}),_.requirements&&(0,U.jsx)("img",{className:"ExclamationCircle",style:{position:"absolute",right:"10px",bottom:"10px"},src:A.A,alt:"Exclamation Circle"})]}),_.requirements&&(0,U.jsx)("p",{className:"error-message",children:_.requirements.message})]})}),(0,U.jsx)(o.A,{sm:12,children:(0,U.jsxs)("div",{className:"formgroup mb-3 mt-0",children:[(0,U.jsx)("label",{style:{fontWeight:"normal"},children:"Only for internal use."}),(0,U.jsxs)("div",{className:"custom-file-upload",style:{marginTop:"10px"},children:[(0,U.jsxs)("label",{htmlFor:"file-upload",className:"custom-upload-btn",style:{border:"1px solid var(--Gray-300, #D0D5DD)",borderRadius:"4px",padding:"8px 14px"},children:["Attach Files \xa0",(0,U.jsx)(f.A,{color:"#1D2939",width:20,height:20})]}),(0,U.jsx)("input",{id:"file-upload",type:"file",multiple:!0,onChange:e=>{const t=Array.from(e.target.files).map((e=>({id:(0,N.A)(),file:e,type:e.type})));q((e=>[...e,...t]))},style:{display:"none"}})]})]})}),(0,U.jsx)(o.A,{sm:12,children:C.length>0&&(0,U.jsx)("div",{className:"uploaded-files pb-5",children:(0,U.jsx)("ul",{children:C.map((e=>{return(0,U.jsxs)("li",{className:"ps-0",children:[(t=e.type,t.includes("pdf")?(0,U.jsx)(a.A,{color:"#000000",width:20,height:20}):t.includes("image")?(0,U.jsx)(i.A,{color:"#000000",width:20,height:20}):t.includes("text")?(0,U.jsx)(c.A,{color:"#000000",width:20,height:20}):t.includes("word")?(0,U.jsx)(l.A,{color:"#000000",width:20,height:20}):t.includes("code")?(0,U.jsx)(d.A,{color:"#000000",width:20,height:20}):(0,U.jsx)(c.A,{color:"#000000",size:20})),(0,U.jsx)("span",{className:"text-lowercase",children:e.file.name}),(0,U.jsx)(g.A,{color:"#98A2B3",style:{cursor:"pointer",marginLeft:"20px"},onClick:()=>(e=>{q((t=>t.filter((t=>t.id!==e))))})(e.id)})]},e.id);var t}))})})})]})})}),(0,U.jsxs)("div",{className:"individual bottomBox justify-content-between",children:[(0,U.jsx)(y.N_,{to:"/sales",children:(0,U.jsx)("button",{type:"button",className:"cancel-button border-0 text-danger",children:"Cancel"})}),(0,U.jsxs)("div",{className:"d-flex",style:{gap:"12px"},children:[(0,U.jsxs)("button",{type:"button",disabled:z.isPending,onClick:async()=>{var e,s;const r=await O(),n=null===(e=G.data)||void 0===e?void 0:e.contact_persons[0],o=null===(s=G.data)||void 0===s?void 0:s.contact_persons.find((e=>!0===e.is_main)),a=null!==o&&void 0!==o&&o.id?null===o||void 0===o?void 0:o.id:null===n||void 0===n?void 0:n.id;a?r&&z.mutate({client:t,action:"draft",contact_person:a,reference:I("reference"),description:I("requirements"),managers:[{manager:null===T||void 0===T?void 0:T.desktop_user_id}]}):v.oR.error("No contact person found for this client. Please add a contact person before saving as a draft.")},className:"cancel-button",children:["Save Draft "," ",z.isPending&&(0,U.jsx)(b.p,{style:{width:"18px",height:"18px"}})]}),(0,U.jsx)("button",{type:"submit",className:"submit-button",children:"Calculate"})]})]})]})]})})})}},31342:(e,t,s)=>{s.d(t,{f:()=>r});const r=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{method:r="GET",headers:n={},body:o}=t,a=localStorage.getItem("access_token"),i=o instanceof FormData,c={"Content-Type":i?"multipart/form-data":"application/json",...n};s&&(c.Authorization=`Bearer ${a}`);const l={method:r,headers:c,body:i?o:JSON.stringify(o),redirect:"follow"};try{const t=new URL(e),s=await fetch(t,l),r=s.headers.get("Content-Type");if(!s.ok){var d;let e=null;e=r&&r.includes("application/json")?await s.json():await s.text(),401===s.status&&(localStorage.clear(),sessionStorage.clear(),window.location.replace("/login"));const t=new Error((null===(d=e)||void 0===d?void 0:d.message)||`HTTP error! Status: ${s.status}`);throw t.status=s.status,t.data=e,t}if(r&&r.includes("application/json"))return await s.json();return{message:"Non-JSON response",body:await s.text()}}catch(h){throw console.error("Fetch API error:",h),h}}},59638:(e,t,s)=>{s.d(t,{EZ:()=>a,F1:()=>x,Fl:()=>u,OF:()=>c,QK:()=>f,Ql:()=>i,X6:()=>l,Ye:()=>g,ab:()=>y,i6:()=>h,kB:()=>j,nP:()=>d,o6:()=>m,oO:()=>o,oo:()=>p,zZ:()=>w});var r=s(31342);const n="https://app.memate.com.au/api/v1",o=async e=>{const t=new URL(`${n}${`/clients/restore/${e}/`}`);return(0,r.f)(t.toString(),{method:"POST"})},a=async e=>{const t=new URL(`${n}${`/clients/${e}/`}`);return(0,r.f)(t.toString(),{method:"GET"})},i=async()=>{const e=new URL(`${n}/references/clients/categories/`);return(0,r.f)(e.toString(),{method:"GET"})},c=async()=>{const e=new URL(`${n}/references/clients/industries/`);return(0,r.f)(e.toString(),{method:"GET"})},l=async()=>{const e=new URL(`${n}/references/countries/`),t=await(0,r.f)(e.toString(),{method:"GET"},!1),s=[1];return(null===t||void 0===t?void 0:t.filter((e=>s.includes(e.id))))||[]},d=async e=>{const t=new URL(`${n}${`/references/states/${e}/`}`);return(0,r.f)(t.toString(),{method:"GET"},!1)},h=async e=>{const t=new URL(`${n}${`/references/cities/${e}/`}`);return(0,r.f)(t.toString(),{method:"GET"},!1)},u=async()=>{const e=new URL(`${n}/references/desktop-users/`);return(0,r.f)(e.toString(),{method:"GET"})},p=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4?arguments[4]:void 0;const i=(e-1)*t,c=new URL(`${n}/clients/`);return c.searchParams.append("limit",t),c.searchParams.append("offset",i),s&&c.searchParams.append("search",s),o&&c.searchParams.append("ordering",o),a&&c.searchParams.append("deleted",1),(0,r.f)(c.toString(),{method:"GET"})},m=async function(e,t,s){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";const i=(t-1)*s,c=new URL(`${n}${`/clients/${e}/orders/`}`);return c.searchParams.append("limit",s),c.searchParams.append("offset",i),o&&c.searchParams.append("number",o),a&&c.searchParams.append("ordering",a),(0,r.f)(c.toString(),{method:"GET"})},f=async e=>{const t=new URL(`${n}${`/clients/address/${e}/main`}`);return(0,r.f)(t.toString(),{method:"PUT"})},g=async e=>{const t=new URL(`${n}${`/clients/contact-persons/${e}/main`}`);return(0,r.f)(t.toString(),{method:"PUT"})},w=async e=>{const t=new URL(`${n}${`/clients/delete/${e}/`}`);return(0,r.f)(t.toString(),{method:"DELETE"})},x=async e=>{const t=new URL(`${n}${`/clients/contact-persons/${e}/delete/`}`);return(0,r.f)(t.toString(),{method:"DELETE"})},y=async e=>{const t=new URL(`${n}${`/clients/address/${e}/delete/`}`);return(0,r.f)(t.toString(),{method:"DELETE"})},j=async e=>{const t={method:"PUT",body:{unique_id:e}},s=new URL(`${n}/projects/back/`);return(0,r.f)(s.toString(),t)}},67046:(e,t,s)=>{s.d(t,{CK:()=>p,D7:()=>o,HT:()=>m,Op:()=>l,V3:()=>h,WG:()=>c,cS:()=>i,fW:()=>u,j3:()=>a,oe:()=>d});var r=s(31342);const n="https://app.memate.com.au/api/v1",o=async e=>{const t={method:"POST",body:e},s=new URL(`${n}/sales/new-request/`);return(0,r.f)(s.toString(),t)},a=async()=>{const e=new Headers,t=localStorage.getItem("access_token");e.append("Authorization",`Bearer ${t}`);const s={method:"GET",headers:e,redirect:"follow"};try{const e=await fetch(`${n}/sales/`,s);return await e.text()}catch(r){throw console.error("Profile fetch error:",r),r}},i=async(e,t)=>{const s=new Headers,r=localStorage.getItem("access_token");s.append("Authorization",`Bearer ${r}`),s.append("Content-Type","application/json");const o={method:"PUT",headers:s,body:JSON.stringify({sales_note:t}),redirect:"follow"};try{const t=await fetch(`${n}/sales/${e}/notes/`,o);if(!t.ok){const e=await t.text();throw new Error(`Sales notes update failed with status ${t.status}: ${e}`)}const s=await t.text();return s.trim()?JSON.parse(s):null}catch(a){throw console.error("Sales notes update error:",a),a}},c=async e=>{const t={method:"PUT",body:{ids:e}},s=new URL(`${n}/sales/status/won/`);return(0,r.f)(s.toString(),t)},l=async e=>{const t={method:"PUT",body:{ids:e}},s=new URL(`${n}/sales/status/lost/`);return(0,r.f)(s.toString(),t)},d=async(e,t)=>{const s=new Headers,r=localStorage.getItem("access_token");s.append("Authorization",`Bearer ${r}`),s.append("Content-Type","application/json");const o={method:"POST",headers:s,body:JSON.stringify(t),redirect:"follow"};try{const t=await fetch(`${n}/sales/${e}/contacts/`,o);return t.ok?t:(console.log("Error:",t.status),null)}catch(a){return console.log("Error:",a),null}},h=async(e,t)=>{const s=new Headers,r=localStorage.getItem("access_token");s.append("Authorization",`Bearer ${r}`),s.append("Content-Type","application/json");const o={method:"PUT",headers:s,body:JSON.stringify({lead:t,unique_id:e}),redirect:"follow"};try{const t=await fetch(`${n}/sales/${e}/lead/`,o);if(!t.ok){const e=await t.text();throw new Error(`Sales lead update failed with status ${t.status}: ${e}`)}const s=await t.text();return s.trim()?JSON.parse(s):null}catch(a){throw console.error("Sales lead update error:",a),a}},u=async e=>{const t=new Headers,s=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${s}`),t.append("Content-Type","application/json");const r={method:"PUT",headers:t,body:JSON.stringify({ids:e}),redirect:"follow"},o=await Promise.all([fetch(`${n}/sales/status/won/`,r)]);return await Promise.all(o.map((e=>e.json())))},p=async e=>{const t=new Headers,s=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${s}`),t.append("Content-Type","application/json");const r={method:"POST",headers:t,redirect:"follow"},o=await fetch(`${n}/sales/${e}/duplicate/`,r);return(await o.json())[0]},m=async e=>{const t=new Headers,s=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${s}`),t.append("Content-Type","application/json");const r={method:"PUT",headers:t,body:JSON.stringify({ids:e}),redirect:"follow"},o=await Promise.all([fetch(`${n}/sales/status/lost/`,r)]);return await Promise.all(o.map((e=>e.json())))}}}]);
//# sourceMappingURL=8273.4c07a4b5.chunk.js.map