"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[5547],{59638:(e,t,a)=>{a.d(t,{EZ:()=>o,F1:()=>f,Fl:()=>m,OF:()=>r,QK:()=>g,Ql:()=>i,X6:()=>c,Ye:()=>v,ab:()=>b,i6:()=>u,kB:()=>w,nP:()=>d,o6:()=>p,oO:()=>n,oo:()=>h,zZ:()=>x});var s=a(31342);const l="https://dev.memate.com.au/api/v1",n=async e=>{const t=new URL(`${l}${`/clients/restore/${e}/`}`);return(0,s.f)(t.toString(),{method:"POST"})},o=async e=>{const t=new URL(`${l}${`/clients/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},i=async()=>{const e=new URL(`${l}/references/clients/categories/`);return(0,s.f)(e.toString(),{method:"GET"})},r=async()=>{const e=new URL(`${l}/references/clients/industries/`);return(0,s.f)(e.toString(),{method:"GET"})},c=async()=>{const e=new URL(`${l}/references/countries/`);return(0,s.f)(e.toString(),{method:"GET"},!1)},d=async e=>{const t=new URL(`${l}${`/references/states/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"},!1)},u=async e=>{const t=new URL(`${l}${`/references/cities/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"},!1)},m=async()=>{const e=new URL(`${l}/references/desktop-users/`);return(0,s.f)(e.toString(),{method:"GET"})},h=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4?arguments[4]:void 0;const i=(e-1)*t,r=new URL(`${l}/clients/`);return r.searchParams.append("limit",t),r.searchParams.append("offset",i),a&&r.searchParams.append("name",a),n&&r.searchParams.append("ordering",n),o&&r.searchParams.append("deleted",1),(0,s.f)(r.toString(),{method:"GET"})},p=async function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";const i=(t-1)*a,r=new URL(`${l}${`/clients/${e}/orders/`}`);return r.searchParams.append("limit",a),r.searchParams.append("offset",i),n&&r.searchParams.append("number",n),o&&r.searchParams.append("ordering",o),(0,s.f)(r.toString(),{method:"GET"})},g=async e=>{const t=new URL(`${l}${`/clients/address/${e}/main`}`);return(0,s.f)(t.toString(),{method:"PUT"})},v=async e=>{const t=new URL(`${l}${`/clients/contact-persons/${e}/main`}`);return(0,s.f)(t.toString(),{method:"PUT"})},x=async e=>{const t=new URL(`${l}${`/clients/delete/${e}/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},f=async e=>{const t=new URL(`${l}${`/clients/contact-persons/${e}/delete/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},b=async e=>{const t=new URL(`${l}${`/clients/address/${e}/delete/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},w=async e=>{const t={method:"PUT",body:{unique_id:e}},a=new URL(`${l}/projects/back/`);return(0,s.f)(a.toString(),t)}},67046:(e,t,a)=>{a.d(t,{CK:()=>h,D7:()=>n,HT:()=>p,Op:()=>c,V3:()=>u,WG:()=>r,cS:()=>i,fW:()=>m,j3:()=>o,oe:()=>d});var s=a(31342);const l="https://dev.memate.com.au/api/v1",n=async e=>{const t={method:"POST",body:e},a=new URL(`${l}/sales/new-request/`);return(0,s.f)(a.toString(),t)},o=async()=>{const e=new Headers,t=localStorage.getItem("access_token");e.append("Authorization",`Bearer ${t}`);const a={method:"GET",headers:e,redirect:"follow"};try{const e=await fetch(`${l}/sales/`,a);return await e.text()}catch(s){throw console.error("Profile fetch error:",s),s}},i=async(e,t)=>{const a=new Headers,s=localStorage.getItem("access_token");a.append("Authorization",`Bearer ${s}`),a.append("Content-Type","application/json");const n={method:"PUT",headers:a,body:JSON.stringify({sales_note:t}),redirect:"follow"};try{const t=await fetch(`${l}/sales/${e}/notes/`,n);if(!t.ok){const e=await t.text();throw new Error(`Sales notes update failed with status ${t.status}: ${e}`)}const a=await t.text();return a.trim()?JSON.parse(a):null}catch(o){throw console.error("Sales notes update error:",o),o}},r=async e=>{const t={method:"PUT",body:{ids:e}},a=new URL(`${l}/sales/status/won/`);return(0,s.f)(a.toString(),t)},c=async e=>{const t={method:"PUT",body:{ids:e}},a=new URL(`${l}/sales/status/lost/`);return(0,s.f)(a.toString(),t)},d=async(e,t)=>{const a=new Headers,s=localStorage.getItem("access_token");a.append("Authorization",`Bearer ${s}`),a.append("Content-Type","application/json");const n={method:"POST",headers:a,body:JSON.stringify(t),redirect:"follow"};try{const t=await fetch(`${l}/sales/${e}/contacts/`,n);return t.ok?t:(console.log("Error:",t.status),null)}catch(o){return console.log("Error:",o),null}},u=async(e,t)=>{const a=new Headers,s=localStorage.getItem("access_token");a.append("Authorization",`Bearer ${s}`),a.append("Content-Type","application/json");const n={method:"PUT",headers:a,body:JSON.stringify({lead:t,unique_id:e}),redirect:"follow"};try{const t=await fetch(`${l}/sales/${e}/lead/`,n);if(!t.ok){const e=await t.text();throw new Error(`Sales lead update failed with status ${t.status}: ${e}`)}const a=await t.text();return a.trim()?JSON.parse(a):null}catch(o){throw console.error("Sales lead update error:",o),o}},m=async e=>{const t=new Headers,a=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${a}`),t.append("Content-Type","application/json");const s={method:"PUT",headers:t,body:JSON.stringify({ids:e}),redirect:"follow"},n=await Promise.all([fetch(`${l}/sales/status/won/`,s)]);return await Promise.all(n.map((e=>e.json())))},h=async e=>{const t=new Headers,a=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${a}`),t.append("Content-Type","application/json");const s={method:"POST",headers:t,redirect:"follow"},n=await fetch(`${l}/sales/${e}/duplicate/`,s);return(await n.json())[0]},p=async e=>{const t=new Headers,a=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${a}`),t.append("Content-Type","application/json");const s={method:"PUT",headers:t,body:JSON.stringify({ids:e}),redirect:"follow"},n=await Promise.all([fetch(`${l}/sales/status/lost/`,s)]);return await Promise.all(n.map((e=>e.json())))}},14834:(e,t,a)=>{function s(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=parseFloat(e);return isNaN(a)?"0.00":t&&Math.abs(a)>=1e3?new Intl.NumberFormat("en-AU",{notation:"compact",compactDisplay:"short",minimumFractionDigits:2,maximumFractionDigits:2}).format(a):new Intl.NumberFormat("en-AU",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a)}a.d(t,{m:()=>s})},81242:(e,t,a)=>{a.d(t,{A:()=>y});var s=a(65043),l=a(61424),n=a(61072),o=a(78602),i=a(14282),r=a(93747),c=a(58387),d=a(75758),u=a(8129),m=a(8868),h=a(28676),p=a(74532),g=a(72052),v=a(93740);const x={headerTitle:"send-email_headerTitle__50KUB",customLabel:"send-email_customLabel__r5xED",bag:"send-email_bag__wtdwK",lable:"send-email_lable__+kNCa",dropdownSelect:"send-email_dropdownSelect__RY5w8",autoCompleteBox:"send-email_autoCompleteBox__fWZ7C",AutoComplete:"send-email_AutoComplete__m9YI5",bcc:"send-email_bcc__BwFzl",box:"send-email_box__Zlmer",active:"send-email_active__vEx4h",inputBox:"send-email_inputBox__NpU2b"};var f=a(81047),b=a(70579);const w=(0,b.jsxs)("span",{className:"ql-formats",children:[(0,b.jsx)("button",{className:"ql-bold","aria-label":"Bold"}),(0,b.jsx)("button",{className:"ql-italic","aria-label":"Italic"}),(0,b.jsx)("button",{className:"ql-underline","aria-label":"Underline"}),(0,b.jsx)("button",{className:"ql-strike","aria-label":"Strikethrough"}),(0,b.jsx)("button",{className:"ql-blockquote","aria-label":"Blockquote"}),(0,b.jsx)("button",{className:"ql-list",value:"ordered","aria-label":"Ordered List"}),(0,b.jsx)("button",{className:"ql-list",value:"bullet","aria-label":"Bullet List"}),(0,b.jsx)("button",{className:"ql-align",value:"","aria-label":"Align Left"}),(0,b.jsx)("button",{className:"ql-align",value:"center","aria-label":"Align Center"}),(0,b.jsx)("button",{className:"ql-align",value:"right","aria-label":"Align Right"}),(0,b.jsx)("button",{className:"ql-align",value:"justify","aria-label":"Justify"}),(0,b.jsx)("button",{className:"ql-link","aria-label":"Insert Link"}),(0,b.jsx)("button",{className:"ql-image","aria-label":"Insert Image"}),(0,b.jsx)("button",{className:"ql-code-block","aria-label":"Code Block"})]}),y=e=>{var t,a,y,j;let{show:S,setShow:N,mutation:$,contactPersons:_,setPayload:C,defaultTemplateId:A}=e;const[T,L]=(0,s.useState)(""),[U,k]=(0,s.useState)([]),[E,P]=(0,s.useState)([]),[q,B]=(0,s.useState)([]),[R,F]=(0,s.useState)(null),[O,I]=(0,s.useState)(null),[z,H]=(0,s.useState)({}),[G,K]=(0,s.useState)([]),D=(0,s.useRef)(null),J=(0,s.useRef)(null),M=(0,s.useRef)(null),[Q,Z]=(0,s.useState)(!1),[W,Y]=(0,s.useState)(!1),[V,X]=(0,s.useState)(null),ee=()=>{N(!1),A||(L([]),k([]),P([]),B([]),F([]),I([]),X(null))},te=(0,r.I)({queryKey:["emailTemplate"],queryFn:f.SQ,enabled:!!S}),ae=(0,r.I)({queryKey:["getOutgoingEmail"],queryFn:f.hx,enabled:!!S}),se=(0,r.I)({queryKey:["emailQuery",V],queryFn:()=>(0,f.hS)(V),enabled:!!V,retry:1});(0,s.useEffect)((()=>{var e,t,a;null!==ae&&void 0!==ae&&ae.data&&(null!==ae&&void 0!==ae&&null!==(e=ae.data)&&void 0!==e&&e.outgoing_email&&null!==ae&&void 0!==ae&&null!==(t=ae.data)&&void 0!==t&&t.outgoing_email_verified?L(null===ae||void 0===ae||null===(a=ae.data)||void 0===a?void 0:a.outgoing_email):L("no-reply@memate.com.au"));if(!V&&null!==te&&void 0!==te&&te.data&&A){var s;const e=null===te||void 0===te||null===(s=te.data)||void 0===s?void 0:s.find((e=>e.type===A));e&&X(null===e||void 0===e?void 0:e.id)}}),[se,ae]);const le=e=>{var t;const a=(null===e||void 0===e||null===(t=e.query)||void 0===t?void 0:t.toLowerCase())||"";let s=_.map((e=>e.email));s=s.filter((e=>!U.includes(e))),s=s.filter((e=>!E.includes(e))),s=s.filter((e=>!q.includes(e))),s=s.filter((e=>e.toLowerCase().includes(a))),K(s)},ne=()=>{le(),D.current&&D.current.show()},oe=()=>{le(),J.current&&J.current.show()},ie=()=>{le(),M.current&&M.current.show()};return(0,s.useEffect)((()=>{if(null!==_&&void 0!==_&&_.length){let e=_.map((e=>e.email));K(e)}}),[_]),(0,s.useEffect)((()=>{C((e=>({...e,subject:R,email_body:O,from_email:T,to:null===U||void 0===U?void 0:U.toString(),...E.length>0&&{cc:E.toString()},...q.length>0&&{bcc:q.toString()}})))}),[R,O,T,U,E,q]),(0,s.useEffect)((()=>{var e,t;I((null===se||void 0===se||null===(e=se.data)||void 0===e?void 0:e.body)||""),F(null===se||void 0===se||null===(t=se.data)||void 0===t?void 0:t.subject),H((e=>({...e,subject:!1}))),H((e=>({...e,text:!1})))}),[null===se||void 0===se||null===(t=se.data)||void 0===t?void 0:t.body]),(0,b.jsxs)(l.A,{show:S,centered:!0,onHide:ee,className:"invoice-form",size:"lg",children:[(0,b.jsx)(l.A.Header,{closeButton:!0,children:(0,b.jsx)("div",{className:`${x.modalHeader}`,children:(0,b.jsx)("div",{className:"w-100 d-flex align-items-center gap-2",children:(0,b.jsx)("span",{className:`white-space-nowrap mt-2 mb-2 ${x.headerTitle}`,children:"Send email"})})})}),(0,b.jsxs)(l.A.Body,{children:[(0,b.jsxs)(n.A,{children:[(0,b.jsxs)(o.A,{sm:6,className:"mb-3",children:[(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)("label",{className:(0,c.A)(x.customLabel),children:"FROM"}),(0,b.jsx)(u.m,{options:ae&&(null===ae||void 0===ae?void 0:ae.data)&&[{value:null===ae||void 0===ae||null===(a=ae.data)||void 0===a?void 0:a.outgoing_email,label:`${null===ae||void 0===ae||null===(y=ae.data)||void 0===y?void 0:y.outgoing_email}`}]||[],className:(0,c.A)(x.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"60px"},placeholder:"Select from email",onChange:e=>{L(e.value),H((e=>({...e,from:!1})))},value:T})]}),(null===z||void 0===z?void 0:z.from)&&(0,b.jsx)("p",{className:"error-message mb-0",children:"From email is required"})]}),(0,b.jsx)(o.A,{sm:6,className:"mb-3",children:(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)("label",{className:(0,c.A)(x.customLabel),children:"Templates"}),(0,b.jsx)(u.m,{options:te&&(null===(j=te.data)||void 0===j?void 0:j.map((e=>({value:e.id,label:`${e.name}`}))))||[],className:(0,c.A)(x.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select template",onChange:e=>{X(e.value)},value:V,loading:null===te||void 0===te?void 0:te.isFetching})]})})]}),(0,b.jsxs)(n.A,{children:[(0,b.jsxs)(o.A,{sm:12,className:"mb-3",children:[(0,b.jsxs)("div",{className:"d-flex gap-3 w-100",children:[(0,b.jsxs)("div",{style:{position:"relative"},className:x.autoCompleteBox,children:[(0,b.jsx)("div",{style:{width:"50px"},className:x.bag}),(0,b.jsx)("label",{className:(0,c.A)(x.customLabel),children:"TO"}),(0,b.jsx)(d.j,{ref:D,value:U,completeMethod:le,onChange:e=>{k(e.value),H((e=>({...e,to:!1})))},multiple:!0,suggestions:G,onClick:ne,onFocus:ne,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const a=t.split(/[\s,]+/).filter((e=>e));k((e=>[...new Set([...e,...a])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(k((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,c.A)(x.AutoComplete,"w-100"),placeholder:"TO"})]}),(0,b.jsx)(i.A,{className:(0,c.A)(x.box,{[x.active]:Q}),onClick:()=>{Z(!Q),P([])},children:"CC"}),(0,b.jsx)(i.A,{className:(0,c.A)(x.box,{[x.active]:W}),onClick:()=>{Y(!W),B([])},children:"BCC"})]}),(null===z||void 0===z?void 0:z.to)&&(0,b.jsx)("p",{className:"error-message mb-0",children:"To email is required"})]}),Q&&(0,b.jsx)(o.A,{sm:6,className:"mb-3",children:(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)("div",{style:{width:"50px"},className:x.bag}),(0,b.jsx)("label",{className:(0,c.A)(x.customLabel),children:"CC"}),(0,b.jsx)(d.j,{ref:J,value:E,completeMethod:le,onChange:e=>{P(e.value)},multiple:!0,suggestions:G,onClick:oe,onFocus:oe,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const a=t.split(/[\s,]+/).filter((e=>e));P((e=>[...new Set([...e,...a])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(P((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,c.A)(x.AutoComplete,"w-100"),placeholder:"CC"})]})}),W&&(0,b.jsx)(o.A,{sm:6,className:"mb-3",children:(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)("div",{style:{width:"60px"},className:x.bag}),(0,b.jsx)("label",{className:(0,c.A)(x.customLabel),children:"BCC"}),(0,b.jsx)(d.j,{ref:M,value:q,completeMethod:le,onChange:e=>{B(e.value)},multiple:!0,suggestions:G,onClick:ie,onFocus:ie,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const a=t.split(/[\s,]+/).filter((e=>e));B((e=>[...new Set([...e,...a])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(B((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,c.A)(x.AutoComplete,x.bcc,"w-100"),placeholder:"BCC"})]})}),(0,b.jsxs)(o.A,{sm:12,className:"mb-2",children:[(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)("div",{style:{width:"60px"},className:x.bag}),(0,b.jsx)("label",{className:(0,c.A)(x.customLabel),children:"SUBJECT"}),(0,b.jsxs)(h.C,{children:[(0,b.jsx)(p.m,{children:(null===se||void 0===se?void 0:se.isFetching)&&(0,b.jsx)(v.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,b.jsx)(g.S,{value:R,className:(0,c.A)(x.inputBox,"w-100"),style:{paddingLeft:"100px"},onChange:e=>{F(e.target.value),H((e=>({...e,subject:!1})))},placeholder:"{Organization} | Quotation: {number} | {reference}"})]})]}),(null===z||void 0===z?void 0:z.subject)&&(0,b.jsx)("p",{className:"error-message mb-0",children:"Subject is required"})]}),(0,b.jsxs)(o.A,{sm:12,children:[(0,b.jsxs)("div",{className:"d-flex flex-column gap-1",style:{position:"relative"},children:[(0,b.jsx)("label",{className:(0,c.A)(x.lable),children:"Message"}),(0,b.jsx)(p.m,{style:{position:"absolute",right:"15px",top:"40px",zIndex:1},children:(null===se||void 0===se?void 0:se.isFetching)&&(0,b.jsx)(v.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,b.jsx)(m.K,{style:{minHeight:"150px"},headerTemplate:w,value:O,placeholder:"Enter a description...",onTextChange:e=>{I(e.htmlValue),H((e=>({...e,text:!1})))}})]}),(null===z||void 0===z?void 0:z.text)&&(0,b.jsx)("p",{className:"error-message mb-0",children:"Message is required"})]})]})]}),(0,b.jsxs)(l.A.Footer,{className:"d-flex justify-content-between",children:[(0,b.jsx)("span",{}),(0,b.jsxs)("div",{className:"d-flex justify-content-end gap-2",children:[(0,b.jsxs)(i.A,{className:"outline-button",onClick:ee,children:["Cancel"," "]}),(0,b.jsxs)(i.A,{disabled:null===$||void 0===$?void 0:$.isPending,className:"solid-button",onClick:async()=>{let e=0;H({}),T||(++e,H((e=>({...e,from:!0})))),0===(null===U||void 0===U?void 0:U.length)&&(++e,H((e=>({...e,to:!0})))),R||(++e,H((e=>({...e,subject:!0})))),O||(++e,H((e=>({...e,text:!0})))),e||$.mutate({subject:R,email_body:O,from_email:T,to:null===U||void 0===U?void 0:U.toString(),...E.length>0&&{cc:E.toString()},...q.length>0&&{bcc:q.toString()}})},children:["Send"," ",(null===$||void 0===$?void 0:$.isPending)&&(0,b.jsx)(v.p,{style:{width:"20px",height:"20px",color:"#fff"}})]})]})]})]})}}}]);
//# sourceMappingURL=5547.ff611523.chunk.js.map