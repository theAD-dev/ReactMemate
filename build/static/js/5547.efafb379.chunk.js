"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[5547],{14834:(e,t,a)=>{function s(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=parseFloat(e);return isNaN(a)?"0.00":t&&Math.abs(a)>=1e3?new Intl.NumberFormat("en-AU",{notation:"compact",compactDisplay:"short",minimumFractionDigits:2,maximumFractionDigits:2}).format(a):new Intl.NumberFormat("en-AU",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a)}a.d(t,{m:()=>s})},59638:(e,t,a)=>{a.d(t,{EZ:()=>o,F1:()=>f,Fl:()=>m,OF:()=>r,QK:()=>g,Ql:()=>i,X6:()=>c,Ye:()=>v,ab:()=>b,i6:()=>u,kB:()=>w,nP:()=>d,o6:()=>h,oO:()=>n,oo:()=>p,zZ:()=>x});var s=a(31342);const l="https://app.memate.com.au/api/v1",n=async e=>{const t=new URL(`${l}${`/clients/restore/${e}/`}`);return(0,s.f)(t.toString(),{method:"POST"})},o=async e=>{const t=new URL(`${l}${`/clients/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"})},i=async()=>{const e=new URL(`${l}/references/clients/categories/`);return(0,s.f)(e.toString(),{method:"GET"})},r=async()=>{const e=new URL(`${l}/references/clients/industries/`);return(0,s.f)(e.toString(),{method:"GET"})},c=async()=>{const e=new URL(`${l}/references/countries/`);return(0,s.f)(e.toString(),{method:"GET"},!1)},d=async e=>{const t=new URL(`${l}${`/references/states/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"},!1)},u=async e=>{const t=new URL(`${l}${`/references/cities/${e}/`}`);return(0,s.f)(t.toString(),{method:"GET"},!1)},m=async()=>{const e=new URL(`${l}/references/desktop-users/`);return(0,s.f)(e.toString(),{method:"GET"})},p=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4?arguments[4]:void 0;const i=(e-1)*t,r=new URL(`${l}/clients/`);return r.searchParams.append("limit",t),r.searchParams.append("offset",i),a&&r.searchParams.append("name",a),n&&r.searchParams.append("ordering",n),o&&r.searchParams.append("deleted",1),(0,s.f)(r.toString(),{method:"GET"})},h=async function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";const i=(t-1)*a,r=new URL(`${l}${`/clients/${e}/orders/`}`);return r.searchParams.append("limit",a),r.searchParams.append("offset",i),n&&r.searchParams.append("number",n),o&&r.searchParams.append("ordering",o),(0,s.f)(r.toString(),{method:"GET"})},g=async e=>{const t=new URL(`${l}${`/clients/address/${e}/main`}`);return(0,s.f)(t.toString(),{method:"PUT"})},v=async e=>{const t=new URL(`${l}${`/clients/contact-persons/${e}/main`}`);return(0,s.f)(t.toString(),{method:"PUT"})},x=async e=>{const t=new URL(`${l}${`/clients/delete/${e}/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},f=async e=>{const t=new URL(`${l}${`/clients/contact-persons/${e}/delete/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},b=async e=>{const t=new URL(`${l}${`/clients/address/${e}/delete/`}`);return(0,s.f)(t.toString(),{method:"DELETE"})},w=async e=>{const t={method:"PUT",body:{unique_id:e}},a=new URL(`${l}/projects/back/`);return(0,s.f)(a.toString(),t)}},67046:(e,t,a)=>{a.d(t,{CK:()=>p,D7:()=>n,HT:()=>h,Op:()=>c,V3:()=>u,WG:()=>r,cS:()=>i,fW:()=>m,j3:()=>o,oe:()=>d});var s=a(31342);const l="https://app.memate.com.au/api/v1",n=async e=>{const t={method:"POST",body:e},a=new URL(`${l}/sales/new-request/`);return(0,s.f)(a.toString(),t)},o=async()=>{const e=new Headers,t=localStorage.getItem("access_token");e.append("Authorization",`Bearer ${t}`);const a={method:"GET",headers:e,redirect:"follow"};try{const e=await fetch(`${l}/sales/`,a);return await e.text()}catch(s){throw console.error("Profile fetch error:",s),s}},i=async(e,t)=>{const a=new Headers,s=localStorage.getItem("access_token");a.append("Authorization",`Bearer ${s}`),a.append("Content-Type","application/json");const n={method:"PUT",headers:a,body:JSON.stringify({sales_note:t}),redirect:"follow"};try{const t=await fetch(`${l}/sales/${e}/notes/`,n);if(!t.ok){const e=await t.text();throw new Error(`Sales notes update failed with status ${t.status}: ${e}`)}const a=await t.text();return a.trim()?JSON.parse(a):null}catch(o){throw console.error("Sales notes update error:",o),o}},r=async e=>{const t={method:"PUT",body:{ids:e}},a=new URL(`${l}/sales/status/won/`);return(0,s.f)(a.toString(),t)},c=async e=>{const t={method:"PUT",body:{ids:e}},a=new URL(`${l}/sales/status/lost/`);return(0,s.f)(a.toString(),t)},d=async(e,t)=>{const a=new Headers,s=localStorage.getItem("access_token");a.append("Authorization",`Bearer ${s}`),a.append("Content-Type","application/json");const n={method:"POST",headers:a,body:JSON.stringify(t),redirect:"follow"};try{const t=await fetch(`${l}/sales/${e}/contacts/`,n);return t.ok?t:(console.log("Error:",t.status),null)}catch(o){return console.log("Error:",o),null}},u=async(e,t)=>{const a=new Headers,s=localStorage.getItem("access_token");a.append("Authorization",`Bearer ${s}`),a.append("Content-Type","application/json");const n={method:"PUT",headers:a,body:JSON.stringify({lead:t,unique_id:e}),redirect:"follow"};try{const t=await fetch(`${l}/sales/${e}/lead/`,n);if(!t.ok){const e=await t.text();throw new Error(`Sales lead update failed with status ${t.status}: ${e}`)}const a=await t.text();return a.trim()?JSON.parse(a):null}catch(o){throw console.error("Sales lead update error:",o),o}},m=async e=>{const t=new Headers,a=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${a}`),t.append("Content-Type","application/json");const s={method:"PUT",headers:t,body:JSON.stringify({ids:e}),redirect:"follow"},n=await Promise.all([fetch(`${l}/sales/status/won/`,s)]);return await Promise.all(n.map((e=>e.json())))},p=async e=>{const t=new Headers,a=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${a}`),t.append("Content-Type","application/json");const s={method:"POST",headers:t,redirect:"follow"},n=await fetch(`${l}/sales/${e}/duplicate/`,s);return(await n.json())[0]},h=async e=>{const t=new Headers,a=localStorage.getItem("access_token");t.append("Authorization",`Bearer ${a}`),t.append("Content-Type","application/json");const s={method:"PUT",headers:t,body:JSON.stringify({ids:e}),redirect:"follow"},n=await Promise.all([fetch(`${l}/sales/status/lost/`,s)]);return await Promise.all(n.map((e=>e.json())))}},81242:(e,t,a)=>{a.d(t,{A:()=>y});var s=a(65043),l=a(32952),n=a(61072),o=a(78602),i=a(14282),r=a(93747),c=a(58387),d=a(75758),u=a(8129),m=a(8868),p=a(28676),h=a(74532),g=a(72052),v=a(93740);const x={headerTitle:"send-email_headerTitle__50KUB",customLabel:"send-email_customLabel__r5xED",bag:"send-email_bag__wtdwK",lable:"send-email_lable__+kNCa",dropdownSelect:"send-email_dropdownSelect__RY5w8",autoCompleteBox:"send-email_autoCompleteBox__fWZ7C",AutoComplete:"send-email_AutoComplete__m9YI5",bcc:"send-email_bcc__BwFzl",box:"send-email_box__Zlmer",active:"send-email_active__vEx4h",inputBox:"send-email_inputBox__NpU2b"};var f=a(81047),b=a(70579);const w=(0,b.jsxs)("span",{className:"ql-formats",children:[(0,b.jsx)("button",{className:"ql-bold","aria-label":"Bold"}),(0,b.jsx)("button",{className:"ql-italic","aria-label":"Italic"}),(0,b.jsx)("button",{className:"ql-underline","aria-label":"Underline"}),(0,b.jsx)("button",{className:"ql-strike","aria-label":"Strikethrough"}),(0,b.jsx)("button",{className:"ql-blockquote","aria-label":"Blockquote"}),(0,b.jsx)("button",{className:"ql-list",value:"ordered","aria-label":"Ordered List"}),(0,b.jsx)("button",{className:"ql-list",value:"bullet","aria-label":"Bullet List"}),(0,b.jsx)("button",{className:"ql-align",value:"","aria-label":"Align Left"}),(0,b.jsx)("button",{className:"ql-align",value:"center","aria-label":"Align Center"}),(0,b.jsx)("button",{className:"ql-align",value:"right","aria-label":"Align Right"}),(0,b.jsx)("button",{className:"ql-align",value:"justify","aria-label":"Justify"}),(0,b.jsx)("button",{className:"ql-link","aria-label":"Insert Link"}),(0,b.jsx)("button",{className:"ql-image","aria-label":"Insert Image"}),(0,b.jsx)("button",{className:"ql-code-block","aria-label":"Code Block"})]}),y=e=>{var t,a,y,j;let{show:S,setShow:N,mutation:$,contactPersons:_,setPayload:A,defaultTemplateId:C}=e;const T=JSON.parse(window.localStorage.getItem("profileData")||"{}"),[L,E]=(0,s.useState)(""),[U,k]=(0,s.useState)([]),[q,P]=(0,s.useState)([]),[B,F]=(0,s.useState)([]),[R,O]=(0,s.useState)(null),[I,z]=(0,s.useState)(null),[H,K]=(0,s.useState)(null),[D,G]=(0,s.useState)({}),[J,M]=(0,s.useState)([]),Q=(0,s.useRef)(null),Z=(0,s.useRef)(null),W=(0,s.useRef)(null),[Y,V]=(0,s.useState)(!1),[X,ee]=(0,s.useState)(!1),[te,ae]=(0,s.useState)(null),se=()=>{N(!1),C||(E([]),k([]),P([]),F([]),O([]),z([]),ae(null))},le=(0,r.I)({queryKey:["emailTemplate"],queryFn:f.SQ,enabled:!!S}),ne=(0,r.I)({queryKey:["getSignatureTemplates"],queryFn:f.AO,enabled:!!S}),oe=(0,r.I)({queryKey:["getOutgoingEmail"],queryFn:f.hx,enabled:!!S}),ie=(0,r.I)({queryKey:["emailQuery",te],queryFn:()=>(0,f.hS)(te),enabled:!!te,retry:1});(0,s.useEffect)((()=>{var e,t,a;null!==oe&&void 0!==oe&&oe.data&&(null!==oe&&void 0!==oe&&null!==(e=oe.data)&&void 0!==e&&e.outgoing_email&&null!==oe&&void 0!==oe&&null!==(t=oe.data)&&void 0!==t&&t.outgoing_email_verified?E(null===oe||void 0===oe||null===(a=oe.data)||void 0===a?void 0:a.outgoing_email):E("no-reply@memate.com.au"));if(!te&&null!==le&&void 0!==le&&le.data&&C){var s;const e=null===le||void 0===le||null===(s=le.data)||void 0===s?void 0:s.find((e=>e.type===C));e&&ae(null===e||void 0===e?void 0:e.id)}}),[le,oe]);const re=e=>{var t;const a=(null===e||void 0===e||null===(t=e.query)||void 0===t?void 0:t.toLowerCase())||"";let s=_.map((e=>e.email));s=s.filter((e=>!U.includes(e))),s=s.filter((e=>!q.includes(e))),s=s.filter((e=>!B.includes(e))),s=s.filter((e=>e.toLowerCase().includes(a))),M(s)},ce=()=>{re(),Q.current&&Q.current.show()},de=()=>{re(),Z.current&&Z.current.show()},ue=()=>{re(),W.current&&W.current.show()};return(0,s.useEffect)((()=>{if(null!==_&&void 0!==_&&_.length){let e=_.map((e=>e.email));M(e)}}),[_]),(0,s.useEffect)((()=>{A((e=>({...e,subject:R,email_body:I,from_email:L,to:null===U||void 0===U?void 0:U.toString(),...q.length>0&&{cc:q.toString()},...B.length>0&&{bcc:B.toString()},...H&&{signature:H}})))}),[R,I,L,U,q,B,H,A]),(0,s.useEffect)((()=>{var e,t;null!==ne&&void 0!==ne&&ne.data&&K(null===ne||void 0===ne||null===(e=ne.data)||void 0===e||null===(t=e.find((e=>e.id===T.email_signature)))||void 0===t?void 0:t.id)}),[null===ne||void 0===ne?void 0:ne.data,T.email_signature]),(0,s.useEffect)((()=>{var e,t;z((null===ie||void 0===ie||null===(e=ie.data)||void 0===e?void 0:e.body)||""),O(null===ie||void 0===ie||null===(t=ie.data)||void 0===t?void 0:t.subject),G((e=>({...e,subject:!1}))),G((e=>({...e,text:!1})))}),[null===ie||void 0===ie?void 0:ie.data]),(0,b.jsxs)(l.A,{show:S,centered:!0,onHide:se,className:"invoice-form",size:"lg",children:[(0,b.jsx)(l.A.Header,{closeButton:!0,children:(0,b.jsx)("div",{className:`${x.modalHeader}`,children:(0,b.jsx)("div",{className:"w-100 d-flex align-items-center gap-2",children:(0,b.jsx)("span",{className:`white-space-nowrap mt-2 mb-2 ${x.headerTitle}`,children:"Send email"})})})}),(0,b.jsxs)(l.A.Body,{children:[(0,b.jsxs)(n.A,{children:[(0,b.jsxs)(o.A,{sm:6,className:"mb-3",children:[(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)("label",{className:(0,c.A)(x.customLabel),children:"FROM"}),(0,b.jsx)(u.m,{options:oe&&(null===oe||void 0===oe?void 0:oe.data)&&[{value:null===oe||void 0===oe||null===(t=oe.data)||void 0===t?void 0:t.outgoing_email,label:`${null===oe||void 0===oe||null===(a=oe.data)||void 0===a?void 0:a.outgoing_email}`}]||[],className:(0,c.A)(x.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"60px"},placeholder:"Select from email",onChange:e=>{E(e.value),G((e=>({...e,from:!1})))},value:L})]}),(null===D||void 0===D?void 0:D.from)&&(0,b.jsx)("p",{className:"error-message mb-0",children:"From email is required"})]}),(0,b.jsx)(o.A,{sm:6,className:"mb-3",children:(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)("label",{className:(0,c.A)(x.customLabel),children:"Templates"}),(0,b.jsx)(u.m,{options:le&&(null===(y=le.data)||void 0===y?void 0:y.map((e=>({value:e.id,label:`${e.name}`}))))||[],className:(0,c.A)(x.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select template",onChange:e=>{ae(e.value)},value:te,loading:null===le||void 0===le?void 0:le.isFetching})]})})]}),(0,b.jsxs)(n.A,{children:[(0,b.jsxs)(o.A,{sm:12,className:"mb-3",children:[(0,b.jsxs)("div",{className:"d-flex gap-3 w-100",children:[(0,b.jsxs)("div",{style:{position:"relative"},className:x.autoCompleteBox,children:[(0,b.jsx)("div",{style:{width:"50px"},className:x.bag}),(0,b.jsx)("label",{className:(0,c.A)(x.customLabel),children:"TO"}),(0,b.jsx)(d.j,{ref:Q,value:U,completeMethod:re,onChange:e=>{k(e.value),G((e=>({...e,to:!1})))},multiple:!0,suggestions:J,onClick:ce,onFocus:ce,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const a=t.split(/[\s,]+/).filter((e=>e));k((e=>[...new Set([...e,...a])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(k((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,c.A)(x.AutoComplete,"w-100"),placeholder:"TO"})]}),(0,b.jsx)(i.A,{className:(0,c.A)(x.box,{[x.active]:Y}),onClick:()=>{V(!Y),P([])},children:"CC"}),(0,b.jsx)(i.A,{className:(0,c.A)(x.box,{[x.active]:X}),onClick:()=>{ee(!X),F([])},children:"BCC"})]}),(null===D||void 0===D?void 0:D.to)&&(0,b.jsx)("p",{className:"error-message mb-0",children:"To email is required"})]}),Y&&(0,b.jsx)(o.A,{sm:6,className:"mb-3",children:(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)("div",{style:{width:"50px"},className:x.bag}),(0,b.jsx)("label",{className:(0,c.A)(x.customLabel),children:"CC"}),(0,b.jsx)(d.j,{ref:Z,value:q,completeMethod:re,onChange:e=>{P(e.value)},multiple:!0,suggestions:J,onClick:de,onFocus:de,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const a=t.split(/[\s,]+/).filter((e=>e));P((e=>[...new Set([...e,...a])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(P((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,c.A)(x.AutoComplete,"w-100"),placeholder:"CC"})]})}),X&&(0,b.jsx)(o.A,{sm:6,className:"mb-3",children:(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)("div",{style:{width:"60px"},className:x.bag}),(0,b.jsx)("label",{className:(0,c.A)(x.customLabel),children:"BCC"}),(0,b.jsx)(d.j,{ref:W,value:B,completeMethod:re,onChange:e=>{F(e.value)},multiple:!0,suggestions:J,onClick:ue,onFocus:ue,onKeyUp:e=>{const t=e.target.value;if(t.includes(",")||"Enter"===e.key){const a=t.split(/[\s,]+/).filter((e=>e));F((e=>[...new Set([...e,...a])])),e.target.value=""}},onBlur:e=>{const t=e.target.value.trim();t&&(F((e=>[...new Set([...e,t])])),e.target.value="")},className:(0,c.A)(x.AutoComplete,x.bcc,"w-100"),placeholder:"BCC"})]})}),(0,b.jsxs)(o.A,{sm:12,className:"mb-2",children:[(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)("div",{style:{width:"60px"},className:x.bag}),(0,b.jsx)("label",{className:(0,c.A)(x.customLabel),children:"SUBJECT"}),(0,b.jsxs)(p.C,{children:[(0,b.jsx)(h.m,{children:(null===ie||void 0===ie?void 0:ie.isFetching)&&(0,b.jsx)(v.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,b.jsx)(g.S,{value:R,className:(0,c.A)(x.inputBox,"w-100"),style:{paddingLeft:"100px"},onChange:e=>{O(e.target.value),G((e=>({...e,subject:!1})))},placeholder:"{Organization} | Quotation: {number} | {reference}"})]})]}),(null===D||void 0===D?void 0:D.subject)&&(0,b.jsx)("p",{className:"error-message mb-0",children:"Subject is required"})]}),(0,b.jsxs)(o.A,{sm:12,className:"mb-3",children:[(0,b.jsxs)("div",{className:"d-flex flex-column gap-1",style:{position:"relative"},children:[(0,b.jsx)("label",{className:(0,c.A)(x.lable),children:"Message"}),(0,b.jsx)(h.m,{style:{position:"absolute",right:"15px",top:"40px",zIndex:1},children:(null===ie||void 0===ie?void 0:ie.isFetching)&&(0,b.jsx)(v.p,{style:{width:"20px",height:"20px",position:"relative",top:"-5px"}})}),(0,b.jsx)(m.K,{style:{minHeight:"150px"},headerTemplate:w,value:I,placeholder:"Enter a description...",onTextChange:e=>{z(e.htmlValue),G((e=>({...e,text:!1})))}})]}),(null===D||void 0===D?void 0:D.text)&&(0,b.jsx)("p",{className:"error-message mb-0",children:"Message is required"})]}),(0,b.jsx)(o.A,{sm:12,children:(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsx)("label",{className:(0,c.A)(x.customLabel),children:"Signature"}),(0,b.jsx)(u.m,{options:ne&&(null===(j=ne.data)||void 0===j?void 0:j.map((e=>({value:e.id,label:`${e.name}`}))))||[],panelClassName:"px880-dropdown-item",className:(0,c.A)(x.dropdownSelect,"dropdown-height-fixed w-100"),style:{height:"46px",paddingLeft:"88px"},placeholder:"Select signature",onChange:e=>{K(e.value)},value:H,loading:null===ne||void 0===ne?void 0:ne.isFetching})]})})]})]}),(0,b.jsxs)(l.A.Footer,{className:"d-flex justify-content-between",children:[(0,b.jsx)("span",{}),(0,b.jsxs)("div",{className:"d-flex justify-content-end gap-2",children:[(0,b.jsxs)(i.A,{className:"outline-button",onClick:se,children:["Cancel"," "]}),(0,b.jsxs)(i.A,{disabled:null===$||void 0===$?void 0:$.isPending,className:"solid-button",onClick:async()=>{let e=0;G({}),L||(++e,G((e=>({...e,from:!0})))),0===(null===U||void 0===U?void 0:U.length)&&(++e,G((e=>({...e,to:!0})))),R||(++e,G((e=>({...e,subject:!0})))),I||(++e,G((e=>({...e,text:!0})))),e||$.mutate({subject:R,email_body:I,from_email:L,to:null===U||void 0===U?void 0:U.toString(),...q.length>0&&{cc:q.toString()},...B.length>0&&{bcc:B.toString()},...H&&{signature:H}})},children:["Send"," ",(null===$||void 0===$?void 0:$.isPending)&&(0,b.jsx)(v.p,{style:{width:"20px",height:"20px",color:"#fff"}})]})]})]})]})}}}]);
//# sourceMappingURL=5547.efafb379.chunk.js.map