"use strict";(self.webpackChunkmemateapp=self.webpackChunkmemateapp||[]).push([[8564],{56080:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ne});var r=s(65043),l=s(75329),i=s(38294),n=s(49367),a=s(73216),o=s(35475),d=s(93747),c=s(58387),u=s(72018),m=s(2028),h=s(56328),x=s(9642),p=s(64824);const v="service-history_gobackBtn__f4UBY",g="service-history_filterBox__xhkUD",f="service-history_active__KqGya",b="service-history_selectedCount__oBu1x",y="service-history_vehicleName__5fSpq",j="service-history_upcomingDefault__ykVRS",_="service-history_upcomingSoon__5LDv3",N="service-history_upcomingMonth__eOK8E",w="service-history_overdue__RnHTu",S="service-history_newButton__ELDEF";var A=s(37990),C=s(48417),k=s(14834),D=s(27734),E=s(99868),I=s(70579);const F=e=>{if(!e)return"-";const t=new Date(1e3*+e);return new Intl.DateTimeFormat("en-AU",{timeZone:"Australia/Sydney",day:"numeric",month:"short",year:"numeric"}).format(t)},O=(0,r.forwardRef)(((e,t)=>{let{selected:s,setSelected:l,searchValue:i,refetch:n}=e;const{id:o}=(0,a.g)(),{trialHeight:d}=(0,C.$)(),c=(0,r.useRef)(null),[u,m]=(0,r.useState)([]),[h,v]=(0,r.useState)(1),[g,f]=(0,r.useState)({sortField:"date",sortOrder:-1}),[b,y]=(0,r.useState)({sortField:"date",sortOrder:-1}),[S,O]=(0,r.useState)(!0),[V,R]=(0,r.useState)(!1);(0,r.useEffect)((()=>{O(!0),v(1)}),[i,n]),(0,r.useEffect)((()=>{o&&(async()=>{R(!0);let e="";1===(null===b||void 0===b?void 0:b.sortOrder)?e=`${b.sortField}`:-1===(null===b||void 0===b?void 0:b.sortOrder)&&(e=`-${b.sortField}`);try{var t;const r=await(0,A.bX)(o,h,25,i,e);var s;if(1===h)m((null===r||void 0===r?void 0:r.results)||[]);else(null===r||void 0===r||null===(s=r.results)||void 0===s?void 0:s.length)>0&&m((e=>{const t=new Set(e.map((e=>e.id))),s=r.results.filter((e=>!t.has(e.id)));return[...e,...s]}));f(b),O(25===(null===r||void 0===r||null===(t=r.results)||void 0===t?void 0:t.length))}catch(r){console.error("Error fetching services:",r)}finally{R(!1)}})()}),[o,h,i,b,n]),(0,r.useEffect)((()=>{if((null===u||void 0===u?void 0:u.length)>0&&S){c.current=new IntersectionObserver((e=>{e[0].isIntersecting&&!V&&v((e=>e+1))}));const e=document.querySelector(".p-datatable-tbody tr:not(.p-datatable-emptymessage):last-child");e&&c.current.observe(e)}return()=>{c.current&&c.current.disconnect()}}),[u,S,V]);return(0,I.jsxs)(p.b,{ref:t,value:u,scrollable:!0,selectionMode:"checkbox",columnResizeMode:"expand",resizableColumns:!0,showGridlines:!0,size:"large",scrollHeight:`calc(100vh - 175px - ${d}px)`,className:"border",selection:s,onSelectionChange:e=>l(e.value),loading:V,loadingIcon:D.A,emptyMessage:(0,I.jsx)(E.A,{isDataExist:!(null===u||void 0===u||!u.length)}),sortField:null===g||void 0===g?void 0:g.sortField,sortOrder:null===g||void 0===g?void 0:g.sortOrder,onSort:e=>{const{sortField:t,sortOrder:s}=e;v(1),O(!0),y({sortField:t,sortOrder:s})},children:[(0,I.jsx)(x.V,{selectionMode:"multiple",headerClassName:"ps-4",bodyClassName:"show-on-hover border-right-0 ps-4",headerStyle:{width:"3rem",textAlign:"center",border:"none"},frozen:!0}),(0,I.jsx)(x.V,{field:"number",header:"Service ID",body:e=>(0,I.jsxs)("div",{className:"d-flex flex-column",style:{lineHeight:"1.385"},children:[(0,I.jsx)("span",{style:{fontWeight:"500"},children:e.id||"-"}),(0,I.jsx)("span",{className:"font-12",style:{color:"#98A2B3"},children:e.date?F(e.date):"-"})]}),frozen:!0,sortable:!0,style:{minWidth:"150px",width:"150px",maxWidth:"150px"},headerClassName:"shadowRight",bodyClassName:"shadowRight"}),(0,I.jsx)(x.V,{field:"number",header:"Expense",style:{minWidth:"150px",width:"150px",maxWidth:"150px"}}),(0,I.jsx)(x.V,{field:"odometer_km",header:"Odometer (km)",body:e=>{var t;return(0,I.jsx)("span",{children:e.odometer_km?`${null===(t=e.odometer_km)||void 0===t?void 0:t.toLocaleString()} km`:"-"})},sortable:!0,style:{minWidth:"200px",maxWidth:"200px",width:"200px"},bodyClassName:"text-end"}),(0,I.jsx)(x.V,{field:"date",header:"Service Date",body:e=>(0,I.jsx)("span",{children:e.date?F(e.date):"-"}),sortable:!0,style:{minWidth:"150px",maxWidth:"150px",width:"150px"}}),(0,I.jsx)(x.V,{field:"upcoming_date",header:"Upcoming Service",body:e=>{if(!e.upcoming_date)return"-";const t=new Date(e.upcoming_date)-new Date,s=Math.ceil(t/864e5);let r=j;return s<0?r=w:s<=7?r=_:s<=30&&(r=N),F(e.upcoming_date)},sortable:!0,style:{minWidth:"150px",maxWidth:"150px",width:"150px"}}),(0,I.jsx)(x.V,{field:"cost",header:"Cost",body:e=>(0,I.jsxs)("span",{className:"text-end d-block",style:{fontWeight:"500"},children:["$",(0,k.m)(e.cost||0)]}),sortable:!0,style:{minWidth:"200px",maxWidth:"200px",width:"200px"},bodyClassName:"text-end"}),(0,I.jsx)(x.V,{field:"notes",header:"Notes",body:e=>{if(!e.notes)return"-";const t=e.notes.length>50?`${e.notes.substring(0,50)}...`:e.notes;return(0,I.jsx)("span",{title:e.notes,style:{fontSize:"13px",color:"#667085"},children:t})},style:{minWidth:"250px"}})]})}));O.displayName="ServiceHistoryTable";const V=O;var R=s(14282),T=s(93202),B=s(56741),M=s(47097),z=s(93740),W=s(20288);const q="create-new-service_circledesignstyle__MM18I",$="create-new-service_out__BsvvZ";var Y=s(62284),G=s(61072),L=s(78602),P=s(9634),H=s(24858),U=s(18403),K=s(85371),Z=s(28676),Q=s(74532),X=s(79255),J=s(27932),ee=s(80899),te=s(61046),se=s(27472);const re=ee.Ik({odometer_km:ee.ai().required("Odometer reading is required").min(0,"Odometer cannot be negative"),date:ee.p6().required("Date is required").nullable(),upcoming_date:ee.p6().required("Upcoming date is required").min(ee.KR("date"),"Upcoming date must be after service date"),notes:ee.Yj().max(500,"Notes must be at most 500 characters")}),le=(0,r.forwardRef)(((e,t)=>{var s;let{onSubmit:l,defaultValues:i,setIsDisabled:n,setExpenseService:a,vehicleId:o}=e;const u=(null===(s=(0,d.I)({queryKey:["getVehicle",o],queryFn:()=>(0,A.Dh)(o),enabled:!!o,staleTime:0}).data)||void 0===s?void 0:s.odometer_km)||0,{control:m,register:h,handleSubmit:x,watch:p,formState:{errors:v}}=(0,H.mN)({resolver:(0,U.t)(re),defaultValues:{odometer_km:0,cost:0,...i}}),g=p("odometer_km"),f=p("date"),b=p("upcoming_date");return(0,r.useEffect)((()=>{n(!(g&&f&&b)),a({odometer_km:g,date:f,upcoming_date:b,notes:p("notes")||""})}),[g,f,b,n]),(0,I.jsxs)("form",{ref:t,onSubmit:x(l),children:[(0,I.jsx)(G.A,{children:(0,I.jsx)(L.A,{sm:12,children:(0,I.jsx)("h2",{className:te.A.sectionTitle,children:"Service Information"})})}),(0,I.jsxs)(G.A,{className:(0,c.A)(te.A.bgGreay),children:[(0,I.jsx)(L.A,{sm:12,children:(0,I.jsxs)("div",{className:"d-flex flex-column mb-4",children:[(0,I.jsxs)("label",{className:(0,c.A)(te.A.lable),children:["Odometer (Minimum ",u," km) ",(0,I.jsx)("span",{className:"required",children:"*"})]}),(0,I.jsxs)("div",{className:te.A.inputGroup,children:[(0,I.jsx)(H.xI,{name:"odometer_km",control:m,render:e=>{let{field:t}=e;return(0,I.jsx)(X.Y,{value:t.value,onValueChange:e=>t.onChange(e.value),className:(0,c.A)(te.A.inputText,{[te.A.error]:v.odometer_km},"p-0"),placeholder:"Enter odometer reading",useGrouping:!1,min:u+1||0},u)}}),(0,I.jsx)("span",{className:te.A.unitText,children:"km"})]}),v.odometer_km&&(0,I.jsx)("p",{className:"error-message",children:v.odometer_km.message})]})}),(0,I.jsx)(L.A,{sm:6,children:(0,I.jsxs)("div",{className:"d-flex flex-column gap-1 mb-4",children:[(0,I.jsxs)("label",{className:(0,c.A)(te.A.lable),children:["Date ",(0,I.jsx)("span",{className:"required",children:"*"})]}),(0,I.jsx)(H.xI,{name:"date",control:m,render:e=>{let{field:t}=e;return(0,I.jsx)(K.V,{...t,value:t.value?new Date(t.value):null,onChange:e=>t.onChange(e.value),showButtonBar:!0,placeholder:"DD/MM/YYYY",dateFormat:"dd/mm/yy",showIcon:!0,style:{height:"46px"},icon:(0,I.jsx)(P.A,{color:"#667085",size:20}),className:(0,c.A)(te.A.inputText,{[te.A.error]:v.date},"p-0 outline-none")})}}),v.date&&(0,I.jsx)("p",{className:"error-message",children:v.date.message})]})}),(0,I.jsx)(L.A,{sm:6,children:(0,I.jsxs)("div",{className:"d-flex flex-column gap-1 mb-4",children:[(0,I.jsxs)("label",{className:(0,c.A)(te.A.lable),children:["Upcoming Date ",(0,I.jsx)("span",{className:"required",children:"*"})]}),(0,I.jsx)(H.xI,{name:"upcoming_date",control:m,render:e=>{let{field:t}=e;return(0,I.jsx)(K.V,{...t,value:t.value?new Date(t.value):null,onChange:e=>t.onChange(e.value),showButtonBar:!0,placeholder:"DD/MM/YYYY",dateFormat:"dd/mm/yy",showIcon:!0,style:{height:"46px"},icon:(0,I.jsx)(P.A,{color:"#667085",size:20}),className:(0,c.A)(te.A.inputText,{[te.A.error]:v.upcoming_date},"p-0 outline-none")})}}),v.upcoming_date&&(0,I.jsx)("p",{className:"error-message",children:v.upcoming_date.message})]})}),(0,I.jsx)(L.A,{sm:12,children:(0,I.jsxs)("div",{className:"d-flex flex-column gap-1 mb-4",children:[(0,I.jsx)("label",{className:(0,c.A)(te.A.lable),children:"Notes"}),(0,I.jsxs)(Z.C,{children:[(0,I.jsx)(Q.m,{children:v.notes&&(0,I.jsx)("img",{src:se.A,className:"mb-3",alt:"error"})}),(0,I.jsx)(J.Z,{...h("notes"),className:(0,c.A)(te.A.inputText,{[te.A.error]:v.notes}),placeholder:"Enter service notes",rows:4,autoResize:!0})]}),v.notes&&(0,I.jsx)("p",{className:"error-message",children:v.notes.message})]})})]})]})})),ie=e=>{let{visible:t,setVisible:s,setRefetch:l,vehicleId:i=1}=e;const n=(0,r.useRef)(null),{id:o}=(0,a.g)(),d=(0,a.Zp)(),[c]=(0,r.useState)({}),[u,m]=(0,r.useState)(!0),[x,p]=(0,r.useState)(!1),[v,g]=(0,r.useState)(null),[f,b]=(0,r.useState)(!1),y=(0,M.n)({mutationFn:e=>{const t={...e,date:e.date?new Date(e.date).toISOString().split("T")[0]:null,upcoming_date:e.upcoming_date?new Date(e.upcoming_date).toISOString().split("T")[0]:null};return(0,A.QL)(i,t)},onSuccess:e=>{console.log("Service created successfully:",e),h.oR.success("Service created successfully"),s(!1),l&&l((e=>!e)),d("/assets?type=vehicles")},onError:e=>{var t;console.error("Error creating service:",e);const s=(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to create service. Please try again.";h.oR.error(s)}});function j(e){if(!e)return"";return`${(e=new Date(e)).getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}const _=async e=>{e.date=j(e.date),e.upcoming_date=j(e.upcoming_date),y.mutate(e)},N=()=>{n.current&&n.current.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))};return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(W.B,{visible:t,position:"right",onHide:()=>s(!1),modal:!1,dismissable:!1,style:{width:"702px"},content:e=>{let{closeIconRef:t,hide:r}=e;return(0,I.jsxs)("div",{className:"create-sidebar d-flex flex-column",children:[(0,I.jsxs)("div",{className:"d-flex align-items-center justify-content-between flex-shrink-0",style:{borderBottom:"1px solid #EAECF0",padding:"16px 24px"},children:[(0,I.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,I.jsx)("div",{className:q,children:(0,I.jsx)("div",{className:$,children:(0,I.jsx)(T.A,{size:24,color:"#17B26A"})})}),(0,I.jsx)("span",{style:{color:"#344054",fontSize:"20px",fontWeight:600},children:"Add New Service"})]}),(0,I.jsx)("span",{children:(0,I.jsx)(R.A,{type:"button",className:"text-button",ref:t,onClick:e=>r(e),children:(0,I.jsx)(B.A,{size:24,color:"#667085"})})})]}),(0,I.jsx)("div",{className:"modal-body",style:{padding:"24px",height:"calc(100vh - 72px - 105px)",overflow:"auto"},children:(0,I.jsx)(le,{ref:n,onSubmit:_,defaultValues:c,setIsDisabled:m,setExpenseService:b,vehicleId:o})}),(0,I.jsxs)("div",{className:"modal-footer d-flex align-items-center justify-content-between gap-3",style:{padding:"16px 24px",borderTop:"1px solid var(--Gray-200, #EAECF0)",height:"72px"},children:[(0,I.jsx)(R.A,{type:"button",onClick:e=>{e.stopPropagation(),s(!1)},className:"outline-button",children:"Cancel"}),(0,I.jsxs)("div",{className:"d-flex align-items-center gap-3",children:[(0,I.jsx)(R.A,{type:"button",disabled:u,className:"outline-button",onClick:()=>{p(!0),g({type:1,id:+o})},children:"Create Expense and Save"}),(0,I.jsx)(R.A,{type:"button",disabled:y.isPending||u,onClick:N,className:"solid-button",style:{minWidth:"75px"},children:y.isPending?(0,I.jsx)(z.p,{style:{width:"20px",height:"20px"}}):"Save"})]})]})]})}}),x&&v.id&&v.type&&(0,I.jsx)(Y.A,{visible:x,setVisible:p,createNewService:!0,createServiceFromExpense:e=>{f&&(f.expense=e,y.mutate(f))},assetForExpense:v,setRefetch:l})]})},ne=()=>{var e,t,s,x;const{id:p}=(0,a.g)(),j=(0,a.Zp)(),_=(0,r.useRef)(null),[N,w]=(0,r.useState)(null),[C,k,D]=(0,m.d7)("",400),[E,F]=(0,r.useState)(!0),[O,R]=(0,r.useState)(!1),T=(0,d.I)({queryKey:["vehicle",p],queryFn:()=>(0,A.Dh)(p),enabled:!!p,retry:1,cacheTime:0});return"Not found"===(null===T||void 0===T||null===(e=T.error)||void 0===e?void 0:e.message)&&(h.oR.error("Vehicle not found"),j("/assets?type=vehicles")),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(n.mg,{children:(0,I.jsxs)("title",{children:["Service History - ",(null===T||void 0===T||null===(t=T.data)||void 0===t?void 0:t.registration_number)||"Vehicle"]})}),(0,I.jsx)("div",{className:"service-history-page",children:(0,I.jsxs)("div",{className:"service-history",style:{width:"100%"},children:[(0,I.jsxs)("div",{className:`topbar ${null!==N&&void 0!==N&&N.length?f:""}`,style:{padding:"4px 32px 4px 23px",position:"relative",height:"48px"},children:[(0,I.jsx)("div",{className:"left-side d-flex align-items-center",style:{gap:"16px"},children:null!==N&&void 0!==N&&N.length?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("h6",{className:b,children:["Selected: ",null===N||void 0===N?void 0:N.length]}),(0,I.jsx)("div",{className:"filtered-box",children:(0,I.jsx)("button",{className:`${g}`,onClick:()=>{return e=!0,void(_.current?_.current.exportCSV({selectionOnly:e}):console.error("DataTable ref is null"));var e},children:(0,I.jsx)(l.A,{})})})]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(o.N_,{to:"/assets?type=vehicles",className:`${v}`,children:[(0,I.jsx)(i.A,{color:"#106b99",size:20})," Go Back"]}),(0,I.jsxs)("div",{className:"searchBox",style:{position:"relative"},children:[(0,I.jsx)("div",{style:{position:"absolute",top:"2px",left:"6px"},children:(0,I.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:(0,I.jsx)("path",{d:"M14.6777 12.9299C15.6661 11.5841 16.25 9.92275 16.25 8.125C16.25 3.63769 12.6123 0 8.125 0C3.63769 0 0 3.63769 0 8.125C0 12.6123 3.63769 16.25 8.125 16.25C9.92323 16.25 11.585 15.6658 12.9309 14.6769L12.9299 14.6777C12.9667 14.7277 13.0078 14.7756 13.053 14.8208L17.8661 19.6339C18.3543 20.122 19.1457 20.122 19.6339 19.6339C20.122 19.1457 20.122 18.3543 19.6339 17.8661L14.8208 13.053C14.7756 13.0078 14.7277 12.9667 14.6777 12.9299ZM15 8.125C15 11.922 11.922 15 8.125 15C4.32804 15 1.25 11.922 1.25 8.125C1.25 4.32804 4.32804 1.25 8.125 1.25C11.922 1.25 15 4.32804 15 8.125Z",fill:"#98A2B3"})})}),(0,I.jsx)("input",{type:"text",placeholder:"Search",value:C,onChange:e=>D(e.target.value),className:"border search-resource",style:{borderRadius:"4px",width:"184px",border:"1px solid #D0D5DD",color:"#424242",paddingLeft:"36px",fontSize:"14px",height:"32px"}})]})]})}),(0,I.jsx)("div",{className:"featureName d-flex align-items-center",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:(0,I.jsx)("h1",{className:(0,c.A)(y,"m-0 p-0"),title:null===T||void 0===T||null===(s=T.data)||void 0===s?void 0:s.registration_number,children:(null===T||void 0===T||null===(x=T.data)||void 0===x?void 0:x.registration_number)||"Loading..."})}),(0,I.jsx)("div",{className:"right-side d-flex align-items-center",style:{gap:"8px"},children:(0,I.jsx)(u.$,{onClick:()=>F(!0),className:`${S}`,children:"New Service"})})]}),(0,I.jsx)(V,{ref:_,selected:N,setSelected:w,searchValue:k,refetch:O})]})}),(0,I.jsx)(ie,{visible:E,setVisible:F,setRefetch:R,vehicleId:p})]})}},61046:(e,t,s)=>{s.d(t,{A:()=>r});const r={sectionTitle:"vehicle-form_sectionTitle__oCFoK",bgGreay:"vehicle-form_bgGreay__ScM6U",lable:"vehicle-form_lable__61kdI",inputText:"vehicle-form_inputText__4fVSj",error:"vehicle-form_error__aD6HI",headingInputs:"vehicle-form_headingInputs__kPF2t",dropdownSelect:"vehicle-form_dropdownSelect__RSqX8",inputGroup:"vehicle-form_inputGroup__KlaAw","p-inputnumber":"vehicle-form_p-inputnumber__gBeQY","p-inputtext":"vehicle-form_p-inputtext__GQdsO",unitText:"vehicle-form_unitText__wsry3",expensesCreateNew:"vehicle-form_expensesCreateNew__CWBMR"}},77918:(e,t,s)=>{s.d(t,{A:()=>d});var r=s(65043),l=s(65173),i=s.n(l),n=["color","size","title","className"];function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)({}).hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},a.apply(null,arguments)}var o=(0,r.forwardRef)((function(e,t){var s=e.color,l=void 0===s?"currentColor":s,i=e.size,o=void 0===i?"1em":i,d=e.title,c=void 0===d?null:d,u=e.className,m=void 0===u?"":u,h=function(e,t){if(null==e)return{};var s,r,l=function(e,t){if(null==e)return{};var s={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;s[r]=e[r]}return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)s=i[r],t.includes(s)||{}.propertyIsEnumerable.call(e,s)&&(l[s]=e[s])}return l}(e,n);return r.createElement("svg",a({ref:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:o,height:o,fill:l,className:["bi","bi-info-circle",m].filter(Boolean).join(" ")},h),c?r.createElement("title",null,c):null,r.createElement("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"}),r.createElement("path",{d:"m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"}))}));o.propTypes={color:i().string,size:i().oneOfType([i().string,i().number]),title:i().string,className:i().string};const d=o}}]);
//# sourceMappingURL=8564.cd3f3b5f.chunk.js.map